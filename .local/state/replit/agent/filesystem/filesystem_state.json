{"file_contents":{"client/src/pages/Game.tsx":{"content":"import { useEffect, useState, useRef, useMemo, useCallback } from \"react\";\nimport { useGameEngine } from \"@/hooks/useGameEngine\";\nimport { useGameStore } from \"@/stores/useGameStore\";\nimport { Difficulty, Note } from \"@/lib/engine/gameTypes\";\nimport { parseBeatmap } from \"@/lib/beatmap/beatmapParser\";\nimport { convertBeatmapNotes } from \"@/lib/beatmap/beatmapConverter\";\n\nimport { useYouTubePlayer } from \"@/hooks/useYoutubePlayer\";\nimport { useGameLogic } from \"@/hooks/useGameLogic\";\nimport { GameOverScreen } from \"@/components/screens/GameOverScreen\";\nimport { PauseMenu } from \"@/components/ui/HUD/PauseMenu\";\nimport { ResumeOverlay } from \"@/components/screens/ResumeOverlay\";\nimport { HealthDisplay } from \"@/components/ui/HUD/HealthDisplay\";\nimport { ScoreDisplay } from \"@/components/ui/HUD/ScoreDisplay\";\nimport { ComboDisplay } from \"@/components/ui/HUD/ComboDisplay\";\nimport { ErrorIndicator } from \"@/components/ui/HUD/ErrorIndicator\";\nimport { ControlsHint } from \"@/components/ui/HUD/ControlsHint\";\nimport { VisualEffects } from \"@/components/game/effects/VisualEffects\";\nimport { DeckHoldMeters } from \"@/components/game/hud/DeckHoldMeters\";\nimport { CamelotWheel } from \"@/components/game/effects/CamelotWheel\";\nimport { Down3DNoteLane } from \"@/components/game/Down3DNoteLane\";\nimport { ErrorLogViewer } from \"@/components/game/loaders/ErrorLogViewer\";\n\ninterface GameProps {\n  difficulty: Difficulty;\n  onBackToHome?: () => void;\n  playerInitializedRef: React.RefObject<boolean>;\n  youtubeVideoId?: string | null;\n}\n\nfunction Game({ difficulty, onBackToHome, playerInitializedRef, youtubeVideoId: propYoutubeVideoId }: GameProps) {\n  const [youtubeVideoId, setYoutubeVideoId] = useState<string | null>(null);\n  const [customNotes, setCustomNotes] = useState<Note[] | undefined>();\n  const setBeatmapBpm = useGameStore(state => state.setBeatmapBpm);\n\n  // Store startGame in ref for use in callbacks\n  const startGameRef = useRef<(() => void) | null>(null);\n  const engineRefForLogic = useRef<any>(null);\n\n  // YouTube hook first â€“ provides getVideoTime with caching\n  const { getVideoTime, resetTime, seek, isReady } = useYouTubePlayer({\n    videoId: youtubeVideoId,\n    playerInitializedRef\n  });\n  \n  // Callback when YouTube confirms playing - triggers game start\n  const handleYouTubePlaying = useCallback(() => {\n    startGameRef.current?.();\n  }, []);\n\n  // Game engine - receives YouTube time via hook (with caching)\n  const { \n    gameState, \n    score, \n    combo, \n    health, \n    notes, \n    currentTime, \n    isPaused,\n    startGame, \n    hitNote,\n    trackHoldStart,\n    trackHoldEnd,\n    resumeGame,\n    restartGame,\n    setGameState\n  } = useGameEngine({ \n    difficulty, \n    customNotes, \n    getVideoTime\n  });\n\n  // Store refs for callbacks\n  useEffect(() => {\n    startGameRef.current = startGame;\n  }, [startGame]);\n\n  useEffect(() => {\n    engineRefForLogic.current = { \n      getCurrentTime: () => currentTime,\n      resetTime: resetTime // Expose resetTime to logic\n    };\n  }, [currentTime, resetTime]);\n\n  // Function to play YouTube when auto-start triggers (before game starts)\n  const onPlayYouTube = useCallback(async () => {\n    try {\n      const { playYouTubeVideo } = await import('@/lib/youtube');\n      await playYouTubeVideo();\n      console.log('[AUTO-START] YouTube video playing - calling onPlaying callback');\n      // YouTube is confirmed playing - trigger game start\n      handleYouTubePlaying();\n    } catch (err) {\n      console.error('[AUTO-START] YouTube play failed:', err);\n    }\n  }, [handleYouTubePlaying]);\n\n  // Game logic hooks (pause, keys, sync, errors)\n  const {\n    isPauseMenuOpen,\n    resumeFadeOpacity,\n    gameErrors,\n    handleLeftDeckSpin,\n    handleRightDeckSpin,\n    handleResume,\n    handleRewind\n  } = useGameLogic({\n    gameState,\n    currentTime,\n    isPaused,\n    notes,\n    getVideoTime,\n    resumeGame,\n    restartGame,\n    startGame,\n    setGameState,\n    setCurrentTime: () => {},\n    hitNote,\n    trackHoldStart,\n    trackHoldEnd,\n    customNotes,\n    engineRef: engineRefForLogic,\n    onHome: onBackToHome,\n    youtubeIsReady: youtubeVideoId ? isReady : true, // If no YouTube video, consider ready; otherwise wait for YouTube\n    youtubeVideoId,\n    onPlayYouTube\n  });\n\n  // Memoized values - ensure notes is always an array\n  const missCount = useMemo(() => (notes || []).filter(n => n.missed).length, [notes]);\n  const scoreDisplay = useMemo(() => score.toString().padStart(6, '0'), [score]);\n\n  // Load beatmap from localStorage and re-parse with new difficulty\n  useEffect(() => {\n    const pendingBeatmapStr = localStorage.getItem('pendingBeatmap');\n    if (pendingBeatmapStr) {\n      try {\n        const beatmapData = JSON.parse(pendingBeatmapStr);\n        setYoutubeVideoId(beatmapData.youtubeVideoId || null);\n        \n        // Re-parse beatmap with the new difficulty to get correct notes\n        if (beatmapData.beatmapText) {\n          const parsed = parseBeatmap(beatmapData.beatmapText, difficulty);\n          if (!parsed.error && parsed.notes) {\n            const beatmapStartOffset = parsed.metadata?.beatmapStart || 0;\n            const convertedNotes = convertBeatmapNotes(parsed.notes, beatmapStartOffset);\n            setCustomNotes(convertedNotes);\n            // Update beatmap BPM for geometry calculations\n            if (parsed.metadata?.bpm) {\n              setBeatmapBpm(parsed.metadata.bpm);\n            }\n          }\n        }\n      } catch (error) {\n        console.error('Failed to load pending beatmap:', error);\n      }\n    }\n  }, [difficulty]); // Re-parse when difficulty changes\n\n  // Reset ALL game state and YouTube player when difficulty changes\n  useEffect(() => {\n    const resetAll = async () => {\n      // Full game state reset: score, combo, health, isPaused, notes, currentTime\n      restartGame();\n      // Reset YouTube player to time 0\n      resetTime();\n      // Seek player to beginning (seekYouTubeVideo is async)\n      await seek(0);\n    };\n    resetAll().catch(() => {\n      // Silently fail on seek errors - game can continue\n    });\n  }, [difficulty, restartGame, resetTime, seek]);\n\n  if (gameState === 'GAME_OVER') {\n    return <GameOverScreen onRestart={() => window.location.reload()} />;\n  }\n\n  return (\n    <div className=\"h-screen w-screen overflow-hidden flex flex-col relative\">\n      {/* Resume Overlay */}\n      <ResumeOverlay visible={gameState === 'RESUMING'} opacity={resumeFadeOpacity} />\n\n      {/* Visual Effects */}\n      <VisualEffects combo={combo} health={health} missCount={missCount} />\n\n      {/* Background */}\n      <div className=\"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-900 via-black to-black opacity-40\" />\n      <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-5 mix-blend-overlay\" />\n\n      {/* Pause Menu - Show immediately when PAUSED, rely on gameState for sync */}\n      {gameState === 'PAUSED' && (\n        <PauseMenu\n          onHome={onBackToHome}\n          onResume={handleResume}\n          onRewind={handleRewind}\n        />\n      )}\n\n      {/* HUD Header */}\n      <header className=\"relative z-10 flex justify-between items-center p-6 border-b border-white/10 bg-black/50 backdrop-blur-sm\">\n        <div className=\"flex items-center gap-4\">\n          <HealthDisplay health={health} />\n          <ErrorIndicator count={gameErrors.length} />\n        </div>\n        <ScoreDisplay score={scoreDisplay} />\n        <ComboDisplay combo={combo} />\n      </header>\n\n      {/* Main Game Area */}\n      <main className=\"flex-1 relative z-10 flex items-center justify-center px-4\">\n        <div className=\"absolute left-8\">\n          <CamelotWheel side=\"left\" onSpin={handleLeftDeckSpin} />\n        </div>\n        <div className=\"absolute left-[200px] right-[200px] top-1/2 -translate-y-1/2 h-48\">\n          <DeckHoldMeters notes={notes} currentTime={Math.round(currentTime)} />\n        </div>\n        <div className=\"relative flex-1 flex items-center justify-center\">\n          <Down3DNoteLane \n            health={health}\n            combo={combo}\n            onPadHit={hitNote}\n          />\n        </div>\n        <div className=\"absolute right-8\">\n          <CamelotWheel side=\"right\" onSpin={handleRightDeckSpin} />\n        </div>\n      </main>\n\n      {/* Controls Hint */}\n      <ControlsHint />\n\n      {/* Error Log */}\n      <ErrorLogViewer />\n    </div>\n  );\n}\n\nexport default Game;","path":null,"size_bytes":8482,"size_tokens":null},"client/src/components/FailureBreakdownSection.tsx":{"content":"export function FailureBreakdownSection({ hitStats }: any) {\n  return (\n    <div className=\"space-y-2\">\n      <h3 className=\"text-sm font-semibold\">Failure Breakdown</h3>\n      <div className=\"grid grid-cols-2 gap-2 text-xs\">\n        <div>Miss Failures: {hitStats?.tapMissFailures || 0}</div>\n        <div>Too Early: {hitStats?.tooEarlyFailures || 0}</div>\n        <div>Hold Miss: {hitStats?.holdMissFailures || 0}</div>\n        <div>Hold Release: {hitStats?.holdReleaseFailures || 0}</div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":522,"size_tokens":null},"client/src/stores/useYoutubeStore.ts":{"content":"import { create } from 'zustand';\n\ninterface YoutubeStoreState {\n  ytPlayer: any;\n  youtubeIframeElement: HTMLIFrameElement | null;\n  youtubeCurrentTimeMs: number;\n  lastTimeUpdate: number;\n  playerReady: boolean;\n  lastGoodTimeMs: number | null;\n\n  // Actions\n  setYtPlayer: (player: any) => void;\n  setYoutubeIframeElement: (element: HTMLIFrameElement | null) => void;\n  setYoutubeCurrentTimeMs: (time: number) => void;\n  setLastTimeUpdate: (time: number) => void;\n  setPlayerReady: (ready: boolean) => void;\n}\n\nexport const useYoutubeStore = create<YoutubeStoreState>((set) => ({\n  ytPlayer: null,\n  youtubeIframeElement: null,\n  youtubeCurrentTimeMs: 0,\n  lastTimeUpdate: 0,\n  playerReady: false,\n  lastGoodTimeMs: null,\n\n  setYtPlayer: (ytPlayer) => set({ ytPlayer }),\n  setYoutubeIframeElement: (youtubeIframeElement) => set({ youtubeIframeElement }),\n  setYoutubeCurrentTimeMs: (youtubeCurrentTimeMs) => set((state) => ({\n    youtubeCurrentTimeMs,\n    lastGoodTimeMs: youtubeCurrentTimeMs >= 0 ? youtubeCurrentTimeMs : state.lastGoodTimeMs\n  })),\n  setLastTimeUpdate: (lastTimeUpdate) => set({ lastTimeUpdate }),\n  setPlayerReady: (playerReady) => set({ playerReady }),\n}));\n\n// Export selectors/getters for non-React usage\nexport const getYoutubeStore = () => useYoutubeStore.getState();\n","path":null,"size_bytes":1296,"size_tokens":null},"client/src/lib/beatmap/beatmapParser.ts":{"content":"import type { Note } from '@/types/game';\n\nexport interface BeatmapMetadata {\n  title?: string;\n  artist?: string;\n  bpm?: number;\n  duration?: number;\n  youtube?: string;\n  beatmapStart?: number;\n  beatmapEnd?: number;\n}\n\nexport interface BeatmapData {\n  metadata: BeatmapMetadata;\n  notes: any[]; // Raw notes to be converted\n  youtubeVideoId?: string;\n  error?: string;\n}\n\nexport function parseBeatmap(text: string, difficulty: 'EASY' | 'MEDIUM' | 'HARD' = 'MEDIUM'): BeatmapData {\n  try {\n    // Check if it's JSON first (backward compatibility)\n    if (text.trim().startsWith('{')) {\n      const parsed = JSON.parse(text);\n      return {\n        metadata: parsed.metadata || {},\n        notes: Array.isArray(parsed.notes) ? parsed.notes : [],\n        youtubeVideoId: parsed.metadata?.youtube,\n      };\n    }\n\n    // Parse custom text format\n    const lines = text.split('\\n').map(l => l.trim()).filter(l => l);\n    const metadata: BeatmapMetadata = {};\n    const notes: any[] = [];\n    let currentSection = '';\n\n    for (const line of lines) {\n      if (line.startsWith('[') && line.endsWith(']')) {\n        currentSection = line.slice(1, -1);\n        continue;\n      }\n\n      if (currentSection === 'METADATA') {\n        const [key, ...valueParts] = line.split(':');\n        if (key && valueParts.length > 0) {\n          const value = valueParts.join(':').trim();\n          const k = key.trim().toLowerCase();\n          if (k === 'title') metadata.title = value;\n          if (k === 'artist') metadata.artist = value;\n          if (k === 'bpm') metadata.bpm = parseFloat(value);\n          if (k === 'duration') metadata.duration = parseInt(value);\n          if (k === 'youtube') metadata.youtube = value;\n          if (k === 'beatmapstart') metadata.beatmapStart = parseInt(value);\n          if (k === 'beatmapend') metadata.beatmapEnd = parseInt(value);\n        }\n      } else if (currentSection === difficulty) {\n        // Parse note line: time|lane|type|duration|id\n        const parts = line.split('|');\n        if (parts.length >= 3) {\n          const time = parseInt(parts[0]);\n          const lane = parseInt(parts[1]);\n          const type = parts[2].toUpperCase();\n          \n          if (!isNaN(time) && !isNaN(lane)) {\n            const note: any = { time, lane, type };\n            \n            if (type === 'HOLD' && parts.length >= 4) {\n              note.duration = parseInt(parts[3]);\n            }\n            \n            // Optional ID\n            if (parts.length >= 5) {\n              note.id = parts[4];\n            }\n\n            notes.push(note);\n          }\n        }\n      }\n    }\n\n    return {\n      metadata,\n      notes,\n      youtubeVideoId: metadata.youtube,\n    };\n  } catch (e: unknown) {\n    const errorMsg = e instanceof Error ? e.message : 'Unknown parsing error';\n    console.error(\"Failed to parse beatmap:\", errorMsg);\n    return { metadata: {}, notes: [], error: `Parse error: ${errorMsg}` };\n  }\n}\n","path":null,"size_bytes":2947,"size_tokens":null},"client/src/lib/config/queryClient.ts":{"content":"import { QueryClient } from \"@tanstack/react-query\";\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":232,"size_tokens":null},"client/src/hooks/useGameConfig.ts":{"content":"// src/hooks/useGameConfig.ts\nimport { Difficulty, GameConfig } from '@/lib/engine/gameTypes';\nimport { GAME_CONFIG } from '@/lib/config/gameConstants';\n\nexport function useGameConfig(_difficulty: Difficulty): GameConfig {\n  // Returns game config from single source of truth (gameConstants.ts)\n  return GAME_CONFIG as GameConfig;\n}","path":null,"size_bytes":332,"size_tokens":null},"client/src/components/ui/HUD/PauseMenu.tsx":{"content":"// src/components/PauseMenu.tsx\nimport React, { memo } from 'react';\nimport { motion } from \"framer-motion\";\nimport { useGameStore } from '@/stores/useGameStore';\n\ninterface PauseMenuProps {\n  onHome?: () => void;\n  countdownSeconds?: number;\n  onResume?: () => void;\n  onRewind?: () => void;\n}\n\nconst PauseMenuComponent = ({ \n  onHome: propOnHome, \n  onResume, \n  onRewind \n}: PauseMenuProps = {}) => {\n  const isPaused = useGameStore(state => state.isPaused);\n  const countdownSeconds = useGameStore(state => state.countdownSeconds);\n  const resumeGameStore = useGameStore(state => state.resumeGame);\n  const rewindGameStore = useGameStore(state => state.rewindGame);\n\n  // Prefer props if available for complex logic (countdown, async seek), fallback to store\n  const handleResume = onResume || resumeGameStore;\n  const handleRewind = onRewind || rewindGameStore;\n\n  if (!isPaused) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center\" data-testid=\"pause-menu-container\">\n      <div className=\"text-center space-y-8\">\n        {countdownSeconds > 0 ? (\n          <>\n            <motion.div\n              className=\"text-9xl font-orbitron text-neon-cyan neon-glow\"\n              animate={{ scale: [1, 1.2, 1], textShadow: ['0 0 20px hsl(180, 100%, 50%)', '0 0 40px hsl(180, 100%, 50%)', '0 0 20px hsl(180, 100%, 50%)'] }}\n              transition={{ duration: 1, repeat: Infinity }}\n              key={countdownSeconds}\n              data-testid=\"countdown-display\"\n            >\n              {countdownSeconds}\n            </motion.div>\n            <p className=\"text-neon-cyan font-rajdhani text-lg\" data-testid=\"text-get-ready\">GET READY!</p>\n          </>\n        ) : (\n          <>\n            <h1 className=\"text-6xl font-orbitron text-neon-cyan neon-glow\" data-testid=\"text-paused\">PAUSED</h1>\n            <p className=\"text-neon-cyan font-rajdhani text-lg\" data-testid=\"text-resume-hint\">Press ESC to resume</p>\n          </>\n        )}\n        <div className=\"flex flex-col gap-4 mt-8\">\n          <button\n            onClick={handleResume}\n            disabled={countdownSeconds > 0}\n            className=\"px-12 py-4 bg-neon-cyan text-black font-bold font-orbitron text-lg hover:bg-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            data-testid=\"button-resume\"\n          >\n            {countdownSeconds > 0 ? 'RESUMING...' : 'RESUME'}\n          </button>\n          <button\n            onClick={handleRewind}\n            className=\"px-12 py-4 bg-emerald-500 text-black font-bold font-orbitron text-lg hover:bg-white transition-colors border-2 border-emerald-500\"\n            data-testid=\"button-rewind\"\n          >\n            REWIND\n          </button>\n          {propOnHome && (\n            <button\n              onClick={propOnHome}\n              className=\"px-12 py-4 bg-neon-pink text-black font-bold font-orbitron text-lg hover:bg-white transition-colors\"\n              data-testid=\"button-sever-node\"\n            >\n              SEVER NODE\n            </button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport const PauseMenu = memo(PauseMenuComponent);","path":null,"size_bytes":3198,"size_tokens":null},"client/src/hooks/useFadeAnimation.ts":{"content":"// src/hooks/useFadeAnimation.ts\nimport { useEffect, useRef } from 'react';\nimport { GameState } from '@/lib/engine/gameTypes';\nimport { playYouTubeVideo } from '@/lib/youtube';\n\nconst FADE_IN_DURATION_MS = 500;\nconst ANIMATION_DELAY_MS = 100;\n\ninterface UseFadeAnimationProps {\n  gameState: GameState;\n  resumeGame: () => void;\n  setGameState: (state: GameState) => void;\n  setResumeFadeOpacity: (opacity: number) => void;\n}\n\nexport function useFadeAnimation({\n  gameState,\n  resumeGame,\n  setGameState,\n  setResumeFadeOpacity,\n}: UseFadeAnimationProps): void {\n  const animationFrameIdRef = useRef<number | null>(null);\n  const startTimeRef = useRef<number | null>(null);\n\n  useEffect(() => {\n    if (gameState !== 'RESUMING') return;\n\n    const animate = (time: number): void => {\n      if (!startTimeRef.current) {\n        startTimeRef.current = time;\n      }\n\n      const elapsed = time - startTimeRef.current;\n      const progress = Math.min(elapsed / FADE_IN_DURATION_MS, 1.0);\n      setResumeFadeOpacity(progress);\n\n      if (progress < 1.0) {\n        animationFrameIdRef.current = requestAnimationFrame(animate);\n      } else {\n        console.log('[RESUME-ANIM] Fade complete, unfreezing engine...');\n        // YouTube-first resume: play YouTube, then sync game to it\n        playYouTubeVideo()\n          .then(() => {\n            // YouTube is playing, now resume the game engine\n            resumeGame();\n            setGameState('PLAYING');\n          })\n          .catch(err => {\n            console.error('[RESUME-ANIM] YouTube play failed:', err);\n            // Fallback: resume anyway\n            resumeGame();\n            setGameState('PLAYING');\n          })\n          .finally(() => {\n            setResumeFadeOpacity(1.0);\n            startTimeRef.current = null;\n          });\n      }\n    };\n\n    const timer = setTimeout(() => {\n      animationFrameIdRef.current = requestAnimationFrame(animate);\n    }, ANIMATION_DELAY_MS);\n\n    return () => {\n      if (animationFrameIdRef.current) {\n        cancelAnimationFrame(animationFrameIdRef.current);\n      }\n      clearTimeout(timer);\n      startTimeRef.current = null;\n    };\n  }, [gameState, setGameState, resumeGame, setResumeFadeOpacity]);\n}","path":null,"size_bytes":2214,"size_tokens":null},"vite-plugin-meta-images.ts":{"content":"import type { Plugin } from 'vite';\nimport fs from 'fs';\nimport path from 'path';\n\n/**\n * Vite plugin that updates og:image and twitter:image meta tags\n * to point to the app's opengraph image with the correct Replit domain.\n */\nexport function metaImagesPlugin(): Plugin {\n  return {\n    name: 'vite-plugin-meta-images',\n    transformIndexHtml(html) {\n      const baseUrl = getDeploymentUrl();\n      if (!baseUrl) {\n        log('[meta-images] no Replit deployment domain found, skipping meta tag updates');\n        return html;\n      }\n\n      // Check if opengraph image exists in public directory\n      const publicDir = path.resolve(process.cwd(), 'client', 'public');\n      const opengraphPngPath = path.join(publicDir, 'opengraph.png');\n      const opengraphJpgPath = path.join(publicDir, 'opengraph.jpg');\n      const opengraphJpegPath = path.join(publicDir, 'opengraph.jpeg');\n\n      let imageExt: string | null = null;\n      if (fs.existsSync(opengraphPngPath)) {\n        imageExt = 'png';\n      } else if (fs.existsSync(opengraphJpgPath)) {\n        imageExt = 'jpg';\n      } else if (fs.existsSync(opengraphJpegPath)) {\n        imageExt = 'jpeg';\n      }\n\n      if (!imageExt) {\n        log('[meta-images] OpenGraph image not found, skipping meta tag updates');\n        return html;\n      }\n\n      const imageUrl = `${baseUrl}/opengraph.${imageExt}`;\n\n      log('[meta-images] updating meta image tags to:', imageUrl);\n\n      html = html.replace(\n        /<meta\\s+property=\"og:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta property=\"og:image\" content=\"${imageUrl}\" />`\n      );\n\n      html = html.replace(\n        /<meta\\s+name=\"twitter:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta name=\"twitter:image\" content=\"${imageUrl}\" />`\n      );\n\n      return html;\n    },\n  };\n}\n\nfunction getDeploymentUrl(): string | null {\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    const url = `https://${process.env.REPLIT_INTERNAL_APP_DOMAIN}`;\n    log('[meta-images] using internal app domain:', url);\n    return url;\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    const url = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n    log('[meta-images] using dev domain:', url);\n    return url;\n  }\n\n  return null;\n}\n\nfunction log(...args: any[]): void {\n  if (process.env.NODE_ENV === 'production') {\n    console.log(...args);\n  }\n}\n","path":null,"size_bytes":2333,"size_tokens":null},"client/src/lib/utils/index.ts":{"content":"export { cn } from './utils';\nexport * from '../config/gameConstants';\nexport * from './laneUtils';\n","path":null,"size_bytes":100,"size_tokens":null},"client/src/hooks/useRewind.ts":{"content":"// src/hooks/useRewind.ts\nimport { useCallback, useRef } from 'react';\nimport { useGameStore } from '@/stores/useGameStore';\nimport { seekYouTubeVideo, playYouTubeVideo, pauseYouTubeVideo } from '@/lib/youtube';\n\ninterface UseRewindProps {\n  setPauseMenuOpen: (open: boolean) => void;\n  engineRef?: React.RefObject<any>;\n  startGame?: () => void;\n}\n\nexport function useRewind({ setPauseMenuOpen, engineRef, startGame }: UseRewindProps): { handleRewind: () => Promise<void> } {\n  const restartGame = useGameStore(state => state.restartGame);\n  const isRewindingRef = useRef(false);\n  const lastRewindTimeRef = useRef(0);\n\n  const handleRewind = useCallback(async (): Promise<void> => {\n    // Allow rewind even if currently \"rewinding\" if it's been > 500ms (break locks)\n    const now = Date.now();\n    if (isRewindingRef.current && (now - lastRewindTimeRef.current < 500)) return;\n    \n    isRewindingRef.current = true;\n    lastRewindTimeRef.current = now;\n\n    // TODO: CHECKPOINT SYSTEM (Future Practice Mode)\n    // Instead of calling restartGame(), this should:\n    // 1. Load the last checkpoint (saved game state + time + notes)\n    // 2. Preserve score/combo/health from checkpoint\n    // 3. Allow practice mode where users can retry sections without penalty\n    // For now, reset everything to full restart behavior\n    restartGame();\n    setPauseMenuOpen(false);\n    \n    // CRITICAL: Reset the cached time in useYouTubePlayer to prevent\n    // the engine from seeing old time and failing all notes immediately\n    if (engineRef?.current?.resetTime) {\n        engineRef.current.resetTime();\n    }\n    \n    try {\n      // Fire and forget pause to ensure we don't get weird audio artifacts\n      pauseYouTubeVideo().catch(() => {});\n      \n      // Seek to 0\n      await seekYouTubeVideo(0);\n      \n      // YouTube-first flow: Play immediately\n      await playYouTubeVideo();\n      \n      // After YouTube plays, call startGame to reset frame timer and set PLAYING state\n      if (startGame) {\n        startGame();\n      }\n    } catch (err) {\n      console.warn('[REWIND] Async operation failed', err);\n    } finally {\n      // Short delay to clear lock\n      setTimeout(() => {\n          isRewindingRef.current = false;\n      }, 100);\n    }\n  }, [restartGame, setPauseMenuOpen, engineRef, startGame]);\n\n  return { handleRewind };\n}","path":null,"size_bytes":2341,"size_tokens":null},"client/src/lib/utils/judgementLineUtils.ts":{"content":"// src/utils/judgementLineUtils.ts\nimport { JUDGEMENT_RADIUS, COLOR_DECK_LEFT, COLOR_DECK_RIGHT } from '@/lib/config/gameConstants';\n\ninterface LineConfig {\n  angle: number;\n  color: string;\n  key?: string;\n}\n\nexport const calculateLinePoints = (config: LineConfig, vpX: number, vpY: number, lineWidth: number): { x1: number; y1: number; x2: number; y2: number } => {\n  const rad = (config.angle * Math.PI) / 180;\n  const cx = vpX + Math.cos(rad) * JUDGEMENT_RADIUS;\n  const cy = vpY + Math.sin(rad) * JUDGEMENT_RADIUS;\n  const perpRad = rad + Math.PI / 2;\n  const x1 = cx + Math.cos(perpRad) * (lineWidth / 2);\n  const y1 = cy + Math.sin(perpRad) * (lineWidth / 2);\n  const x2 = cx - Math.cos(perpRad) * (lineWidth / 2);\n  const y2 = cy - Math.sin(perpRad) * (lineWidth / 2);\n  return { x1, y1, x2, y2 };\n};\n\nexport const TAP_LINE_CONFIGS: LineConfig[] = [\n  { angle: 120, color: '#FF007F', key: 'W' },\n  { angle: 60, color: '#0096FF', key: 'O' },\n  { angle: 300, color: '#BE00FF', key: 'I' },\n  { angle: 240, color: '#00FFFF', key: 'E' },\n];\n\nexport const HOLD_LINE_CONFIGS: LineConfig[] = [\n  { angle: 180, color: COLOR_DECK_LEFT },\n  { angle: 0, color: COLOR_DECK_RIGHT },\n];","path":null,"size_bytes":1179,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3007,"size_tokens":null},"client/src/lib/youtube/youtubeTypes.ts":{"content":"// src/lib/utils/youtube/youtubeTypes.ts\n// Declare YouTube IFrame API on window\ndeclare global {\n  interface Window {\n    YT: any;\n    onYouTubeIframeAPIReady: () => void;\n  }\n}\n\nexport {};","path":null,"size_bytes":190,"size_tokens":null},"client/src/lib/geometry/tapNoteGeometry.ts":{"content":"import { JUDGEMENT_RADIUS, TAP_DEPTH, TAP_RAY } from '@/lib/config/gameConstants';\n\nexport interface TapNoteGeometry {\n  x1: number; y1: number;\n  x2: number; y2: number;\n  x3: number; y3: number;\n  x4: number; y4: number;\n  points: string;\n}\n\nconst calculateEffectiveProgress = (\n  progress: number,\n  isFailedOrHit: boolean,\n  noteTime: number,\n  currentTime: number,\n  failureTime?: number\n): number => {\n  if (isFailedOrHit && Number.isFinite(noteTime) && Number.isFinite(currentTime)) {\n    // Early failure: note failed BEFORE reaching hit line (failureTime < noteTime)\n    // Use the frozen progress value - DO NOT CLAMP to allow smooth flow past judgement line\n    if (failureTime !== undefined && failureTime < noteTime) {\n      return Math.max(0, progress);\n    }\n    \n    // Late failure or successful hit: note PASSED hit line (failureTime >= noteTime)\n    // Continue morphing past the hit line using current time\n    return Math.max(0, 1 - ((noteTime - currentTime) / TAP_DEPTH.FADE_TIME));\n  }\n  return Math.max(0, Math.min(1, progress));\n};\n\nconst calculateDistances = (\n  effectiveProgress: number,\n  beatmapBpm: number = 120\n): { nearDist: number; farDist: number } => {\n  const clampedProgress = Math.max(0, Math.min(1, effectiveProgress));\n  \n  // Scale world-space depth by approach progress\n  // At vanishing point (progress=0): scaled depth is tiny\n  // At judgement (progress=1): scaled depth is full size (TAP_DEPTH.MAX)\n  const perspectiveScale = clampedProgress; // 0 at VP, 1 at judgement\n  const scaledDepth = TAP_DEPTH.MAX * perspectiveScale;\n  \n  const nearDist = 1 + (effectiveProgress * (JUDGEMENT_RADIUS - 1));\n  const farDist = Math.max(1, nearDist - scaledDepth);\n  return { nearDist, farDist };\n};\n\nconst calculateRayCorners = (\n  vpX: number,\n  vpY: number,\n  rayAngle: number,\n  nearDist: number,\n  farDist: number\n): { x1: number; y1: number; x2: number; y2: number; x3: number; y3: number; x4: number; y4: number } => {\n  const leftRayAngle = rayAngle - TAP_RAY.SPREAD_ANGLE;\n  const rightRayAngle = rayAngle + TAP_RAY.SPREAD_ANGLE;\n  const leftRad = (leftRayAngle * Math.PI) / 180;\n  const rightRad = (rightRayAngle * Math.PI) / 180;\n\n  return {\n    x1: vpX + Math.cos(leftRad) * farDist,\n    y1: vpY + Math.sin(leftRad) * farDist,\n    x2: vpX + Math.cos(rightRad) * farDist,\n    y2: vpY + Math.sin(rightRad) * farDist,\n    x3: vpX + Math.cos(rightRad) * nearDist,\n    y3: vpY + Math.sin(rightRad) * nearDist,\n    x4: vpX + Math.cos(leftRad) * nearDist,\n    y4: vpY + Math.sin(leftRad) * nearDist,\n  };\n};\n\nexport const calculateTapNoteGeometry = (\n  progress: number,\n  tapRayAngle: number,\n  vpX: number,\n  vpY: number,\n  isSuccessfulHit: boolean = false,\n  currentTime: number = 0,\n  isFailed: boolean = false,\n  noteTime: number = 0,\n  failureTime?: number,\n  beatmapBpm: number = 120\n): TapNoteGeometry => {\n  const isFailedOrHit = isFailed || isSuccessfulHit;\n  const effectiveProgress = calculateEffectiveProgress(progress, isFailedOrHit, noteTime, currentTime, failureTime);\n  const { nearDist, farDist } = calculateDistances(effectiveProgress, beatmapBpm);\n  const corners = calculateRayCorners(vpX, vpY, tapRayAngle, nearDist, farDist);\n\n  return {\n    ...corners,\n    points: `${corners.x1},${corners.y1} ${corners.x2},${corners.y2} ${corners.x3},${corners.y3} ${corners.x4},${corners.y4}`,\n  };\n};\n","path":null,"size_bytes":3352,"size_tokens":null},"client/src/lib/youtube/index.ts":{"content":"// Main YouTube utilities aggregator\n// SINGLE SOURCE OF TRUTH: All ytPlayer access goes through youtubeSharedState\n// All player readiness checks go through youtubePlayerState\nexport * from './youtubeTypes';\nexport { extractYouTubeId, buildYouTubeEmbedUrl } from './youtubeUrlUtils';\nexport { initYouTubePlayer } from './youtubePlayerInit';\nexport { waitForPlayerReady, isPlayerReady } from './youtubePlayerState';\nexport { \n  getYtPlayer, \n  getYoutubeIframeElement, \n  getYoutubeCurrentTimeMs, \n  getLastTimeUpdate, \n  getPlayerReady, \n  setYtPlayer, \n  setYoutubeIframeElement, \n  setYoutubeCurrentTimeMs, \n  setLastTimeUpdate, \n  setPlayerReady \n} from './youtubeSharedState';\nexport { getYouTubeVideoTime } from './youtubeTimeGetter';\nexport { initYouTubeTimeListener } from './youtubeTimeListener';\nexport { resetYouTubeTimeTracker } from './youtubeTimeReset';\nexport { seekYouTubeVideo } from './youtubeSeek';\nexport { playYouTubeVideo } from './youtubePlay';\nexport { pauseYouTubeVideo } from './youtubePause';\n","path":null,"size_bytes":1020,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/game/tunnel/TapJudgementLines.tsx":{"content":"// src/components/TapJudgementLines.tsx\nimport React, { memo } from 'react';\nimport { calculateLinePoints, TAP_LINE_CONFIGS } from '@/lib/utils/judgementLineUtils';\nimport { TUNNEL_CONTAINER_WIDTH, TUNNEL_CONTAINER_HEIGHT, TAP_JUDGEMENT_LINE_WIDTH } from '@/lib/config/gameConstants';\n\ninterface TapJudgementLinesProps {\n  vpX: number;\n  vpY: number;\n}\n\nconst TapJudgementLinesComponent = ({ vpX, vpY }: TapJudgementLinesProps) => {\n  return (\n    <svg \n      className=\"absolute inset-0\" \n      data-testid=\"tap-judgement-lines-svg\"\n      style={{ \n        width: `${TUNNEL_CONTAINER_WIDTH}px`, \n        height: `${TUNNEL_CONTAINER_HEIGHT}px`, \n        opacity: 1, \n        pointerEvents: 'none', \n        margin: '0 auto' \n      }}\n    >\n      {TAP_LINE_CONFIGS.map((config, idx) => {\n        const { x1, y1, x2, y2 } = calculateLinePoints(config, vpX, vpY, TAP_JUDGEMENT_LINE_WIDTH);\n        return (\n          <g key={`judgement-line-${idx}`} data-testid={`tap-line-group-${idx}`}>\n            <line \n              x1={x1} \n              y1={y1} \n              x2={x2} \n              y2={y2} \n              stroke={config.color} \n              strokeWidth=\"2.5\" \n              opacity=\"1\" \n              strokeLinecap=\"round\"\n              data-testid={`tap-line-${idx}`}\n            />\n          </g>\n        );\n      })}\n    </svg>\n  );\n};\n\nexport const TapJudgementLines = memo(TapJudgementLinesComponent);","path":null,"size_bytes":1413,"size_tokens":null},"client/src/stores/useConsoleLogStore.ts":{"content":"import { create } from 'zustand';\n\nexport interface ConsoleLogEntry {\n  t: number;\n  l: 'log' | 'warn' | 'error';\n  m: string;\n}\n\nexport interface ConsoleLogStoreState {\n  logs: ConsoleLogEntry[];\n  addLog: (entry: ConsoleLogEntry) => void;\n  getLogs: () => ConsoleLogEntry[];\n  clearLogs: () => void;\n}\n\nexport const useConsoleLogStore = create<ConsoleLogStoreState>((set, get) => ({\n  logs: [],\n\n  addLog: (entry) => {\n    set((state) => ({ logs: [...state.logs, entry] }));\n  },\n\n  getLogs: () => get().logs,\n\n  clearLogs: () => set({ logs: [] }),\n}));\n","path":null,"size_bytes":556,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/hooks/useApiMutation.ts":{"content":"// src/hooks/useApiMutation.ts\nimport { useCallback } from 'react';\n\nexport function useApiMutation<T>(method: 'POST' | 'PUT' | 'DELETE' = 'POST') {\n  const mutate = useCallback(\n    async (url: string, data?: unknown): Promise<T> => {\n      try {\n        console.log(`[API] ${method} ${url}`, data);\n        // Mock implementation for mockup mode\n        return {} as T;\n      } catch (error) {\n        console.error(`[API Error] ${method} ${url}:`, error);\n        throw error;\n      }\n    },\n    [method]\n  );\n\n  return { mutate };\n}","path":null,"size_bytes":536,"size_tokens":null},"client/src/stores/useToastStore.ts":{"content":"import { create } from 'zustand';\nimport type { ToastActionElement, ToastProps } from \"@/components/ui/toast\";\n\nconst TOAST_LIMIT = 1;\nconst TOAST_REMOVE_DELAY = 1000000;\n\ntype ToasterToast = ToastProps & {\n  id: string;\n  title?: React.ReactNode;\n  description?: React.ReactNode;\n  action?: ToastActionElement;\n};\n\ntype Action =\n  | { type: 'ADD_TOAST'; toast: ToasterToast }\n  | { type: 'UPDATE_TOAST'; toast: Partial<ToasterToast> }\n  | { type: 'DISMISS_TOAST'; toastId?: ToasterToast['id'] }\n  | { type: 'REMOVE_TOAST'; toastId?: ToasterToast['id'] };\n\ninterface State {\n  toasts: ToasterToast[];\n}\n\nlet count = 0;\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER;\n  return count.toString();\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>();\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return;\n  }\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId);\n    useToastStore.getState().removeToast(toastId);\n  }, TOAST_REMOVE_DELAY);\n  toastTimeouts.set(toastId, timeout);\n};\n\nconst reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      };\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      };\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action;\n      if (toastId) {\n        addToRemoveQueue(toastId);\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id);\n        });\n      }\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      };\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        };\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      };\n  }\n};\n\ninterface ToastStore extends State {\n  toast: (props: Omit<ToasterToast, 'id'>) => { id: string; dismiss: () => void; update: (props: ToasterToast) => void };\n  dismiss: (toastId?: string) => void;\n  removeToast: (toastId?: string) => void;\n}\n\nexport const useToastStore = create<ToastStore>((set) => ({\n  toasts: [],\n  toast({ ...props }: Omit<ToasterToast, 'id'>) {\n    const id = genId();\n    const update = (props: ToasterToast) =>\n      set(state => reducer(state, {\n        type: \"UPDATE_TOAST\",\n        toast: { ...props, id },\n      }));\n    const dismiss = () => set(state => reducer(state, { type: \"DISMISS_TOAST\", toastId: id }));\n    \n    set(state => reducer(state, {\n      type: \"ADD_TOAST\",\n      toast: {\n        ...props,\n        id,\n        open: true,\n        onOpenChange: (open) => {\n          if (!open) dismiss();\n        },\n      },\n    }));\n    \n    return {\n      id: id,\n      dismiss,\n      update,\n    };\n  },\n  dismiss: (toastId?: string) => set(state => reducer(state, { type: \"DISMISS_TOAST\", toastId })),\n  removeToast: (toastId?: string) => set(state => reducer(state, { type: \"REMOVE_TOAST\", toastId })),\n}));\n\n// Backward compatibility helper for components expecting { toast } = useToast()\nexport const toast = (props: Omit<ToasterToast, 'id'>) => {\n  return useToastStore.getState().toast(props);\n};\n\nexport const useToast = () => {\n  const store = useToastStore();\n  return {\n    toast: store.toast,\n    dismiss: store.dismiss,\n    toasts: store.toasts\n  };\n};\n","path":null,"size_bytes":3733,"size_tokens":null},"client/src/lib/notes/hold/holdNoteStyle.ts":{"content":"import { GREYSCALE_GLOW_COLOR, FAILURE_ANIMATION_DURATION, HOLD_OPACITY, HOLD_STROKE, HOLD_GLOW } from '@/lib/config/gameConstants';\nimport { HoldNoteFailureStates } from './holdNoteHelpers';\nimport { HoldNoteColors, GreyscaleState } from './holdGreystate';\n\nexport interface HoldNoteStyle {\n  opacity: number;\n  strokeWidth: number;\n  filter: string;\n}\n\nconst getBaseOpacity = (approachProgress: number): number =>\n  HOLD_OPACITY.MIN_BASE + Math.min(approachProgress, 1.0) * HOLD_OPACITY.MAX_PROGRESSION;\n\nconst getFailureOpacity = (\n  baseOpacity: number,\n  failures: HoldNoteFailureStates,\n  failureTime: number | undefined,\n  currentTime: number\n): number => {\n  if (!failures.hasAnyFailure || !failureTime) return baseOpacity;\n  \n  const timeSinceFailure = Math.max(0, currentTime - failureTime);\n  const failFadeProgress = Math.min(timeSinceFailure / FAILURE_ANIMATION_DURATION, 1.0);\n  return baseOpacity * (1.0 - failFadeProgress);\n};\n\nconst getCollapseOpacity = (\n  opacity: number,\n  collapseProgress: number,\n  pressHoldTime: number\n): number => {\n  if (collapseProgress > 0 && pressHoldTime > 0) {\n    return Math.max(1.0 - collapseProgress, 0.0);\n  }\n  return opacity;\n};\n\nconst calculateStrokeWidth = (\n  approachProgress: number,\n  collapseProgress: number\n): number => {\n  if (collapseProgress > 0) {\n    return HOLD_STROKE.BASE_WIDTH + (1 - collapseProgress) * HOLD_STROKE.COLLAPSE_MULTIPLIER;\n  }\n  return HOLD_STROKE.BASE_WIDTH + approachProgress * HOLD_STROKE.APPROACH_MULTIPLIER;\n};\n\nconst calculateGlowFilter = (\n  greyscaleState: GreyscaleState,\n  colors: HoldNoteColors,\n  finalGlowScale: number\n): string => {\n  if (greyscaleState.isGreyed) {\n    return `drop-shadow(0 0 8px ${GREYSCALE_GLOW_COLOR}) grayscale(1)`;\n  }\n  \n  const outerShadow = Math.max(HOLD_GLOW.MIN_SHADOW, HOLD_GLOW.SHADOW_SCALE * finalGlowScale);\n  const innerShadow = Math.max(HOLD_GLOW.MIN_INNER_SHADOW, HOLD_GLOW.INNER_SHADOW_SCALE * finalGlowScale);\n  \n  return `drop-shadow(0 0 ${outerShadow}px ${colors.glowColor}) drop-shadow(0 0 ${innerShadow}px ${colors.glowColor})`;\n};\n\nexport const calculateHoldNoteStyle = (\n  approachProgress: number,\n  collapseProgress: number,\n  pressHoldTime: number,\n  failures: HoldNoteFailureStates,\n  failureTime: number | undefined,\n  currentTime: number,\n  greyscaleState: GreyscaleState,\n  colors: HoldNoteColors,\n  finalGlowScale: number\n): HoldNoteStyle => {\n  const baseOpacity = getBaseOpacity(approachProgress);\n  const failureOpacity = getFailureOpacity(baseOpacity, failures, failureTime, currentTime);\n  const opacity = getCollapseOpacity(failureOpacity, collapseProgress, pressHoldTime);\n  \n  const strokeWidth = calculateStrokeWidth(approachProgress, collapseProgress);\n  const filter = calculateGlowFilter(greyscaleState, colors, finalGlowScale);\n  \n  return { opacity, strokeWidth, filter };\n};\n","path":null,"size_bytes":2843,"size_tokens":null},"client/src/components/ui/item.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction ItemGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      role=\"list\"\n      data-slot=\"item-group\"\n      className={cn(\"group/item-group flex flex-col\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"item-separator\"\n      orientation=\"horizontal\"\n      className={cn(\"my-0\", className)}\n      {...props}\n    />\n  )\n}\n\nconst itemVariants = cva(\n  \"group/item [a]:hover:bg-accent/50 focus-visible:border-ring focus-visible:ring-ring/50 [a]:transition-colors flex flex-wrap items-center rounded-md border border-transparent text-sm outline-none transition-colors duration-100 focus-visible:ring-[3px]\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline: \"border-border\",\n        muted: \"bg-muted/50\",\n      },\n      size: {\n        default: \"gap-4 p-4 \",\n        sm: \"gap-2.5 px-4 py-3\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Item({\n  className,\n  variant = \"default\",\n  size = \"default\",\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> &\n  VariantProps<typeof itemVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n  return (\n    <Comp\n      data-slot=\"item\"\n      data-variant={variant}\n      data-size={size}\n      className={cn(itemVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nconst itemMediaVariants = cva(\n  \"flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:translate-y-0.5 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted size-8 rounded-sm border [&_svg:not([class*='size-'])]:size-4\",\n        image:\n          \"size-10 overflow-hidden rounded-sm [&_img]:size-full [&_img]:object-cover\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction ItemMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof itemMediaVariants>) {\n  return (\n    <div\n      data-slot=\"item-media\"\n      data-variant={variant}\n      className={cn(itemMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction ItemContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-content\"\n      className={cn(\n        \"flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-title\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"item-description\"\n      className={cn(\n        \"text-muted-foreground line-clamp-2 text-balance text-sm font-normal leading-normal\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemActions({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-actions\"\n      className={cn(\"flex items-center gap-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-header\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-footer\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Item,\n  ItemMedia,\n  ItemContent,\n  ItemActions,\n  ItemGroup,\n  ItemSeparator,\n  ItemTitle,\n  ItemDescription,\n  ItemHeader,\n  ItemFooter,\n}\n","path":null,"size_bytes":4494,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2560,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n      {children}\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4280,"size_tokens":null},"client/src/lib/errors/gameDebugTypes.ts":{"content":"export type FailureType = \n  | 'tapTooEarlyFailure'\n  | 'tapMissFailure'\n  | 'tooEarlyFailure'\n  | 'holdMissFailure'\n  | 'holdReleaseFailure'\n  | 'successful';\n\nexport interface AnimationTrackingEntry {\n  noteId: string;\n  type: FailureType;\n  failureTime?: number;\n  completed: boolean;\n}\n\nexport interface NoteStatistics {\n  total: number;\n  tap: number;\n  hold: number;\n  hit: number;\n  missed: number;\n  failed: number;\n  byLane: Record<number, number>;\n}\n\nexport interface HitStatistics {\n  successfulHits: number;\n  tapTooEarlyFailures: number;\n  tapMissFailures: number;\n  tooEarlyFailures: number;\n  holdMissFailures: number;\n  holdReleaseFailures: number;\n}\n\nexport interface RenderStatistics {\n  rendered: number;\n  preMissed: number;\n}\n\nexport interface AnimationStatistics {\n  total: number;\n  completed: number;\n  failed: number;\n  pending: number;\n  rendering: number;\n}\n","path":null,"size_bytes":885,"size_tokens":null},"client/src/hooks/useParticles.ts":{"content":"// src/hooks/useParticles.ts\nimport { useParticlesStore } from '@/stores/useParticlesStore';\nimport type { Particle } from '@/types/visualEffects';\n\nexport const useParticles = (): Particle[] => {\n  return useParticlesStore((state) => state.particles);\n};","path":null,"size_bytes":255,"size_tokens":null},"client/src/hooks/useBeatmapLoader.ts":{"content":"// src/hooks/useBeatmapLoader.ts\nimport { useState } from 'react';\nimport { parseBeatmap, BeatmapData } from \"@/lib/beatmap/beatmapParser\";\nimport { convertBeatmapNotes } from \"@/lib/beatmap/beatmapConverter\";\nimport { extractYouTubeId } from '@/lib/youtube';\nimport { GameErrors } from '@/lib/errors/errorLog';\n\ninterface UseBeatmapLoaderProps {\n  difficulty: 'EASY' | 'MEDIUM' | 'HARD';\n  onBeatmapLoad: (data: BeatmapData, beatmapText: string) => void;\n}\n\ninterface UseBeatmapLoaderReturn {\n  beatmapText: string;\n  error: string;\n  isBeatmapLoaded: boolean;\n  handleBeatmapTextChange: (text: string) => void;\n  handleLoadBeatmap: () => void;\n  handleQuickLoadEscapingGravity: () => Promise<void>;\n}\n\nconst defaultBeatmap = `[METADATA]\ntitle: Song Title\nartist: Artist Name\nbpm: 120\nduration: 180\nyoutube: https://www.youtube.com/watch?v=VIDEO_ID\nbeatmapStart: 0\nbeatmapEnd: 180\n\n[MEDIUM]\n500|0|TAP\n1000|1|TAP\n1500|2|HOLD|1000\n3000|3|TAP`;\n\nexport const useBeatmapLoader = ({ difficulty, onBeatmapLoad }: UseBeatmapLoaderProps): UseBeatmapLoaderReturn => {\n  const [beatmapText, setBeatmapText] = useState(defaultBeatmap);\n  const [error, setError] = useState(\"\");\n  const [isBeatmapLoaded, setIsBeatmapLoaded] = useState(false);\n\n  const handleBeatmapTextChange = (text: string) => {\n    setBeatmapText(text);\n    setError(\"\");\n  };\n\n  const handleLoadBeatmap = () => {\n    setError(\"\");\n    if (!beatmapText.trim()) {\n      const msg = \"Please paste a beatmap\";\n      setError(msg);\n      GameErrors.log(`BeatmapLoader: ${msg}`);\n      return;\n    }\n\n    try {\n      const parsed = parseBeatmap(beatmapText, difficulty);\n      \n      if (parsed.error) {\n        const msg = parsed.error;\n        setError(msg);\n        GameErrors.log(`BeatmapLoader: ${msg}`);\n        return;\n      }\n\n      let youtubeVideoId: string | undefined;\n      if (parsed.metadata.youtube) {\n        const extractedId = extractYouTubeId(parsed.metadata.youtube);\n        if (!extractedId) {\n          const msg = \"Invalid YouTube URL in beatmap metadata\";\n          setError(msg);\n          GameErrors.log(`BeatmapLoader: ${msg}`);\n          return;\n        }\n        youtubeVideoId = extractedId;\n      }\n\n      const beatmapStartOffset = parsed.metadata?.beatmapStart || 0;\n      const convertedNotes = convertBeatmapNotes(parsed.notes, beatmapStartOffset);\n      if (convertedNotes.length === 0) {\n        const msg = \"Beatmap has no notes after conversion\";\n        setError(msg);\n        GameErrors.log(`BeatmapLoader: ${msg}`);\n        return;\n      }\n\n      setIsBeatmapLoaded(true);\n      \n      // Notify parent with the processed data AND raw beatmapText for re-parsing with different difficulties\n      onBeatmapLoad({\n        ...parsed,\n        notes: convertedNotes as any[], // Convert strictly typed notes back to array for storage if needed, or adjust types\n        youtubeVideoId\n      }, beatmapText);\n      \n      setBeatmapText(\"\");\n      \n    } catch (error) {\n      const msg = `Beatmap loading error: ${error instanceof Error ? error.message : 'Unknown error'}`;\n      setError(msg);\n      GameErrors.log(`BeatmapLoader: ${msg}`);\n    }\n  };\n\n  const handleQuickLoadEscapingGravity = async () => {\n    setError(\"\");\n    try {\n      const response = await fetch(\"/escaping-gravity.txt\");\n      if (!response.ok) throw new Error(\"Failed to load beatmap file\");\n      const content = await response.text();\n      setBeatmapText(content);\n    } catch (error) {\n      const msg = `Failed to load escaping-gravity.txt: ${error instanceof Error ? error.message : 'Unknown error'}`;\n      setError(msg);\n      GameErrors.log(`BeatmapLoader: ${msg}`);\n    }\n  };\n\n  return {\n    beatmapText,\n    error,\n    isBeatmapLoaded,\n    handleBeatmapTextChange,\n    handleLoadBeatmap,\n    handleQuickLoadEscapingGravity,\n  };\n};","path":null,"size_bytes":3814,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7606,"size_tokens":null},"client/src/lib/youtube/youtubeTimeGetter.ts":{"content":"import { useYoutubeStore } from '@/stores/useYoutubeStore';\n\n/**\n * Get current video time from YouTube player\n * Returns time in milliseconds to match game engine format\n * Tries official API first (getCurrentTime), falls back to postMessage tracking, then query\n * CRITICAL: Never returns null during normal flow to prevent note desync in rhythm game\n */\nexport function getYouTubeVideoTime(): number | null {\n  const { ytPlayer, youtubeCurrentTimeMs, lastTimeUpdate, youtubeIframeElement, lastGoodTimeMs } = useYoutubeStore.getState();\n  \n  console.log('[YOUTUBE-TIME-READ] getYouTubeVideoTime() called - ytPlayer:', ytPlayer ? 'valid' : 'null', 'youtubeCurrentTimeMs:', youtubeCurrentTimeMs, 'lastTimeUpdate:', lastTimeUpdate);\n  \n  // Try official YouTube API method first\n  if (ytPlayer && typeof ytPlayer.getCurrentTime === 'function') {\n    try {\n      const timeSeconds = ytPlayer.getCurrentTime();\n      console.log('[YOUTUBE-TIME-READ] Official API returned:', timeSeconds);\n      if (typeof timeSeconds === 'number' && !isNaN(timeSeconds) && isFinite(timeSeconds) && timeSeconds >= 0) {\n        const timeMs = timeSeconds * 1000;\n        console.log(`[YOUTUBE-TIME-READ] Official API: ${(timeSeconds).toFixed(2)}s (${timeMs.toFixed(0)}ms)`);\n        return timeMs;\n      }\n      console.warn('[YOUTUBE-TIME-READ] Official API returned invalid value:', timeSeconds);\n    } catch (error) {\n      console.warn('[YOUTUBE-TIME-READ] Official API call failed:', error);\n    }\n  } else {\n    console.log('[YOUTUBE-TIME-READ] ytPlayer unavailable or getCurrentTime not a function');\n  }\n\n  // Fallback: use postMessage-tracked time (throttled)\n  const timeSinceUpdate = Date.now() - lastTimeUpdate;\n  console.log('[YOUTUBE-TIME-READ] Checking postMessage fallback - youtubeCurrentTimeMs:', youtubeCurrentTimeMs, 'timeSinceUpdate:', timeSinceUpdate, 'threshold: 1000');\n  if (youtubeCurrentTimeMs >= 0 && timeSinceUpdate < 1000) {\n    console.log(`[YOUTUBE-TIME-READ] Fallback (postMessage): ${(youtubeCurrentTimeMs / 1000).toFixed(2)}s (${youtubeCurrentTimeMs.toFixed(0)}ms)`);\n    return youtubeCurrentTimeMs;\n  }\n\n  // Tertiary: Query via postMessage (one-shot)\n  if (youtubeIframeElement?.contentWindow) {\n    console.log('[YOUTUBE-TIME-READ] Querying via postMessage (one-shot)...');\n    youtubeIframeElement.contentWindow.postMessage(\n      JSON.stringify({ event: 'command', func: 'getCurrentTime', args: [] }),\n      '*'\n    );\n    // Critical: Return last good time instead of null to prevent note desync\n    if (lastGoodTimeMs !== null) {\n      console.log(`[YOUTUBE-TIME-READ] Holding lastGoodTime: ${(lastGoodTimeMs / 1000).toFixed(2)}s (${lastGoodTimeMs.toFixed(0)}ms)`);\n      return lastGoodTimeMs;\n    }\n  } else {\n    console.log('[YOUTUBE-TIME-READ] No iframe element to query');\n  }\n\n  console.log(`[YOUTUBE-TIME-READ] No time available (null)`);\n  return null;\n}","path":null,"size_bytes":2885,"size_tokens":null},"client/src/hooks/useShake.ts":{"content":"// src/hooks/useShake.ts\nimport { useShakeStore } from '@/stores/useShakeStore';\nimport type { ShakeOffset } from '@/types/visualEffects';\n\nexport const useShake = (): ShakeOffset => useShakeStore((state) => state.shakeOffset);","path":null,"size_bytes":227,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute right-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5745,"size_tokens":null},"client/src/components/game/loaders/AnimationStatsSection.tsx":{"content":"// src/components/AnimationStatsSection.tsx\nimport React from 'react';\nimport { StatBox, StatGrid, StatSection } from './ErrorLogViewerHelpers';\n\ninterface AnimationStatsSectionProps {\n  animationStats: { total: number; completed: number; failed: number; pending: number; rendering: number };\n  animations: any[];\n}\n\nexport const AnimationStatsSection: React.FC<AnimationStatsSectionProps> = ({ animationStats, animations }) => (\n  <>\n    <StatSection title=\"ANIMATION LIFECYCLE\" titleColor=\"cyan\" textColor=\"cyan\">\n      <StatGrid cols={4}>\n        <StatBox label=\"Total\" value={animationStats.total} color=\"gray\" />\n        <StatBox label=\"Pending\" value={animationStats.pending} color=\"yellow\" />\n        <StatBox label=\"Rendering\" value={animationStats.rendering} color=\"blue\" />\n        <StatBox label=\"âœ“ Completed\" value={animationStats.completed} color=\"green\" />\n      </StatGrid>\n      {animationStats.failed > 0 && (\n        <div className=\"bg-red-900/30 border border-red-600 p-1 rounded\">\n          <div className=\"text-red-400 text-xs\">âœ— Animation Errors</div>\n          <div className=\"text-lg font-bold text-red-300\">{animationStats.failed}</div>\n        </div>\n      )}\n      <div className=\"text-xs text-gray-500 italic pt-1 border-t border-gray-700\">\n        Lifecycle: pending â†’ rendering â†’ completed\n      </div>\n    </StatSection>\n    {animations.length > 0 && (\n      <details className=\"bg-gray-900 rounded p-2 text-xs text-yellow-300 font-mono\">\n        <summary className=\"cursor-pointer hover:text-yellow-200\">\n          {animations.length} Animation Events\n        </summary>\n        <div className=\"mt-2 space-y-1 max-h-32 overflow-y-auto\">\n          {animations.map((anim, idx) => (\n            <div key={idx} className=\"text-gray-400 truncate\">\n              [{anim.type}] {anim.noteId.substring(0, 12)}... = {anim.status}\n              {anim.errorMsg && ` - ${anim.errorMsg}`}\n            </div>\n          ))}\n        </div>\n      </details>\n    )}\n  </>\n);","path":null,"size_bytes":1996,"size_tokens":null},"client/src/lib/notes/tap/tapNoteHelpers.ts":{"content":"import { Note } from '@/lib/engine/gameTypes';\nimport { GameErrors } from '@/lib/errors/errorLog';\nimport { TAP_FAILURE_ANIMATIONS, TAP_RENDER_WINDOW_MS, TAP_FALLTHROUGH_WINDOW_MS, TAP_HIT_FLASH, LEAD_TIME, REFERENCE_BPM } from '@/lib/config/gameConstants';\n\nexport interface TapNoteState {\n  isHit: boolean;\n  isFailed: boolean;\n  isTapTooEarlyFailure: boolean;\n  isTapMissFailure: boolean;\n  failureTime: number | undefined;\n  hitTime: number | undefined;\n  timeSinceFail: number;\n  timeSinceHit: number;\n}\n\nexport const getTapNoteState = (note: Note, currentTime: number): TapNoteState => {\n  const isHit = note.hit || false;\n  const isTapTooEarlyFailure = note.tapTooEarlyFailure || false;\n  const isTapMissFailure = note.tapMissFailure || false;\n  const isFailed = isTapTooEarlyFailure || isTapMissFailure;\n  const failureTime = note.failureTime;\n  const hitTime = isHit ? currentTime : undefined;\n  \n  const timeSinceFail = failureTime ? Math.max(0, currentTime - failureTime) : 0;\n  const timeSinceHit = isHit && hitTime ? Math.max(0, currentTime - hitTime) : 0;\n  \n  return { isHit, isFailed, isTapTooEarlyFailure, isTapMissFailure, failureTime, hitTime, timeSinceFail, timeSinceHit };\n};\n\nconst getFailureAnimationDuration = (isTooEarly: boolean): number =>\n  isTooEarly ? TAP_FAILURE_ANIMATIONS.TOO_EARLY.duration : TAP_FAILURE_ANIMATIONS.MISS.duration;\n\nexport const shouldRenderTapNote = (state: TapNoteState, timeUntilHit: number, beatmapBpm: number = 120): boolean => {\n  // Calculate effective TAP render window based on BPM\n  const effectiveLEAD_TIME = LEAD_TIME * (REFERENCE_BPM / Math.max(1, beatmapBpm));\n  \n  // For failed notes, only check animation duration, not render window\n  // Failed notes need to stay visible longer than normal notes (visibility handled in useTapNotes)\n  if (state.isFailed) {\n    const failureAnimDuration = state.isTapTooEarlyFailure \n      ? TAP_FAILURE_ANIMATIONS.TOO_EARLY.duration \n      : TAP_FAILURE_ANIMATIONS.MISS.duration;\n    \n    // Hide only after animation completes\n    if (state.timeSinceFail > failureAnimDuration) {\n      return false;\n    }\n    return true;\n  }\n  \n  // For non-failed notes, apply normal render/fallthrough window checks using BPM-scaled window\n  if (timeUntilHit > effectiveLEAD_TIME || timeUntilHit < -TAP_FALLTHROUGH_WINDOW_MS) return false;\n  \n  // Hide successful hits after flash animation completes\n  if (state.isHit && state.timeSinceHit >= TAP_HIT_FLASH.DURATION) return false;\n  \n  return true;\n};\n\nexport const trackTapNoteAnimation = (note: Note, state: TapNoteState, currentTime: number): void => {\n  if (!state.isFailed) return;\n  \n  const failureType = state.isTapTooEarlyFailure ? 'tapTooEarlyFailure' : 'tapMissFailure';\n  const animDuration = getFailureAnimationDuration(state.isTapTooEarlyFailure);\n  \n  const animEntry = GameErrors.animations.find((a: any) => a.noteId === note.id && a.type === failureType);\n  if (!animEntry) {\n    GameErrors.trackAnimation(note.id, failureType, state.failureTime || currentTime);\n  } else if (!animEntry.completed && state.timeSinceFail >= animDuration) {\n    GameErrors.updateAnimation(note.id, { completed: true });\n  }\n};\n\nexport { calculateTapNoteGeometry, type TapNoteGeometry } from '../../geometry/tapNoteGeometry';\nexport { calculateTapNoteStyle, type TapNoteStyle, determineTapGreyscaleState, calculateTapNoteColors, type TapNoteColors, type TapGreyscaleState } from './tapNoteStyle';\n","path":null,"size_bytes":3433,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/hooks/useGameLogic.ts":{"content":"import { useState, useCallback, useEffect } from 'react';\nimport { useGameStore } from '@/stores/useGameStore';\nimport type { GameState, Note } from '@/types/game';\nimport { usePauseLogic } from './usePauseLogic';\nimport { useKeyControls } from './useKeyControls';\nimport { useCountdown } from './useCountdown';\nimport { useFadeAnimation } from './useFadeAnimation';\nimport { useAutoStart } from './useAutoStart';\nimport { useRewind } from './useRewind';\n\ninterface UseGameLogicProps {\n  gameState: GameState;\n  currentTime: number;\n  isPaused: boolean;\n  notes: Note[];\n  getVideoTime?: (() => number | null) | null;\n  resumeGame: () => void;\n  restartGame: () => void;\n  startGame: () => void;\n  setGameState: (state: GameState) => void;\n  setCurrentTime: (time: number) => void;\n  hitNote: (noteId: number) => void;\n  trackHoldStart: (noteId: number) => void;\n  trackHoldEnd: (noteId: number) => void;\n  customNotes?: Note[];\n  engineRef?: React.RefObject<any>;\n  setPauseMenuOpen?: (open: boolean) => void;\n  onHome?: () => void;\n  youtubeIsReady?: boolean;\n  youtubeVideoId?: string | null;\n  onPlayYouTube?: () => Promise<void>;\n}\n\ninterface UseGameLogicReturn {\n  isPauseMenuOpen: boolean;\n  countdownSeconds: number;\n  resumeFadeOpacity: number;\n  gameErrors: any[];\n  handleLeftDeckSpin: () => void;\n  handleRightDeckSpin: () => void;\n  handleRewind: () => Promise<void>;\n  handleResume: () => void;\n  pauseGame: () => void;\n}\n\nexport function useGameLogic({\n  gameState,\n  currentTime,\n  getVideoTime,\n  resumeGame,\n  restartGame,\n  startGame,\n  setGameState,\n  setCurrentTime,\n  hitNote,\n  trackHoldStart,\n  trackHoldEnd,\n  customNotes,\n  engineRef,\n  setPauseMenuOpen,\n  youtubeIsReady = true,\n  youtubeVideoId,\n  onPlayYouTube,\n}: UseGameLogicProps): UseGameLogicReturn {\n  const [isPauseMenuOpen, setIsPauseMenuOpenLocal] = useState(false);\n  const [resumeFadeOpacity, setResumeFadeOpacity] = useState(0);\n\n  const setPauseMenuOpenHandler = useCallback((open: boolean) => {\n    setPauseMenuOpen?.(open);\n    setIsPauseMenuOpenLocal(open);\n  }, [setPauseMenuOpen]);\n\n  // Deck handlers\n  const handleLeftDeckSpin = useCallback(() => hitNote(-1), [hitNote]);\n  const handleRightDeckSpin = useCallback(() => hitNote(-2), [hitNote]);\n\n  // Pause logic\n  const { pauseGame: pauseHandler, handleResume } = usePauseLogic({\n    getVideoTime: getVideoTime ?? undefined,\n    setPauseMenuOpen: setPauseMenuOpenHandler,\n  });\n\n  // Rewind (must be declared before useKeyControls)\n  const { handleRewind } = useRewind({ \n    setPauseMenuOpen: setPauseMenuOpenHandler,\n    engineRef,\n    startGame\n  });\n\n  // Key controls\n  useKeyControls({\n    onPause: pauseHandler,\n    onResume: handleResume,\n    onRewind: handleRewind,\n    onHitNote: hitNote,\n    onTrackHoldStart: trackHoldStart,\n    onTrackHoldEnd: trackHoldEnd,\n  });\n\n  // Countdown\n  useCountdown({\n    gameState,\n    onCountdownComplete: () => setGameState('RESUMING'),\n    setPauseMenuOpen: setPauseMenuOpenHandler,\n  });\n\n  // Fade animation\n  useFadeAnimation({\n    gameState,\n    resumeGame,\n    setGameState,\n    setResumeFadeOpacity,\n  });\n\n  // Auto-start (YouTube: play first via callback, then game starts via onPlaying | Non-YouTube: start directly)\n  useAutoStart({ customNotes: customNotes ?? [], startGame, youtubeIsReady, youtubeVideoId, onPlayYouTube });\n\n  // Reset on game state changes\n  useEffect(() => {\n    if (gameState === 'GAME_OVER') {\n      setIsPauseMenuOpenLocal(false);\n    } else if (gameState === 'PLAYING') {\n      setIsPauseMenuOpenLocal(false);\n    } else if (gameState === 'RESUMING') {\n      setIsPauseMenuOpenLocal(false);\n    }\n  }, [gameState]);\n\n  return {\n    isPauseMenuOpen,\n    countdownSeconds: useGameStore(s => s.countdownSeconds), // From store\n    resumeFadeOpacity,\n    gameErrors: [],\n    handleLeftDeckSpin,\n    handleRightDeckSpin,\n    handleRewind,\n    handleResume,\n    pauseGame: pauseHandler,\n  };\n}","path":null,"size_bytes":3918,"size_tokens":null},"client/src/hooks/useChromatic.ts":{"content":"// src/hooks/useChromatic.ts\nimport { useState, useEffect, useRef } from 'react';\nimport { useGameStore } from '@/stores/useGameStore'; // Assumes store with game stats\nimport { COMBO_MILESTONE, CHROMATIC_INTENSITY, CHROMATIC_DURATION } from '@/lib/config/gameConstants';\n\ninterface UseChromaticProps {\n  // Optional override; defaults to store for global sync\n  combo?: number;\n}\n\nexport const useChromatic = ({ combo: propCombo }: UseChromaticProps = {}): number => {\n  // Pull from Zustand (fallback to props for testing/flexibility)\n  const combo = useGameStore(state => propCombo ?? state.combo);\n\n  const [intensity, setIntensity] = useState(0);\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    if (combo > 0 && combo % COMBO_MILESTONE === 0) {\n      setIntensity(CHROMATIC_INTENSITY);\n      if (timeoutRef.current) clearTimeout(timeoutRef.current);\n      timeoutRef.current = setTimeout(() => setIntensity(0), CHROMATIC_DURATION);\n    }\n\n    return () => {\n      if (timeoutRef.current) clearTimeout(timeoutRef.current);\n    };\n  }, [combo]);\n\n  return intensity;\n};","path":null,"size_bytes":1107,"size_tokens":null},"client/src/hooks/useConsoleLogger.ts":{"content":"import { useEffect } from 'react';\nimport { useConsoleLogStore } from '@/stores/useConsoleLogStore';\n\nexport function useConsoleLogger() {\n  useEffect(() => {\n    const startTime = Date.now();\n    const originalLog = console.log;\n    const originalWarn = console.warn;\n    const originalError = console.error;\n\n    const shouldCapture = (message: string): boolean => {\n      return (\n        message.includes('[CRITICAL]') ||\n        message.includes('[ERROR]') ||\n        message.includes('[WARN]') ||\n        message.includes('[ENGINE]') ||\n        message.includes('[RESUME]') ||\n        message.includes('[SYNC]') ||\n        message.includes('[FRAME]') ||\n        message.includes('[GAME-OVER]') ||\n        message.includes('[SYSTEM]')\n      );\n    };\n\n    const captureLog = (level: string, ...args: any[]) => {\n      const message = args.map(arg =>\n        typeof arg === 'object' ? JSON.stringify(arg) : String(arg)\n      ).join(' ');\n\n      if (level === 'error' || level === 'warn' || shouldCapture(message)) {\n        useConsoleLogStore.getState().addLog({\n          t: Date.now() - startTime,\n          l: level as 'log' | 'warn' | 'error',\n          m: message\n        });\n      }\n    };\n\n    console.log = (...args) => {\n      originalLog(...args);\n      captureLog('log', ...args);\n    };\n    console.warn = (...args) => {\n      originalWarn(...args);\n      captureLog('warn', ...args);\n    };\n    console.error = (...args) => {\n      originalError(...args);\n      captureLog('error', ...args);\n    };\n\n    return () => {\n      console.log = originalLog;\n      console.warn = originalWarn;\n      console.error = originalError;\n    };\n  }, []);\n}","path":null,"size_bytes":1659,"size_tokens":null},"client/src/components/game/effects/CamelotWheel.tsx":{"content":"import { motion } from \"framer-motion\";\nimport { useState, useEffect, useRef, useCallback } from \"react\";\nimport wheelImg from \"@assets/generated_images/neon_glowing_cyber_turntable_interface.png\";\nimport { GameErrors } from '@/lib/errors/errorLog';\nimport { ROTATION_SPEED, SPIN_THRESHOLD, STATE_UPDATE_INTERVAL, DRAG_VELOCITY_THRESHOLD } from '@/lib/config/gameConstants';\n\ninterface CamelotWheelProps {\n  side: \"left\" | \"right\";\n  onSpin: () => void;\n  onHoldStart?: (lane: number) => void;\n  onHoldEnd?: () => void;\n  onRotationChange?: (rotation: number) => void;\n}\n\nexport function CamelotWheel({ \n  side, \n  onSpin, \n  onHoldStart = () => {}, \n  onHoldEnd = () => {}, \n  onRotationChange = () => {} \n}: CamelotWheelProps) {\n  const [internalRotation, setInternalRotation] = useState(0);\n  const [isKeyPressed, setIsKeyPressed] = useState(false);\n  const rotationRef = useRef(0);\n  const isKeyPressedRef = useRef(false);\n  const lastSpinRotationRef = useRef(0);\n  const lastStateUpdateTimeRef = useRef(0);\n  const wheelLane = side === 'left' ? -1 : -2;\n\n  // Sync refs when state changes\n  useEffect(() => {\n    isKeyPressedRef.current = isKeyPressed;\n  }, [isKeyPressed]);\n\n  // Memoized callbacks to prevent recreation in effects\n  const handleKeyDown = useCallback((e: KeyboardEvent) => {\n    if (e.repeat) return;\n    const key = e.key.toLowerCase();\n    const isLeftDeckKey = side === 'left' && key === 'q';\n    const isRightDeckKey = side === 'right' && key === 'p';\n\n    if (isLeftDeckKey || isRightDeckKey) {\n      setIsKeyPressed(true);\n      onHoldStart(wheelLane);\n    }\n  }, [side, wheelLane, onHoldStart]);\n\n  const handleKeyUp = useCallback((e: KeyboardEvent) => {\n    const key = e.key.toLowerCase();\n    const isLeftDeckKey = side === 'left' && key === 'q';\n    const isRightDeckKey = side === 'right' && key === 'p';\n\n    if (isLeftDeckKey || isRightDeckKey) {\n      setIsKeyPressed(false);\n      onHoldEnd();\n    }\n  }, [side, onHoldEnd]);\n\n  // Single key toggle for spin direction - stable listeners\n  useEffect(() => {\n    window.addEventListener('keydown', handleKeyDown);\n    window.addEventListener('keyup', handleKeyUp);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n      window.removeEventListener('keyup', handleKeyUp);\n    };\n  }, [handleKeyDown, handleKeyUp]);\n\n  // Continuous rotation loop using RAF - batches callbacks\n  useEffect(() => {\n    let animationId: number;\n    const animate = (now: number) => {\n      if (isKeyPressedRef.current) {\n        const rotationDelta = ROTATION_SPEED;\n        const newRotation = rotationRef.current + rotationDelta;\n        rotationRef.current = newRotation;\n\n        // Trigger onSpin event periodically when rotation threshold exceeded\n        if (Math.abs(newRotation - lastSpinRotationRef.current) >= SPIN_THRESHOLD) {\n          onSpin();\n          lastSpinRotationRef.current = newRotation;\n        }\n\n        // Batch state updates and callbacks: only when interval elapsed\n        if (now - lastStateUpdateTimeRef.current >= STATE_UPDATE_INTERVAL) {\n          setInternalRotation(newRotation);\n          onRotationChange(newRotation);\n          lastStateUpdateTimeRef.current = now;\n        }\n      }\n      animationId = requestAnimationFrame(animate);\n    };\n    animationId = requestAnimationFrame(animate);\n    return () => cancelAnimationFrame(animationId);\n  }, [onSpin, onRotationChange]);\n\n  const handleDrag = useCallback((_: any, info: any) => {\n    try {\n      // Validate full framer-motion drag info structure\n      if (!info || typeof info !== 'object' || !info.delta || !Number.isFinite(info.delta.x)) {\n        GameErrors.log(`CamelotWheel: Invalid drag info structure`);\n        return;\n      }\n\n      // Update ref first for RAF loop consistency, then batch state update\n      const newRot = rotationRef.current + info.delta.x;\n      rotationRef.current = newRot;\n      setInternalRotation(newRot);\n      onRotationChange(newRot);\n\n      // Trigger spin event if drag velocity exceeds threshold\n      if (info.velocity && typeof info.velocity === 'object' && Number.isFinite(info.velocity.x) &&\n          Math.abs(info.velocity.x) > DRAG_VELOCITY_THRESHOLD) {\n        onSpin();\n      }\n    } catch (error) {\n      GameErrors.log(`CamelotWheel drag error: ${error instanceof Error ? error.message : 'Unknown'}`);\n    }\n  }, [onRotationChange, onSpin]);\n\n  // Hitline color class\n  const hitlineColorClass = side === 'left' ? 'bg-neon-green/70 shadow-[0_0_20px_rgb(0,255,0)]' : 'bg-neon-red/70 shadow-[0_0_20px_rgb(255,0,0)]';\n  const borderColorClass = side === 'left' ? 'border-neon-green/50 shadow-[0_0_30px_rgba(0,255,0,0.3)]' : 'border-neon-red/50 shadow-[0_0_30px_rgba(255,0,0,0.3)]';\n\n  return (\n    <div className=\"flex flex-col items-center gap-6 relative\">\n      {/* Hitline at top edge - scales with wheel */}\n      <div className={`absolute z-40 -top-8 md:-top-10 ${side === 'left' ? 'left-1/2 -translate-x-1/4' : 'right-1/2 translate-x-1/4'}`}>\n        <div className={`w-1 h-8 md:h-10 ${hitlineColorClass}`} />\n      </div>\n\n      {/* Semicircle Container */}\n      <div className=\"relative h-64 w-32 md:h-80 md:w-40 overflow-hidden\">\n        {/* Inner Container for the Full Wheel - positioned to show only from spawn point (50%) onwards */}\n        <div\n          className={`absolute top-1/2 -translate-y-1/2 w-64 h-64 md:w-80 md:h-80 ${side === 'left' ? 'right-0' : 'left-0'}`}\n        >\n          {/* The Interactive Wheel (Spins) */}\n          <motion.div\n            className={`w-full h-full rounded-full border-4 overflow-hidden relative bg-black cursor-grab active:cursor-grabbing ${borderColorClass}`}\n            style={{ rotate: internalRotation }}\n            drag=\"x\"\n            dragConstraints={{ left: 0, right: 0, top: 0, bottom: 0 }}\n            dragElastic={0}\n            onDrag={handleDrag}\n          >\n             <img\n               src={wheelImg}\n               alt=\"Turntable\"\n               className=\"w-full h-full object-cover opacity-80 mix-blend-screen\"\n               draggable={false}\n               onError={(e) => {\n                 // Fallback to gradient if image fails to load\n                 (e.target as HTMLImageElement).style.display = 'none';\n               }}\n             />\n             {/* Fallback pattern if image doesn't load */}\n             <div className=\"absolute inset-0 bg-gradient-conic from-neon-green via-neon-blue to-neon-red opacity-20\" />\n\n             {/* Center Axis */}\n             <div className=\"absolute inset-0 m-auto w-20 h-20 rounded-full bg-black border-2 border-neon-cyan flex items-center justify-center z-20\">\n                <div className=\"w-2 h-2 bg-white rounded-full animate-ping\" />\n             </div>\n          </motion.div>\n        </div>\n      </div>\n\n      {/* Label */}\n      <div className=\"text-neon-blue font-orbitron text-sm tracking-widest\">\n        DECK {side === 'left' ? 'A' : 'B'}\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":6958,"size_tokens":null},"client/src/lib/notes/processors/noteValidator.ts":{"content":"import { Note, GameConfig, NoteType } from '@/lib/engine/gameTypes';\nimport { TAP_RENDER_WINDOW_MS, LEAD_TIME, REFERENCE_BPM } from '@/lib/config/gameConstants';\n\n// ============================================================================\n// NOTE VALIDATOR - Pure functions for note state validation\n// ============================================================================\n\nexport class NoteValidator {\n  private effectiveLEAD_TIME: number;\n  \n  constructor(private config: GameConfig, beatmapBpm: number = 120) {\n    // Scale LEAD_TIME with BPM to match geometry scaling\n    this.effectiveLEAD_TIME = LEAD_TIME * (REFERENCE_BPM / Math.max(1, beatmapBpm));\n  }\n\n  isNoteActive(note: Note): boolean {\n    return !note.hit && \n           !note.missed && \n           !note.tapTooEarlyFailure && \n           !note.tapMissFailure && \n           !note.tooEarlyFailure && \n           !note.holdMissFailure && \n           !note.holdReleaseFailure;\n  }\n\n  isNoteFailed(note: Note): boolean {\n    return !!(note.tapTooEarlyFailure || \n              note.tapMissFailure || \n              note.tooEarlyFailure || \n              note.holdMissFailure || \n              note.holdReleaseFailure);\n  }\n\n  shouldCleanupNote(note: Note, currentTime: number): boolean {\n    const CLEANUP_DELAY = 700;\n    \n    if ((note.type === 'SPIN_LEFT' || note.type === 'SPIN_RIGHT') && \n        note.holdMissFailure && note.failureTime) {\n      return currentTime > note.failureTime + CLEANUP_DELAY;\n    }\n    \n    return false;\n  }\n\n  findPressableTapNote(notes: Note[], lane: number, currentTime: number): Note | null {\n    return notes.find(n => \n      n.lane === lane &&\n      n.type === 'TAP' &&\n      this.isNoteActive(n) &&\n      currentTime >= n.time - this.config.TAP_HIT_WINDOW &&\n      currentTime <= n.time + this.config.TAP_HIT_WINDOW\n    ) || null;\n  }\n\n  findClosestActiveNote(notes: Note[], lane: number, type: NoteType, currentTime: number): Note | null {\n    const candidates = notes.filter(n => \n      n.lane === lane && \n      n.type === type && \n      this.isNoteActive(n) &&\n      Number.isFinite(n.time)\n    );\n\n    if (candidates.length === 0) return null;\n\n    return candidates.reduce((prev, curr) => \n      Math.abs(curr.time - currentTime) < Math.abs(prev.time - currentTime) ? curr : prev\n    );\n  }\n\n  findPressableHoldNote(notes: Note[], lane: number, currentTime: number): Note | null {\n    return notes.find(n => \n      n.lane === lane &&\n      (n.type === 'SPIN_LEFT' || n.type === 'SPIN_RIGHT') &&\n      this.isNoteActive(n) &&\n      currentTime >= n.time - this.effectiveLEAD_TIME &&\n      currentTime <= n.time + this.config.HOLD_ACTIVATION_WINDOW\n    ) || null;\n  }\n\n  findActiveHoldNote(notes: Note[], lane: number, currentTime: number): Note | null {\n    return notes.find(n => \n      n.lane === lane &&\n      (n.type === 'SPIN_LEFT' || n.type === 'SPIN_RIGHT') &&\n      n.pressHoldTime !== undefined &&\n      n.pressHoldTime > 0 &&\n      this.isNoteActive(n) &&\n      currentTime - n.time >= -this.effectiveLEAD_TIME\n    ) || null;\n  }\n\n  getActiveNotes(notes: Note[]): Note[] {\n    return notes.filter(n => this.isNoteActive(n));\n  }\n\n  getCompletedNotes(notes: Note[]): Note[] {\n    return notes.filter(n => n.hit || this.isNoteFailed(n));\n  }\n\n  getActiveNotesOnLane(notes: Note[], lane: number): Note[] {\n    return notes.filter(n => n.lane === lane && this.isNoteActive(n));\n  }\n\n  /**\n   * Get notes that are visible within the current time window\n   * @param notes All notes\n   * @param currentTime Current playback time in ms\n   * @returns Notes that should be visible on screen\n   */\n  getVisibleNotes(notes: Note[], currentTime: number): Note[] {\n    return notes.filter(n => \n      this.isNoteActive(n) &&\n      n.time >= currentTime - this.effectiveLEAD_TIME &&\n      n.time <= currentTime + 1000 // Show notes up to 1 second ahead\n    );\n  }\n\n  /**\n   * Update note timings after time jump (e.g., on resume)\n   * This ensures notes are in correct state relative to new current time\n   * @param notes All notes\n   * @param currentTime New current time in ms\n   * @returns Notes updated for new time context (clears temporary state if needed)\n   */\n  updateNoteTimes(notes: Note[], currentTime: number): Note[] {\n    return notes.map(n => {\n      // If note was marked as too early relative to old time,\n      // but is now within valid window at new time, reset early flag\n      if (n.tooEarlyFailure && currentTime >= n.time - this.effectiveLEAD_TIME) {\n        return { ...n, tooEarlyFailure: false };\n      }\n      // Same for TAP notes\n      if (n.tapTooEarlyFailure && currentTime >= n.time - TAP_RENDER_WINDOW_MS) {\n        return { ...n, tapTooEarlyFailure: false };\n      }\n      return n;\n    });\n  }\n}\n","path":null,"size_bytes":4745,"size_tokens":null},"client/src/components/ui/button-group.tsx":{"content":"import { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nconst buttonGroupVariants = cva(\n  \"flex w-fit items-stretch has-[>[data-slot=button-group]]:gap-2 [&>*]:focus-visible:relative [&>*]:focus-visible:z-10 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1\",\n  {\n    variants: {\n      orientation: {\n        horizontal:\n          \"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none\",\n        vertical:\n          \"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none\",\n      },\n    },\n    defaultVariants: {\n      orientation: \"horizontal\",\n    },\n  }\n)\n\nfunction ButtonGroup({\n  className,\n  orientation,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof buttonGroupVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"button-group\"\n      data-orientation={orientation}\n      className={cn(buttonGroupVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupText({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  asChild?: boolean\n}) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      className={cn(\n        \"bg-muted shadow-xs flex items-center gap-2 rounded-md border px-4 text-sm font-medium [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupSeparator({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"button-group-separator\"\n      orientation={orientation}\n      className={cn(\n        \"bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  ButtonGroup,\n  ButtonGroupSeparator,\n  ButtonGroupText,\n  buttonGroupVariants,\n}\n","path":null,"size_bytes":2209,"size_tokens":null},"client/src/lib/engine/gameTypes.ts":{"content":"/**\n * Re-export hub for game types\n * Maintains backward compatibility - all existing imports continue to work\n * Core types are now defined in @/types/game.ts\n */\n\nexport type {\n  Difficulty,\n  GameState,\n  NoteType,\n  Note,\n  GameConfig,\n  ScoreState,\n  TimingResult,\n  FailureType,\n  InputHandler,\n  Processor,\n  PostProcessor,\n  GameStoreState,\n} from '@/types/game';\n\n// SyncConfig placeholder for compatibility\nexport interface SyncConfig {\n  notesInterval?: number;\n  stateInterval?: number;\n}\n","path":null,"size_bytes":502,"size_tokens":null},"client/src/lib/errors/errorLog.ts":{"content":"import { useGameDebuggerStore } from '@/stores/useGameDebuggerStore';\nimport type { AnimationTrackingEntry, FailureType } from '@/types/gameDebugTypes';\n\nexport const GameErrors = {\n  // Public selectors (reactive)\n  notes: [] as (string | any)[], // Mixed strings/LogEntry objects\n  animations: [] as AnimationTrackingEntry[],\n  noteStats: { total: 0, tap: 0, hold: 0, hit: 0, missed: 0, failed: 0, byLane: {} as Record<number, number> },\n  renderStats: { rendered: 0, preMissed: 0 },\n  hitStats: { successfulHits: 0, tapTooEarlyFailures: 0, tapMissFailures: 0, tooEarlyFailures: 0, holdMissFailures: 0, holdReleaseFailures: 0 },\n\n  // Methods (dispatch to store)\n  log(msg: string, gameTime?: number) {\n    useGameDebuggerStore.getState().log(msg, gameTime);\n    // Sync legacy\n    this.notes = [...useGameDebuggerStore.getState().notes];\n  },\n\n  trackAnimation(noteId: string, type: FailureType, failureTime?: number) {\n    useGameDebuggerStore.getState().trackAnimation(noteId, type, failureTime);\n    this.animations = [...useGameDebuggerStore.getState().animations];\n  },\n\n  updateAnimation(noteId: string, updates: Partial<AnimationTrackingEntry>) {\n    useGameDebuggerStore.getState().updateAnimation(noteId, updates);\n    this.animations = [...useGameDebuggerStore.getState().animations];\n  },\n\n  updateNoteStats(notes: any[]) {\n    useGameDebuggerStore.getState().updateNoteStats(notes);\n    // Sync legacy stats\n    const store = useGameDebuggerStore.getState();\n    this.noteStats = store.noteStats;\n    this.hitStats = store.hitStats; // Assume hitStats updated in action if needed\n  },\n\n  updateRenderStats(rendered: number, preMissed: number) {\n    useGameDebuggerStore.getState().updateRenderStats(rendered, preMissed);\n    this.renderStats = useGameDebuggerStore.getState().renderStats;\n  },\n\n  updateHitStats(stats: any) {\n    useGameDebuggerStore.getState().updateHitStats(stats);\n    this.hitStats = useGameDebuggerStore.getState().hitStats;\n  },\n\n  getAnimationStats() {\n    const animations = useGameDebuggerStore.getState().animations;\n    const total = animations.length;\n    const completed = animations.filter(a => a.completed).length;\n    const failed = 0; // Not currently tracked in AnimationTrackingEntry\n    const pending = total - completed;\n    const rendering = pending; // Simplified mapping\n\n    return {\n      total,\n      completed,\n      failed,\n      pending,\n      rendering\n    };\n  },\n};","path":null,"size_bytes":2430,"size_tokens":null},"client/src/lib/youtube/youtubeSeek.ts":{"content":"import { waitForPlayerReady } from './youtubePlayerState';\nimport { getYouTubeVideoTime } from './youtubeTimeGetter';\nimport { resetYouTubeTimeTracker } from './youtubeTimeReset';\nimport { useYoutubeStore } from '@/stores/useYoutubeStore';\n\n/**\n * Seek YouTube video to specific time (in seconds) with polling confirmation\n * Uses official API if available, falls back to iframe postMessage control\n */\nexport async function seekYouTubeVideo(timeSeconds: number, signal?: AbortSignal): Promise<void> {\n  // Reduce wait time for player ready - 2s is too long for gameplay\n  await waitForPlayerReady(500);\n  if (signal?.aborted) throw new Error('Seek aborted');\n\n  // Reset tracker optimistically\n  resetYouTubeTimeTracker(timeSeconds);\n\n  const clampedTime = Math.max(0, timeSeconds);\n  const minutes = Math.floor(clampedTime / 60);\n  const seconds = (clampedTime % 60).toFixed(2);\n\n  try {\n    let ytPlayer = useYoutubeStore.getState().ytPlayer;\n    let youtubeIframeElement = useYoutubeStore.getState().youtubeIframeElement;\n    \n    // Try official YouTube API first\n    if (ytPlayer && typeof ytPlayer.seekTo === 'function') {\n      // Don't force pause before seek - it slows things down. Just seek.\n      ytPlayer.seekTo(clampedTime, true); \n      console.log(`[YOUTUBE-SEEK] Official API: Seeking to ${minutes}:${seconds}`);\n    } else if (youtubeIframeElement?.contentWindow) {\n      // Fallback postMessage\n      youtubeIframeElement.contentWindow.postMessage(\n        JSON.stringify({\n          event: 'command',\n          func: 'seekTo',\n          args: [clampedTime, true]\n        }),\n        '*'\n      );\n      console.log(`[YOUTUBE-SEEK] PostMessage fallback: Seeking to ${minutes}:${seconds}`);\n    } else {\n      // If no player, just return (don't throw/block gameplay)\n      console.warn('[YOUTUBE-SEEK] No seek method available');\n      return;\n    }\n\n    // FAST POLL: Check for confirmation but timeout quickly (250ms)\n    // We don't want to block the UI for a slow iframe\n    await new Promise<void>((resolve) => {\n      const maxAttempts = 5; // 250ms @ 50ms\n      let attempts = 0;\n      const poll = () => {\n        attempts++;\n        const current = getYouTubeVideoTime();\n        // Looser tolerance (0.5s) for quick seeking\n        if (current !== null && Math.abs(current / 1000 - clampedTime) < 0.5) { \n          console.log(`[YOUTUBE-SEEK] Confirmed: ${(current / 1000).toFixed(2)}s`);\n          resolve();\n        } else if (attempts >= maxAttempts) {\n          console.log(`[YOUTUBE-SEEK] Proceeding (timeout or unconfirmed)`);\n          resolve(); \n        } else {\n          setTimeout(poll, 50);\n        }\n      };\n      setTimeout(poll, 50);\n    });\n  } catch (error) {\n    console.error('[YOUTUBE-SEEK] Failed:', error);\n    // Don't throw - let game continue\n  }\n}","path":null,"size_bytes":2804,"size_tokens":null},"client/src/lib/geometry/holdNoteGeometry.ts":{"content":"import { Note } from '@/lib/engine/gameTypes';\nimport { GameErrors } from '@/lib/errors/errorLog';\nimport { LEAD_TIME, JUDGEMENT_RADIUS, HOLD_NOTE_STRIP_WIDTH_MULTIPLIER, REFERENCE_BPM, HOLD_RAY } from '@/lib/config/gameConstants';\n\nexport interface ApproachGeometry {\n  nearDistance: number;\n  farDistance: number;\n}\n\nexport const calculateApproachGeometry = (\n  timeUntilHit: number,\n  pressHoldTime: number,\n  isTooEarlyFailure: boolean,\n  holdDuration: number,\n  isHoldMissFailure: boolean = false,\n  useFixedDepth: boolean = true,\n  beatmapBpm: number = 120\n): ApproachGeometry => {\n  // Fixed depth mode - depth is proportional to duration AND approach speed\n  // Near end approaches based on note.time\n  // Far end = near end + fixed offset based on duration scaled by approach speed\n  \n  // LEAD_TIME scales with BPM to prevent note stacking on fast songs\n  // At 120 BPM: LEAD_TIME = 4000ms (baseline)\n  // At 240 BPM: LEAD_TIME = 2000ms (half - snappier, prevents doubled-up notes)\n  // At 60 BPM: LEAD_TIME = 8000ms (double - longer window for slower songs)\n  // Formula: effectiveLEAD_TIME = LEAD_TIME Ã— (REFERENCE_BPM / beatmapBpm)\n  \n  const effectiveLEAD_TIME = LEAD_TIME * (REFERENCE_BPM / Math.max(1, beatmapBpm));\n  \n  const rawNearProgress = (effectiveLEAD_TIME - timeUntilHit) / effectiveLEAD_TIME;\n  const nearProgress = Math.max(0, rawNearProgress);\n  const nearDistance = Math.max(1, 1 + (nearProgress * (JUDGEMENT_RADIUS - 1)));\n  \n  if (useFixedDepth) {\n    // Approach speed = tunnel distance / effective LEAD_TIME\n    // This automatically scales with BPM since effectiveLEAD_TIME scales inversely\n    // High BPM: shorter window, faster approach speed\n    // Low BPM: longer window, slower approach speed\n    // Hold visual depth = duration Ã— approach speed\n    const TUNNEL_DISTANCE = JUDGEMENT_RADIUS - 1; // 186 pixels\n    const approachSpeed = TUNNEL_DISTANCE / effectiveLEAD_TIME; // pixels per millisecond\n    const fixedDepthOffset = Math.max(1, holdDuration * approachSpeed);\n    // Scale depth offset by approach progress (time-aware) to maintain constant z-depth in world space\n    // perspectiveScale represents how far along the approach we are (0 at VP, 1 at judgement)\n    // This naturally accounts for BPM through effectiveLEAD_TIME\n    // At vanishing point: scaled offset is tiny, at judgement: scaled offset is full size\n    // This creates visual growth of depth as note approaches while keeping z-depth constant\n    const perspectiveScale = Math.max(0, (effectiveLEAD_TIME - timeUntilHit) / effectiveLEAD_TIME);\n    const scaledDepthOffset = fixedDepthOffset * perspectiveScale;\n    // Far end is closer to vanishing point (smaller distance), near end is at judgement\n    const farDistance = Math.max(1, nearDistance - scaledDepthOffset);\n    return { nearDistance, farDistance };\n  } else {\n    // LEGACY: Dynamic depth mode (both ends approach based on timing)\n    const timeUntilHitFar = timeUntilHit + holdDuration;\n    const rawFarProgress = (effectiveLEAD_TIME - timeUntilHitFar) / effectiveLEAD_TIME;\n    const farProgress = Math.max(0, rawFarProgress);\n    const farDistance = Math.max(1, 1 + (farProgress * (JUDGEMENT_RADIUS - 1)));\n    return { nearDistance, farDistance };\n  }\n};\n\nexport interface CollapseGeometry {\n  nearDistance: number;\n  farDistance: number;\n  collapseProgress: number;\n}\n\nexport const calculateCollapseGeometry = (\n  pressHoldTime: number,\n  collapseDuration: number,\n  currentTime: number,\n  lockedNearDistance: number,\n  farDistanceAtPress: number,\n  approachNearDistance: number,\n  approachFarDistance: number,\n  isActiveHold: boolean = false,\n  noteTime: number = 0\n): CollapseGeometry => {\n  if (!pressHoldTime || pressHoldTime === 0) {\n    // Not pressed yet - return approach geometry (no collapse)\n    return { nearDistance: approachNearDistance, farDistance: approachFarDistance, collapseProgress: 0 };\n  }\n  \n  // For active holds (pressed with no failure), collapse should start from noteTime to match deck meter fill timing\n  // For failures, collapse starts from pressHoldTime (frozen geometry at failure moment)\n  const collapseStartTime = isActiveHold ? noteTime : pressHoldTime;\n  const timeSinceCollapseStart = currentTime - collapseStartTime;\n  const collapseProgress = Math.min(Math.max(timeSinceCollapseStart / collapseDuration, 0), 1.0);\n  \n  const nearDistance = lockedNearDistance;\n  const farDistance = farDistanceAtPress * (1 - collapseProgress) + lockedNearDistance * collapseProgress;\n  \n  return { nearDistance, farDistance, collapseProgress };\n};\n\nexport const calculateLockedNearDistance = (\n  note: Note,\n  pressHoldTime: number,\n  isTooEarlyFailure: boolean,\n  approachNearDistance: number,\n  failureTime: number | null,\n  isHoldMissFailure: boolean = false,\n  beatmapBpm: number = 120\n): number | null => {\n  if (note.hit) return JUDGEMENT_RADIUS;\n  if (!pressHoldTime || pressHoldTime === 0) return null;\n  if (isTooEarlyFailure) return null;\n  \n  // For holdMissFailure, don't lock near distance - let approach geometry continue extending past judgement\n  if (isHoldMissFailure) return null;\n  \n  if (note.holdReleaseFailure) {\n    if (!failureTime) return null;\n    const timeUntilHitAtFailure = note.time - failureTime;\n    // Use effectiveLEAD_TIME scaled by BPM\n    const effectiveLEAD_TIME = LEAD_TIME * (REFERENCE_BPM / Math.max(1, beatmapBpm));\n    const approachProgressAtFailure = Math.max((effectiveLEAD_TIME - timeUntilHitAtFailure) / effectiveLEAD_TIME, 0);\n    return Math.max(1, 1 + (approachProgressAtFailure * (JUDGEMENT_RADIUS - 1)));\n  }\n  \n  // For active holds (pressed with no failure), lock near distance at judgement line during collapse\n  // The near end should remain fixed at the hit point (JUDGEMENT_RADIUS) while far end collapses inward\n  return JUDGEMENT_RADIUS;\n};\n\nexport interface GlowCalculation {\n  glowScale: number;\n  collapseGlow: number;\n  finalGlowScale: number;\n}\n\nexport const calculateHoldNoteGlow = (\n  pressHoldTime: number,\n  currentTime: number,\n  collapseDuration: number,\n  approachProgress: number,\n  note: Note,\n  isActiveHold: boolean = false,\n  noteTime: number = 0\n): GlowCalculation => {\n  const hasActivePress = pressHoldTime > 0 || note.hit;\n  \n  const glowScale = hasActivePress ? 0.2 + (Math.min(approachProgress, 1.0) * 0.8) : 0.05;\n  \n  let collapseGlow = 0;\n  if (pressHoldTime && pressHoldTime > 0) {\n    // For active holds, glow collapse starts from noteTime to match deck meter timing\n    // For failures, collapse starts from pressHoldTime\n    const collapseStartTime = isActiveHold ? noteTime : pressHoldTime;\n    const timeSinceCollapseStart = currentTime - collapseStartTime;\n    const collapseGlowProgress = Math.min(Math.max(timeSinceCollapseStart / collapseDuration, 0), 1.0);\n    collapseGlow = collapseGlowProgress > 0 ? (1 - collapseGlowProgress) * 0.8 : 0;\n  }\n  \n  const finalGlowScale = hasActivePress ? Math.max(glowScale - collapseGlow, 0.1) : 0.05;\n  \n  return { glowScale, collapseGlow, finalGlowScale };\n};\n\nexport const getTrapezoidCorners = (\n  rayAngle: number,\n  nearDistance: number,\n  farDistance: number,\n  vanishingPointX: number,\n  vanishingPointY: number,\n  noteId?: string\n): { x1: number; y1: number; x2: number; y2: number; x3: number; y3: number; x4: number; y4: number } | null => {\n  // Allow partial rendering: notes can span from behind vanishing point (negative z) to in front (positive z)\n  // Both ends must be at least slightly valid (distance > 0), but not necessarily both > 1\n  // The SVG viewport will naturally clip negative x/y coordinates\n  if (Math.max(nearDistance, farDistance) < 1) {\n    return null;\n  }\n  \n  // Normalize angle to 0-360 range for consistent winding order\n  const normalizedAngle = ((rayAngle % 360) + 360) % 360;\n  \n  // For angles in 270-90 range (right side), we need to swap left/right to maintain clockwise winding\n  // This ensures consistent polygon winding across all lanes\n  const needsSwap = normalizedAngle >= 270 || normalizedAngle < 90;\n  \n  // Use fixed angle spread for both ends (true ray geometry)\n  // Both left and right rays follow the same angle, creating proper perspective convergence\n  // Width scales naturally with distance: width = 2 * distance * tan(angleSpread)\n  // This ensures synchronized rate of change between near and far ends\n  \n  const leftAngle = needsSwap ? rayAngle + HOLD_RAY.SPREAD_ANGLE : rayAngle - HOLD_RAY.SPREAD_ANGLE;\n  const rightAngle = needsSwap ? rayAngle - HOLD_RAY.SPREAD_ANGLE : rayAngle + HOLD_RAY.SPREAD_ANGLE;\n  \n  const leftRad = (leftAngle * Math.PI) / 180;\n  const rightRad = (rightAngle * Math.PI) / 180;\n  \n  const corners = {\n    x1: vanishingPointX + Math.cos(leftRad) * farDistance,\n    y1: vanishingPointY + Math.sin(leftRad) * farDistance,\n    x2: vanishingPointX + Math.cos(rightRad) * farDistance,\n    y2: vanishingPointY + Math.sin(rightRad) * farDistance,\n    x3: vanishingPointX + Math.cos(rightRad) * nearDistance,\n    y3: vanishingPointY + Math.sin(rightRad) * nearDistance,\n    x4: vanishingPointX + Math.cos(leftRad) * nearDistance,\n    y4: vanishingPointY + Math.sin(leftRad) * nearDistance,\n  };\n  \n  // Validate all coordinates are finite (no NaN or Infinity)\n  const allFinite = Object.values(corners).every(v => Number.isFinite(v));\n  if (!allFinite) {\n    if (noteId) {\n      GameErrors.log(`getTrapezoidCorners: Invalid coordinates for note ${noteId}: ${JSON.stringify(corners)}`);\n    }\n    return null;\n  }\n  \n  // Allow negative coordinates - SVG viewport will clip them naturally\n  // This allows hold notes to render partially when they span across the vanishing point\n  \n  return corners;\n};\n","path":null,"size_bytes":9637,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7406,"size_tokens":null},"client/src/lib/utils/holdMeterUtils.ts":{"content":"// src/utils/holdMeterUtils.ts\nimport { Note } from '@/lib/engine/gameTypes';\nimport { GameErrors } from '@/lib/errors/errorLog';\nimport {\n  DECK_METER_COMPLETION_THRESHOLD,\n  DECK_METER_DEFAULT_HOLD_DURATION,\n} from '@/lib/config/gameConstants';\n\n// Helper: Check if a note is an active (pressed, not failed) hold note on a specific lane\nexport const isActiveHoldNote = (note: Note, lane: number): boolean => {\n  return !!(\n    note &&\n    note.lane === lane &&\n    (note.type === 'SPIN_LEFT' || note.type === 'SPIN_RIGHT') &&\n    !note.hit &&\n    !note.tooEarlyFailure &&\n    !note.holdMissFailure &&\n    !note.holdReleaseFailure &&\n    note.pressHoldTime &&\n    note.pressHoldTime > 0\n  );\n};\n\nexport interface HoldProgressData {\n  progress: number;\n  shouldGlow: boolean;\n  prevCompletion: boolean;\n}\n\nexport const getHoldProgress = (\n  notes: Note[],\n  currentTime: number,\n  lane: number,\n  DECK_METER_COMPLETION_THRESHOLD: number,\n  DECK_METER_DEFAULT_HOLD_DURATION: number\n): number => {\n  try {\n    if (!Array.isArray(notes) || !Number.isFinite(currentTime)) return 0;\n\n    const activeNote = notes.find(n => isActiveHoldNote(n, lane));\n\n    if (!activeNote) return 0;\n\n    if (!activeNote.pressHoldTime || activeNote.pressHoldTime <= 0) return 0;\n\n    const beatmapHoldDuration = (activeNote.duration && activeNote.duration > 0)\n      ? activeNote.duration\n      : DECK_METER_DEFAULT_HOLD_DURATION;\n\n    const elapsedFromNoteTime = currentTime - activeNote.time;\n\n    if (elapsedFromNoteTime < 0) return 0;\n\n    let progress = Math.min(elapsedFromNoteTime / beatmapHoldDuration, 1.0);\n\n    if (!Number.isFinite(progress) || progress < 0 || progress > 1) progress = 0;\n\n    return progress;\n  } catch (error) {\n    GameErrors.log(`DeckMeter getHoldProgress error for lane ${lane}: ${error instanceof Error ? error.message : 'Unknown'}`);\n    return 0;\n  }\n};","path":null,"size_bytes":1867,"size_tokens":null},"client/src/lib/youtube/youtubePause.ts":{"content":"import { waitForPlayerReady, isPlayerReady } from './youtubePlayerState';\nimport { useYoutubeStore } from '@/stores/useYoutubeStore';\n\n/**\n * Pause YouTube video\n * Uses official API if available, falls back to iframe postMessage control\n */\nexport async function pauseYouTubeVideo(): Promise<void> {\n  // Optimization: If player is already ready (which is 99% of the time during gameplay),\n  // don't wait. Just execute immediately to minimize latency.\n  if (!isPlayerReady()) {\n    await waitForPlayerReady(1000);\n  }\n\n  try {\n    // Get fresh player reference right before using it\n    let ytPlayer = useYoutubeStore.getState().ytPlayer;\n    let currentState: number | null = null;\n    if (ytPlayer?.getPlayerState) {\n      currentState = ytPlayer.getPlayerState();\n      if (currentState === 2) { // Already paused\n        console.log('[YOUTUBE-PAUSE] Already paused, skipping');\n        return;\n      }\n    }\n\n    // Get fresh references right before calling methods\n    ytPlayer = useYoutubeStore.getState().ytPlayer;\n    const youtubeIframeElement = useYoutubeStore.getState().youtubeIframeElement;\n    const youtubeCurrentTimeMs = useYoutubeStore.getState().youtubeCurrentTimeMs;\n\n    if (ytPlayer && typeof ytPlayer.pauseVideo === 'function') {\n      const currentTime = ytPlayer.getCurrentTime?.() ?? 0;\n      const minutes = Math.floor(currentTime / 60);\n      const seconds = (currentTime % 60).toFixed(2);\n      \n      // Execute synchronously if possible\n      ytPlayer.pauseVideo();\n      \n      console.log(`[YOUTUBE-PAUSE] Official API: Paused at ${minutes}:${seconds} (${currentTime.toFixed(2)}s total)`);\n    } else if (youtubeIframeElement?.contentWindow) {\n      youtubeIframeElement.contentWindow.postMessage(\n        JSON.stringify({\n          event: 'command',\n          func: 'pauseVideo',\n          args: []\n        }),\n        'https://www.youtube.com'\n      );\n      console.log(`[YOUTUBE-PAUSE] PostMessage fallback: Paused at tracked time ${(youtubeCurrentTimeMs / 1000).toFixed(2)}s`);\n    } else {\n      console.error('[YOUTUBE-PAUSE] No pause method available - ytPlayer:', ytPlayer ? 'exists' : 'null', 'iframe:', youtubeIframeElement ? 'exists' : 'null');\n      throw new Error('No pause method available');\n    }\n  } catch (error) {\n    console.error('[YOUTUBE-PAUSE] Failed:', error);\n    throw error;\n  }\n}","path":null,"size_bytes":2344,"size_tokens":null},"client/src/components/ui/HUD/ErrorIndicator.tsx":{"content":"// src/components/ErrorIndicator.tsx\nimport React from 'react';\nimport { useGameStore } from '@/stores/useGameStore';\n\ninterface ErrorIndicatorProps {\n  count?: number;\n}\n\nexport function ErrorIndicator({ count: propCount }: ErrorIndicatorProps = {}) {\n  // Count missed notes from game store\n  const missedCount = useGameStore(state => {\n    const notes = state.notes || [];\n    return notes.filter(n => n.missed || n.tapMissFailure || n.holdMissFailure).length;\n  });\n  \n  const totalErrors = propCount ?? missedCount;\n\n  return totalErrors > 0 ? (\n    <div className=\"text-xs text-red-400 font-rajdhani\" data-testid=\"error-indicator\">\n      {totalErrors} miss{totalErrors !== 1 ? 'es' : ''}\n    </div>\n  ) : null;\n}","path":null,"size_bytes":718,"size_tokens":null},"client/src/lib/utils/convertBeatmapNotes.ts":{"content":"// src/utils/convertBeatmapNotes.ts (keep original logic, minor refactors for store integration)\nimport { Note } from '@/lib/engine/gameTypes';\nimport { GameErrors } from '@/lib/errors/errorLog';\n\nexport interface BeatmapNote {\n  time: number;\n  lane: number;\n  type: 'TAP' | 'HOLD';\n  duration?: number;\n  holdId?: string;\n  beatmapStart?: number;\n  beatmapEnd?: number;\n}\n\nexport function convertBeatmapNotes(beatmapNotes: BeatmapNote[]): Note[] {\n  if (!Array.isArray(beatmapNotes) || beatmapNotes.length === 0) {\n    return [];\n  }\n  const validNoteIndices = new Set<number>();\n  const seenHoldIds = new Set<string>();\n  for (let i = 0; i < beatmapNotes.length; i++) {\n    const note = beatmapNotes[i];\n    if (!note || !Number.isFinite(note.time) || !Number.isFinite(note.lane) || !note.type) {\n      GameErrors.log(`BeatmapConverter: Invalid note at index ${i}: time=${note?.time}, lane=${note?.lane}, type=${note?.type}`);\n      continue;\n    }\n    if (note.lane !== -2 && note.lane !== -1 && (note.lane < 0 || note.lane > 3)) {\n      GameErrors.log(`BeatmapConverter: Invalid lane ${note.lane} at note index ${i}. Valid lanes: -2 (P deck), -1 (Q deck), 0-3 (soundpads)`);\n      continue;\n    }\n\n    // STRICT ENFORCEMENT: Lanes 0-3 are TAP only. Lanes -1/-2 are HOLD (SPIN) only.\n    let enforcedType = note.type;\n    \n    // Force Soundpads (0-3) to TAP\n    if (note.lane >= 0 && note.lane <= 3) {\n        if (note.type === 'HOLD') {\n            // console.warn(`BeatmapConverter: Lane ${note.lane} forced to TAP (HOLD not supported on soundpads)`);\n            enforcedType = 'TAP';\n        }\n    }\n\n    // Force Decks (-1, -2) to HOLD (SPIN) if they have duration, otherwise TAP (though deck taps might be rare/unsupported?)\n    // User said: \"Lanes q and p, or -1 and -2, are reserved for hold notes alone\"\n    if (note.lane === -1 || note.lane === -2) {\n        if (note.type === 'TAP') {\n             // console.warn(`BeatmapConverter: Lane ${note.lane} forced to HOLD (TAP not supported on decks)`);\n             enforcedType = 'HOLD';\n             // Give it a default duration if missing, so it works as a spin\n             if (!note.duration) note.duration = 1000; \n        }\n    }\n\n    if (enforcedType === 'HOLD') {\n      if (note.duration === undefined || !Number.isFinite(note.duration) || note.duration <= 0) {\n        // If we forced it to HOLD, we might have just added duration. If it was already HOLD but bad duration:\n        if (note.lane === -1 || note.lane === -2) {\n             note.duration = 1000; // Fallback for decks\n        } else {\n             GameErrors.log(`BeatmapConverter: HOLD note at index ${i} has invalid duration. Skipping.`);\n             continue;\n        }\n      }\n      if (note.holdId && seenHoldIds.has(note.holdId)) {\n        continue;\n      }\n      if (note.holdId) {\n        seenHoldIds.add(note.holdId);\n      }\n    }\n    validNoteIndices.add(i);\n  }\n  const gameNotes: Note[] = [];\n  for (let i = 0; i < beatmapNotes.length; i++) {\n    if (!validNoteIndices.has(i)) continue;\n    const note = beatmapNotes[i];\n    \n    let type: 'TAP' | 'SPIN_LEFT' | 'SPIN_RIGHT';\n    \n    // Re-apply logic to determine final internal type\n    if (note.lane === -1) {\n        type = 'SPIN_LEFT';\n    } else if (note.lane === -2) {\n        type = 'SPIN_RIGHT';\n    } else {\n        type = 'TAP';\n    }\n\n    const id = note.holdId || `note-${note.time}-${i}`;\n    const gameNote: Note = {\n      id,\n      lane: note.lane,\n      time: note.time,\n      type,\n      hit: false,\n      missed: false,\n    };\n    \n    // Apply duration if it's a spin note\n    if ((type === 'SPIN_LEFT' || type === 'SPIN_RIGHT') && note.duration) {\n      gameNote.duration = note.duration;\n    }\n    // Fallback: if we decided it's a spin note but it has no duration (was TAP in beatmap), give it default\n    if ((type === 'SPIN_LEFT' || type === 'SPIN_RIGHT') && !gameNote.duration) {\n      gameNote.duration = 1000;\n    }\n\n    if (note.beatmapStart !== undefined) {\n      gameNote.beatmapStart = note.beatmapStart;\n    }\n    if (note.beatmapEnd !== undefined) {\n      gameNote.beatmapEnd = note.beatmapEnd;\n    }\n    gameNotes.push(gameNote);\n  }\n  let isChronological = true;\n  for (let i = 1; i < gameNotes.length; i++) {\n    if (gameNotes[i].time < gameNotes[i - 1].time) {\n      isChronological = false;\n      break;\n    }\n  }\n  if (!isChronological) {\n    GameErrors.log(`BeatmapConverter: Notes were out of chronological order, sorting by time`);\n    gameNotes.sort((a, b) => a.time - b.time);\n  }\n  return gameNotes;\n}","path":null,"size_bytes":4549,"size_tokens":null},"client/src/lib/notes/hold/holdNoteHelpers.ts":{"content":"import { Note } from '@/lib/engine/gameTypes';\nimport { GameErrors } from '@/lib/errors/errorLog';\nimport { FAILURE_ANIMATION_DURATION } from '@/lib/config/gameConstants';\n\nexport interface HoldNoteFailureStates {\n  isTooEarlyFailure: boolean;\n  isHoldReleaseFailure: boolean;\n  isHoldMissFailure: boolean;\n  hasAnyFailure: boolean;\n}\n\nexport const getHoldNoteFailureStates = (note: Note): HoldNoteFailureStates => {\n  const isTooEarlyFailure = note.tooEarlyFailure || false;\n  const isHoldReleaseFailure = note.holdReleaseFailure || false;\n  const isHoldMissFailure = note.holdMissFailure || false;\n  \n  return {\n    isTooEarlyFailure,\n    isHoldReleaseFailure,\n    isHoldMissFailure,\n    hasAnyFailure: isTooEarlyFailure || isHoldReleaseFailure || isHoldMissFailure,\n  };\n};\n\nexport const markAnimationCompletedIfDone = (\n  note: Note,\n  failures: HoldNoteFailureStates,\n  timeSinceFail: number,\n  currentTime: number\n): void => {\n  if (timeSinceFail > FAILURE_ANIMATION_DURATION) {\n    const failureTypes: Array<'tooEarlyFailure' | 'holdReleaseFailure' | 'holdMissFailure'> = [];\n    if (failures.isTooEarlyFailure) failureTypes.push('tooEarlyFailure');\n    if (failures.isHoldReleaseFailure) failureTypes.push('holdReleaseFailure');\n    if (failures.isHoldMissFailure) failureTypes.push('holdMissFailure');\n    \n    for (const failureType of failureTypes) {\n      const animEntry = GameErrors.animations.find(a => a.noteId === note.id && a.type === failureType);\n      if (animEntry && !animEntry.completed) {\n        GameErrors.updateAnimation(note.id, { completed: true });\n      }\n    }\n  }\n};\n\nexport const trackHoldNoteAnimationLifecycle = (\n  note: Note,\n  failures: HoldNoteFailureStates,\n  currentTime: number\n): void => {\n  if (!failures.hasAnyFailure) return;\n  \n  const failureTypes: Array<'tooEarlyFailure' | 'holdReleaseFailure' | 'holdMissFailure'> = [];\n  if (failures.isTooEarlyFailure) failureTypes.push('tooEarlyFailure');\n  if (failures.isHoldReleaseFailure) failureTypes.push('holdReleaseFailure');\n  if (failures.isHoldMissFailure) failureTypes.push('holdMissFailure');\n  \n  for (const failureType of failureTypes) {\n    let animEntry = GameErrors.animations.find(a => a.noteId === note.id && a.type === failureType);\n    const failureTime = animEntry?.failureTime || note.failureTime || currentTime;\n    const timeSinceFailure = Math.max(0, currentTime - failureTime);\n    \n    if (!animEntry) {\n      GameErrors.trackAnimation(note.id, failureType, note.failureTime || currentTime);\n      animEntry = GameErrors.animations.find(a => a.noteId === note.id && a.type === failureType);\n    }\n    \n    if (animEntry) {\n      if (!animEntry.completed && timeSinceFailure >= FAILURE_ANIMATION_DURATION) {\n        GameErrors.updateAnimation(note.id, { completed: true });\n      }\n    }\n  }\n};\n\nexport { calculateApproachGeometry, calculateCollapseGeometry, calculateLockedNearDistance, calculateHoldNoteGlow, getTrapezoidCorners, type ApproachGeometry, type CollapseGeometry, type GlowCalculation } from '../../geometry/holdNoteGeometry';\nexport { calculateHoldNoteColors, determineGreyscaleState, type HoldNoteColors, type GreyscaleState } from './holdGreystate';\n","path":null,"size_bytes":3184,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  // put application routes here\n  // prefix all routes with /api\n\n  // use storage to perform CRUD operations on the storage interface\n  // e.g. storage.insertUser(user) or storage.getUserByUsername(username)\n\n  return httpServer;\n}\n","path":null,"size_bytes":458,"size_tokens":null},"client/src/lib/utils/errorLogUtils.ts":{"content":"// src/utils/errorLogUtils.ts\n// Pure functions for error/logic derivation - no state, testable\nexport const countErrorsByCategory = (notes: (string | any)[]) => {\n  const counts = {\n    beatmapLoader: 0,\n    parser: 0,\n    converter: 0,\n    meter: 0,\n    trapezoid: 0,\n    game: 0,\n  };\n  notes.forEach(entry => {\n    const err = typeof entry === 'string' ? entry : entry.message || '';\n    if (err.includes('BeatmapLoader')) counts.beatmapLoader++;\n    else if (err.includes('BeatmapParser')) counts.parser++;\n    else if (err.includes('BeatmapConverter')) counts.converter++;\n    else if (err.includes('DeckMeter')) counts.meter++;\n    else if (err.includes('Trapezoid')) counts.trapezoid++;\n    else counts.game++;\n  });\n  return counts;\n};\n\nexport const getLaneNames = (): Record<string, string> => ({\n  '0': 'W',\n  '1': 'O',\n  '2': 'I',\n  '3': 'E',\n  '-1': 'Q',\n  '-2': 'P',\n});\n\nexport const formatLaneStats = (byLane: Record<number, number>): string => {\n  const laneNames = getLaneNames();\n  return Object.entries(byLane)\n    .map(([lane, count]) => `${laneNames[lane] || lane}=${count}`)\n    .join(' ');\n};\n\n// Resets - can be called in store actions\nexport const resetHitStats = () => ({\n  successfulHits: 0,\n  tapTooEarlyFailures: 0,\n  tapMissFailures: 0,\n  tooEarlyFailures: 0,\n  holdMissFailures: 0,\n  holdReleaseFailures: 0,\n});\n\nexport const resetRenderStats = () => ({\n  rendered: 0,\n  preMissed: 0,\n});","path":null,"size_bytes":1420,"size_tokens":null},"client/src/components/game/hud/DeckHoldMeters.tsx":{"content":"// src/components/DeckHoldMeters.tsx\nimport React from 'react';\nimport { useGameStore } from '@/stores/useGameStore'; // Assumes store with notes, currentTime\nimport { useHoldProgress } from '@/hooks/useHoldProgress';\nimport { RectangleMeter } from '@/components/game/hud/RectangleMeter';\nimport { COLOR_DECK_LEFT, COLOR_DECK_RIGHT } from '@/lib/config/gameConstants';\nimport { Note } from '@/types/game';\n\ninterface DeckHoldMetersProps {\n  // Optional overrides; defaults to store for global sync\n  notes?: Note[];\n  currentTime?: number;\n}\n\nexport function DeckHoldMeters({ notes: propNotes, currentTime: propCurrentTime }: DeckHoldMetersProps = {}) {\n  // Left meter (lane -1 for Q)\n  const { progress: leftProgress, isGlowing: leftGlowing } = useHoldProgress({\n    lane: -1,\n  });\n\n  // Right meter (lane -2 for P)\n  const { progress: rightProgress, isGlowing: rightGlowing } = useHoldProgress({\n    lane: -2,\n  });\n\n  return (\n    <div className=\"absolute inset-0 flex items-center justify-between px-4 pointer-events-none\">\n      {/* Left Deck Hold Meter */}\n      <div className=\"flex flex-col items-center gap-3\">\n        <div className=\"text-sm font-rajdhani text-neon-green font-bold tracking-widest\">Q</div>\n        <RectangleMeter\n          progress={leftProgress}\n          outlineColor={COLOR_DECK_LEFT}\n          lane={-1}\n          isGlowing={leftGlowing}\n        />\n      </div>\n      {/* Right Deck Hold Meter */}\n      <div className=\"flex flex-col items-center gap-3\">\n        <div className=\"text-sm font-rajdhani text-neon-red font-bold tracking-widest\">P</div>\n        <RectangleMeter\n          progress={rightProgress}\n          outlineColor={COLOR_DECK_RIGHT}\n          lane={-2}\n          isGlowing={rightGlowing}\n        />\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":1781,"size_tokens":null},"client/src/components/game/effects/GlitchOverlay.tsx":{"content":"// src/components/GlitchOverlay.tsx\nimport { GLITCH_BACKGROUND_SIZE, GLITCH_OPACITY } from '@/lib/config/gameConstants';\n\ninterface GlitchOverlayProps {\n  glitch: number;\n  glitchPhase: number;\n  glitchOpacityMultiplier: number;\n}\n\nexport const GlitchOverlay: React.FC<GlitchOverlayProps> = ({ glitch, glitchPhase, glitchOpacityMultiplier }) => {\n  const opacity = Math.min(glitch * GLITCH_OPACITY * glitchOpacityMultiplier, 1);\n  const animationDuration = 0.1 + glitchPhase * 0.2;\n\n  return (\n    <div\n      className=\"absolute inset-0\"\n      style={{\n        backgroundImage: `linear-gradient(\n          0deg,\n          rgba(255, 0, 127, ${opacity}) 0%,\n          transparent 2%,\n          transparent 8%,\n          rgba(0, 255, 255, ${opacity}) 10%,\n          transparent 12%\n        )`,\n        backgroundSize: `100% ${GLITCH_BACKGROUND_SIZE}px`,\n        backgroundPosition: `0 ${glitchPhase * GLITCH_BACKGROUND_SIZE}px`,\n        animation: `glitch-scroll ${animationDuration}s linear infinite`,\n      }}\n    />\n  );\n};","path":null,"size_bytes":1023,"size_tokens":null},"client/src/index.css":{"content":"@import \"tailwindcss\";\n@import \"tw-animate-css\";\n\n@keyframes glitch {\n  0% { transform: translate(0); }\n  20% { transform: translate(-2px, 2px); }\n  40% { transform: translate(2px, -2px); }\n  60% { transform: translate(-1px, 1px); }\n  80% { transform: translate(1px, -1px); }\n  100% { transform: translate(0); }\n}\n\n@custom-variant dark (&:is(.dark *));\n\n@theme inline {\n  --font-orbitron: 'Orbitron', sans-serif;\n  --font-rajdhani: 'Rajdhani', sans-serif;\n\n  --color-background: hsl(var(--background));\n  --color-foreground: hsl(var(--foreground));\n  \n  --color-neon-blue: hsl(var(--neon-blue));\n  --color-neon-purple: hsl(var(--neon-purple));\n  --color-neon-pink: hsl(var(--neon-pink));\n  --color-neon-cyan: hsl(var(--neon-cyan));\n  --color-neon-green: hsl(var(--neon-green));\n  --color-neon-red: hsl(var(--neon-red));\n  \n  --color-card: hsl(var(--card));\n  --color-card-foreground: hsl(var(--card-foreground));\n  \n  --color-primary: hsl(var(--primary));\n  --color-primary-foreground: hsl(var(--primary-foreground));\n  \n  --color-secondary: hsl(var(--secondary));\n  --color-secondary-foreground: hsl(var(--secondary-foreground));\n  \n  --color-muted: hsl(var(--muted));\n  --color-muted-foreground: hsl(var(--muted-foreground));\n  \n  --color-accent: hsl(var(--accent));\n  --color-accent-foreground: hsl(var(--accent-foreground));\n  \n  --color-destructive: hsl(var(--destructive));\n  --color-destructive-foreground: hsl(var(--destructive-foreground));\n  \n  --color-border: hsl(var(--border));\n  --color-input: hsl(var(--input));\n  --color-ring: hsl(var(--ring));\n  \n  --radius: 0.5rem;\n}\n\n:root {\n  /* Cyberpunk / Neon Dark Mode by default */\n  --background: 240 30% 10%; /* Very dark blue/black */\n  --foreground: 180 100% 90%; /* Light Cyan */\n\n  --neon-blue: 190 100% 50%;\n  --neon-purple: 280 100% 60%;\n  --neon-pink: 320 100% 60%;\n  --neon-cyan: 180 100% 50%;\n  --neon-green: 120 100% 50%;\n  --neon-red: 0 100% 50%;\n\n  --card: 240 25% 15%;\n  --card-foreground: 180 20% 90%;\n\n  --popover: 240 25% 15%;\n  --popover-foreground: 180 20% 90%;\n\n  --primary: 190 100% 50%; /* Neon Cyan */\n  --primary-foreground: 240 30% 10%;\n\n  --secondary: 280 80% 20%; /* Dark Purple */\n  --secondary-foreground: 280 100% 80%;\n\n  --muted: 240 20% 20%;\n  --muted-foreground: 240 10% 60%;\n\n  --accent: 320 100% 50%; /* Neon Pink */\n  --accent-foreground: 240 30% 10%;\n\n  --destructive: 0 100% 50%;\n  --destructive-foreground: 210 40% 98%;\n\n  --border: 240 30% 30%;\n  --input: 240 30% 30%;\n  --ring: 190 100% 50%;\n\n  --radius: 0.25rem;\n}\n\nbody {\n  font-family: var(--font-rajdhani);\n  background-color: hsl(var(--background));\n  color: hsl(var(--foreground));\n  overflow: hidden; /* Prevent scrolling for game feel */\n}\n\nh1, h2, h3, h4, h5, h6 {\n  font-family: var(--font-orbitron);\n  letter-spacing: 0.05em;\n}\n\n.neon-text-blue {\n  text-shadow: 0 0 5px hsl(var(--neon-blue)), 0 0 10px hsl(var(--neon-blue));\n}\n.neon-text-pink {\n  text-shadow: 0 0 5px hsl(var(--neon-pink)), 0 0 10px hsl(var(--neon-pink));\n}\n\n.neon-border-blue {\n  box-shadow: 0 0 5px hsl(var(--neon-blue)), inset 0 0 5px hsl(var(--neon-blue));\n}\n\n.glass-panel {\n  background: rgba(20, 20, 40, 0.7);\n  backdrop-filter: blur(10px);\n  border: 1px solid rgba(100, 200, 255, 0.2);\n}\n\n.neon-glow {\n  filter: drop-shadow(0 0 10px currentColor) drop-shadow(0 0 20px currentColor);\n}\n\n@keyframes pulse-glow {\n  0%, 100% { filter: drop-shadow(0 0 10px currentColor) drop-shadow(0 0 20px currentColor); }\n  50% { filter: drop-shadow(0 0 20px currentColor) drop-shadow(0 0 40px currentColor); }\n}\n\n.pulse-glow {\n  animation: pulse-glow 0.5s ease-in-out;\n}\n\n@keyframes glitch {\n  0% { clip-path: inset(40% 0 61% 0); transform: translate(-2px, -2px); }\n  20% { clip-path: inset(92% 0 1% 0); transform: translate(2px, 2px); }\n  40% { clip-path: inset(43% 0 1% 0); transform: translate(-2px, 2px); }\n  60% { clip-path: inset(25% 0 58% 0); transform: translate(2px, -2px); }\n  80% { clip-path: inset(54% 0 7% 0); transform: translate(-2px, -2px); }\n  100% { clip-path: inset(58% 0 43% 0); transform: translate(2px, 2px); }\n}\n\n.glitch-effect {\n  animation: glitch 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;\n}\n","path":null,"size_bytes":4142,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"// src/hooks/useIsMobile.ts\nimport * as React from \"react\";\n\nconst MOBILE_BREAKPOINT = 768;\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean>(false);\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`);\n    const onChange = (event: MediaQueryListEvent) => {\n      setIsMobile(event.matches);\n    };\n\n    mql.addEventListener(\"change\", onChange);\n    setIsMobile(mql.matches); // Initial check\n\n    return () => mql.removeEventListener(\"change\", onChange);\n  }, []);\n\n  return isMobile;\n}","path":null,"size_bytes":580,"size_tokens":null},"client/src/components/game/loaders/ErrorCountsSection.tsx":{"content":"// src/components/ErrorCountsSection.tsx\nimport React from 'react';\n\ninterface ErrorCountsSectionProps {\n  errorCounts: { beatmapLoader: number; parser: number; converter: number; meter: number; trapezoid: number; game: number };\n}\n\nexport const ErrorCountsSection: React.FC<ErrorCountsSectionProps> = ({ errorCounts }) => {\n  const hasErrors = Object.values(errorCounts).some(v => v > 0);\n  if (!hasErrors) return null;\n\n  return (\n    <div className=\"bg-gray-900 rounded p-2 text-xs text-yellow-300 font-mono grid grid-cols-3 gap-1\">\n      {errorCounts.beatmapLoader > 0 && (\n        <div><span className=\"text-gray-500\">Loader</span>: <span className=\"font-bold\">{errorCounts.beatmapLoader}</span></div>\n      )}\n      {errorCounts.parser > 0 && (\n        <div><span className=\"text-gray-500\">Parser</span>: <span className=\"font-bold\">{errorCounts.parser}</span></div>\n      )}\n      {errorCounts.converter > 0 && (\n        <div><span className=\"text-gray-500\">Convert</span>: <span className=\"font-bold\">{errorCounts.converter}</span></div>\n      )}\n      {errorCounts.meter > 0 && (\n        <div><span className=\"text-gray-500\">Meter</span>: <span className=\"font-bold\">{errorCounts.meter}</span></div>\n      )}\n      {errorCounts.trapezoid > 0 && (\n        <div><span className=\"text-gray-500\">Trap</span>: <span className=\"font-bold\">{errorCounts.trapezoid}</span></div>\n      )}\n      {errorCounts.game > 0 && (\n        <div><span className=\"text-gray-500\">Game</span>: <span className=\"font-bold\">{errorCounts.game}</span></div>\n      )}\n    </div>\n  );\n};","path":null,"size_bytes":1566,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":792,"size_tokens":null},"client/src/lib/utils/tunnelUtils.ts":{"content":"// src/utils/tunnelUtils.ts\nimport { MAX_HEALTH } from '@/lib/config/gameConstants';\n\nexport const getHealthBasedRayColor = (health: number): string => {\n  const healthFactor = Math.max(0, MAX_HEALTH - health) / MAX_HEALTH;\n  const r = Math.round(0 + (255 - 0) * healthFactor);\n  const g = Math.round(255 * (1 - healthFactor));\n  const b = Math.round(255 * (1 - healthFactor));\n  return `rgba(${r},${g},${b},1)`;\n};","path":null,"size_bytes":415,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-3.5 w-3.5 fill-primary\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1410,"size_tokens":null},"client/src/lib/managers/timingManager.ts":{"content":"// ============================================================================\n// TIMING MANAGER - Handles all time-related calculations\n// ============================================================================\n\nexport class TimingManager {\n  private startTime: number = 0;\n  private pausedTime: number = 0;\n  private totalPausedDuration: number = 0;\n  private isPaused: boolean = false;\n\n  start(): void {\n    this.startTime = performance.now();\n    this.pausedTime = 0;\n    this.totalPausedDuration = 0;\n    this.isPaused = false;\n  }\n\n  pause(): void {\n    if (!this.isPaused) {\n      this.pausedTime = performance.now();\n      this.isPaused = true;\n    }\n  }\n\n  resume(): void {\n    if (this.isPaused) {\n      this.totalPausedDuration += performance.now() - this.pausedTime;\n      this.isPaused = false;\n      this.pausedTime = 0;\n    }\n  }\n\n  /**\n   * Sync timing to a known video time (used after resume to align with YouTube)\n   * @param videoTimeMs The current video time in milliseconds\n   */\n  syncToVideoTime(videoTimeMs: number): void {\n    console.log(`[TIMING-SYNC] Syncing to video time: ${videoTimeMs.toFixed(0)}ms`);\n    // Reset start time so that getCurrentTime returns the video time\n    this.startTime = performance.now() - videoTimeMs;\n  }\n\n  getCurrentTime(videoTime?: number | null): number {\n    // Prefer authoritative video time if available\n    if (videoTime !== undefined && videoTime !== null && videoTime >= 0) {\n      return Math.round(videoTime);\n    }\n    \n    // Fallback to performance-based timing\n    const now = performance.now();\n    const elapsed = now - this.startTime - this.totalPausedDuration;\n    return Math.round(Math.max(0, elapsed));\n  }\n\n  reset(): void {\n    this.startTime = 0;\n    this.pausedTime = 0;\n    this.totalPausedDuration = 0;\n    this.isPaused = false;\n  }\n}\n","path":null,"size_bytes":1830,"size_tokens":null},"client/src/components/game/notes/TapNotes.tsx":{"content":"// src/components/TapNotes.tsx\nimport React, { memo, useCallback } from 'react';\nimport { TapNote } from './TapNote';\nimport { useTapNotes } from '@/hooks/useTapNotes';\nimport { useGameStore } from '@/stores/useGameStore';\nimport { TUNNEL_CONTAINER_WIDTH, TUNNEL_CONTAINER_HEIGHT } from '@/lib/config/gameConstants';\n\ninterface TapNotesProps {\n  vpX?: number;\n  vpY?: number;\n}\n\nconst TapNotesComponent = ({ vpX: propVpX = 350, vpY: propVpY = 300 }: TapNotesProps) => {\n  // Memoize selectors to prevent unnecessary store subscriptions\n  const currentTime = useGameStore(state => state.currentTime);\n  const beatmapBpm = useGameStore(state => state.beatmapBpm) || 120;\n  const processedNotes = useTapNotes();\n\n  return (\n    <svg \n      className=\"absolute inset-0\"\n      data-testid=\"tap-notes-container\"\n      style={{ \n        width: `${TUNNEL_CONTAINER_WIDTH}px`, \n        height: `${TUNNEL_CONTAINER_HEIGHT}px`, \n        opacity: 1, \n        pointerEvents: 'none', \n        margin: '0 auto' \n      }}\n    >\n      {processedNotes.map((noteData: any) => (\n        <TapNote\n          key={noteData.note.id}\n          note={noteData.note}\n          currentTime={currentTime}\n          vpX={propVpX}\n          vpY={propVpY}\n          state={noteData.state}\n          progressForGeometry={noteData.progressForGeometry}\n          clampedProgress={noteData.clampedProgress}\n          rawProgress={noteData.rawProgress}\n          beatmapBpm={beatmapBpm}\n        />\n      ))}\n    </svg>\n  );\n};\n\nexport const TapNotes = memo(TapNotesComponent);","path":null,"size_bytes":1539,"size_tokens":null},"client/src/App.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { queryClient } from \"./lib/config/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useConsoleLogger } from \"@/hooks/useConsoleLogger\";\nimport { initYouTubePlayer, initYouTubeTimeListener, buildYouTubeEmbedUrl } from \"@/lib/youtube\";\nimport { YOUTUBE_BACKGROUND_EMBED_OPTIONS } from \"@/lib/config/gameConstants\";\nimport Home from \"@/pages/Home\";\nimport Game from \"@/pages/Game\";\n\nfunction App() {\n  const [gameActive, setGameActive] = useState(false);\n  const [selectedDifficulty, setSelectedDifficulty] = useState<'EASY' | 'MEDIUM' | 'HARD'>('MEDIUM');\n  const youtubeIframeRef = useRef<HTMLIFrameElement>(null);\n  const playerInitializedRef = useRef<boolean>(false) as React.RefObject<boolean>;\n  const [youtubeVideoId, setYoutubeVideoId] = useState<string | null>(null);\n\n  // Initialize console logging for diagnostics\n  useConsoleLogger();\n\n  // Initialize YouTube player when iframe mounts or videoId changes\n  useEffect(() => {\n    if (!youtubeIframeRef.current || !window.YT) return;\n\n    console.log('[APP-YOUTUBE-INIT] Initializing YouTube player for videoId:', youtubeVideoId);\n    playerInitializedRef.current = false; // Reset for new video\n    \n    initYouTubePlayer(youtubeIframeRef.current, () => {\n      console.log('[APP-YOUTUBE-INIT] Player ready for videoId:', youtubeVideoId);\n      playerInitializedRef.current = true;\n    });\n    initYouTubeTimeListener();\n  }, [youtubeVideoId]);\n\n  // Get YouTube video ID from localStorage (set by Game component)\n  useEffect(() => {\n    const loadVideoId = () => {\n      const pending = localStorage.getItem('pendingBeatmap');\n      if (pending) {\n        try {\n          const data = JSON.parse(pending);\n          if (data.youtubeVideoId) {\n            setYoutubeVideoId(data.youtubeVideoId);\n          }\n        } catch (e) {\n          console.warn('[APP-YOUTUBE] Failed to parse beatmap');\n        }\n      }\n    };\n    loadVideoId();\n    const interval = setInterval(loadVideoId, 500);\n    return () => clearInterval(interval);\n  }, []);\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        {/* Persistent background container - never remounts */}\n        <div className=\"fixed inset-0 w-full h-full bg-black overflow-hidden\">\n          \n          {/* YouTube player - PERSISTENT background (z-0) */}\n          {youtubeVideoId && (\n            <div className=\"absolute inset-0 pointer-events-none z-0\">\n              <iframe\n                key={`youtube-${youtubeVideoId}`}\n                ref={youtubeIframeRef}\n                width=\"100%\"\n                height=\"100%\"\n                src={buildYouTubeEmbedUrl(youtubeVideoId, {\n                  ...YOUTUBE_BACKGROUND_EMBED_OPTIONS,\n                  autoplay: false\n                })}\n                title=\"YouTube background audio/video sync\"\n                allow=\"autoplay; encrypted-media\"\n                style={{ display: 'block', opacity: 0.05, width: '100%', height: '100%', objectFit: 'cover' as const }}\n                data-testid=\"iframe-youtube-background\"\n              />\n            </div>\n          )}\n\n          {/* UI Layer - Home or Game (z-10+) */}\n          <div className=\"absolute inset-0 z-10\">\n            {!gameActive && (\n              <Home onStartGame={(difficulty) => { setSelectedDifficulty(difficulty); setGameActive(true); }} />\n            )}\n            {gameActive && (\n              <Game \n                key={`game-${youtubeVideoId}-${selectedDifficulty}-${gameActive}`}\n                difficulty={selectedDifficulty}\n                onBackToHome={() => setGameActive(false)}\n                playerInitializedRef={playerInitializedRef}\n                youtubeVideoId={youtubeVideoId}\n              />\n            )}\n          </div>\n        </div>\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":4054,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/lib/config/useApiQuery.ts":{"content":"// src/lib/config/useApiQuery.ts\nimport { useEffect, useState, useCallback } from 'react';\nimport { useApiStore } from '@/stores/useApiStore';\n\ninterface UseApiQueryReturn<T> {\n  data: T | null;\n  loading: boolean;\n  error: Error | null;\n  refetch: () => Promise<void>;\n}\n\nexport function useApiQuery<T>(url: string, on401?: \"returnNull\" | \"throw\"): UseApiQueryReturn<T> {\n  const apiRequest = useApiStore(state => state.apiRequest);\n  const [data, setData] = useState<T | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n\n  const fetchData = useCallback(async (): Promise<void> => {\n    setLoading(true);\n    setError(null);\n    try {\n      const result = await apiRequest<T>('GET', url);\n      setData(result);\n    } catch (err: unknown) {\n      const errorObj = err instanceof Error ? err : new Error(String(err));\n      if (on401 === \"throw\") {\n        throw errorObj;\n      } else if (on401 === \"returnNull\") {\n        setData(null);\n      }\n      setError(errorObj);\n    } finally {\n      setLoading(false);\n    }\n  }, [url, apiRequest, on401]);\n\n  useEffect(() => {\n    fetchData();\n  }, [fetchData]);\n\n  return {\n    data,\n    loading,\n    error,\n    refetch: fetchData,\n  };\n}","path":null,"size_bytes":1255,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1598,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":768,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":649,"size_tokens":null},"client/src/lib/config/gameConstants.ts":{"content":"// src/lib/config/gameConstants.ts\n// Shared game constants used across components\n\n/**\n * Button configuration for all 6 lanes (4 soundpads + 2 deck controls)\n * \n * SOUNDPAD LANES (0-3): Hexagonal tunnel, clockwise from top\n *  - Lane 0 (W): 120Â° top-left pink - SOUNDPAD_W\n *  - Lane 1 (O): 60Â° top-right blue - SOUNDPAD_O\n *  - Lane 2 (I): 300Â° bottom-right purple - SOUNDPAD_I\n *  - Lane 3 (E): 240Â° bottom-left cyan - SOUNDPAD_E\n * \n * DECK CONTROL LANES (negative): Turntable controls outside tunnel\n *  - Lane -1 (Q): 180Â° left deck green - DECK_LEFT\n *  - Lane -2 (P): 0Â° right deck red - DECK_RIGHT\n */\nexport interface ButtonConfig {\n  /** Lane ID: 0-3 for soundpads, negative for deck controls (-1, -2) */\n  lane: number;\n  /** Keyboard key binding for this button */\n  key: string;\n  /** Angle in degrees from center (0-360), used for hexagon positioning and deck rotation */\n  angle: number;\n  /** Hex color code for button and note rendering */\n  color: string;\n}\n\nexport const BUTTON_CONFIG: ButtonConfig[] = [\n  // SOUNDPAD LANES (tunnel): 4 hexagon rays, 60Â° apart, clockwise from top\n  { lane: 0, key: 'W', angle: 120, color: '#FF007F' }, // Lane 0 (W): 120Â° top-left, pink\n  { lane: 1, key: 'O', angle: 60, color: '#0096FF' },  // Lane 1 (O): 60Â° top-right, blue\n  { lane: 2, key: 'I', angle: 300, color: '#BE00FF' }, // Lane 2 (I): 300Â° bottom-right, purple\n  { lane: 3, key: 'E', angle: 240, color: '#00FFFF' }, // Lane 3 (E): 240Â° bottom-left, cyan\n  // DECK CONTROL LANES (turntable): outside tunnel, opposite sides\n  { lane: -1, key: 'Q', angle: 180, color: '#00FF00' }, // Lane -1 (Q): 180Â° left deck, green\n  { lane: -2, key: 'P', angle: 0, color: '#FF0000' },   // Lane -2 (P): 0Â° right deck, red\n];\n\n/**\n * 2D polar coordinate tunnel geometry for perspective rendering\n * Uses 6 lanes (0-3 soundpads, -1 to -2 decks) radiating from vanishing point\n */\nexport interface TunnelGeometry {\n  /** Center X coordinate of tunnel perspective (vanishing point) */\n  vanishingPointX: number;\n  /** Center Y coordinate of tunnel perspective (vanishing point) */\n  vanishingPointY: number;\n  /** Max distance (from vanishing point) before notes despawn, pixels */\n  tunnelMaxDistance: number;\n  /** SVG container width in pixels */\n  tunnelContainerWidth: number;\n  /** SVG container height in pixels */\n  tunnelContainerHeight: number;\n  /** Distance where notes are scored (judgement line), pixels from vanishing point */\n  judgementRadius: number;\n  /** 6 concentric hexagon radii for visual layering (inner to outer), pixels */\n  hexagonRadii: number[];\n  /** 6 ray angles (lanes) at 60Â° intervals: 0Â°, 60Â°, 120Â°, 180Â°, 240Â°, 300Â° */\n  rayAngles: number[];\n  /** Thickness of TAP note hit zone around judgement line, pixels */\n  tapJudgementLineWidth: number;\n  /** Thickness of HOLD note hit zone around judgement line, pixels */\n  holdJudgementLineWidth: number;\n}\n\nexport const TUNNEL_GEOMETRY: TunnelGeometry = {\n  // Vanishing point: center of perspective (where all rays converge)\n  vanishingPointX: 350,    // Center X of 700px wide container\n  vanishingPointY: 300,    // Center Y of 600px tall container\n  // Rendering range\n  tunnelMaxDistance: 260,  // Notes visible from VP to 260px (at distance=1 to distance=187)\n  tunnelContainerWidth: 700,   // SVG viewport width\n  tunnelContainerHeight: 600,  // SVG viewport height\n  // Scoring zone: where notes must reach to be hit\n  judgementRadius: 187,    // Matches 5th hexagon radius (notes are scored here)\n  // 6 concentric hexagon layers for visual hierarchy and depth illusion\n  hexagonRadii: [22, 52, 89, 135, 187, 248],  // Inner â†’ Outer (pixel distances from VP)\n  // 6 lanes (soundpads + decks) evenly spaced 60Â° apart\n  rayAngles: [0, 60, 120, 180, 240, 300],     // Degrees from VP center\n  // Hit zones: thickness of scoring window around judgement line\n  tapJudgementLineWidth: 35,   // Â±17.5px from judgement line\n  holdJudgementLineWidth: 45,  // Â±22.5px from judgement line\n};\n\n// Convenience exports for commonly used tunnel constants\nexport const RAY_ANGLES = TUNNEL_GEOMETRY.rayAngles;\nexport const TUNNEL_MAX_DISTANCE = TUNNEL_GEOMETRY.tunnelMaxDistance;\nexport const TAP_JUDGEMENT_LINE_WIDTH = TUNNEL_GEOMETRY.tapJudgementLineWidth;\nexport const JUDGEMENT_RADIUS = TUNNEL_GEOMETRY.judgementRadius;\n\n/**\n * HOLD note visual geometry - controls strip rendering and failure animation\n * HOLD notes render as strips with duration mapped to visual width\n */\nexport interface HoldNoteGeometry {\n  /** Multiplier: duration (ms) Ã— this value = visual width in pixels at judgement */\n  stripWidthMultiplier: number;\n  /** Time for failure animation (glitch effect) to play, milliseconds */\n  failureAnimationDuration: number;\n}\nexport const HOLD_NOTE_GEOMETRY: HoldNoteGeometry = {\n  stripWidthMultiplier: 0.15,        // 1000ms duration â†’ 150px strip width\n  failureAnimationDuration: 1100,    // Glitch effect duration on missed hold\n};\n\n/**\n * TAP note visual timing - controls when notes appear and disappear\n */\nexport interface TapNoteGeometry {\n  /** Time before note.time that TAP note becomes visible (appears at VP), milliseconds */\n  renderWindowMs: number;\n  /** Time after judgement line passes before TAP note despawns, milliseconds */\n  fallthroughWindowMs: number;\n}\nexport const TAP_NOTE_GEOMETRY: TapNoteGeometry = {\n  renderWindowMs: 4000,      // TAP notes visible 4000ms before hit (matches LEAD_TIME)\n  fallthroughWindowMs: 200,  // Notes visible 200ms past judgement line before disappearing\n};\n\n/** RGB colors for 4 soundpad lanes (index = lane number) */\nexport const SOUNDPAD_COLORS = [\n  'rgb(255,0,127)',   // Lane 0 (W): 120Â° top-left, pink\n  'rgb(0,150,255)',   // Lane 1 (O): 60Â° top-right, blue\n  'rgb(190,0,255)',   // Lane 2 (I): 300Â° bottom-right, purple\n  'rgb(0,255,255)'    // Lane 3 (E): 240Â° bottom-left, cyan\n];\n\n/**\n * Deck (turntable) rotation mechanics - for deck wheel (lanes -1 and -2)\n */\nexport interface DeckRotation {\n  /** Base rotation increment per frame, degrees */\n  rotationSpeed: number;\n  /** Total rotation required to trigger spin note activation, degrees */\n  spinThreshold: number;\n  /** Min drag speed to count as spin input, pixels per second */\n  dragVelocityThreshold: number;\n}\nexport const DECK_ROTATION: DeckRotation = {\n  rotationSpeed: 2.0,              // 2Â° per frame at ~60fps â‰ˆ 120Â°/sec\n  spinThreshold: 30,               // Hold note activates after 30Â° total rotation\n  dragVelocityThreshold: 100,      // Drag must be â‰¥100px/s to register as spin\n};\n\n/**\n * Visual effects - particle spawning, screen effects, and health state animations\n */\nexport interface VisualEffects {\n  /** Game health maximum (also MAX_HEALTH constant) */\n  maxHealth: number;\n  /** Health threshold where continuous glitch effect starts (25% of max) */\n  lowHealthThreshold: number;\n  /** Spawn particles every N combo count (normal milestone) */\n  comboMilestone: number;\n  /** Spawn particles every N combo count (perfect-only milestone) */\n  comboPerfectMilestone: number;\n  /** Particles spawned per combo milestone trigger */\n  particlesPerEffect: number;\n  /** Max particles allowed alive at once (buffer pool size) */\n  maxParticlesBuffer: number;\n  /** Particle sprite size range, pixels */\n  particleSizeMin: number;\n  particleSizeMax: number;\n  /** Screen shake: update interval between offset changes, milliseconds */\n  shakeInterval: number;\n  /** Screen shake: max random offset per update, pixels */\n  shakeOffsetMultiplier: number;\n  /** Screen shake: total duration, milliseconds */\n  shakeDuration: number;\n  /** Chromatic aberration (RGB split): duration, milliseconds */\n  chromaticDuration: number;\n  /** Chromatic aberration: effect strength, 0-1 */\n  chromaticIntensity: number;\n  /** Chromatic aberration: RGB channel offset, pixels */\n  chromaticOffsetPx: number;\n  /** Glitch effect: base interval between glitch pulses, milliseconds */\n  glitchBaseInterval: number;\n  /** Glitch effect: random variance added to interval, milliseconds */\n  glitchRandomRange: number;\n  /** Glitch effect: base opacity of glitch scan lines, 0-1 */\n  glitchOpacity: number;\n  /** Greyscale filter: max intensity at 0 health, 0-1 */\n  greyscaleIntensity: number;\n  /** Glitch effect: height of scan line effect, pixels */\n  glitchBackgroundSize: number;\n}\nexport const VISUAL_EFFECTS: VisualEffects = {\n  maxHealth: 200,                  // Health ranges 0-200\n  lowHealthThreshold: 50,          // At â‰¤50 health (25%), continuous glitch starts\n  comboMilestone: 5,               // Particles spawn at combos 5, 10, 15, etc.\n  comboPerfectMilestone: 10,       // Perfect-only particles at 10, 20, 30, etc.\n  particlesPerEffect: 12,          // 12 particles per trigger\n  maxParticlesBuffer: 60,          // Max 60 particles total on screen\n  particleSizeMin: 4,              // Smallest particle sprite: 4px\n  particleSizeMax: 12,             // Largest particle sprite: 12px\n  shakeInterval: 50,               // Screen shake updates every 50ms (~20Hz)\n  shakeOffsetMultiplier: 16,       // Max Â±16px shake per frame\n  shakeDuration: 300,              // Screen shake lasts 300ms total\n  chromaticDuration: 400,          // RGB aberration lasts 400ms\n  chromaticIntensity: 0.8,         // 80% strength aberration (strong effect)\n  chromaticOffsetPx: 15,           // RGB channels offset 15px apart\n  glitchBaseInterval: 400,         // Glitch pulses every 400ms\n  glitchRandomRange: 200,          // Plus 0-200ms random variance\n  glitchOpacity: 0.3,              // Glitch lines at 30% opacity\n  greyscaleIntensity: 0.8,         // Full greyscale at 0 health (80%)\n  glitchBackgroundSize: 60,        // Scan lines 60px tall\n};\n\n/**\n * Color palette for particle effects (spawned on combo milestones)\n */\nexport interface ParticleColorPalette {\n  /** Array of HSL color strings for particle variety */\n  colors: string[];\n}\nexport const PARTICLE_COLOR_PALETTE: ParticleColorPalette = {\n  colors: [\n    'hsl(120, 100%, 50%)',   // Bright green\n    'hsl(0, 100%, 50%)',     // Bright red\n    'hsl(180, 100%, 50%)',   // Bright cyan\n    'hsl(280, 100%, 60%)',   // Bright purple\n    'hsl(320, 100%, 60%)',   // Bright magenta\n  ],\n};\n/** Convenience export: direct reference to particle colors */\nexport const PARTICLE_COLORS = PARTICLE_COLOR_PALETTE.colors;\n\n/**\n * Deck hold meter display - shows progress for SPIN_LEFT/SPIN_RIGHT hold notes\n * Meter fills as player holds rotation, glows when complete\n */\nexport interface DeckMeter {\n  /** Number of visual segments in the meter bar */\n  segments: number;\n  /** Width of each segment, pixels */\n  segmentWidth: number;\n  /** Progress threshold to trigger completion glow, 0-1 (1 = 100%) */\n  completionThreshold: number;\n  /** Duration of glow pulse when meter completes, milliseconds */\n  completionGlowDuration: number;\n  /** Default hold duration if beatmap doesn't specify, milliseconds */\n  defaultHoldDuration: number;\n}\nexport const DECK_METER: DeckMeter = {\n  segments: 16,                    // 16 segments = 16 Ã— 60px = 960px total width\n  segmentWidth: 60,                // Each segment fills independently as hold progresses\n  completionThreshold: 0.95,       // Glow at 95% full (allows 5% tolerance)\n  completionGlowDuration: 400,     // Glow pulse lasts 400ms\n  defaultHoldDuration: 1000,       // If beatmap missing, hold requires 1000ms\n};\n\n/**\n * UI color palette - hex and HSL colors for all interactive elements\n * Maps soundpad lanes, deck controls, and particle effects\n */\nexport interface UIColorPalette {\n  /** Lane -1 (Q) deck control, left turntable */\n  deckLeft: string;\n  /** Lane -2 (P) deck control, right turntable */\n  deckRight: string;\n  /** Lane 0 (W) soundpad, 120Â° top-left */\n  padW: string;\n  /** Lane 1 (O) soundpad, 60Â° top-right */\n  padO: string;\n  /** Lane 2 (I) soundpad, 300Â° bottom-right */\n  padI: string;\n  /** Lane 3 (E) soundpad, 240Â° bottom-left */\n  padE: string;\n  /** Green particle color for combo effects */\n  particleGreen: string;\n  /** Red particle color for combo effects */\n  particleRed: string;\n}\nexport const UI_COLOR_PALETTE: UIColorPalette = {\n  deckLeft: '#00FF00',              // Lane -1: Green\n  deckRight: '#FF0000',             // Lane -2: Red\n  padW: '#FF007F',                  // Lane 0: Pink\n  padO: '#0096FF',                  // Lane 1: Blue\n  padI: '#BE00FF',                  // Lane 2: Purple\n  padE: '#00FFFF',                  // Lane 3: Cyan\n  particleGreen: 'hsl(120, 100%, 50%)',  // Green particles\n  particleRed: 'hsl(0, 100%, 50%)',      // Red particles\n};\n/** Individual color exports for convenience access */\nexport const COLOR_DECK_LEFT = UI_COLOR_PALETTE.deckLeft;\nexport const COLOR_DECK_RIGHT = UI_COLOR_PALETTE.deckRight;\nexport const COLOR_PAD_W = UI_COLOR_PALETTE.padW;\nexport const COLOR_PAD_O = UI_COLOR_PALETTE.padO;\nexport const COLOR_PAD_I = UI_COLOR_PALETTE.padI;\nexport const COLOR_PAD_E = UI_COLOR_PALETTE.padE;\nexport const COLOR_PARTICLE_GREEN = UI_COLOR_PALETTE.particleGreen;\nexport const COLOR_PARTICLE_RED = UI_COLOR_PALETTE.particleRed;\n\n/**\n * YouTube loader UI strings - dialog and error messages\n */\nexport interface YouTubeUI {\n  /** Main button label to open YouTube loader */\n  labelButton: string;\n  /** Dialog title when loading video */\n  dialogTitle: string;\n  /** Input field label */\n  inputLabel: string;\n  /** Input placeholder text */\n  inputPlaceholder: string;\n  /** Error message when URL/ID is empty */\n  errorEmpty: string;\n  /** Error message when URL/ID is invalid */\n  errorInvalid: string;\n  /** Load button label */\n  buttonLoad: string;\n  /** Cancel button label */\n  buttonCancel: string;\n  /** Label for video preview panel */\n  previewLabel: string;\n  /** Tooltip for preview video */\n  previewTitle: string;\n  /** Help text explaining video usage */\n  helpText: string;\n}\nexport const YOUTUBE_UI: YouTubeUI = {\n  labelButton: 'LOAD YOUTUBE',\n  dialogTitle: 'LOAD YOUTUBE VIDEO',\n  inputLabel: 'YouTube URL or Video ID',\n  inputPlaceholder: 'https://youtube.com/watch?v=... or just the video ID',\n  errorEmpty: 'Please enter a YouTube URL or video ID',\n  errorInvalid: 'Invalid YouTube URL or video ID',\n  buttonLoad: 'LOAD',\n  buttonCancel: 'CANCEL',\n  previewLabel: 'â–¶ YouTube',\n  previewTitle: 'YouTube video preview',\n  helpText: 'The video will play silently in the background. Use its timing for gameplay sync.',\n};\n\n/**\n * YouTube preview panel dimensions and opacity settings\n */\nexport interface YouTubeDimensions {\n  /** Preview panel width, pixels (w-64 Tailwind = 256px) */\n  previewWidth: number;\n  /** Preview panel height, pixels (h-36 Tailwind = 144px) */\n  previewHeight: number;\n  /** Default opacity when not hovering, 0-1 */\n  previewOpacityDefault: number;\n  /** Opacity when hovering over preview, 0-1 */\n  previewOpacityHover: number;\n  /** Close button icon size, pixels */\n  closeIconSize: number;\n}\nexport const YOUTUBE_DIMENSIONS: YouTubeDimensions = {\n  previewWidth: 256,              // Tailwind w-64\n  previewHeight: 144,             // Tailwind h-36 (16:9 aspect)\n  previewOpacityDefault: 0.1,     // 10% - subtle background video\n  previewOpacityHover: 0.2,       // 20% - more visible on hover\n  closeIconSize: 14,              // Small close button\n};\n\n/**\n * YouTube embed iframe configuration for preview and background players\n */\nexport interface YouTubeEmbedOptions {\n  /** Auto-start video (false = manual play control) */\n  autoplay: boolean;\n  /** Show YouTube player controls in iframe */\n  controls: boolean;\n  /** Hide YouTube branding in player */\n  modestBranding: boolean;\n  /** Enable JS API for player control */\n  enableJsApi: boolean;\n}\nexport const YOUTUBE_PREVIEW_EMBED_OPTIONS: YouTubeEmbedOptions = {\n  autoplay: false,              // Player starts paused\n  controls: false,              // No controls in preview\n  modestBranding: true,         // Minimal YouTube UI\n  enableJsApi: true             // Can control via JS\n} as const;\n\nexport const YOUTUBE_BACKGROUND_EMBED_OPTIONS: YouTubeEmbedOptions = {\n  autoplay: false,              // App controls timing\n  controls: false,              // Hidden background player\n  modestBranding: true,         // Minimal UI if visible\n  enableJsApi: true             // Must sync with game timer\n} as const;\n\n// Down3D Note Lane - tunnel geometry constants (already in TUNNEL_GEOMETRY)\n\n/**\n * Game engine timing - BPM ranges, note generation, and sync intervals\n */\nexport interface GameEngineTiming {\n  /** Easy difficulty target BPM (slowest) */\n  easyBpm: number;\n  /** Medium difficulty target BPM */\n  mediumBpm: number;\n  /** Hard difficulty target BPM (fastest) */\n  hardBpm: number;\n  /** Conversion constant: milliseconds per minute, for BPM â†’ time conversions */\n  msPerMinute: number;\n  /** Delay before first note spawns, milliseconds */\n  noteStartTime: number;\n  /** Cap on generated notes (procedural generation safety limit) */\n  maxGeneratedNotes: number;\n  /** Generate SPIN notes every N beats (4 = every 4th beat) */\n  spinFrequency: number;\n  /** Alternate SPIN_LEFT and SPIN_RIGHT every N beats */\n  spinAlternation: number;\n  /** HOLD notes appear this many ms before hit (matches TAP_RENDER_WINDOW_MS in TAP_NOTE_GEOMETRY) */\n  leadTime: number;\n  /** TAP notes appear this many ms before hit (currently 2000ms, unused - see TAP_NOTE_GEOMETRY) */\n  tapRenderWindowMs: number;\n  /** TAP notes stay visible this many ms after judgement line passes */\n  tapFallthroughWindowMs: number;\n  /** HOLD notes appear this many ms before hit */\n  holdRenderWindowMs: number;\n  /** Note sync animation update interval, milliseconds (~60fps) */\n  notesSyncInterval: number;\n  /** Batch state updates, milliseconds */\n  stateUpdateBatchInterval: number;\n  /** State update interval, milliseconds */\n  stateUpdateInterval: number;\n}\nexport const GAME_ENGINE_TIMING: GameEngineTiming = {\n  easyBpm: 60,                   // Slowest difficulty\n  mediumBpm: 90,                 // Medium speed\n  hardBpm: 120,                  // Fastest difficulty (2 beats/sec)\n  msPerMinute: 60000,            // 60 seconds Ã— 1000ms\n  noteStartTime: 2000,           // 2 second delay before first note\n  maxGeneratedNotes: 1000,       // Safety cap to prevent memory issues\n  spinFrequency: 4,              // Generate spin every 4 beats\n  spinAlternation: 8,            // Alternate left/right every 8 beats\n  leadTime: 4000,                // HOLD notes visible 4000ms before hit\n  tapRenderWindowMs: 2000,       // TAP notes appear 2000ms before (unused - see TAP_NOTE_GEOMETRY)\n  tapFallthroughWindowMs: 1100,  // TAP notes last 1100ms past judgement\n  holdRenderWindowMs: 4000,      // HOLD notes visible 4000ms before hit\n  notesSyncInterval: 16,         // ~60fps update rate (1000/60 â‰ˆ 16ms)\n  stateUpdateBatchInterval: 50,  // Batch updates every 50ms\n  stateUpdateInterval: 50,       // 20Hz state updates\n};\n\n// BPM and tunnel speed calibration\nexport const REFERENCE_BPM = 120;               // Reference BPM for LEAD_TIME scaling (hardest difficulty)\nexport const DEFAULT_BEATMAP_BPM = 120;        // Default BPM if beatmap metadata missing\n\n// Hold animation duration (already in FAILURE_ANIMATION_DURATION)\n\n// Grouped convenience interfaces for related visual effects\nexport interface HealthThresholds {\n  max: number;\n  lowThreshold: number;\n}\nexport const HEALTH_THRESHOLDS: HealthThresholds = {\n  max: VISUAL_EFFECTS.maxHealth,\n  lowThreshold: VISUAL_EFFECTS.lowHealthThreshold,\n};\n\nexport interface ComboMilestones {\n  normal: number;\n  perfect: number;\n}\nexport const COMBO_MILESTONES: ComboMilestones = {\n  normal: VISUAL_EFFECTS.comboMilestone,\n  perfect: VISUAL_EFFECTS.comboPerfectMilestone,\n};\n\nexport interface ChromaticEffect {\n  duration: number;\n  intensity: number;\n  offsetPx: number;\n}\nexport const CHROMATIC_EFFECT: ChromaticEffect = {\n  duration: VISUAL_EFFECTS.chromaticDuration,\n  intensity: VISUAL_EFFECTS.chromaticIntensity,\n  offsetPx: VISUAL_EFFECTS.chromaticOffsetPx,\n};\n\nexport interface GlitchEffect {\n  baseInterval: number;\n  randomRange: number;\n  opacity: number;\n  backgroundSize: number;\n}\nexport const GLITCH_EFFECT: GlitchEffect = {\n  baseInterval: VISUAL_EFFECTS.glitchBaseInterval,\n  randomRange: VISUAL_EFFECTS.glitchRandomRange,\n  opacity: VISUAL_EFFECTS.glitchOpacity,\n  backgroundSize: VISUAL_EFFECTS.glitchBackgroundSize,\n};\n\nexport interface ParticleSize {\n  min: number;\n  max: number;\n}\nexport const PARTICLE_SIZE: ParticleSize = {\n  min: VISUAL_EFFECTS.particleSizeMin,\n  max: VISUAL_EFFECTS.particleSizeMax,\n};\n\nexport interface TunnelViewport {\n  vanishingPointX: number;\n  vanishingPointY: number;\n  containerWidth: number;\n  containerHeight: number;\n}\nexport const TUNNEL_VIEWPORT: TunnelViewport = {\n  vanishingPointX: TUNNEL_GEOMETRY.vanishingPointX,\n  vanishingPointY: TUNNEL_GEOMETRY.vanishingPointY,\n  containerWidth: TUNNEL_GEOMETRY.tunnelContainerWidth,\n  containerHeight: TUNNEL_GEOMETRY.tunnelContainerHeight,\n};\n\nexport interface DeckWheelConfig {\n  rotationSpeed: number;\n  spinThreshold: number;\n  dragVelocityThreshold: number;\n}\nexport const DECK_WHEEL_CONFIG: DeckWheelConfig = {\n  rotationSpeed: DECK_ROTATION.rotationSpeed,\n  spinThreshold: DECK_ROTATION.spinThreshold,\n  dragVelocityThreshold: DECK_ROTATION.dragVelocityThreshold,\n};\n\n// Top-level exports for backward compatibility and direct access\n// Health exports\nexport const LOW_HEALTH_THRESHOLD = HEALTH_THRESHOLDS.lowThreshold;\n\n// Combo exports\nexport const COMBO_MILESTONE = COMBO_MILESTONES.normal;\nexport const COMBO_PERFECT_MILESTONE = COMBO_MILESTONES.perfect;\n\n// Chromatic effect exports\nexport const CHROMATIC_DURATION = CHROMATIC_EFFECT.duration;\nexport const CHROMATIC_INTENSITY = CHROMATIC_EFFECT.intensity;\nexport const CHROMATIC_OFFSET_PX = CHROMATIC_EFFECT.offsetPx;\n\n// Greyscale export\nexport const GREYSCALE_INTENSITY = VISUAL_EFFECTS.greyscaleIntensity;\n\n// Glitch effect exports\nexport const GLITCH_BACKGROUND_SIZE = GLITCH_EFFECT.backgroundSize;\nexport const GLITCH_BASE_INTERVAL = GLITCH_EFFECT.baseInterval;\nexport const GLITCH_RANDOM_RANGE = GLITCH_EFFECT.randomRange;\nexport const GLITCH_OPACITY = GLITCH_EFFECT.opacity;\n\n// Particle size exports\nexport const PARTICLE_SIZE_MIN = PARTICLE_SIZE.min;\nexport const PARTICLE_SIZE_MAX = PARTICLE_SIZE.max;\n\n// Tunnel geometry exports\nexport const HEXAGON_RADII = TUNNEL_GEOMETRY.hexagonRadii;\nexport const HOLD_JUDGEMENT_LINE_WIDTH = TUNNEL_GEOMETRY.holdJudgementLineWidth;\n\n// Tunnel viewport exports\nexport const VANISHING_POINT_X = TUNNEL_VIEWPORT.vanishingPointX;\nexport const VANISHING_POINT_Y = TUNNEL_VIEWPORT.vanishingPointY;\nexport const TUNNEL_CONTAINER_WIDTH = TUNNEL_VIEWPORT.containerWidth;\nexport const TUNNEL_CONTAINER_HEIGHT = TUNNEL_VIEWPORT.containerHeight;\n\n// Hold Note Geometry exports\nexport const HOLD_NOTE_STRIP_WIDTH_MULTIPLIER = HOLD_NOTE_GEOMETRY.stripWidthMultiplier;\nexport const FAILURE_ANIMATION_DURATION = HOLD_NOTE_GEOMETRY.failureAnimationDuration;\n\n// Tap Note Geometry exports\nexport const TAP_RENDER_WINDOW_MS = TAP_NOTE_GEOMETRY.renderWindowMs;\nexport const TAP_FALLTHROUGH_WINDOW_MS = TAP_NOTE_GEOMETRY.fallthroughWindowMs;\n\n// Deck Meter exports\nexport const DECK_METER_SEGMENTS = DECK_METER.segments;\nexport const DECK_METER_SEGMENT_WIDTH = DECK_METER.segmentWidth;\nexport const DECK_METER_COMPLETION_THRESHOLD = DECK_METER.completionThreshold;\nexport const DECK_METER_COMPLETION_GLOW_DURATION = DECK_METER.completionGlowDuration;\nexport const DECK_METER_DEFAULT_HOLD_DURATION = DECK_METER.defaultHoldDuration;\n\n// Deck Rotation exports\nexport const ROTATION_SPEED = DECK_WHEEL_CONFIG.rotationSpeed;\nexport const SPIN_THRESHOLD = DECK_WHEEL_CONFIG.spinThreshold;\nexport const DRAG_VELOCITY_THRESHOLD = DECK_WHEEL_CONFIG.dragVelocityThreshold;\n\n// ============================================================================\n// GAME CONFIG - Single source of truth for all gameplay constants\n// ============================================================================\n\n/**\n * GAME CONFIG - Single source of truth for all gameplay timing and scoring\n * Asymmetric windows: narrow before note.time, larger leniency after\n */\nexport interface GameConfigConstants {\n  /** TAP note hit window: Â±150ms around note.time for successful hit */\n  TAP_HIT_WINDOW: number;\n  /** TAP note failure buffer: extra time after TAP_HIT_WINDOW before auto-miss */\n  TAP_FAILURE_BUFFER: number;\n  /** HOLD note start window: Â±150ms around note.time to successfully press hold */\n  HOLD_HIT_WINDOW: number;\n  /** HOLD note miss timeout: time after note.time before hold auto-fails if not pressed */\n  HOLD_MISS_TIMEOUT: number;\n  /** HOLD release offset: extra time before expected release before failure */\n  HOLD_RELEASE_OFFSET: number;\n  /** HOLD release window: Â±time around expected release time for successful release */\n  HOLD_RELEASE_WINDOW: number;\n  /** HOLD activation window: max time after note.time to press hold (same as HIT_WINDOW) */\n  HOLD_ACTIVATION_WINDOW: number;\n  /** LEAD_TIME: milliseconds before note.time that notes become visible (appear at VP) */\n  LEAD_TIME: number;\n  /** Timing accuracy threshold for \"PERFECT\" rating, milliseconds */\n  ACCURACY_PERFECT_MS: number;\n  /** Timing accuracy threshold for \"GREAT\" rating, milliseconds */\n  ACCURACY_GREAT_MS: number;\n  /** Score points for PERFECT accuracy */\n  ACCURACY_PERFECT_POINTS: number;\n  /** Score points for GREAT accuracy */\n  ACCURACY_GREAT_POINTS: number;\n  /** Score points for normal hit */\n  ACCURACY_NORMAL_POINTS: number;\n  /** Game health system maximum (also MAX_HEALTH export) */\n  MAX_HEALTH: number;\n}\n\nexport const GAME_CONFIG: GameConfigConstants = {\n  // TAP note timing (tight window around note.time)\n  TAP_HIT_WINDOW: 150,            // Â±150ms = 300ms total window\n  TAP_FAILURE_BUFFER: 100,        // Additional 100ms before auto-miss\n  // HOLD note timing (asymmetric: tight before, leniency after)\n  HOLD_HIT_WINDOW: 150,           // Â±150ms around note.time to press\n  HOLD_MISS_TIMEOUT: 500,         // 500ms after note.time before auto-fail\n  HOLD_RELEASE_OFFSET: 200,       // Time before expected release\n  HOLD_RELEASE_WINDOW: 150,       // Â±150ms around expected release\n  HOLD_ACTIVATION_WINDOW: 150,    // Must match HOLD_HIT_WINDOW for sync verification\n  // Rendering: notes visible this long before note.time\n  LEAD_TIME: 4000,                // 4000ms before hit (notes approach from VP)\n  // Accuracy thresholds for scoring\n  ACCURACY_PERFECT_MS: 50,        // Â±50ms = PERFECT\n  ACCURACY_GREAT_MS: 100,         // Â±100ms = GREAT\n  ACCURACY_PERFECT_POINTS: 100,   // Points for PERFECT\n  ACCURACY_GREAT_POINTS: 75,      // Points for GREAT\n  ACCURACY_NORMAL_POINTS: 50,     // Points for normal/late hit\n  // Game state\n  MAX_HEALTH: 200,                // Health 0-200\n};\n\n// Game Config exports (individual constants for convenience)\nexport const TAP_HIT_WINDOW = GAME_CONFIG.TAP_HIT_WINDOW;\nexport const TAP_FAILURE_BUFFER = GAME_CONFIG.TAP_FAILURE_BUFFER;\nexport const HOLD_HIT_WINDOW = GAME_CONFIG.HOLD_HIT_WINDOW;\nexport const HOLD_MISS_TIMEOUT = GAME_CONFIG.HOLD_MISS_TIMEOUT;\nexport const HOLD_RELEASE_OFFSET = GAME_CONFIG.HOLD_RELEASE_OFFSET;\nexport const HOLD_RELEASE_WINDOW = GAME_CONFIG.HOLD_RELEASE_WINDOW;\nexport const HOLD_ACTIVATION_WINDOW = GAME_CONFIG.HOLD_ACTIVATION_WINDOW;\nexport const LEAD_TIME = GAME_CONFIG.LEAD_TIME;\nexport const ACCURACY_PERFECT_MS = GAME_CONFIG.ACCURACY_PERFECT_MS;\nexport const ACCURACY_GREAT_MS = GAME_CONFIG.ACCURACY_GREAT_MS;\nexport const ACCURACY_PERFECT_POINTS = GAME_CONFIG.ACCURACY_PERFECT_POINTS;\nexport const ACCURACY_GREAT_POINTS = GAME_CONFIG.ACCURACY_GREAT_POINTS;\nexport const ACCURACY_NORMAL_POINTS = GAME_CONFIG.ACCURACY_NORMAL_POINTS;\n\n// Game Engine exports\nexport const STATE_UPDATE_INTERVAL = GAME_ENGINE_TIMING.stateUpdateInterval;\nexport const MAX_HEALTH = GAME_CONFIG.MAX_HEALTH;\n\n// ============================================================================\n// TAP NOTE SPECIFIC CONSTANTS\n// ============================================================================\n\n/** TAP note failure animation durations */\nexport const TAP_FAILURE_ANIMATIONS = {\n  TOO_EARLY: { duration: 1200 },  // Glitch effect when pressed too early\n  MISS: { duration: 1100 },       // Glitch effect when missed\n} as const;\n\n/** TAP note hit flash animation timing */\nexport const TAP_HIT_FLASH = {\n  DURATION: 600,                  // Total white flash duration\n  FADE_START: 600,                // When fade-out begins (at end)\n  FADE_DURATION: 100,             // Fade-out duration\n} as const;\n\n/** TAP note rendering depth (distance from VP) */\nexport const TAP_DEPTH = {\n  MIN: 5,                         // Closest visible distance (pixels)\n  MAX: 40,                        // Farthest distance before fade\n  FADE_TIME: 2000,                // Fade-in duration as note approaches\n} as const;\n\n/** TAP note geometry - spread angle for 8Â° cone from each ray */\nexport const TAP_RAY = {\n  SPREAD_ANGLE: 8,                // Â±8Â° spread from lane ray (16Â° total)\n} as const;\n\n/** TAP note colors - stroke and glow effects */\nexport const TAP_COLORS = {\n  STROKE_DEFAULT: 'rgba(255,255,255,0.8)',  // White outline during approach\n  STROKE_FAILED: 'rgba(120, 120, 120, 1)',  // Grey outline when failed\n  GLOW_SHADOW: (color: string) => `drop-shadow(0 0 35px ${color}) drop-shadow(0 0 20px ${color}) drop-shadow(0 0 10px ${color})`,  // Triple-layer glow\n} as const;\n\n/** TAP note opacity ranges for visual progression */\nexport const TAP_OPACITY = {\n  MIN_BASE: 0.4,                  // Base opacity during approach\n  MAX_PROGRESSION: 0.6,           // Peak opacity near judgement\n  MIN_FADE: 0.1,                  // Opacity at start of approach\n} as const;\n\n// ============================================================================\n// HOLD NOTE SPECIFIC CONSTANTS\n// ============================================================================\n\n/** HOLD note opacity ranges for visual progression through approach and hold */\nexport const HOLD_OPACITY = {\n  MIN_BASE: 0.4,                  // Base opacity during approach\n  MAX_PROGRESSION: 0.6,           // Peak opacity near judgement / during hold\n} as const;\n\n/** HOLD note stroke width scaling for perspective effect */\nexport const HOLD_STROKE = {\n  BASE_WIDTH: 2,                  // Default stroke width (pixels)\n  APPROACH_MULTIPLIER: 2,         // Stroke gets 2Ã— thicker during approach\n  COLLAPSE_MULTIPLIER: 2,         // Stroke gets 2Ã— thicker when collapsing\n} as const;\n\n/** HOLD note glow effects - shadows and inner glow */\nexport const HOLD_GLOW = {\n  MIN_SHADOW: 20,                 // Base outer shadow blur (pixels)\n  SHADOW_SCALE: 25,               // Shadow scales 0-25px by distance\n  MIN_INNER_SHADOW: 12,           // Base inner shadow blur\n  INNER_SHADOW_SCALE: 15,         // Inner shadow scales 0-15px by distance\n} as const;\n\n/** HOLD note geometry - spread angle for wider cone than TAP notes */\nexport const HOLD_RAY = {\n  SPREAD_ANGLE: 18,               // Â±18Â° spread from lane ray (36Â° total) - wider than TAP's 8Â° for visibility\n} as const;\n\n// ============================================================================\n// VISUAL EFFECT COLORS\n// ============================================================================\n\n/** Greyscale overlay color - applied when health reaches 0 */\nexport const GREYSCALE_FILL_COLOR = 'rgba(80, 80, 80, 0.8)';    // Dark grey fill\n/** Greyscale glow color - complements greyscale effect */\nexport const GREYSCALE_GLOW_COLOR = 'rgba(100, 100, 100, 0.4)';\n","path":null,"size_bytes":31616,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1237,"size_tokens":null},"client/src/lib/errors/gameDebugTools.ts":{"content":"import { Note } from '@/lib/engine/gameTypes';\nimport { HitStatistics, NoteStatistics, RenderStatistics, AnimationStatistics, FailureType, AnimationTrackingEntry } from './gameDebugTypes';\n\nconst EMPTY_NOTE_STATS: NoteStatistics = {\n  total: 0,\n  tap: 0,\n  hold: 0,\n  hit: 0,\n  missed: 0,\n  failed: 0,\n  byLane: {},\n};\n\nconst EMPTY_HIT_STATS: HitStatistics = {\n  successfulHits: 0,\n  tapTooEarlyFailures: 0,\n  tapMissFailures: 0,\n  tooEarlyFailures: 0,\n  holdMissFailures: 0,\n  holdReleaseFailures: 0,\n};\n\nconst EMPTY_ANIM_STATS: AnimationStatistics = {\n  total: 0,\n  completed: 0,\n  failed: 0,\n  pending: 0,\n  rendering: 0\n};\n\nexport class GameDebugger {\n  private errorLog: string[] = [];\n  private noteStats: NoteStatistics = { ...EMPTY_NOTE_STATS };\n  private hitStats: HitStatistics = { ...EMPTY_HIT_STATS };\n  private renderStats: RenderStatistics = { rendered: 0, preMissed: 0 };\n  private readonly MAX_LOG_SIZE = 100;\n\n  constructor(private enableConsole: boolean = true) {\n  }\n\n  log(message: string): void {\n    const logEntry = `[${Date.now()}] ${message}`;\n    this.errorLog.push(logEntry);\n    if (this.errorLog.length > this.MAX_LOG_SIZE) this.errorLog.shift();\n    if (this.enableConsole) console.warn(`[GAME DEBUG] ${logEntry}`);\n  }\n\n  trackAnimation(noteId: string, type: FailureType, failureTime?: number): void {\n    // Animation tracking removed\n  }\n\n  updateAnimation(noteId: string, updates: Record<string, unknown>): void {\n    // Animation tracking removed\n  }\n\n  updateRenderStats(rendered: number, preMissed: number): void {\n    this.renderStats = { rendered, preMissed };\n  }\n\n  updateNoteStats(notes: Note[]): void {\n    const noteStats = { ...EMPTY_NOTE_STATS };\n    const hitStats = { ...EMPTY_HIT_STATS };\n\n    for (const note of notes) {\n      noteStats.total++;\n      noteStats.byLane[note.lane] = (noteStats.byLane[note.lane] || 0) + 1;\n      if (note.type === 'TAP') noteStats.tap++;\n      else noteStats.hold++;\n      if (note.hit) {\n        noteStats.hit++;\n        hitStats.successfulHits++;\n      }\n      if (note.missed) noteStats.missed++;\n      \n      const failures = this.getFailures(note);\n      if (failures.length > 0) {\n        noteStats.failed++;\n        failures.forEach(f => {\n          hitStats[`${f}s` as keyof HitStatistics]++;\n        });\n      }\n    }\n\n    this.noteStats = noteStats;\n    this.hitStats = hitStats;\n  }\n\n  getAnimationStats(): AnimationStatistics {\n    return { ...EMPTY_ANIM_STATS };\n  }\n\n  getAnimationTracking(): AnimationTrackingEntry[] {\n    return [];\n  }\n\n  getErrorLog(): string[] {\n    return [...this.errorLog];\n  }\n\n  getNoteStats(): NoteStatistics {\n    return { ...this.noteStats, byLane: { ...this.noteStats.byLane } };\n  }\n\n  getHitStats(): HitStatistics {\n    return { ...this.hitStats };\n  }\n\n  getRenderStats(): RenderStatistics {\n    return { ...this.renderStats };\n  }\n\n  clear(): void {\n    this.errorLog = [];\n    this.noteStats = { ...EMPTY_NOTE_STATS };\n    this.hitStats = { ...EMPTY_HIT_STATS };\n    this.renderStats = { rendered: 0, preMissed: 0 };\n  }\n\n  private getFailures(note: Note): string[] {\n    const failures: string[] = [];\n    if (note.tapTooEarlyFailure) failures.push('tapTooEarlyFailure');\n    if (note.tapMissFailure) failures.push('tapMissFailure');\n    if (note.tooEarlyFailure) failures.push('tooEarlyFailure');\n    if (note.holdMissFailure) failures.push('holdMissFailure');\n    if (note.holdReleaseFailure) failures.push('holdReleaseFailure');\n    return failures;\n  }\n}\n\nexport { useGameDebugger, useDebugValue } from './gameDebugHooks';\n","path":null,"size_bytes":3560,"size_tokens":null},"client/src/lib/utils/tapNoteGeometryUtils.ts":{"content":"// src/utils/tapNoteGeometry.ts\nimport { GameErrors } from '@/lib/errors/errorLog';\nimport {\n  JUDGEMENT_RADIUS,\n  TAP_DEPTH, // Assume { MIN: number, MAX: number, FADE_TIME: number }\n  TAP_RAY, // Assume { SPREAD_ANGLE: number }\n} from '@/lib/config/gameConstants';\n\nexport interface TapNoteGeometry {\n  x1: number; y1: number;\n  x2: number; y2: number;\n  x3: number; y3: number;\n  x4: number; y4: number;\n  points: string;\n}\n\nconst calculateEffectiveProgress = (\n  progress: number,\n  isFailedOrHit: boolean,\n  noteTime: number,\n  currentTime: number\n): number => {\n  if (isFailedOrHit && Number.isFinite(noteTime) && Number.isFinite(currentTime)) {\n    return Math.max(0, 1 - ((noteTime - currentTime) / TAP_DEPTH.FADE_TIME));\n  }\n  return Math.max(0, Math.min(1, progress));\n};\n\nconst calculateDistances = (effectiveProgress: number): { nearDist: number; farDist: number } => {\n  const trapezoidDepth = TAP_DEPTH.MIN + (Math.min(effectiveProgress, 1) * (TAP_DEPTH.MAX - TAP_DEPTH.MIN));\n  const nearDist = 1 + (effectiveProgress * (JUDGEMENT_RADIUS - 1));\n  const farDist = Math.max(1, nearDist - trapezoidDepth);\n  return { nearDist, farDist };\n};\n\nconst calculateRayCorners = (\n  vpX: number,\n  vpY: number,\n  rayAngle: number,\n  nearDist: number,\n  farDist: number\n): { x1: number; y1: number; x2: number; y2: number; x3: number; y3: number; x4: number; y4: number } => {\n  const leftRayAngle = rayAngle - TAP_RAY.SPREAD_ANGLE;\n  const rightRayAngle = rayAngle + TAP_RAY.SPREAD_ANGLE;\n  const leftRad = (leftRayAngle * Math.PI) / 180;\n  const rightRad = (rightRayAngle * Math.PI) / 180;\n  return {\n    x1: vpX + Math.cos(leftRad) * farDist,\n    y1: vpY + Math.sin(leftRad) * farDist,\n    x2: vpX + Math.cos(rightRad) * farDist,\n    y2: vpY + Math.sin(rightRad) * farDist,\n    x3: vpX + Math.cos(rightRad) * nearDist,\n    y3: vpY + Math.sin(rightRad) * nearDist,\n    x4: vpX + Math.cos(leftRad) * nearDist,\n    y4: vpY + Math.sin(leftRad) * nearDist,\n  };\n};\n\nexport const calculateTapNoteGeometry = (\n  progress: number,\n  tapRayAngle: number,\n  vpX: number,\n  vpY: number,\n  isSuccessfulHit: boolean = false,\n  currentTime: number = 0,\n  isFailed: boolean = false,\n  noteTime: number = 0\n): TapNoteGeometry => {\n  const isFailedOrHit = isFailed || isSuccessfulHit;\n  const effectiveProgress = calculateEffectiveProgress(progress, isFailedOrHit, noteTime, currentTime);\n  \n  // Apply perspective warp (cubic) to simulate 3D depth speed\n  // Objects should move slowly in the distance and accelerate as they get closer\n  const perspectiveProgress = Math.pow(effectiveProgress, 3);\n  \n  const { nearDist, farDist } = calculateDistances(perspectiveProgress);\n  const corners = calculateRayCorners(vpX, vpY, tapRayAngle, nearDist, farDist);\n\n  // Validate finite values (debug log if invalid)\n  const allFinite = Object.values(corners).every(v => Number.isFinite(v));\n  if (!allFinite) {\n    GameErrors.log(`calculateTapNoteGeometry: Invalid coordinates - progress: ${progress}, nearDist: ${nearDist}, farDist: ${farDist}`);\n    // Fallback to default trapezoid (e.g., at progress 0.5)\n    return calculateTapNoteGeometry(0.5, tapRayAngle, vpX, vpY, false, currentTime, false, noteTime);\n  }\n\n  return {\n    ...corners,\n    points: `${corners.x1},${corners.y1} ${corners.x2},${corners.y2} ${corners.x3},${corners.y3} ${corners.x4},${corners.y4}`,\n  };\n};","path":null,"size_bytes":3357,"size_tokens":null},"client/src/components/NoteStatsSection.tsx":{"content":"export function NoteStatsSection({ stats }: any) {\n  return (\n    <div className=\"space-y-2\">\n      <h3 className=\"text-sm font-semibold\">Note Statistics</h3>\n      <div className=\"grid grid-cols-2 gap-2 text-xs\">\n        <div>Total: {stats?.total || 0}</div>\n        <div>Tap: {stats?.tap || 0}</div>\n        <div>Hold: {stats?.hold || 0}</div>\n        <div>Hit: {stats?.hit || 0}</div>\n        <div>Missed: {stats?.missed || 0}</div>\n        <div>Failed: {stats?.failed || 0}</div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":515,"size_tokens":null},"client/src/components/screens/GameOverScreen.tsx":{"content":"// src/components/GameOverScreen.tsx\nimport React, { memo } from 'react';\nimport { motion } from \"framer-motion\";\nimport { useGameStore } from '@/stores/useGameStore';\nimport { ErrorLogViewer } from \"@/components/game/loaders/ErrorLogViewer\";\n\ninterface GameOverScreenProps {\n  onRestart?: () => void;\n  score?: number;\n  combo?: number;\n  errorCount?: number;\n}\n\nconst GameOverScreenComponent = ({ onRestart: propOnRestart, errorCount: propErrorCount = 0 }: GameOverScreenProps = {}) => {\n  const { score, combo, restartGame } = useGameStore(state => ({\n    score: state.score,\n    combo: state.combo,\n    restartGame: propOnRestart ?? state.restartGame,\n  }));\n\n  return (\n    <div className=\"min-h-screen bg-black flex flex-col items-center justify-center text-center space-y-8\">\n      <h1 className=\"text-6xl font-orbitron text-destructive neon-text-pink\" data-testid=\"text-game-over-title\">SYSTEM CRITICAL</h1>\n      <div className=\"text-2xl font-rajdhani\">\n        <p data-testid=\"text-final-score\">FINAL SCORE: {score}</p>\n        <p data-testid=\"text-max-combo\">MAX COMBO: {combo}</p>\n        {propErrorCount > 0 && (\n          <div className=\"text-xs text-neon-yellow mt-4 max-h-20 overflow-y-auto\">\n            <p data-testid=\"text-errors-detected\">ERRORS DETECTED: {propErrorCount}</p>\n          </div>\n        )}\n      </div>\n      <motion.button\n        whileHover={{ scale: 1.05 }}\n        onClick={restartGame}\n        className=\"px-8 py-3 bg-neon-blue text-black font-bold hover:bg-white transition-colors\"\n        data-testid=\"button-restart-game\"\n      >\n        REBOOT SYSTEM\n      </motion.button>\n\n      <ErrorLogViewer />\n    </div>\n  );\n};\n\nexport const GameOverScreen = memo(GameOverScreenComponent);","path":null,"size_bytes":1724,"size_tokens":null},"client/src/components/game/loaders/NoteStatsSection.tsx":{"content":"// src/components/NoteStatsSection.tsx\nimport React from 'react';\nimport { StatBox, StatGrid, StatSection, formatLaneStats } from './ErrorLogViewerHelpers';\n\ninterface NoteStatsSectionProps {\n  noteStats: { total: number; tap: number; hold: number; hit: number; missed: number; failed: number; byLane: Record<number, number> };\n}\n\nexport const NoteStatsSection: React.FC<NoteStatsSectionProps> = ({ noteStats }) => {\n  if (noteStats.total === 0) return null;\n\n  return (\n    <StatSection title=\"BEATMAP LOADED\" titleColor=\"purple\" textColor=\"purple\">\n      <StatGrid cols={3}>\n        <StatBox label=\"Total\" value={noteStats.total} color=\"gray\" />\n        <StatBox label=\"TAP\" value={noteStats.tap} color=\"blue\" />\n        <StatBox label=\"HOLD\" value={noteStats.hold} color=\"pink\" />\n      </StatGrid>\n      <div className=\"grid grid-cols-3 gap-1 pt-1 border-t border-gray-700\">\n        <StatBox label=\"âœ“ Hit\" value={noteStats.hit} color=\"green\" />\n        <StatBox label=\"âœ— Failed\" value={noteStats.failed} color=\"red\" />\n        <StatBox label=\"Pending\" value={noteStats.total - noteStats.hit - noteStats.failed - noteStats.missed} color=\"yellow\" />\n      </div>\n      {Object.keys(noteStats.byLane).length > 0 && (\n        <div className=\"text-xs text-gray-400 pt-1 border-t border-gray-700\">\n          <div className=\"font-mono\">Lanes: {formatLaneStats(noteStats.byLane)}</div>\n        </div>\n      )}\n    </StatSection>\n  );\n};","path":null,"size_bytes":1436,"size_tokens":null},"client/src/lib/notes/config/types.ts":{"content":"import { Note, ScoreState } from '@/lib/engine/gameTypes';\n\nexport interface NoteUpdateResult {\n  updatedNote: Note;\n  scoreChange?: ScoreState;\n  success: boolean;\n}\n","path":null,"size_bytes":167,"size_tokens":null},"client/src/lib/youtube/youtubeTimeReset.ts":{"content":"import { useYoutubeStore } from '@/stores/useYoutubeStore';\n\n/**\n * Reset YouTube time tracker (useful for seeks and rewinds)\n */\nexport function resetYouTubeTimeTracker(timeSeconds: number = 0): void {\n  const timeMs = timeSeconds * 1000;\n  const { setYoutubeCurrentTimeMs, setLastTimeUpdate } = useYoutubeStore.getState();\n  setYoutubeCurrentTimeMs(timeMs);\n  setLastTimeUpdate(Date.now());\n  console.log(`[YOUTUBE-TIME-TRACKER] Reset to ${timeSeconds.toFixed(2)}s (${timeMs.toFixed(0)}ms)`);\n}","path":null,"size_bytes":496,"size_tokens":null},"client/src/stores/useYouTubePlayerStore.ts":{"content":"import { create } from 'zustand';\n\nexport interface YouTubePlayerStoreState {\n  videoId: string | null;\n  currentTime: number;\n  duration: number;\n  isReady: boolean;\n  lastValidTime: number | null;\n\n  setVideoId: (videoId: string | null) => void;\n  setCurrentTime: (time: number) => void;\n  setDuration: (duration: number) => void;\n  setIsReady: (ready: boolean) => void;\n  setLastValidTime: (time: number | null) => void;\n  getVideoTime: () => number | null;\n}\n\nexport const useYouTubePlayerStore = create<YouTubePlayerStoreState>((set, get) => ({\n  videoId: null,\n  currentTime: 0,\n  duration: 0,\n  isReady: false,\n  lastValidTime: null,\n\n  setVideoId: (videoId) => set({ videoId }),\n  setCurrentTime: (currentTime) => {\n    set({ currentTime });\n    set({ lastValidTime: currentTime });\n  },\n  setDuration: (duration) => set({ duration }),\n  setIsReady: (isReady) => set({ isReady }),\n  setLastValidTime: (lastValidTime) => set({ lastValidTime }),\n\n  getVideoTime: () => {\n    const { currentTime, lastValidTime } = get();\n    return currentTime > 0 ? currentTime : lastValidTime;\n  },\n}));\n","path":null,"size_bytes":1095,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n\" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n           // @replit: no hover, and add primary border\n           \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm border-destructive-border\",\n        outline:\n          // @replit Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color. Uses shadow-xs. no shadow on active\n          // No hover state\n          \" border [border-color:var(--button-outline)] shadow-xs active:shadow-none \",\n        secondary:\n          // @replit border, no hover, no shadow, secondary border.\n          \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // @replit no hover, transparent border\n        ghost: \"border border-transparent\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        // @replit changed sizes\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2356,"size_tokens":null},"client/src/hooks/useGameQueries.ts":{"content":"// src/hooks/useGameQueries.ts\nimport { useGameStore } from '@/stores/useGameStore';\nimport type { Note } from '@/types/game';\n\nexport interface UseGameQueriesReturn {\n  activeNotes: Note[];\n  completedNotes: Note[];\n  activeNotesOnLane: (lane: number) => Note[];\n  isDead: boolean;\n}\n\nexport function useGameQueries(): UseGameQueriesReturn {\n  const activeNotes = useGameStore(state => state.getActiveNotes());\n  const completedNotes = useGameStore(state => state.getCompletedNotes());\n  const isDead = useGameStore(state => state.isDead());\n  const getActiveNotesOnLane = useGameStore(state => state.getActiveNotesOnLane);\n\n  return {\n    activeNotes,\n    completedNotes,\n    activeNotesOnLane: getActiveNotesOnLane,\n    isDead,\n  };\n}\n\nexport function useActiveNotes(): Note[] {\n  return useGameStore((state) => state.getActiveNotes());\n}\n","path":null,"size_bytes":842,"size_tokens":null},"client/src/hooks/useVisibleNotes.ts":{"content":"// src/hooks/useVisibleNotes.ts\nimport { useGameStore } from '@/stores/useGameStore';\nimport type { Note } from '@/lib/engine/gameTypes';\n\nexport function useVisibleNotes(): Note[] {\n  const state = useGameStore((s) => s);\n  return state.getVisibleNotes?.() ?? [];\n}","path":null,"size_bytes":266,"size_tokens":null},"client/src/components/game/loaders/RenderAndHitStatsSection.tsx":{"content":"// src/components/RenderAndHitStatsSection.tsx\nimport React from 'react';\nimport { StatBox, StatSection } from './ErrorLogViewerHelpers';\n\ninterface RenderAndHitStatsSectionProps {\n  renderStats: { rendered: number; preMissed: number };\n  hitStats: { successfulHits: number; tapMissFailures: number; tooEarlyFailures: number; holdMissFailures: number; holdReleaseFailures: number };\n}\n\nexport const RenderAndHitStatsSection: React.FC<RenderAndHitStatsSectionProps> = ({ renderStats, hitStats }) => (\n  <div className=\"grid grid-cols-2 gap-2\">\n    <StatSection title=\"RENDER TRACKING\" titleColor=\"green\" textColor=\"green\">\n      <StatBox label=\"Rendered\" value={renderStats.rendered} color=\"gray\" />\n      <StatBox label=\"Pre-Missed\" value={renderStats.preMissed} color=\"yellow\" />\n    </StatSection>\n    <StatSection title=\"HIT RESULTS\" titleColor=\"blue\" textColor=\"blue\">\n      <StatBox label=\"âœ“ Successful\" value={hitStats.successfulHits} color=\"green\" />\n      <StatBox label=\"âœ— Failed\" value={hitStats.tapMissFailures + hitStats.tooEarlyFailures + hitStats.holdMissFailures + hitStats.holdReleaseFailures} color=\"red\" />\n    </StatSection>\n  </div>\n);","path":null,"size_bytes":1159,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"@neondatabase/serverless\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1439,"size_tokens":null},"client/src/components/game/notes/TapNote.tsx":{"content":"// src/components/TapNote.tsx\nimport React, { memo } from 'react';\nimport type { Note } from '@/lib/engine/gameTypes';\nimport { getLaneAngle, getColorForLane } from '@/lib/utils/laneUtils';\nimport { calculateTapNoteGeometry } from \"@/lib/geometry/tapNoteGeometry\";\nimport { calculateTapNoteStyle } from \"@/lib/notes/tap/tapNoteStyle\";\nimport { TapNoteState } from '@/lib/notes/tap/tapNoteHelpers';\n\ninterface TapNoteProps {\n  note: Note;\n  currentTime: number;\n  vpX: number;\n  vpY: number;\n  state: TapNoteState;\n  progressForGeometry: number;\n  clampedProgress: number;\n  rawProgress: number;\n  beatmapBpm?: number;\n}\n\nconst TapNoteComponent = ({ note, currentTime, vpX, vpY, state, progressForGeometry, clampedProgress, rawProgress, beatmapBpm = 120 }: TapNoteProps): React.ReactElement => {\n  const tapRayAngle = getLaneAngle(note.lane);\n  const noteColor = getColorForLane(note.lane);\n  const geometry = calculateTapNoteGeometry(progressForGeometry, tapRayAngle, vpX, vpY, state.isHit, currentTime, state.isFailed, note.time, state.failureTime, beatmapBpm);\n  const style = calculateTapNoteStyle(clampedProgress, state, noteColor, rawProgress, note.lane);\n  return (\n    <polygon\n      data-testid={`tap-note-${note.id}`}\n      points={geometry.points}\n      fill={style.fill}\n      opacity={style.opacity}\n      stroke={style.stroke}\n      strokeWidth={1.5}\n      style={{ filter: style.filter || 'none', transition: 'all 0.05s linear', mixBlendMode: 'screen' }}\n    />\n  );\n};\n\nexport const TapNote = memo(TapNoteComponent, (prev, next) => \n  prev.note.id === next.note.id &&\n  prev.currentTime === next.currentTime &&\n  prev.vpX === next.vpX &&\n  prev.vpY === next.vpY &&\n  prev.state.isHit === next.state.isHit &&\n  prev.state.isFailed === next.state.isFailed &&\n  prev.progressForGeometry === next.progressForGeometry &&\n  prev.clampedProgress === next.clampedProgress &&\n  prev.rawProgress === next.rawProgress\n);","path":null,"size_bytes":1924,"size_tokens":null},"client/src/types/youtube.ts":{"content":"/**\n * YouTube player and integration types\n * For use in Zustand YouTube store and YouTube utilities\n */\n\ndeclare global {\n  interface Window {\n    YT: any;\n    onYouTubeIframeAPIReady: () => void;\n  }\n}\n\nexport interface YouTubePlayerConfig {\n  autoplay: number;\n  controls: number;\n  modestbranding: number;\n  rel: number;\n  showinfo: number;\n}\n\nexport interface YouTubePlayerState {\n  videoId: string | null;\n  currentTime: number;\n  duration: number;\n  isPlaying: boolean;\n  isReady: boolean;\n  volume: number;\n}\n\n/**\n * Zustand Store Types\n */\n\nexport interface YouTubeStoreState {\n  // State\n  videoId: string | null;\n  currentTime: number;\n  duration: number;\n  isReady: boolean;\n  lastValidTime: number | null;\n  \n  // Actions\n  setVideoId: (videoId: string | null) => void;\n  setCurrentTime: (time: number) => void;\n  setDuration: (duration: number) => void;\n  setIsReady: (ready: boolean) => void;\n  setLastValidTime: (time: number | null) => void;\n  \n  // Utilities\n  getVideoTime: () => number | null;\n}\n\nexport {};\n","path":null,"size_bytes":1029,"size_tokens":null},"client/src/lib/engine/gameEngineQueries.ts":{"content":"import { Note } from './gameTypes';\nimport { NoteValidator } from '@/lib/notes/processors/noteValidator';\nimport { ScoringManager } from '@/lib/managers/scoringManager';\n\n/**\n * Query utilities for GameEngineCore\n * Provides convenient query methods for the UI and debugging\n */\nexport class GameEngineQueries {\n  constructor(\n    private validator: NoteValidator,\n    private scoringManager: ScoringManager,\n    private notes: Note[]\n  ) {}\n\n  /**\n   * Get all active notes (not yet completed)\n   */\n  getActiveNotes(): Note[] {\n    return this.validator.getActiveNotes(this.notes);\n  }\n\n  /**\n   * Get all completed notes (hit or failed)\n   */\n  getCompletedNotes(): Note[] {\n    return this.validator.getCompletedNotes(this.notes);\n  }\n\n  /**\n   * Get active notes on a specific lane\n   */\n  getActiveNotesOnLane(lane: number): Note[] {\n    return this.validator.getActiveNotesOnLane(this.notes, lane);\n  }\n\n  /**\n   * Check if player is dead (health depleted)\n   */\n  isDead(): boolean {\n    return this.scoringManager.isDead();\n  }\n}\n","path":null,"size_bytes":1039,"size_tokens":null},"client/src/components/game/tunnel/JudgementLines.tsx":{"content":"// src/components/JudgementLines.tsx\nimport React, { memo } from 'react';\nimport { TapJudgementLines } from './TapJudgementLines';\nimport { HoldJudgementLines } from './HoldJudgementLines';\n\ninterface JudgementLinesProps {\n  vpX?: number;\n  vpY?: number;\n  type: 'tap' | 'hold';\n}\n\nconst JudgementLinesComponent = ({ vpX = 350, vpY = 300, type }: JudgementLinesProps) => {\n  return type === 'tap' ? (\n    <TapJudgementLines vpX={vpX} vpY={vpY} data-testid=\"tap-judgement-lines\" />\n  ) : (\n    <HoldJudgementLines vpX={vpX} vpY={vpY} data-testid=\"hold-judgement-lines\" />\n  );\n};\n\nexport const JudgementLines = memo(JudgementLinesComponent);","path":null,"size_bytes":640,"size_tokens":null},"client/src/lib/errors/gameDebugHooks.ts":{"content":"import { useRef, useEffect } from 'react';\nimport { useDebugValue as useReactDebugValue } from 'react';\nimport { GameDebugger } from './gameDebugTools';\n\nexport function useGameDebugger(enabled: boolean = true): GameDebugger {\n  const debuggerRef = useRef<GameDebugger | undefined>(undefined);\n  \n  if (!debuggerRef.current) {\n    debuggerRef.current = new GameDebugger(enabled);\n  }\n\n  useEffect(() => {\n    return () => {\n      debuggerRef.current?.clear();\n    };\n  }, []);\n\n  return debuggerRef.current;\n}\n\nexport function useDebugValue(debugValue: GameDebugger): void {\n  const stats = {\n    animations: debugValue.getAnimationStats(),\n    notes: debugValue.getNoteStats(),\n    hits: debugValue.getHitStats(),\n    render: debugValue.getRenderStats(),\n  };\n\n  useReactDebugValue(stats);\n}\n","path":null,"size_bytes":793,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverAnchor = PopoverPrimitive.Anchor\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }\n","path":null,"size_bytes":1342,"size_tokens":null},"client/src/hooks/useHoldProgress.ts":{"content":"// src/hooks/useHoldProgress.ts\nimport { useState, useEffect, useRef } from 'react';\nimport { useGameStore } from '@/stores/useGameStore';\nimport { getHoldProgress } from '@/lib/utils/holdMeterUtils';\nimport { \n  DECK_METER_COMPLETION_GLOW_DURATION,\n  DECK_METER_COMPLETION_THRESHOLD,\n  DECK_METER_DEFAULT_HOLD_DURATION\n} from '@/lib/config/gameConstants';\n\ninterface UseHoldProgressProps {\n  lane?: number;\n}\n\ninterface HoldProgressReturn {\n  progress: number;\n  isGlowing: boolean;\n}\n\nexport const useHoldProgress = ({ lane: propLane }: UseHoldProgressProps = {}): HoldProgressReturn => {\n  const notes = useGameStore(state => state.notes);\n  const currentTime = useGameStore(state => state.currentTime);\n  const lane = propLane ?? -1;\n\n  const [isGlowing, setIsGlowing] = useState(false);\n  const prevCompletionRef = useRef<boolean>(false);\n  const prevActiveNoteIdRef = useRef<string>('');\n  const glowTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    return () => {\n      if (glowTimeoutRef.current) {\n        clearTimeout(glowTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    const activeNote = notes.find(n => n.lane === lane && !n.hit);\n    const currentNoteId = activeNote?.id || '';\n\n    if (prevActiveNoteIdRef.current !== currentNoteId) {\n      prevCompletionRef.current = false;\n      setIsGlowing(false);\n      prevActiveNoteIdRef.current = currentNoteId;\n    }\n  }, [notes, lane]);\n\n  // Calculate progress purely for rendering\n  const progress = getHoldProgress(\n    notes,\n    currentTime,\n    lane,\n    DECK_METER_COMPLETION_THRESHOLD,\n    DECK_METER_DEFAULT_HOLD_DURATION\n  );\n\n  // Handle side effects (glow) in useEffect\n  useEffect(() => {\n    const shouldGlow = progress >= DECK_METER_COMPLETION_THRESHOLD && !prevCompletionRef.current;\n    \n    if (shouldGlow) {\n      setIsGlowing(true);\n      prevCompletionRef.current = true;\n      \n      if (glowTimeoutRef.current) clearTimeout(glowTimeoutRef.current);\n      glowTimeoutRef.current = setTimeout(() => setIsGlowing(false), DECK_METER_COMPLETION_GLOW_DURATION);\n    } else if (progress < DECK_METER_COMPLETION_THRESHOLD) {\n      // Reset completion flag if progress drops (e.g. new note or reset)\n      // Only if we are tracking the same note, which is handled by the other useEffect resetting on note ID change\n      // But we might want to double check here if we need to reset prevCompletion for the same note if it somehow rewinds?\n      // For now, just relying on note ID change is safer to avoid flickering.\n      if (progress === 0) {\n          prevCompletionRef.current = false;\n      }\n    }\n  }, [progress]);\n\n  return { progress, isGlowing };\n};","path":null,"size_bytes":2681,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n","path":null,"size_bytes":584,"size_tokens":null},"client/src/stores/useApiStore.ts":{"content":"// src/stores/useApiStore.ts\nimport { create } from 'zustand';\n\ninterface ApiStoreState {\n  apiRequest: <T,>(method: string, url: string, data?: unknown) => Promise<T>;\n  postData: <T,>(url: string, data?: unknown) => Promise<T>;\n}\n\nexport const useApiStore = create<ApiStoreState>(() => ({\n  apiRequest: async <T,>(method: string, url: string, data?: unknown): Promise<T> => {\n    console.log(`[API] ${method} ${url}`, data);\n    // Mock implementation for mockup mode\n    return {} as T;\n  },\n  postData: async <T,>(url: string, data?: unknown): Promise<T> => {\n    console.log(`[API] POST ${url}`, data);\n    // Mock implementation for mockup mode\n    return {} as T;\n  },\n}));\n","path":null,"size_bytes":681,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"client/src/types/game.ts":{"content":"// src/types/game.ts\n// Core game types - single source of truth\n\nexport type Difficulty = 'EASY' | 'MEDIUM' | 'HARD';\nexport type GameState = 'IDLE' | 'PLAYING' | 'PAUSED' | 'RESUMING' | 'REWINDING' | 'GAME_OVER';\nexport type NoteType = 'TAP' | 'HOLD' | 'SPIN_LEFT' | 'SPIN_RIGHT';\nexport type FailureType = 'tapTooEarlyFailure' | 'tapMissFailure' | 'tooEarlyFailure' | 'holdMissFailure' | 'holdReleaseFailure' | 'successful';\n\n// Note structure\nexport interface Note {\n  id: string;\n  lane: number; // -2 to 3\n  time: number; // ms\n  type: NoteType;\n  duration?: number; // For HOLD/SPIN\n  hit: boolean;\n  missed: boolean;\n  pressHoldTime?: number; // Start of hold\n  releaseTime?: number; // End of hold\n  failureTime?: number;\n  // Debug failure flags\n  tapTooEarlyFailure?: boolean;\n  tapMissFailure?: boolean;\n  tooEarlyFailure?: boolean;\n  holdMissFailure?: boolean;\n  holdReleaseFailure?: boolean;\n  beatmapStart?: number;\n  beatmapEnd?: number;\n}\n\nexport interface GameConfig {\n  TAP_HIT_WINDOW: number;\n  TAP_FAILURE_BUFFER: number;\n  HOLD_HIT_WINDOW: number;\n  HOLD_MISS_TIMEOUT: number;\n  HOLD_RELEASE_OFFSET: number;\n  HOLD_RELEASE_WINDOW: number;\n  HOLD_ACTIVATION_WINDOW: number;\n  LEAD_TIME: number;\n  ACCURACY_PERFECT_MS: number;\n  ACCURACY_GREAT_MS: number;\n  ACCURACY_PERFECT_POINTS: number;\n  ACCURACY_GREAT_POINTS: number;\n  ACCURACY_NORMAL_POINTS: number;\n  MAX_HEALTH: number;\n}\n\nexport interface ScoreState {\n  score: number;\n  combo: number;\n  health: number;\n}\n\nexport interface TimingResult {\n  error: number;\n  isWithinWindow: boolean;\n  isTooEarly: boolean;\n  isTooLate: boolean;\n}\n\nexport type InputHandler = () => Note | null;\nexport type Processor = (note: Note, time: number) => { updatedNote: Note; success?: boolean };\nexport type PostProcessor = (note: Note, time: number) => void;\n\n// Zustand Store Types\nexport interface GameStoreState {\n  // Core game state\n  gameState: GameState;\n  difficulty: Difficulty;\n  notes: Note[];\n  currentTime: number;\n  isPaused: boolean;\n  \n  // Score tracking\n  score: number;\n  combo: number;\n  health: number;\n  maxHealth: number;\n  missCount: number;\n  \n  // UI state\n  countdownSeconds: number;\n  \n  // Beatmap metadata\n  beatmapBpm: number;\n  \n  // Actions\n  setGameState: (state: GameState) => void;\n  setDifficulty: (difficulty: Difficulty) => void;\n  setNotes: (notes: Note[]) => void;\n  setScore: (score: number) => void;\n  setCombo: (combo: number) => void;\n  setHealth: (health: number) => void;\n  setMissCount: (missCount: number) => void;\n  setCurrentTime: (time: number) => void;\n  setIsPaused: (paused: boolean) => void;\n  setCountdownSeconds: (seconds: number) => void;\n  setBeatmapBpm: (bpm: number) => void;\n  \n  // Game actions\n  hitNote: (lane: number) => void;\n  hitPad: (lane: number) => void;\n  startDeckHold: (lane: number) => void;\n  endDeckHold: (lane: number) => void;\n  pauseGame: () => void;\n  resumeGame: () => void;\n  resetGameState: () => void;\n  rewindGame: () => void;\n  restartGame: () => void;\n  \n  // Computed selectors\n  getVisibleNotes: () => Note[];\n  getProcessedTapNotes: () => Note[];\n  getHoldNotes: () => Note[];\n  getActiveNotes: () => Note[];\n  getCompletedNotes: () => Note[];\n  getActiveNotesOnLane: (lane: number) => Note[];\n  isDead: () => boolean;\n}\n","path":null,"size_bytes":3273,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-primary/10\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":266,"size_tokens":null},"client/src/lib/youtube/youtubeSharedState.ts":{"content":"// src/lib/utils/youtube/youtubeSharedState.ts\n// Shared state module - MIGRATED TO ZUSTAND\n// Proxies calls to the centralized store\nimport { useYoutubeStore } from '@/stores/useYoutubeStore';\n\n// Getters - read directly from store state\nexport const getYtPlayer = () => useYoutubeStore.getState().ytPlayer;\nexport const getYoutubeIframeElement = () => useYoutubeStore.getState().youtubeIframeElement;\nexport const getYoutubeCurrentTimeMs = () => useYoutubeStore.getState().youtubeCurrentTimeMs;\nexport const getLastTimeUpdate = () => useYoutubeStore.getState().lastTimeUpdate;\nexport const getPlayerReady = () => useYoutubeStore.getState().playerReady;\nexport const getLastGoodTimeMs = () => useYoutubeStore.getState().lastGoodTimeMs;\n\n// Setters - dispatch actions to store\nexport const setYtPlayer = (value: any) => { \n  useYoutubeStore.getState().setYtPlayer(value); \n};\nexport const setYoutubeIframeElement = (value: HTMLIFrameElement | null) => { \n  useYoutubeStore.getState().setYoutubeIframeElement(value); \n};\nexport const setYoutubeCurrentTimeMs = (value: number) => { \n  useYoutubeStore.getState().setYoutubeCurrentTimeMs(value);\n};\nexport const setLastTimeUpdate = (value: number) => { \n  useYoutubeStore.getState().setLastTimeUpdate(value); \n};\nexport const setPlayerReady = (value: boolean) => { \n  useYoutubeStore.getState().setPlayerReady(value); \n};\n","path":null,"size_bytes":1368,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\n// YouTube IFrame API callback - MUST be defined on window before API loads\ndeclare global {\n  interface Window {\n    onYouTubeIframeAPIReady: () => void;\n  }\n}\n\nwindow.onYouTubeIframeAPIReady = () => {\n  console.log('YouTube IFrame API Ready');\n};\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":407,"size_tokens":null},"client/src/hooks/useAutoStart.ts":{"content":"// src/hooks/useAutoStart.ts\nimport { useEffect } from 'react';\nimport { useGameStore } from '@/stores/useGameStore';\nimport { Note } from '@/lib/engine/gameTypes';\n\ninterface UseAutoStartProps {\n  customNotes: Note[];\n  startGame: () => void;\n  youtubeIsReady?: boolean;\n  youtubeVideoId?: string | null;\n  onPlayYouTube?: () => Promise<void>;\n}\n\nexport function useAutoStart({ \n  customNotes, \n  startGame, \n  youtubeIsReady = true,\n  youtubeVideoId,\n  onPlayYouTube\n}: UseAutoStartProps): void {\n  const gameState = useGameStore(state => state.gameState);\n\n  useEffect(() => {\n    if (gameState !== 'IDLE' || !customNotes || customNotes.length === 0) return;\n    \n    // Only start if YouTube is ready (if required)\n    if (!youtubeIsReady) return;\n\n    // For YouTube videos: play first, then game starts via onPlaying callback\n    if (youtubeVideoId && onPlayYouTube) {\n      onPlayYouTube().catch(err => console.error('[AUTO-START] YouTube play failed:', err));\n      // Game will start via onPlaying callback after YouTube confirms playback\n      return;\n    }\n\n    // For non-YouTube: start game immediately\n    startGame();\n  }, [customNotes, gameState, startGame, youtubeIsReady, youtubeVideoId, onPlayYouTube]);\n}","path":null,"size_bytes":1224,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-9 px-2 min-w-9\",\n        sm: \"h-8 px-1.5 min-w-8\",\n        lg: \"h-10 px-2.5 min-w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1486,"size_tokens":null},"client/src/components/ui/input-group.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Textarea } from \"@/components/ui/textarea\"\n\nfunction InputGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"input-group\"\n      role=\"group\"\n      className={cn(\n        \"group/input-group border-input dark:bg-input/30 shadow-xs relative flex w-full items-center rounded-md border outline-none transition-[color,box-shadow]\",\n        \"h-9 has-[>textarea]:h-auto\",\n\n        // Variants based on alignment.\n        \"has-[>[data-align=inline-start]]:[&>input]:pl-2\",\n        \"has-[>[data-align=inline-end]]:[&>input]:pr-2\",\n        \"has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3\",\n        \"has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3\",\n\n        // Focus state.\n        \"has-[[data-slot=input-group-control]:focus-visible]:ring-ring has-[[data-slot=input-group-control]:focus-visible]:ring-1\",\n\n        // Error state.\n        \"has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40\",\n\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupAddonVariants = cva(\n  \"text-muted-foreground flex h-auto cursor-text select-none items-center justify-center gap-2 py-1.5 text-sm font-medium group-data-[disabled=true]/input-group:opacity-50 [&>kbd]:rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-4\",\n  {\n    variants: {\n      align: {\n        \"inline-start\":\n          \"order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]\",\n        \"inline-end\":\n          \"order-last pr-3 has-[>button]:mr-[-0.4rem] has-[>kbd]:mr-[-0.35rem]\",\n        \"block-start\":\n          \"[.border-b]:pb-3 order-first w-full justify-start px-3 pt-3 group-has-[>input]/input-group:pt-2.5\",\n        \"block-end\":\n          \"[.border-t]:pt-3 order-last w-full justify-start px-3 pb-3 group-has-[>input]/input-group:pb-2.5\",\n      },\n    },\n    defaultVariants: {\n      align: \"inline-start\",\n    },\n  }\n)\n\nfunction InputGroupAddon({\n  className,\n  align = \"inline-start\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof inputGroupAddonVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"input-group-addon\"\n      data-align={align}\n      className={cn(inputGroupAddonVariants({ align }), className)}\n      onClick={(e) => {\n        if ((e.target as HTMLElement).closest(\"button\")) {\n          return\n        }\n        e.currentTarget.parentElement?.querySelector(\"input\")?.focus()\n      }}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupButtonVariants = cva(\n  \"flex items-center gap-2 text-sm shadow-none\",\n  {\n    variants: {\n      size: {\n        xs: \"h-6 gap-1 rounded-[calc(var(--radius)-5px)] px-2 has-[>svg]:px-2 [&>svg:not([class*='size-'])]:size-3.5\",\n        sm: \"h-8 gap-1.5 rounded-md px-2.5 has-[>svg]:px-2.5\",\n        \"icon-xs\":\n          \"size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0\",\n        \"icon-sm\": \"size-8 p-0 has-[>svg]:p-0\",\n      },\n    },\n    defaultVariants: {\n      size: \"xs\",\n    },\n  }\n)\n\nfunction InputGroupButton({\n  className,\n  type = \"button\",\n  variant = \"ghost\",\n  size = \"xs\",\n  ...props\n}: Omit<React.ComponentProps<typeof Button>, \"size\"> &\n  VariantProps<typeof inputGroupButtonVariants>) {\n  return (\n    <Button\n      type={type}\n      data-size={size}\n      variant={variant}\n      className={cn(inputGroupButtonVariants({ size }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupText({ className, ...props }: React.ComponentProps<\"span\">) {\n  return (\n    <span\n      className={cn(\n        \"text-muted-foreground flex items-center gap-2 text-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupInput({\n  className,\n  ...props\n}: React.ComponentProps<\"input\">) {\n  return (\n    <Input\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupTextarea({\n  className,\n  ...props\n}: React.ComponentProps<\"textarea\">) {\n  return (\n    <Textarea\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupText,\n  InputGroupInput,\n  InputGroupTextarea,\n}\n","path":null,"size_bytes":4971,"size_tokens":null},"client/src/hooks/useYoutubePlayer.ts":{"content":"import { useYouTubePlayerStore } from '@/stores/useYouTubePlayerStore';\nimport { useEffect, useCallback, useRef, useState } from 'react';\nimport { getYouTubeVideoTime, seekYouTubeVideo, playYouTubeVideo, pauseYouTubeVideo } from '@/lib/youtube';\n\ninterface UseYouTubePlayerProps {\n  videoId: string | null;\n  playerInitializedRef: React.MutableRefObject<boolean>;\n  onPlaying?: () => void;\n}\n\ninterface UseYouTubePlayerReturn {\n  getVideoTime: () => number | null;\n  resetTime: () => void;\n  seek: typeof seekYouTubeVideo;\n  play: typeof playYouTubeVideo;\n  pause: typeof pauseYouTubeVideo;\n  isReady: boolean;\n}\n\nexport function useYouTubePlayer({ videoId, playerInitializedRef, onPlaying }: UseYouTubePlayerProps): UseYouTubePlayerReturn {\n  const [isReady, setIsReady] = useState(false);\n  const initRef = useRef(false);\n  const lastValidTime = useRef<number | null>(null);\n\n  const getVideoTime = useCallback((): number | null => {\n    const t = getYouTubeVideoTime();\n    if (t !== null) {\n      lastValidTime.current = t;\n      return t;\n    }\n    return lastValidTime.current;\n  }, []);\n\n  const resetTime = useCallback(() => {\n    lastValidTime.current = 0;\n  }, []);\n\n  const seek = useCallback(seekYouTubeVideo, []);\n  const play = useCallback(playYouTubeVideo, []);\n  const pause = useCallback(pauseYouTubeVideo, []);\n\n  useEffect(() => {\n    if (!videoId || !playerInitializedRef.current || initRef.current) return;\n    \n    // Delay setting isReady to allow YouTube iframe to fully initialize\n    // Without this, game starts before YouTube API is ready, causing note desync\n    const timeoutId = setTimeout(() => {\n      setIsReady(true);\n    }, 800); // 800ms buffer for YouTube initialization\n    \n    initRef.current = true;\n    \n    return () => clearTimeout(timeoutId);\n  }, [videoId]);\n\n  return {\n    getVideoTime,\n    resetTime,\n    seek,\n    play,\n    pause,\n    isReady\n  };\n}","path":null,"size_bytes":1900,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Portal>\n    <TooltipPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </TooltipPrimitive.Portal>\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1267,"size_tokens":null},"client/src/lib/utils/holdNoteUtils.ts":{"content":"// src/utils/holdNoteUtils.ts\nimport { Note } from '@/lib/engine/gameTypes';\nimport { GameErrors } from '@/lib/errors/errorLog';\nimport { calculateApproachGeometry, calculateLockedNearDistance, calculateHoldNoteGlow, calculateCollapseGeometry } from \"@/lib/geometry/holdNoteGeometry\";\nimport { calculateHoldNoteColors, determineGreyscaleState } from \"@/lib/notes/hold/holdGreystate\";\nimport { markAnimationCompletedIfDone, trackHoldNoteAnimationLifecycle, getHoldNoteFailureStates } from \"@/lib/notes/hold/holdNoteHelpers\";\nimport { FAILURE_ANIMATION_DURATION, HOLD_NOTE_STRIP_WIDTH_MULTIPLIER, JUDGEMENT_RADIUS, LEAD_TIME } from '@/lib/config/gameConstants';\nimport { getLaneAngle, getColorForLane } from '@/lib/utils/laneUtils';\n\nexport interface HoldNoteProcessedData {\n  note: Note;\n  rayAngle: number;\n  nearDistance: number;\n  farDistance: number;\n  collapseProgress: number;\n  approachProgress: number;\n  pressHoldTime: number;\n  failures: ReturnType<typeof getHoldNoteFailureStates>;\n  failureTime: number;\n  greyscaleState: ReturnType<typeof determineGreyscaleState>;\n  finalGlowScale: number;\n  colors: ReturnType<typeof calculateHoldNoteColors>;\n  currentTime: number;\n}\n\nexport function processSingleHoldNote(note: Note, currentTime: number, beatmapBpm: number = 120): HoldNoteProcessedData | null {\n  try {\n    if (!note || !Number.isFinite(note.time) || !note.id) return null;\n\n    const timeUntilHit = note.time - currentTime;\n    if (!Number.isFinite(timeUntilHit) || !Number.isFinite(LEAD_TIME)) return null;\n\n    const pressHoldTime = note.pressHoldTime || 0;\n    const holdDuration = note.duration || 1000;\n    const failures = getHoldNoteFailureStates(note);\n\n    if (failures.hasAnyFailure && note.failureTime === undefined) {\n      GameErrors.log(`CRITICAL: Note ${note.id} has failure but failureTime is missing!`);\n      return null;\n    }\n\n    const failureTime = note.failureTime || currentTime;\n\n    if (failures.hasAnyFailure) {\n      const timeSinceFail = Math.max(0, currentTime - failureTime);\n      if (timeSinceFail > FAILURE_ANIMATION_DURATION) {\n        markAnimationCompletedIfDone(note, failures, timeSinceFail, currentTime);\n        return null;\n      }\n    }\n\n    const rayAngle = getLaneAngle(note.lane);\n    if (!Number.isFinite(rayAngle)) {\n      console.warn(`Invalid ray angle for lane ${note.lane}`);\n      return null;\n    }\n\n    // For early failures, calculate approach geometry at the time of failure (frozen, clamped to judgement)\n    // For miss failures, calculate at current time allowing extension past judgement\n    // For other cases, use current time with clamping\n    let approachGeometry;\n    if (failures.isTooEarlyFailure && failureTime) {\n      const timeUntilHitAtFailure = note.time - failureTime;\n      approachGeometry = calculateApproachGeometry(timeUntilHitAtFailure, pressHoldTime, failures.isTooEarlyFailure, holdDuration, false, true, beatmapBpm);\n    } else {\n      approachGeometry = calculateApproachGeometry(timeUntilHit, pressHoldTime, failures.isTooEarlyFailure, holdDuration, failures.isHoldMissFailure, true, beatmapBpm);\n    }\n    \n    const collapseDuration = failures.hasAnyFailure ? FAILURE_ANIMATION_DURATION : holdDuration;\n    const lockedNearDistance = calculateLockedNearDistance(note, pressHoldTime, failures.isTooEarlyFailure, approachGeometry.nearDistance, failureTime, failures.isHoldMissFailure, beatmapBpm);\n    const stripWidth = holdDuration * HOLD_NOTE_STRIP_WIDTH_MULTIPLIER;\n    // Use the actual approach geometry's far distance (what was being rendered)\n    // not a recalculated value - this prevents discontinuous jumps on hit/press\n    const farDistanceAtPress = approachGeometry.farDistance;\n    \n    // isActiveHold: true if pressed with no failure (collapse starts from noteTime to match meter fill)\n    const isActiveHold = pressHoldTime > 0 && !failures.hasAnyFailure;\n    const collapseGeo = calculateCollapseGeometry(pressHoldTime, collapseDuration, currentTime, lockedNearDistance || approachGeometry.nearDistance, farDistanceAtPress, approachGeometry.nearDistance, approachGeometry.farDistance, isActiveHold, note.time);\n\n    // Only stop rendering if note has a failure that finished animating, NOT from collapse progress\n    if (failures.hasAnyFailure && collapseGeo.collapseProgress >= 1.0) {\n      // Failure animation complete - stop rendering\n      return null;\n    }\n\n    const greyscaleState = determineGreyscaleState(failures, pressHoldTime, collapseGeo.nearDistance, note.hit || false);\n    const glowCalc = calculateHoldNoteGlow(pressHoldTime, currentTime, collapseDuration, approachGeometry.nearDistance > 0 ? (approachGeometry.nearDistance - 1) / (JUDGEMENT_RADIUS - 1) : 0, note, isActiveHold, note.time);\n    const baseColor = getColorForLane(note.lane);\n    const colors = calculateHoldNoteColors(greyscaleState.isGreyed, note.lane, baseColor);\n    const approachProgress = (approachGeometry.nearDistance - 1) / (JUDGEMENT_RADIUS - 1);\n\n    trackHoldNoteAnimationLifecycle(note, failures, currentTime);\n\n    return {\n      note,\n      rayAngle,\n      nearDistance: collapseGeo.nearDistance,\n      farDistance: collapseGeo.farDistance,\n      collapseProgress: collapseGeo.collapseProgress,\n      approachProgress,\n      pressHoldTime,\n      failures,\n      failureTime,\n      greyscaleState,\n      finalGlowScale: glowCalc.finalGlowScale,\n      colors,\n      currentTime,\n    };\n  } catch (error) {\n    console.warn(`Hold note processing error: ${error}`);\n    return null;\n  }\n}","path":null,"size_bytes":5507,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1148,"size_tokens":null},"client/src/components/ui/spinner.tsx":{"content":"import { Loader2Icon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Spinner({ className, ...props }: React.ComponentProps<\"svg\">) {\n  return (\n    <Loader2Icon\n      role=\"status\"\n      aria-label=\"Loading\"\n      className={cn(\"size-4 animate-spin\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Spinner }\n","path":null,"size_bytes":331,"size_tokens":null},"client/src/lib/beatmap/beatmapConverter.ts":{"content":"import type { Note } from '@/types/game';\n\nexport function convertBeatmapNotes(rawNotes: any[], beatmapStart: number = 0): Note[] {\n  return rawNotes.map((n, i) => ({\n    id: n.id || `note-${i}`,\n    lane: n.lane,\n    time: n.time + beatmapStart,\n    type: n.type === 'HOLD' ? (n.lane === -1 ? 'SPIN_LEFT' : 'SPIN_RIGHT') : 'TAP',\n    duration: n.duration,\n    hit: false,\n    missed: false,\n  }));\n}\n","path":null,"size_bytes":401,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue | null>(null)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  if (!itemContext) {\n    throw new Error(\"useFormField should be used within <FormItem>\")\n  }\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue | null>(null)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-[0.8rem] text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-[0.8rem] font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4175,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Minus } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-1 ring-ring\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Minus />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2143,"size_tokens":null},"client/src/lib/managers/scoringManager.ts":{"content":"import { GameConfig, ScoreState } from '../engine/gameTypes';\n\n// ============================================================================\n// SCORING MANAGER - Handles score, combo, health\n// ============================================================================\n\nexport class ScoringManager {\n  private state: ScoreState;\n  \n  constructor(private config: GameConfig) {\n    this.state = {\n      score: 0,\n      combo: 0,\n      health: config.MAX_HEALTH,\n    };\n  }\n\n  getState(): ScoreState {\n    return { ...this.state };\n  }\n\n  reset(): void {\n    this.state = {\n      score: 0,\n      combo: 0,\n      health: this.config.MAX_HEALTH,\n    };\n  }\n\n  calculateHitScore(timingError: number): number {\n    const absError = Math.abs(timingError);\n    if (absError < this.config.ACCURACY_PERFECT_MS) {\n      return this.config.ACCURACY_PERFECT_POINTS;\n    }\n    if (absError < this.config.ACCURACY_GREAT_MS) {\n      return this.config.ACCURACY_GREAT_POINTS;\n    }\n    return this.config.ACCURACY_NORMAL_POINTS;\n  }\n\n  recordHit(timingError: number): ScoreState {\n    const points = this.calculateHitScore(timingError);\n    this.state.score += points;\n    this.state.combo += 1;\n    this.state.health = Math.min(this.config.MAX_HEALTH, this.state.health + 1);\n    return this.getState();\n  }\n\n  recordMiss(): ScoreState {\n    this.state.combo = 0;\n    this.state.health = Math.max(0, this.state.health - 2);\n    return this.getState();\n  }\n\n  isDead(): boolean {\n    return this.state.health <= 0;\n  }\n}\n","path":null,"size_bytes":1507,"size_tokens":null},"client/src/hooks/usePauseLogic.ts":{"content":"// src/hooks/usePauseLogic.ts\nimport { useCallback, useRef, useEffect } from 'react';\nimport { useGameStore } from '@/stores/useGameStore';\nimport { pauseYouTubeVideo } from '@/lib/youtube';\n\ninterface UsePauseLogicProps {\n  getVideoTime?: () => number | null;\n  setPauseMenuOpen?: (open: boolean) => void;\n}\n\nexport function usePauseLogic({\n  getVideoTime,\n  setPauseMenuOpen,\n}: UsePauseLogicProps) {\n  const gameState = useGameStore(state => state.gameState);\n  const setIsPaused = useGameStore(state => state.setIsPaused);\n  const setGameState = useGameStore(state => state.setGameState);\n  const setCountdownSeconds = useGameStore(state => state.setCountdownSeconds);\n\n  // Keep track of latest game state for async operations\n  const gameStateRef = useRef(gameState);\n  useEffect(() => {\n    gameStateRef.current = gameState;\n  }, [gameState]);\n\n  // Pause handler\n  const pauseGame = useCallback(() => {\n    if (gameStateRef.current !== 'PLAYING') return;\n\n    setIsPaused(true);\n    setGameState('PAUSED');\n    setPauseMenuOpen?.(true);\n\n    // Async YouTube pause - fire and forget mainly, don't block UI\n    // execute immediately to sync with UI as close as possible\n    (async () => {\n      try {\n        await pauseYouTubeVideo();\n        \n        // Simple verification\n        if (gameStateRef.current === 'PAUSED' && getVideoTime) {\n            // Just one quick check after a short delay\n            setTimeout(() => {\n              if (gameStateRef.current === 'PAUSED') getVideoTime();\n            }, 100);\n        }\n      } catch (err) {\n        // Pause failed, continue anyway\n      }\n    })();\n  }, [getVideoTime, setIsPaused, setGameState, setPauseMenuOpen]);\n\n  // Resume handler - triggers countdown which leads to YouTube-first resume flow\n  // Flow: setCountdownSeconds(3) â†’ countdown expires â†’ onCountdownComplete (RESUMING) \n  //       â†’ useFadeAnimation: fade-in + playYouTubeVideo() â†’ resumeGame() â†’ PLAYING\n  const handleResume = useCallback((): void => {\n    if (gameState !== 'PAUSED') return;\n    setCountdownSeconds(3);\n  }, [gameState, setCountdownSeconds]);\n\n  return { pauseGame, handleResume };\n}","path":null,"size_bytes":2147,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/RenderAndHitStatsSection.tsx":{"content":"export function RenderAndHitStatsSection({ renderStats, hitStats }: any) {\n  return (\n    <div className=\"space-y-2\">\n      <h3 className=\"text-sm font-semibold\">Render & Hit Statistics</h3>\n      <div className=\"grid grid-cols-2 gap-2 text-xs\">\n        <div>Rendered: {renderStats?.rendered || 0}</div>\n        <div>Pre-Missed: {renderStats?.preMissed || 0}</div>\n        <div>Successful Hits: {hitStats?.successfulHits || 0}</div>\n        <div>Too Early: {hitStats?.tapTooEarlyFailures || 0}</div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":531,"size_tokens":null},"client/src/lib/youtube/youtubePlayerInit.ts":{"content":"import { useYoutubeStore } from '@/stores/useYoutubeStore';\n\nexport function initYouTubePlayer(iframeElement: HTMLIFrameElement | null, onReady?: () => void): void {\n  console.log('[YOUTUBE-PLAYER-INIT] initYouTubePlayer called, iframeElement:', iframeElement ? 'present' : 'null');\n  if (!iframeElement) {\n    console.warn('[YOUTUBE-PLAYER-INIT] No iframe element provided');\n    return;\n  }\n\n  // Store iframe reference for direct control (postMessage-based seek/play)\n  useYoutubeStore.getState().setYoutubeIframeElement(iframeElement);\n  console.log('[YOUTUBE-PLAYER-INIT] Iframe stored, src:', iframeElement.src?.slice(0, 50) + '...');\n\n  // Dynamic script load if YT API missing\n  if (!window.YT) {\n    console.log('[YOUTUBE-PLAYER-INIT] YT API missing, loading script dynamically');\n    const tag = document.createElement('script');\n    tag.src = 'https://www.youtube.com/iframe_api';\n    const firstScript = document.getElementsByTagName('script')[0];\n    firstScript?.parentNode?.insertBefore(tag, firstScript);\n    console.log('[YOUTUBE-PLAYER-INIT] API script injected, waiting for onYouTubeIframeAPIReady...');\n\n    (window as any).onYouTubeIframeAPIReady = () => {\n      console.log('[YOUTUBE-PLAYER-INIT] API ready callback fired');\n      initPlayer(onReady);\n    };\n    return;\n  }\n\n  console.log('[YOUTUBE-PLAYER-INIT] YT API already available, initializing player directly');\n  initPlayer(onReady);\n\n  function initPlayer(onReadyCb?: () => void) {\n    console.log('[YOUTUBE-PLAYER-INIT] initPlayer() called, window.YT:', window.YT ? 'available' : 'undefined');\n    try {\n      console.log('[YOUTUBE-PLAYER-INIT] Creating new YT.Player instance...');\n      const player = new window.YT.Player(iframeElement, {\n        events: {\n          onReady: () => {\n            useYoutubeStore.getState().setPlayerReady(true);\n            console.log('[YOUTUBE-PLAYER-INIT] Player onReady fired - ytPlayer is now: valid');\n            console.log('[YOUTUBE-PLAYER-INIT] ytPlayer methods available:', {\n              playVideo: typeof player?.playVideo,\n              pauseVideo: typeof player?.pauseVideo,\n              seekTo: typeof player?.seekTo,\n              getCurrentTime: typeof player?.getCurrentTime,\n              getPlayerState: typeof player?.getPlayerState\n            });\n            onReadyCb?.();\n          },\n          onError: (e: any) => console.warn('[YOUTUBE-PLAYER-ERROR] YouTube player error:', e),\n          onStateChange: (e: any) => {\n            console.log('[YOUTUBE-STATE-CHANGE] State:', e.data); // 1=playing, 2=paused\n          }\n        }\n      });\n      useYoutubeStore.getState().setYtPlayer(player);\n      console.log('[YOUTUBE-PLAYER-INIT] YT.Player instance created, ytPlayer: valid');\n    } catch (error) {\n      console.warn('[YOUTUBE-PLAYER-INIT] Failed to initialize YouTube player:', error);\n      // Fallback ready\n      useYoutubeStore.getState().setPlayerReady(true);\n      onReadyCb?.();\n    }\n  }\n}\n\n","path":null,"size_bytes":2955,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/HUD/ComboDisplay.tsx":{"content":"// src/components/ComboDisplay.tsx\nimport React from 'react';\nimport { motion } from \"framer-motion\";\nimport { useGameStore } from '@/stores/useGameStore'; // Assumes store with game stats\n\ninterface ComboDisplayProps {\n  // Optional override; defaults to store for global sync\n  combo?: number;\n}\n\nexport function ComboDisplay({ combo: propCombo }: ComboDisplayProps = {}) {\n  // Pull from Zustand (fallback to props for testing/flexibility)\n  const combo = useGameStore(state => propCombo ?? state.combo);\n\n  return (\n    <div className=\"text-right flex items-center gap-4\">\n      <motion.div\n        className=\"text-3xl font-bold font-orbitron neon-glow\"\n        style={{ color: combo % 20 === 0 && combo > 0 ? 'hsl(120, 100%, 50%)' : 'hsl(280, 100%, 60%)' }}\n        animate={combo > 0 ? { scale: [1, 1.15, 1], rotate: combo % 10 === 0 ? [0, 5, -5, 0] : 0 } : {}}\n        transition={{ duration: 0.3 }}\n      >\n        x{combo}\n      </motion.div>\n      <div className=\"text-xs text-white/50\">COMBO</div>\n    </div>\n  );\n}","path":null,"size_bytes":1026,"size_tokens":null},"client/src/hooks/useKeyControls.ts":{"content":"// src/hooks/useKeyControls.ts\nimport { useEffect, useCallback } from 'react';\nimport { useGameStore } from '@/stores/useGameStore';\n\ninterface UseKeyControlsProps {\n  onPause?: () => void;\n  onResume?: () => void;\n  onRewind?: () => void;\n  onHitNote?: (lane: number) => void;\n  onTrackHoldStart?: (lane: number) => void;\n  onTrackHoldEnd?: (lane: number) => void;\n}\n\nconst KEY_LANE_MAP: Record<string, number> = {\n  'w': 0, 'W': 0,\n  'o': 1, 'O': 1,\n  'i': 2, 'I': 2,\n  'e': 3, 'E': 3,\n  'q': -1, 'Q': -1,\n  'p': -2, 'P': -2,\n};\n\nconst GAMEPLAY_KEYS = new Set(['w', 'W', 'o', 'O', 'i', 'I', 'e', 'E', 'q', 'Q', 'p', 'P']);\nconst HOLD_NOTE_LANES = new Set([-1, -2]);\n\nexport function useKeyControls({ onPause, onResume, onRewind, onHitNote, onTrackHoldStart, onTrackHoldEnd }: UseKeyControlsProps): void {\n  const gameState = useGameStore(state => state.gameState);\n  const isPaused = useGameStore(state => state.isPaused);\n  const storeHitNote = useGameStore(state => state.hitNote);\n  const hitNote = onHitNote || storeHitNote;\n\n  const handleKeyDown = useCallback(\n    (e: KeyboardEvent): void => {\n      if (GAMEPLAY_KEYS.has(e.key)) {\n        e.preventDefault();\n      }\n\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        if (gameState === 'PAUSED' || isPaused) {\n          onResume?.();\n        } else if (gameState === 'PLAYING' || gameState === 'RESUMING') {\n          onPause?.();\n        }\n      } else if ((e.key === 'r' || e.key === 'R') && (gameState === 'PLAYING' || gameState === 'PAUSED')) {\n        e.preventDefault();\n        onRewind?.();\n      }\n\n      if ((gameState === 'PLAYING' || gameState === 'RESUMING') && !isPaused) {\n        const lane = KEY_LANE_MAP[e.key];\n        if (lane !== undefined) {\n          if (HOLD_NOTE_LANES.has(lane)) {\n            onTrackHoldStart?.(lane);\n          } else {\n            hitNote(lane);\n          }\n        }\n      }\n    },\n    [gameState, isPaused, hitNote, onHitNote, storeHitNote, onPause, onResume, onRewind, onTrackHoldStart]\n  );\n\n  const handleKeyUp = useCallback(\n    (e: KeyboardEvent): void => {\n      if ((gameState === 'PLAYING' || gameState === 'RESUMING') && !isPaused) {\n        const lane = KEY_LANE_MAP[e.key];\n        if (lane !== undefined && HOLD_NOTE_LANES.has(lane)) {\n          onTrackHoldEnd?.(lane);\n        }\n      }\n    },\n    [gameState, isPaused, onTrackHoldEnd]\n  );\n\n  useEffect(() => {\n    window.addEventListener('keydown', handleKeyDown);\n    window.addEventListener('keyup', handleKeyUp);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n      window.removeEventListener('keyup', handleKeyUp);\n    };\n  }, [handleKeyDown, handleKeyUp]);\n}","path":null,"size_bytes":2685,"size_tokens":null},"client/src/lib/youtube/youtubeTimeListener.ts":{"content":"import { useYoutubeStore } from '@/stores/useYoutubeStore';\n\n/**\n * Initialize YouTube postMessage listener to track time updates\n * YouTube IFrame communicates internally via postMessage - we listen for time changes\n */\nexport function initYouTubeTimeListener(): void {\n  console.log('[YOUTUBE-TIME-LISTENER] Initializing postMessage listener...');\n  let messageCount = 0;\n  \n  const handleMessage = (event: MessageEvent) => {\n    messageCount++;\n    const originMatch = event.origin === 'https://www.youtube.com';\n    console.log(`[YOUTUBE-MESSAGE] #${messageCount} origin: ${event.origin} (match: ${originMatch}), data type: ${typeof event.data}`);\n    \n    // Strict origin check for security\n    if (event.origin !== 'https://www.youtube.com') {\n      console.log(`[YOUTUBE-MESSAGE] #${messageCount} Ignored: wrong origin`);\n      return;\n    }\n\n    let data;\n    try {\n      // YT sends objects or strings; try parse if string\n      if (typeof event.data === 'string') {\n        data = JSON.parse(event.data);\n      } else {\n        data = event.data;\n      }\n      console.log(`[YOUTUBE-MESSAGE] #${messageCount} Parsed data:`, JSON.stringify(data).slice(0, 100));\n    } catch (e) {\n      // Ignore non-JSON (e.g., plain \"YT.ready\")\n      console.log(`[YOUTUBE-MESSAGE] #${messageCount} Failed to parse, ignoring (likely non-JSON)`);\n      return;\n    }\n\n    // Handle state changes\n    if (data.event === 'onStateChange') {\n      console.log('[YOUTUBE-MESSAGE] State change:', data.data);\n    }\n\n    // Time updates: Primarily from infoDelivery (fires ~1s during play)\n    if (data.event === 'infoDelivery' && data.info?.currentTime !== undefined) {\n      const newTimeMs = data.info.currentTime * 1000;\n      const { youtubeCurrentTimeMs, setYoutubeCurrentTimeMs, setLastTimeUpdate } = useYoutubeStore.getState();\n      if (Math.abs(newTimeMs - youtubeCurrentTimeMs) > 50) { // Avoid micro-jitters\n        setYoutubeCurrentTimeMs(newTimeMs);\n        setLastTimeUpdate(Date.now());\n        console.log(`[YOUTUBE-MESSAGE] Time update (infoDelivery): ${(data.info.currentTime).toFixed(2)}s (was ${(youtubeCurrentTimeMs / 1000).toFixed(2)}s)`);\n      }\n      return;\n    }\n\n    // Fallback keys for other formats\n    const { setYoutubeCurrentTimeMs, setLastTimeUpdate } = useYoutubeStore.getState();\n    if (typeof data.currentTime === 'number') {\n      console.log(`[YOUTUBE-MESSAGE] #${messageCount} Found currentTime in fallback format: ${data.currentTime}`);\n      setYoutubeCurrentTimeMs(data.currentTime * 1000);\n      setLastTimeUpdate(Date.now());\n    } else if (data.info?.currentTime !== undefined) {\n      console.log(`[YOUTUBE-MESSAGE] #${messageCount} Found currentTime in info format: ${data.info.currentTime}`);\n      setYoutubeCurrentTimeMs(data.info.currentTime * 1000);\n      setLastTimeUpdate(Date.now());\n    } else if (data.time !== undefined && typeof data.time === 'number') {\n      console.log(`[YOUTUBE-MESSAGE] #${messageCount} Found time in legacy format: ${data.time}`);\n      setYoutubeCurrentTimeMs(data.time * 1000);\n      setLastTimeUpdate(Date.now());\n    }\n\n    // Query responses (e.g., getCurrentTime)\n    if (data.event === 'onApiChange' && data.data?.currentTime !== undefined) {\n      console.log(`[YOUTUBE-MESSAGE] #${messageCount} API change with currentTime: ${data.data.currentTime}`);\n      setYoutubeCurrentTimeMs(data.data.currentTime * 1000);\n      setLastTimeUpdate(Date.now());\n    }\n  };\n\n  window.addEventListener('message', handleMessage);\n  console.log('[YOUTUBE-TIME-LISTENER] postMessage listener initialized and attached to window');\n}","path":null,"size_bytes":3596,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport tailwindcss from \"@tailwindcss/vite\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\nimport { metaImagesPlugin } from \"./vite-plugin-meta-images\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    tailwindcss(),\n    metaImagesPlugin(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  css: {\n    postcss: {\n      plugins: [],\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    host: \"0.0.0.0\",\n    allowedHosts: true,\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1330,"size_tokens":null},"client/src/components/game/hud/SoundpadButtons.tsx":{"content":"// src/components/SoundpadButtons.tsx\nimport React, { useCallback } from 'react';\nimport { useGameStore } from '@/stores/useGameStore'; // Assumes store with vpX, vpY (e.g., viewport state)\nimport { SoundpadButton } from './SoundpadButton';\nimport { calculateButtonPosition } from '@/lib/utils/soundpadUtils';\nimport { BUTTON_CONFIG, TUNNEL_CONTAINER_WIDTH, TUNNEL_CONTAINER_HEIGHT } from '@/lib/config/gameConstants';\n\ninterface SoundpadButtonsProps {\n  // Optional overrides; defaults to store for global sync\n  vpX?: number;\n  vpY?: number;\n  onPadHit?: (lane: number) => void;\n}\n\nexport function SoundpadButtons(props: SoundpadButtonsProps = {}) {\n  const { vpX = 350, vpY = 300, onPadHit = () => {} } = props;\n  \n  // Validate viewport values before rendering\n  const isValid = typeof vpX === 'number' && typeof vpY === 'number' && vpX >= 0 && vpY >= 0;\n  \n  if (!isValid) {\n    return null;\n  }\n\n  return (\n    <svg\n      className=\"absolute inset-0\"\n      data-testid=\"soundpad-container\"\n      style={{\n        width: `${TUNNEL_CONTAINER_WIDTH}px`,\n        height: `${TUNNEL_CONTAINER_HEIGHT}px`,\n        opacity: 1,\n        margin: '0 auto',\n      }}\n    >\n      {BUTTON_CONFIG.map(({ lane, angle }) => {\n        const position = calculateButtonPosition(angle, vpX, vpY);\n        return (\n          <SoundpadButton\n            key={`soundpad-button-${lane}`}\n            lane={lane}\n            position={position}\n            onPadHit={onPadHit}\n            data-testid={`soundpad-button-${lane}`}\n          />\n        );\n      })}\n    </svg>\n  );\n}\n","path":null,"size_bytes":1560,"size_tokens":null},"client/src/hooks/useTapNotes.ts":{"content":"// src/hooks/useTapNotes.ts\nimport { useMemo } from 'react';\nimport { useGameStore } from '@/stores/useGameStore';\nimport type { Note } from '@/lib/engine/gameTypes';\nimport { getTapNoteState, TapNoteState, shouldRenderTapNote } from '@/lib/notes/tap/tapNoteHelpers';\nimport { LEAD_TIME, REFERENCE_BPM } from '@/lib/config/gameConstants';\nimport { GameErrors } from '@/lib/errors/errorLog';\n\nexport interface TapNoteProcessedData {\n  note: Note;\n  state: TapNoteState;\n  progressForGeometry: number;\n  clampedProgress: number;\n  rawProgress: number;\n}\n\nexport function useTapNotes(): TapNoteProcessedData[] {\n  const notes = useGameStore(state => state.notes);\n  const currentTime = useGameStore(state => state.currentTime);\n  const gameState = useGameStore(state => state.gameState);\n  const beatmapBpm = useGameStore(state => state.beatmapBpm) || 120;\n\n  return useMemo(() => {\n    // Don't render notes until game is actually playing (YouTube started)\n    if (gameState !== 'PLAYING' && gameState !== 'PAUSED' && gameState !== 'RESUMING') {\n      return [];\n    }\n    \n    // Ensure notes is an array\n    if (!notes || !Array.isArray(notes)) {\n      return [];\n    }\n\n    // effectiveLEAD_TIME scales with BPM to prevent note stacking on fast songs\n    const effectiveLEAD_TIME = LEAD_TIME * (REFERENCE_BPM / Math.max(1, beatmapBpm));\n\n    // Filter visibly relevant notes first to reduce map overhead\n    // Keep failed notes visible longer to ensure they reach judgement line and greyscale animation completes\n    // tapTooEarlyFailure needs very long window (4000ms) to travel from failure point to judgement line\n    // tapMissFailure needs moderate window (2000ms) since they already reached judgement line\n    const visibleNotes = notes.filter(n => {\n      if (n.tapTooEarlyFailure) return n.time <= currentTime + effectiveLEAD_TIME && n.time >= currentTime - 4000;\n      if (n.tapMissFailure) return n.time <= currentTime + effectiveLEAD_TIME && n.time >= currentTime - 2000;\n      return n.time <= currentTime + effectiveLEAD_TIME && n.time >= currentTime - 500;\n    });\n    \n    const processed = visibleNotes\n      .filter(n => n.type === 'TAP')\n      .map(note => {\n        const state = getTapNoteState(note, currentTime);\n        \n        // Calculate progress\n        // progress 0 = spawn (far away)\n        // progress 1 = hit line (near)\n        const rawProgress = 1 - ((note.time - currentTime) / effectiveLEAD_TIME);\n        const clampedProgress = Math.max(0, Math.min(1, rawProgress));\n        \n        // For geometry, we allow it to go > 1 to show it falling through/passing judgement line\n        const progressForGeometry = rawProgress;\n\n        if (!shouldRenderTapNote(state, note.time - currentTime, beatmapBpm)) {\n            return null;\n        }\n\n        return {\n          note,\n          state,\n          progressForGeometry,\n          clampedProgress,\n          rawProgress\n        };\n      })\n      .filter((n): n is TapNoteProcessedData => n !== null);\n\n      return processed;\n  }, [notes, currentTime, gameState, beatmapBpm]);\n}","path":null,"size_bytes":3071,"size_tokens":null},"client/src/lib/youtube/youtubePlay.ts":{"content":"import { waitForPlayerReady } from './youtubePlayerState';\nimport { useYoutubeStore } from '@/stores/useYoutubeStore';\nimport { resetYouTubeTimeTracker } from './youtubeTimeReset';\n\n/**\n * Play YouTube video\n * Uses official API if available, falls back to iframe postMessage control\n */\nexport async function playYouTubeVideo(): Promise<void> {\n  await waitForPlayerReady(1000);\n\n  try {\n    // Get fresh player reference right before using it\n    let ytPlayer = useYoutubeStore.getState().ytPlayer;\n    let currentState: number | null = null;\n    if (ytPlayer?.getPlayerState) {\n      currentState = ytPlayer.getPlayerState();\n      if (currentState === 1) { // Already playing\n        console.log('[YOUTUBE-PLAY] Already playing, skipping');\n        return;\n      }\n    }\n\n    // Get fresh references right before calling methods\n    ytPlayer = useYoutubeStore.getState().ytPlayer;\n    const youtubeIframeElement = useYoutubeStore.getState().youtubeIframeElement;\n    const youtubeCurrentTimeMs = useYoutubeStore.getState().youtubeCurrentTimeMs;\n\n    if (ytPlayer && typeof ytPlayer.playVideo === 'function') {\n      const currentTime = ytPlayer.getCurrentTime?.() ?? 0;\n      const minutes = Math.floor(currentTime / 60);\n      const seconds = (currentTime % 60).toFixed(2);\n      ytPlayer.playVideo();\n      console.log(`[YOUTUBE-PLAY] Official API: Playing from ${minutes}:${seconds} (${currentTime.toFixed(2)}s total)`);\n    } else if (youtubeIframeElement?.contentWindow) {\n      youtubeIframeElement.contentWindow.postMessage(\n        JSON.stringify({\n          event: 'command',\n          func: 'playVideo',\n          args: []\n        }),\n        '*'\n      );\n      console.log(`[YOUTUBE-PLAY] PostMessage fallback: Playing from tracked time ${(youtubeCurrentTimeMs / 1000).toFixed(2)}s`);\n    } else {\n      console.error('[YOUTUBE-PLAY] No play method available - ytPlayer:', ytPlayer ? 'exists' : 'null', 'iframe:', youtubeIframeElement ? 'exists' : 'null');\n      throw new Error('No play method available');\n    }\n\n    // Poll for play confirmation (handles buffering stalls)\n    await new Promise<void>((resolve) => {\n      const maxAttempts = 5; // Reduced to 250ms for responsiveness\n      let attempts = 0;\n      const poll = () => {\n        attempts++;\n        let state = -1;\n        const ytPlayerCheck = useYoutubeStore.getState().ytPlayer;\n        const iframeCheck = useYoutubeStore.getState().youtubeIframeElement;\n        if (ytPlayerCheck?.getPlayerState) {\n          state = ytPlayerCheck.getPlayerState();\n        } else if (iframeCheck?.contentWindow) {\n          // Fallback: Query state via postMessage (one-shot, response async but approx)\n          iframeCheck.contentWindow.postMessage(\n            JSON.stringify({ event: 'command', func: 'getPlayerState', args: [] }),\n            '*'\n          );\n          // Note: Actual response handled in listener; use timeout as proxy\n          state = 1; // Optimistic for fallback\n        }\n        if (state === 1) { // Playing confirmed\n          console.log(`[YOUTUBE-PLAY] Confirmed playing after ${attempts * 50}ms`);\n          // Reset time tracker to mark as \"fresh\" - restarts 1000ms fallback window\n          const currentTimeSeconds = ytPlayerCheck?.getCurrentTime?.() ?? youtubeCurrentTimeMs / 1000 ?? 0;\n          resetYouTubeTimeTracker(currentTimeSeconds);\n          resolve();\n        } else if (attempts >= maxAttempts) {\n          console.warn(`[YOUTUBE-PLAY] Timeout: state=${state}, proceeding optimistically`);\n          resolve(); // Fallback: Assume started\n        } else {\n          setTimeout(poll, 50);\n        }\n      };\n      setTimeout(poll, 50); // Initial settle\n    });\n  } catch (error) {\n    console.error('[YOUTUBE-PLAY] Failed:', error);\n    throw error;\n  }\n}","path":null,"size_bytes":3776,"size_tokens":null},"client/src/lib/notes/index.ts":{"content":"export type { NoteUpdateResult } from './config/types';\n\n// TAP note processors\nexport { getTapNoteState, shouldRenderTapNote, trackTapNoteAnimation } from './tap/tapNoteHelpers';\nexport * from './tap/tapNoteStyle';\n\n// HOLD note processors  \nexport { getHoldNoteFailureStates, markAnimationCompletedIfDone, trackHoldNoteAnimationLifecycle } from './hold/holdNoteHelpers';\nexport * from './hold/holdGreystate';\nexport * from './hold/holdNoteStyle';\n\n// Main processors\nexport { NoteProcessor } from './processors/noteProcessor';\nexport { NoteValidator } from './processors/noteValidator';\nexport * from './processors/noteUpdateHelpers';\nexport * from './processors/noteAutoFailHelpers';\n","path":null,"size_bytes":687,"size_tokens":null},"client/src/lib/youtube/youtubePlayerState.ts":{"content":"import { useYoutubeStore } from '@/stores/useYoutubeStore';\n\n/**\n * SINGLE SOURCE OF TRUTH: Check if YouTube player is ready\n * ytPlayer exists AND playerReady flag is set AND has either API player or iframe element\n */\nexport function isPlayerReady(): boolean {\n  const { ytPlayer, playerReady, youtubeIframeElement } = useYoutubeStore.getState();\n  return playerReady && (ytPlayer !== null || youtubeIframeElement !== null);\n}\n\n/**\n * SINGLE SOURCE OF TRUTH: Wait for YouTube player to be ready with exponential backoff\n * Checks both YT.Player API and iframe element availability\n * @param maxWaitMs Maximum milliseconds to wait (default 5000ms)\n * @returns true if player becomes ready, false if timeout (continues anyway with postMessage fallback)\n */\nexport async function waitForPlayerReady(maxWaitMs: number = 5000): Promise<boolean> {\n  const startTime = performance.now();\n  let waitTime = 50; // Start with 50ms\n\n  while (performance.now() - startTime < maxWaitMs) {\n    if (isPlayerReady()) {\n      console.log(`[YOUTUBE-READY] Player ready after ${(performance.now() - startTime).toFixed(0)}ms`);\n      return true;\n    }\n    await new Promise(resolve => setTimeout(resolve, waitTime));\n    waitTime = Math.min(waitTime * 1.5, 200); // Cap at 200ms between checks\n  }\n\n  // Player not ready but continue anyway - postMessage fallback will handle it\n  console.log(`[YOUTUBE-READY] Player API not available after ${maxWaitMs}ms, continuing with postMessage fallback`);\n  return false;\n}\n\n/**\n * SINGLE SOURCE OF TRUTH: Check if YouTube has a valid current time\n * @returns true if current time is valid and >= 0\n */\nexport function hasValidYouTubeTime(): boolean {\n  const ytPlayer = useYoutubeStore.getState().ytPlayer;\n  if (!ytPlayer || typeof ytPlayer.getCurrentTime !== 'function') {\n    return false;\n  }\n  \n  try {\n    const time = ytPlayer.getCurrentTime();\n    return typeof time === 'number' && !isNaN(time) && time >= 0;\n  } catch {\n    return false;\n  }\n}","path":null,"size_bytes":1978,"size_tokens":null},"client/src/lib/notes/processors/noteUpdateHelpers.ts":{"content":"import { Note, ScoreState } from '@/lib/engine/gameTypes';\n\nexport type NoteUpdateResult = {\n  updatedNote: Note;\n  scoreChange?: ScoreState;\n  success: boolean;\n};\n\nexport const roundTime = (time: number): number => Math.round(time);\n\nexport const createFailureUpdate = (\n  note: Note,\n  currentTime: number,\n  failureType: keyof Omit<Note, 'id' | 'type' | 'time' | 'lane' | 'duration' | 'hit' | 'missed'>,\n  scoreChange: ScoreState\n): NoteUpdateResult => ({\n  updatedNote: {\n    ...note,\n    [failureType]: true,\n    failureTime: roundTime(currentTime),\n  },\n  scoreChange,\n  success: false,\n});\n\nexport const createSuccessUpdate = (\n  note: Note,\n  scoreChange: ScoreState\n): NoteUpdateResult => ({\n  updatedNote: {\n    ...note,\n    hit: true,\n  },\n  scoreChange,\n  success: true,\n});\n\nexport const createTapHitUpdate = (\n  note: Note,\n  currentTime: number,\n  scoreChange: ScoreState,\n  isTooEarly: boolean\n): NoteUpdateResult => ({\n  updatedNote: {\n    ...note,\n    hit: !isTooEarly,\n    tapTooEarlyFailure: isTooEarly,\n    failureTime: isTooEarly ? roundTime(currentTime) : undefined,\n  },\n  scoreChange,\n  success: !isTooEarly,\n});\n\nexport const createHoldStartUpdate = (\n  note: Note,\n  currentTime: number,\n  scoreChange: ScoreState | undefined,\n  failureType?: 'tooEarlyFailure' | 'holdMissFailure'\n): NoteUpdateResult => ({\n  updatedNote: {\n    ...note,\n    pressHoldTime: roundTime(currentTime),\n    ...(failureType && { [failureType]: true, failureTime: roundTime(currentTime) }),\n  },\n  scoreChange,\n  success: !failureType,\n});\n\nexport const createHoldEndUpdate = (\n  note: Note,\n  currentTime: number,\n  scoreChange: ScoreState,\n  isValid: boolean\n): NoteUpdateResult => ({\n  updatedNote: {\n    ...note,\n    releaseTime: roundTime(currentTime),\n    hit: isValid,\n    holdReleaseFailure: !isValid,\n    failureTime: isValid ? undefined : roundTime(currentTime),\n  },\n  scoreChange,\n  success: isValid,\n});\n","path":null,"size_bytes":1920,"size_tokens":null},"client/src/lib/notes/tap/tapNoteStyle.ts":{"content":"import { GREYSCALE_GLOW_COLOR, TAP_FAILURE_ANIMATIONS, TAP_HIT_FLASH, TAP_COLORS, TAP_OPACITY } from '@/lib/config/gameConstants';\nimport { TapNoteState } from './tapNoteHelpers';\nimport { TapNoteColors, TapGreyscaleState, determineTapGreyscaleState, calculateTapNoteColors } from './tapGreystate';\n\nexport interface TapNoteStyle {\n  opacity: number;\n  fill: string;\n  stroke: string;\n  filter: string;\n  hitFlashIntensity: number;\n}\n\nconst getBaseOpacity = (progress: number): number => TAP_OPACITY.MIN_BASE + (progress * TAP_OPACITY.MAX_PROGRESSION);\n\nconst getFailureOpacity = (state: TapNoteState, rawProgress: number): number => {\n  const baseOpacity = getBaseOpacity(rawProgress);\n  const animDuration = state.isTapTooEarlyFailure ? TAP_FAILURE_ANIMATIONS.TOO_EARLY.duration : TAP_FAILURE_ANIMATIONS.MISS.duration;\n  const failProgress = Math.min(state.timeSinceFail / animDuration, 1.0);\n  return baseOpacity * (1.0 - failProgress);\n};\n\nconst getHitOpacity = (state: TapNoteState, progress: number): number => {\n  if (state.timeSinceHit < TAP_HIT_FLASH.FADE_START) {\n    return getBaseOpacity(progress);\n  }\n  const fadeProgress = (state.timeSinceHit - TAP_HIT_FLASH.FADE_START) / TAP_HIT_FLASH.FADE_DURATION;\n  return Math.max(TAP_OPACITY.MIN_FADE, (1 - fadeProgress) * getBaseOpacity(progress));\n};\n\nconst getApproachingOpacity = (progress: number): number => getBaseOpacity(progress);\n\nconst calculateHitFlashIntensity = (state: TapNoteState): number => {\n  if (!state.isHit || state.timeSinceHit >= TAP_HIT_FLASH.DURATION) return 0;\n  return Math.max(0, 1 - (state.timeSinceHit / TAP_HIT_FLASH.DURATION));\n};\n\nconst calculateGlowFilter = (\n  greyscaleState: TapGreyscaleState,\n  colors: TapNoteColors,\n  hitFlashIntensity: number\n): string => {\n  if (greyscaleState.isGreyed) {\n    return `drop-shadow(0 0 8px ${GREYSCALE_GLOW_COLOR}) grayscale(1)`;\n  }\n  \n  if (hitFlashIntensity > 0) {\n    return TAP_COLORS.GLOW_SHADOW(colors.glowColor);\n  }\n  \n  return '';\n};\n\nexport const calculateTapNoteStyle = (\n  progress: number,\n  state: TapNoteState,\n  noteColor: string,\n  rawProgress: number = 0,\n  lane: number = 0\n): TapNoteStyle => {\n  const hitFlashIntensity = calculateHitFlashIntensity(state);\n  const greyscaleState = determineTapGreyscaleState(state, rawProgress);\n  const colors = calculateTapNoteColors(greyscaleState, lane, noteColor);\n\n  let opacity: number;\n  let filter = '';\n\n  if (state.isTapTooEarlyFailure || state.isTapMissFailure) {\n    opacity = getFailureOpacity(state, rawProgress);\n    filter = calculateGlowFilter(greyscaleState, colors, 0);\n  } else if (state.isHit) {\n    opacity = getHitOpacity(state, progress);\n    filter = calculateGlowFilter(greyscaleState, colors, hitFlashIntensity);\n  } else {\n    opacity = getApproachingOpacity(progress);\n  }\n\n  return { \n    opacity: Math.max(opacity, 0), \n    fill: colors.fillColor, \n    stroke: colors.strokeColor, \n    filter, \n    hitFlashIntensity \n  };\n};\n\nexport { determineTapGreyscaleState, calculateTapNoteColors, type TapNoteColors, type TapGreyscaleState } from './tapGreystate';\n","path":null,"size_bytes":3074,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/game/loaders/BeatmapLoader.tsx":{"content":"// src/components/BeatmapLoader.tsx\nimport React from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Music } from \"lucide-react\";\nimport { useBeatmapLoader } from '@/hooks/useBeatmapLoader';\nimport { BeatmapData } from '@/lib/beatmap/beatmapParser';\n\ninterface BeatmapLoaderProps {\n  difficulty: 'EASY' | 'MEDIUM' | 'HARD';\n  isOpen: boolean;\n  setIsOpen: (open: boolean) => void;\n  onBeatmapLoad: (data: BeatmapData, beatmapText: string) => void;\n}\n\nexport function BeatmapLoader({ difficulty, isOpen, setIsOpen, onBeatmapLoad }: BeatmapLoaderProps) {\n  const {\n    beatmapText,\n    error,\n    isBeatmapLoaded,\n    handleBeatmapTextChange,\n    handleLoadBeatmap,\n    handleQuickLoadEscapingGravity,\n  } = useBeatmapLoader({ difficulty, onBeatmapLoad });\n\n  return (\n    <div className=\"absolute top-4 left-4 z-30\">\n      <Dialog open={isOpen} onOpenChange={setIsOpen}>\n        <DialogTrigger asChild>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className={`border-neon-cyan text-neon-cyan hover:bg-neon-cyan/10 font-rajdhani text-xs gap-1.5 ${\n              isBeatmapLoaded ? 'bg-neon-cyan/20' : ''\n            }`}\n            data-testid=\"button-load-beatmap\"\n          >\n            <Music size={14} />\n            {isBeatmapLoaded ? 'BEATMAP LOADED' : 'LOAD BEATMAP'}\n          </Button>\n        </DialogTrigger>\n        <DialogContent className=\"bg-black/95 border-neon-cyan/50 backdrop-blur-sm max-w-5xl max-h-[80vh] flex flex-col\">\n          <DialogHeader>\n            <DialogTitle className=\"text-neon-cyan font-orbitron tracking-wider\">\n              LOAD BEATMAP\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"flex-1 flex flex-col gap-4 overflow-hidden\">\n            {/* Main content area: textarea and instructions side-by-side */}\n            <div className=\"flex gap-4 flex-1 min-h-0\">\n              {/* Left: Textarea */}\n              <div className=\"flex-1 flex flex-col gap-2 min-w-0\">\n                <label className=\"text-sm text-neon-pink font-rajdhani\">\n                  Paste Beatmap Text ({difficulty})\n                </label>\n                <Textarea\n                  value={beatmapText}\n                  onChange={(e) => handleBeatmapTextChange(e.target.value)}\n                  className=\"bg-black/50 border-neon-cyan/30 text-white placeholder:text-white/20 font-mono text-xs resize-none flex-1\"\n                  data-testid=\"textarea-beatmap\"\n                />\n              </div>\n              {/* Right: Instructions */}\n              <div className=\"w-64 flex flex-col gap-2 overflow-y-auto\">\n                <div className=\"bg-black/50 border border-neon-cyan/20 rounded p-3 text-xs text-white/60 font-rajdhani space-y-2 flex-shrink-0\">\n                  <p className=\"font-bold text-neon-cyan\">FORMAT</p>\n                  <div className=\"space-y-1\">\n                    <p className=\"text-white/80\">[METADATA]:</p>\n                    <p className=\"ml-2 text-white/50\">title, artist, bpm</p>\n                    <p className=\"ml-2 text-white/50\">duration, youtube</p>\n                    <p className=\"ml-2 text-white/50\">beatmapStart, beatmapEnd</p>\n                  </div>\n                  <div className=\"space-y-1\">\n                    <p className=\"text-neon-cyan mt-2\">TAP:</p>\n                    <p className=\"font-mono ml-2 text-white/50\">time|lane|TAP</p>\n                  </div>\n                  <div className=\"space-y-1\">\n                    <p className=\"text-neon-cyan\">HOLD:</p>\n                    <p className=\"font-mono ml-2 text-white/50 text-xs\">start|lane</p>\n                    <p className=\"font-mono ml-2 text-white/50 text-xs\">|HOLD_START</p>\n                    <p className=\"font-mono ml-2 text-white/50 text-xs\">end|lane</p>\n                    <p className=\"font-mono ml-2 text-white/50 text-xs\">|HOLD_END</p>\n                  </div>\n                  <div className=\"space-y-1 mt-2\">\n                    <p className=\"text-white/50 text-xs\">Lanes:</p>\n                    <p className=\"ml-2 text-white/40 text-xs\">0-3: pads</p>\n                    <p className=\"ml-2 text-white/40 text-xs\">-1: Q (left)</p>\n                    <p className=\"ml-2 text-white/40 text-xs\">-2: P (right)</p>\n                  </div>\n                </div>\n              </div>\n            </div>\n            {/* Error message */}\n            {error && (\n              <p className=\"text-xs text-neon-pink font-rajdhani\">{error}</p>\n            )}\n            {/* Buttons */}\n            <div className=\"flex gap-2 flex-shrink-0\">\n              <Button\n                onClick={handleLoadBeatmap}\n                className=\"flex-1 bg-neon-cyan text-black hover:bg-neon-cyan/80 font-rajdhani font-bold\"\n                data-testid=\"button-confirm-beatmap\"\n              >\n                LOAD\n              </Button>\n              <Button\n                onClick={handleQuickLoadEscapingGravity}\n                size=\"sm\"\n                className=\"bg-neon-yellow/30 text-neon-yellow hover:bg-neon-yellow/50 font-rajdhani text-xs\"\n                data-testid=\"button-quick-load-gravity\"\n              >\n                ESCAPING GRAVITY\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={() => setIsOpen(false)}\n                className=\"border-neon-pink text-neon-pink hover:bg-neon-pink/10 font-rajdhani\"\n                data-testid=\"button-cancel-beatmap\"\n              >\n                CANCEL\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","path":null,"size_bytes":5776,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload\n            .filter((item) => item.type !== \"none\")\n            .map((item, index) => {\n              const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n              const itemConfig = getPayloadConfigFromPayload(config, item, key)\n              const indicatorColor = color || item.payload.fill || item.color\n\n              return (\n                <div\n                  key={item.dataKey}\n                  className={cn(\n                    \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                    indicator === \"dot\" && \"items-center\"\n                  )}\n                >\n                  {formatter && item?.value !== undefined && item.name ? (\n                    formatter(item.value, item.name, item, index, item.payload)\n                  ) : (\n                    <>\n                      {itemConfig?.icon ? (\n                        <itemConfig.icon />\n                      ) : (\n                        !hideIndicator && (\n                          <div\n                            className={cn(\n                              \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                              {\n                                \"h-2.5 w-2.5\": indicator === \"dot\",\n                                \"w-1\": indicator === \"line\",\n                                \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                  indicator === \"dashed\",\n                                \"my-0.5\": nestLabel && indicator === \"dashed\",\n                              }\n                            )}\n                            style={\n                              {\n                                \"--color-bg\": indicatorColor,\n                                \"--color-border\": indicatorColor,\n                              } as React.CSSProperties\n                            }\n                          />\n                        )\n                      )}\n                      <div\n                        className={cn(\n                          \"flex flex-1 justify-between leading-none\",\n                          nestLabel ? \"items-end\" : \"items-center\"\n                        )}\n                      >\n                        <div className=\"grid gap-1.5\">\n                          {nestLabel ? tooltipLabel : null}\n                          <span className=\"text-muted-foreground\">\n                            {itemConfig?.label || item.name}\n                          </span>\n                        </div>\n                        {item.value && (\n                          <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                            {item.value.toLocaleString()}\n                          </span>\n                        )}\n                      </div>\n                    </>\n                  )}\n                </div>\n              )\n            })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload\n          .filter((item) => item.type !== \"none\")\n          .map((item) => {\n            const key = `${nameKey || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n            return (\n              <div\n                key={item.value}\n                className={cn(\n                  \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n                )}\n              >\n                {itemConfig?.icon && !hideIcon ? (\n                  <itemConfig.icon />\n                ) : (\n                  <div\n                    className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                    style={{\n                      backgroundColor: item.color,\n                    }}\n                  />\n                )}\n                {itemConfig?.label}\n              </div>\n            )\n          })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10763,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4887,"size_tokens":null},"client/src/components/game/tunnel/TunnelBackground.tsx":{"content":"// src/components/TunnelBackground.tsx\nimport React, { memo } from 'react';\nimport { useGameStore } from '@/stores/useGameStore';\nimport { getHealthBasedRayColor } from '@/lib/utils/tunnelUtils';\nimport { HexagonLayers } from './HexagonLayers';\nimport { RadialSpokes } from './RadialSpokes';\nimport { VANISHING_POINT_X, VANISHING_POINT_Y, TUNNEL_CONTAINER_WIDTH, TUNNEL_CONTAINER_HEIGHT } from '@/lib/config/gameConstants';\n\ninterface TunnelBackgroundProps {\n  vpX?: number;\n  vpY?: number;\n  hexCenterX?: number;\n  hexCenterY?: number;\n  health?: number;\n}\n\nconst TunnelBackgroundComponent = ({ \n  vpX = VANISHING_POINT_X, \n  vpY = VANISHING_POINT_Y, \n  hexCenterX = VANISHING_POINT_X,\n  hexCenterY = VANISHING_POINT_Y,\n  health: propHealth \n}: TunnelBackgroundProps) => {\n  const storeHealth = useGameStore(state => state.health);\n  const health = propHealth ?? storeHealth;\n\n  const rayColor = getHealthBasedRayColor(health);\n\n  return (\n    <div \n      className=\"relative\" \n      data-testid=\"tunnel-background\"\n      style={{ width: `${TUNNEL_CONTAINER_WIDTH}px`, height: `${TUNNEL_CONTAINER_HEIGHT}px`, margin: '0 auto' }}\n    >\n      <svg className=\"absolute inset-0 w-full h-full\" style={{ opacity: 1 }} data-testid=\"tunnel-background-svg\">\n        <circle cx={vpX} cy={vpY} r=\"6\" fill=\"rgba(0,255,255,0.05)\" data-testid=\"vanishing-point-circle\" />\n        <HexagonLayers rayColor={rayColor} vpX={vpX} vpY={vpY} hexCenterX={hexCenterX} hexCenterY={hexCenterY} />\n        <RadialSpokes rayColor={rayColor} vpX={vpX} vpY={vpY} hexCenterX={hexCenterX} hexCenterY={hexCenterY} />\n      </svg>\n    </div>\n  );\n};\n\nexport const TunnelBackground = memo(TunnelBackgroundComponent);","path":null,"size_bytes":1682,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"grid place-content-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1031,"size_tokens":null},"client/src/components/ui/kbd.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Kbd({ className, ...props }: React.ComponentProps<\"kbd\">) {\n  return (\n    <kbd\n      data-slot=\"kbd\"\n      className={cn(\n        \"bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 select-none items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium\",\n        \"[&_svg:not([class*='size-'])]:size-3\",\n        \"[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction KbdGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <kbd\n      data-slot=\"kbd-group\"\n      className={cn(\"inline-flex items-center gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Kbd, KbdGroup }\n","path":null,"size_bytes":862,"size_tokens":null},"client/src/lib/youtube/youtubeUrlUtils.ts":{"content":"// src/lib/utils/youtube/youtubeUrlUtils.ts\n/**\n * Extract YouTube video ID from URL or ID string\n * Supports: full URLs, shortened URLs, and raw video IDs\n */\nexport function extractYouTubeId(url: string): string | null {\n  // Input validation\n  if (!url || typeof url !== 'string') {\n    return null;\n  }\n  // Trim whitespace\n  url = url.trim();\n  // Validate URL is not empty after trimming\n  if (url.length === 0) {\n    return null;\n  }\n  const patterns = [\n    /(?:https?:\\/\\/)?(?:www\\.)?youtube\\.com\\/watch\\?v=([a-zA-Z0-9_-]{11})/,\n    /(?:https?:\\/\\/)?(?:www\\.)?youtu\\.be\\/([a-zA-Z0-9_-]{11})/,\n    /^([a-zA-Z0-9_-]{11})$/, // Raw ID: must be exactly 11 chars, nothing more\n  ];\n  for (const pattern of patterns) {\n    const match = url.match(pattern);\n    if (match && match[1]) {\n      return match[1];\n    }\n  }\n  return null;\n}\n\n/**\n * Build YouTube embed URL with full audio/video sync support\n * For background playback: game engine controls playback via API\n * For gameplay sync: must use currentTime property via iframe access\n */\nexport function buildYouTubeEmbedUrl(videoId: string, options: {\n  autoplay?: boolean;\n  muted?: boolean;\n  controls?: boolean;\n  modestBranding?: boolean;\n  enableJsApi?: boolean;\n  start?: number; // Start time in seconds\n  origin?: string; // Security for postMessage\n} = {}): string {\n  const params = new URLSearchParams();\n\n  // Default to no autoplay for background control\n  params.append('autoplay', '0');\n  if (options.autoplay === true) params.append('autoplay', '1');\n\n  // Prevent YouTube from showing related videos (game focus)\n  params.append('rel', '0');\n  \n  if (options.muted) params.append('mute', '1');\n  if (options.controls === false) params.append('controls', '0');\n  if (options.modestBranding) params.append('modestbranding', '1');\n  // Always enable JS API for game control\n  params.append('enablejsapi', '1');\n  if (typeof options.start === 'number' && options.start > 0) {\n    params.append('start', Math.floor(options.start).toString());\n  }\n  // Origin for postMessage security (default to current domain; set via env in prod)\n  const origin = options.origin || window.location.origin;\n  params.append('origin', origin);\n\n  return `https://www.youtube.com/embed/${videoId}?${params.toString()}`;\n}","path":null,"size_bytes":2274,"size_tokens":null},"client/src/types/gameDebugTypes.ts":{"content":"export type FailureType = \n  | 'tapTooEarlyFailure'\n  | 'tapMissFailure'\n  | 'tooEarlyFailure'\n  | 'holdMissFailure'\n  | 'holdReleaseFailure';\n\nexport interface AnimationTrackingEntry {\n  noteId: string;\n  type: FailureType;\n  failureTime?: number;\n  completed: boolean;\n}\n","path":null,"size_bytes":273,"size_tokens":null},"client/src/components/game/hud/SoundpadButton.tsx":{"content":"// src/components/SoundpadButton.tsx\nimport React from 'react';\nimport { BUTTON_CONFIG } from '@/lib/config/gameConstants';\n\ninterface SoundpadButtonProps {\n  lane: number;\n  position: { cx: number; cy: number };\n  onPadHit: (lane: number) => void;\n}\n\nexport const SoundpadButton: React.FC<SoundpadButtonProps> = ({ lane, position, onPadHit }) => {\n  const { key, color } = BUTTON_CONFIG.find(config => config.lane === lane)!; // Assumes config has unique lanes\n  const { cx, cy } = position;\n\n  return (\n    <g data-testid={`soundpad-button-${lane}`}>\n      <rect\n        x={cx - 20}\n        y={cy - 20}\n        width=\"40\"\n        height=\"40\"\n        fill={color}\n        stroke={color}\n        strokeWidth=\"2\"\n        opacity=\"0.8\"\n        style={{ cursor: 'pointer' }}\n        onMouseDown={(e) => {\n          e.preventDefault();\n          onPadHit(lane);\n        }}\n        onTouchStart={(e) => {\n          e.preventDefault();\n          onPadHit(lane);\n        }}\n      />\n      <rect\n        x={cx - 20}\n        y={cy - 20}\n        width=\"40\"\n        height=\"40\"\n        fill=\"none\"\n        stroke={color}\n        strokeWidth=\"1\"\n        opacity=\"0.3\"\n        style={{ pointerEvents: 'none' }}\n      />\n      <text\n        x={cx}\n        y={cy}\n        textAnchor=\"middle\"\n        dominantBaseline=\"middle\"\n        fill={color}\n        fontSize=\"12\"\n        fontWeight=\"bold\"\n        fontFamily=\"Rajdhani, monospace\"\n        opacity=\"1\"\n        style={{ pointerEvents: 'none' }}\n      >\n        {key}\n      </text>\n    </g>\n  );\n};","path":null,"size_bytes":1535,"size_tokens":null},"client/src/components/ui/HUD/ScoreDisplay.tsx":{"content":"// src/components/ScoreDisplay.tsx\nimport React from 'react';\nimport { motion } from \"framer-motion\";\nimport { useGameStore } from '@/stores/useGameStore'; // Assumes store with game stats\n\ninterface ScoreDisplayProps {\n  // Optional override; defaults to store for global sync\n  score?: string;\n}\n\nexport function ScoreDisplay({ score: propScore }: ScoreDisplayProps = {}) {\n  // Pull from Zustand (fallback to props for testing/flexibility)\n  const score = useGameStore(state => propScore ?? state.score.toString());\n\n  return (\n    <div className=\"text-center\">\n      <motion.h2\n        className=\"text-4xl font-orbitron text-white tracking-widest tabular-nums neon-glow\"\n        animate={parseInt(score) % 500 === 0 && parseInt(score) > 0 ? { scale: [1, 1.2, 1], textShadow: ['0 0 10px white', '0 0 30px hsl(320, 100%, 60%)', '0 0 10px white'] } : {}}\n        transition={{ duration: 0.3 }}\n      >\n        {score}\n      </motion.h2>\n      <p className=\"text-neon-pink font-rajdhani text-sm tracking-[0.5em] uppercase\">score</p>\n    </div>\n  );\n}","path":null,"size_bytes":1050,"size_tokens":null},"client/src/types/ui.ts":{"content":"/**\n * UI and component types\n * For use in Zustand store and UI-related components\n */\n\nimport type { Difficulty, GameState } from './game';\n\nexport interface UIState {\n  isPauseMenuOpen: boolean;\n  countdownSeconds: number;\n  resumeFadeOpacity: number;\n  showErrorLog: boolean;\n}\n\nexport interface HomeUIState {\n  selectedDifficulty: Difficulty;\n  beatmapLoaded: boolean;\n}\n\nexport interface ErrorDisplayState {\n  errors: string[];\n  errorCount: number;\n  showViewer: boolean;\n}\n\nexport interface HUDDisplayState {\n  score: number;\n  combo: number;\n  health: number;\n  healthPercentage: number;\n  missCount: number;\n  gameState: GameState;\n}\n","path":null,"size_bytes":644,"size_tokens":null},"client/src/pages/Home.tsx":{"content":"import { motion } from \"framer-motion\";\nimport { useState, useEffect } from \"react\";\nimport { BeatmapLoader } from \"@/components/game/loaders/BeatmapLoader\";\nimport { BeatmapData } from \"@/lib/beatmap/beatmapParser\";\n\ninterface HomeProps {\n  onStartGame: (difficulty: 'EASY' | 'MEDIUM' | 'HARD') => void;\n}\n\nexport default function Home({ onStartGame }: HomeProps) {\n  const [selectedDifficulty, setSelectedDifficulty] = useState<'EASY' | 'MEDIUM' | 'HARD'>('MEDIUM');\n  const [isLoaderOpen, setIsLoaderOpen] = useState(false);\n  const [beatmapLoaded, setBeatmapLoaded] = useState(false);\n\n  const colors = [\"#00FFFF\", \"#FF00FF\", \"#00FF00\", \"#00CCFF\", \"#FF0080\"];\n  const [colorIndex, setColorIndex] = useState(0);\n\n  // Check if beatmap is already loaded in localStorage on mount and when returning from game\n  useEffect(() => {\n    const pendingBeatmap = localStorage.getItem('pendingBeatmap');\n    if (pendingBeatmap) {\n      try {\n        const beatmapData = JSON.parse(pendingBeatmap);\n        if (beatmapData.youtubeVideoId && beatmapData.beatmapText) {\n          setBeatmapLoaded(true);\n        } else {\n          setBeatmapLoaded(false);\n        }\n      } catch {\n        setBeatmapLoaded(false);\n      }\n    } else {\n      setBeatmapLoaded(false);\n    }\n  }, []);\n\n  const bannerMessages = [\n    { text: \"[ENCRYPTING NEURAL PATHWAYS] â€¢ QUANTUM SYNC PROTOCOL ACTIVE â€¢ SYNCHRONIZING BRAINWAVES\", color: \"#00FFFF\" },\n    { text: \"[NEURAL INTERFACE ONLINE] â€¢ FREQUENCY LOCKED â€¢ HARMONIC RESONANCE DETECTED\", color: \"#FF00FF\" },\n    { text: \"[DECRYPTION IN PROGRESS] â€¢ SYSTEM CALIBRATION COMPLETE â€¢ AWAITING INPUT SIGNAL\", color: \"#00FF00\" },\n    { text: \"[GATEWAY INITIALIZED] â€¢ DIMENSIONAL BREACH IMMINENT â€¢ CONSCIOUSNESS UPLOADING\", color: \"#00CCFF\" },\n    { text: \"[NEURAL SYNC: 99%] â€¢ QUANTUM ENTANGLEMENT SUCCESSFUL â€¢ READY FOR TRANSCENDENCE\", color: \"#FF0080\" },\n  ];\n\n  // Create continuous scrolling text - repeat 3x for seamless infinite scroll with no gaps\n  const baseText = bannerMessages.map(m => m.text).join(\" â€¢ \");\n  const continuousText = baseText + \" â€¢ \" + baseText + \" â€¢ \" + baseText + \" â€¢ \";\n\n  // Cycle through colors\n  useEffect(() => {\n    const colorInterval = setInterval(() => {\n      setColorIndex((prev) => (prev + 1) % colors.length);\n    }, 2000); // Change color every 2 seconds\n    return () => clearInterval(colorInterval);\n  }, [colors.length]);\n\n  const handleBeatmapLoad = (data: BeatmapData, beatmapText: string) => {\n    // Store full beatmap TEXT (not parsed notes) so Game can re-parse with any difficulty\n    const beatmapStorageData = { \n      youtubeVideoId: data.youtubeVideoId,\n      beatmapText: beatmapText\n    };\n    localStorage.setItem('pendingBeatmap', JSON.stringify(beatmapStorageData));\n    setBeatmapLoaded(true);\n    setIsLoaderOpen(false); // Auto-close the loader\n  };\n\n  return (\n    <div className=\"min-h-screen w-full flex flex-col items-center justify-center relative overflow-hidden\">\n      {/* Beatmap Loader */}\n      <BeatmapLoader \n        difficulty={selectedDifficulty}\n        isOpen={isLoaderOpen}\n        setIsOpen={setIsLoaderOpen}\n        onBeatmapLoad={handleBeatmapLoad}\n      />\n      {/* Semi-transparent overlay to show video behind */}\n      <div className=\"absolute inset-0 bg-black/40 pointer-events-none z-0\" />\n      {/* Background FX */}\n      <div className=\"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-10 pointer-events-none z-1\" />\n      <div className=\"absolute top-0 left-0 w-full h-full bg-grid-white/[0.01] pointer-events-none z-1\" />\n\n      <motion.div \n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"z-20 text-center space-y-12 relative\"\n      >\n        <div className=\"space-y-4\">\n          <h1 \n            className=\"text-6xl md:text-8xl font-black font-orbitron\"\n            style={{\n              background: 'linear-gradient(45deg, #00FFFF, #FF00FF)',\n              backgroundClip: 'text',\n              WebkitBackgroundClip: 'text',\n              WebkitTextFillColor: 'transparent',\n              filter: 'drop-shadow(0 0 30px rgba(0, 255, 255, 0.6))',\n            }}\n          >\n            HYPERVERSE\n          </h1>\n          {/* Animated scrolling banner */}\n          <div \n            className=\"w-full max-w-2xl mx-auto border-3 px-6 py-4 overflow-hidden bg-black/30 relative transition-colors duration-300\"\n            style={{ borderColor: colors[colorIndex] }}\n          >\n            {/* Gradient fade edges for smooth scroll effect */}\n            <div \n              className=\"absolute left-0 top-0 bottom-0 w-12 bg-gradient-to-r to-transparent z-10\"\n              style={{ backgroundImage: `linear-gradient(to right, rgb(0, 0, 0), transparent)` }}\n            />\n            <div \n              className=\"absolute right-0 top-0 bottom-0 w-12 bg-gradient-to-l to-transparent z-10\"\n              style={{ backgroundImage: `linear-gradient(to left, rgb(0, 0, 0), transparent)` }}\n            />\n            \n            <motion.div\n              className=\"font-rajdhani text-xl uppercase whitespace-nowrap font-semibold tracking-wider\"\n              style={{ color: colors[colorIndex] }}\n              initial={{ x: 0 }}\n              animate={{ x: -baseText.length * 8 - 12 }}\n              transition={{ duration: 35, ease: 'linear', repeat: Infinity, repeatType: 'loop' }}\n            >\n              {continuousText}\n            </motion.div>\n          </div>\n        </div>\n\n        <div className=\"flex flex-col gap-4 w-64 mx-auto\">\n          {(['EASY', 'MEDIUM', 'HARD'] as const).map((diff) => (\n            <button\n              key={diff}\n              onClick={() => setSelectedDifficulty(diff)}\n              className={`\n                px-8 py-4 rounded-none border transition-all duration-300 font-orbitron tracking-widest\n                ${selectedDifficulty === diff \n                  ? 'bg-neon-pink text-black border-neon-pink shadow-[0_0_30px_rgba(255,0,100,0.5)] scale-105' \n                  : 'bg-transparent text-white border-white/20 hover:border-neon-pink/50 hover:text-neon-pink'}\n              `}\n            >\n              {diff}\n            </button>\n          ))}\n        </div>\n\n        <div className=\"flex gap-4 justify-center items-center flex-nowrap\">\n          <motion.button \n            onClick={() => onStartGame(selectedDifficulty)}\n            disabled={!beatmapLoaded}\n            whileHover={beatmapLoaded ? { scale: 1.05 } : {}}\n            whileTap={beatmapLoaded ? { scale: 0.95 } : {}}\n            className={`px-12 py-6 text-black font-bold text-xl font-orbitron rounded-sm border-2 transition-colors whitespace-nowrap ${\n              beatmapLoaded\n                ? 'bg-neon-pink shadow-[0_0_50px_rgba(255,0,127,0.8)] border-neon-pink cursor-pointer'\n                : 'bg-neon-cyan shadow-[0_0_50px_cyan] border-white hover:bg-white opacity-50 cursor-not-allowed'\n            }`}\n            data-testid=\"button-start-session\"\n          >\n            START SESSION\n          </motion.button>\n          \n          {beatmapLoaded && (\n            <motion.button \n              onClick={() => { setIsLoaderOpen(true); }}\n              whileHover={{ scale: 1.05 }}\n              whileTap={{ scale: 0.95 }}\n              className=\"px-6 py-6 text-white font-bold font-orbitron rounded-sm border-2 border-neon-cyan bg-transparent hover:bg-neon-cyan/10 transition-colors text-sm whitespace-nowrap\"\n              data-testid=\"button-load-new-beatmap\"\n            >\n              LOAD NEW\n            </motion.button>\n          )}\n        </div>\n      </motion.div>\n      \n      {/* Footer */}\n      <div className=\"absolute bottom-8 text-white/30 text-xs font-mono z-20\">\n        SYSTEM_READY // V.1.2.0 // REPLIT_MOCKUP\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7836,"size_tokens":null},"client/src/hooks/useGameDebugger.ts":{"content":"// src/hooks/useGameDebugger.ts\nimport { useDebugValue as useReactDebugValue } from 'react';\nimport { useGameDebuggerStore } from '@/stores/useGameDebuggerStore';\nimport { FailureType } from '@/types/gameDebugTypes';\n\n// Facade interface for debug operations\ninterface DebugFacade {\n  log: (msg: string) => void;\n  trackAnimation: (noteId: string, type: FailureType, failureTime?: number) => void;\n  updateAnimation: (noteId: string, updates: any) => void;\n  updateNoteStats: (notes: any[]) => void;\n  updateRenderStats: (rendered: number, preMissed: number) => void;\n  getAnimationStats: () => any;\n  getNoteStats: () => any;\n  getHitStats: () => any;\n  getRenderStats: () => any;\n}\n\nexport function useGameDebugger(enabled: boolean = true): DebugFacade {\n  // Enabled facade: Dispatch actions\n  const facade: DebugFacade = enabled ? {\n    log: (msg) => useGameDebuggerStore.getState().log(msg),\n    trackAnimation: (noteId, type, failureTime) => useGameDebuggerStore.getState().trackAnimation(noteId, type, failureTime),\n    updateAnimation: (noteId, updates) => useGameDebuggerStore.getState().updateAnimation(noteId, updates),\n    updateNoteStats: (notes) => useGameDebuggerStore.getState().updateNoteStats(notes),\n    updateRenderStats: (rendered, preMissed) => useGameDebuggerStore.getState().updateRenderStats(rendered, preMissed),\n    getAnimationStats: () => ({ total: useGameDebuggerStore.getState().animations.length }),\n    getNoteStats: () => useGameDebuggerStore.getState().noteStats,\n    getHitStats: () => useGameDebuggerStore.getState().hitStats,\n    getRenderStats: () => useGameDebuggerStore.getState().renderStats,\n  } : {\n    // Disabled: Noop facade\n    log: () => {},\n    trackAnimation: () => {},\n    updateAnimation: () => {},\n    updateNoteStats: () => {},\n    updateRenderStats: () => {},\n    getAnimationStats: () => ({}),\n    getNoteStats: () => ({}),\n    getHitStats: () => ({}),\n    getRenderStats: () => ({}),\n  };\n\n  return facade;\n}\n\nexport function useDebugValue(debugFacade: DebugFacade): void {\n  // Use store directly for reactive stats (bypasses facade for perf)\n  const stats = useGameDebuggerStore((state) => ({\n    animations: { total: state.animations.length /* derive */ },\n    notes: state.noteStats,\n    hits: state.hitStats,\n    render: state.renderStats,\n  }));\n\n  useReactDebugValue(stats);\n}","path":null,"size_bytes":2341,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationLink,\n  PaginationItem,\n  PaginationPrevious,\n  PaginationNext,\n  PaginationEllipsis,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1877,"size_tokens":null},"client/src/lib/utils/laneUtils.ts":{"content":"import { MAX_HEALTH } from '@/lib/config/gameConstants';\nimport { GameErrors } from '@/lib/errors/errorLog';\n\n// Lane to ray angle mapping\nexport const getLaneAngle = (lane: number): number => {\n  const rayMapping: Record<number, number> = {\n    [-2]: 0,\n    [-1]: 180,\n    [0]: 120,\n    [1]: 60,\n    [2]: 300,\n    [3]: 240,\n  };\n  const angle = rayMapping[lane];\n  if (!Number.isFinite(angle)) {\n    GameErrors.log(`Invalid lane ${lane}, using default angle 0`);\n    return 0;\n  }\n  return angle;\n};\n\n// Lane to color mapping with health-based desaturation\nexport const getColorForLane = (lane: number, health: number = MAX_HEALTH): string => {\n  const baseColor = (() => {\n    switch (lane) {\n      case -1: return '#00FF00'; // Q - green\n      case -2: return '#FF0000'; // P - red\n      case 0: return '#FF007F'; // W - pink\n      case 1: return '#0096FF'; // O - blue\n      case 2: return '#BE00FF'; // I - purple\n      case 3: return '#00FFFF'; // E - cyan\n      default: return '#FFFFFF';\n    }\n  })();\n\n  const healthFactor = Math.max(0, MAX_HEALTH - health) / MAX_HEALTH;\n  if (healthFactor === 0) return baseColor;\n\n  const r = parseInt(baseColor.slice(1, 3), 16);\n  const g = parseInt(baseColor.slice(3, 5), 16);\n  const b = parseInt(baseColor.slice(5, 7), 16);\n\n  const newR = Math.round(r + (255 - r) * healthFactor);\n  const newG = Math.round(g * (1 - healthFactor));\n  const newB = Math.round(b * (1 - healthFactor));\n\n  return `#${newR.toString(16).padStart(2, '0')}${newG.toString(16).padStart(2, '0')}${newB.toString(16).padStart(2, '0')}`.toUpperCase();\n};\n","path":null,"size_bytes":1576,"size_tokens":null},"client/src/components/game/notes/HoldNote.tsx":{"content":"// src/components/HoldNote.tsx\nimport React, { memo } from 'react';\nimport { getTrapezoidCorners } from \"@/lib/geometry/holdNoteGeometry\";\nimport { calculateHoldNoteStyle } from \"@/lib/notes/hold/holdNoteStyle\";\nimport { HoldNoteProcessedData } from '@/hooks/useHoldNotes';\n\ninterface HoldNoteProps {\n  noteData: HoldNoteProcessedData;\n  vpX: number;\n  vpY: number;\n}\n\nconst HoldNoteComponent = ({ noteData, vpX, vpY }: HoldNoteProps) => {\n  const { note, rayAngle, colors, approachProgress, collapseProgress, pressHoldTime, failures, failureTime, currentTime, greyscaleState, finalGlowScale } = noteData;\n  const corners = getTrapezoidCorners(rayAngle, noteData.nearDistance, noteData.farDistance, vpX, vpY, note.id);\n  if (!corners) return null;\n  const { x1, y1, x2, y2, x3, y3, x4, y4 } = corners;\n  const holdStyle = calculateHoldNoteStyle(approachProgress, collapseProgress, pressHoldTime, failures, failureTime, currentTime, greyscaleState, colors, finalGlowScale);\n  \n  // Unique gradient ID for this note instance\n  const gradientId = `hold-gradient-${note.id}`;\n  \n  // Opacity gradient: low opacity near vanishing point (far), high opacity near judgement (near)\n  // The gradient flows from point (x1,y1)-(x2,y2) [far end] to (x4,y4)-(x3,y3) [near end]\n  const gradientStartOpacity = Math.max(0.1, holdStyle.opacity * 0.3); // Far end: ~30% of full opacity\n  const gradientEndOpacity = holdStyle.opacity; // Near end: full opacity\n  \n  return (\n    <>\n      <defs>\n        <linearGradient \n          id={gradientId}\n          x1={x1} y1={y1}\n          x2={x4} y2={y4}\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop offset=\"0%\" stopColor={colors.fillColor} stopOpacity={gradientStartOpacity} />\n          <stop offset=\"100%\" stopColor={colors.fillColor} stopOpacity={gradientEndOpacity} />\n        </linearGradient>\n      </defs>\n      <polygon\n        key={`hold-note-${note.id}`}\n        data-testid={`hold-note-${note.id}`}\n        points={`${x1},${y1} ${x2},${y2} ${x3},${y3} ${x4},${y4}`}\n        fill={`url(#${gradientId})`}\n        stroke={colors.strokeColor}\n        strokeWidth={holdStyle.strokeWidth}\n        style={{ filter: holdStyle.filter || 'none', transition: 'all 0.05s linear', mixBlendMode: 'screen' }}\n      />\n    </>\n  );\n};\n\nexport const HoldNote = memo(HoldNoteComponent);","path":null,"size_bytes":2326,"size_tokens":null},"client/src/components/game/tunnel/HoldJudgementLines.tsx":{"content":"// src/components/HoldJudgementLines.tsx\nimport React, { memo } from 'react';\nimport { calculateLinePoints, HOLD_LINE_CONFIGS } from '@/lib/utils/judgementLineUtils';\nimport { TUNNEL_CONTAINER_WIDTH, TUNNEL_CONTAINER_HEIGHT, HOLD_JUDGEMENT_LINE_WIDTH } from '@/lib/config/gameConstants';\n\ninterface HoldJudgementLinesProps {\n  vpX: number;\n  vpY: number;\n}\n\nconst HoldJudgementLinesComponent = ({ vpX, vpY }: HoldJudgementLinesProps) => {\n  return (\n    <svg \n      className=\"absolute inset-0\"\n      data-testid=\"hold-judgement-lines-container\"\n      style={{ \n        width: `${TUNNEL_CONTAINER_WIDTH}px`, \n        height: `${TUNNEL_CONTAINER_HEIGHT}px`, \n        opacity: 1, \n        pointerEvents: 'none', \n        margin: '0 auto' \n      }}\n    >\n      {HOLD_LINE_CONFIGS.map((config, idx) => {\n        const { x1, y1, x2, y2 } = calculateLinePoints(config, vpX, vpY, HOLD_JUDGEMENT_LINE_WIDTH);\n        return (\n          <line \n            key={`hold-judgement-line-${idx}`}\n            data-testid={`hold-judgement-line-${idx}`}\n            x1={x1} \n            y1={y1} \n            x2={x2} \n            y2={y2} \n            stroke={config.color} \n            strokeWidth={3}\n            opacity={1}\n            strokeLinecap=\"round\" \n          />\n        );\n      })}\n    </svg>\n  );\n};\n\nexport const HoldJudgementLines = memo(HoldJudgementLinesComponent);","path":null,"size_bytes":1365,"size_tokens":null},"client/src/components/ui/HUD/HealthDisplay.tsx":{"content":"// src/components/HealthDisplay.tsx\nimport React from 'react';\nimport { useGameStore } from '@/stores/useGameStore'; // Assumes store with game stats\nimport { MAX_HEALTH } from '@/lib/config/gameConstants'; // Assuming MAX_HEALTH=200 from prior\n\ninterface HealthDisplayProps {\n  // Optional override; defaults to store for global sync\n  health?: number;\n}\n\nexport function HealthDisplay({ health: propHealth }: HealthDisplayProps = {}) {\n  // Pull from Zustand (fallback to props for testing/flexibility)\n  const health = useGameStore(state => propHealth ?? state.health);\n\n  const healthPercent = Math.floor((health / MAX_HEALTH) * 100);\n\n  return (\n    <>\n      <div className=\"w-12 h-12 rounded-full border-2 border-neon-cyan flex items-center justify-center text-neon-cyan font-bold\">\n        {healthPercent}%\n      </div>\n      <div className=\"h-2 w-32 bg-gray-800 rounded-full overflow-hidden\">\n        <div\n          className=\"h-full bg-neon-cyan transition-all duration-300\"\n          style={{ width: `${healthPercent}%` }}\n        />\n      </div>\n    </>\n  );\n}","path":null,"size_bytes":1071,"size_tokens":null},"client/src/hooks/useGlitch.ts":{"content":"// src/hooks/useGlitch.ts\nimport { useState, useEffect, useRef } from 'react';\nimport { GlitchState } from '@/types/visualEffects';\nimport { LOW_HEALTH_THRESHOLD, GLITCH_BASE_INTERVAL, GLITCH_RANDOM_RANGE, GLITCH_OPACITY, GREYSCALE_INTENSITY } from '@/lib/config/gameConstants';\nimport { toggleGlitchState } from '@/lib/utils/visualEffectsUtils';\n\ninterface UseGlitchProps {\n  missCount: number;\n  health: number;\n  prevMissCount: number;\n}\n\nexport const useGlitch = ({ missCount, health, prevMissCount }: UseGlitchProps): GlitchState => {\n  const [glitch, setGlitch] = useState(0);\n  const [glitchPhase, setGlitchPhase] = useState(0);\n  const [prevMiss, setPrevMiss] = useState(prevMissCount);\n  const lowHealthIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const missIntervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  // Miss glitch\n  useEffect(() => {\n    if (missCount > prevMiss) {\n      setGlitch(1);\n      setGlitchPhase(0);\n      setPrevMiss(missCount);\n\n      if (missIntervalRef.current) clearInterval(missIntervalRef.current);\n      \n      missIntervalRef.current = setInterval(() => {\n        setGlitchPhase(prev => {\n          const nextPhase = prev + 0.1;\n          if (nextPhase >= 1) {\n            setGlitch(0);\n            if (missIntervalRef.current) clearInterval(missIntervalRef.current);\n            missIntervalRef.current = null;\n            return nextPhase;\n          }\n          return nextPhase;\n        });\n      }, 30);\n    }\n\n    return () => {\n      if (missIntervalRef.current) {\n        clearInterval(missIntervalRef.current);\n        missIntervalRef.current = null;\n      }\n    };\n  }, [missCount, prevMiss]);\n\n  // Low health subtle glitch\n  useEffect(() => {\n    if (health < LOW_HEALTH_THRESHOLD) {\n      if (lowHealthIntervalRef.current) clearInterval(lowHealthIntervalRef.current);\n      \n      const interval = GLITCH_BASE_INTERVAL + Math.random() * GLITCH_RANDOM_RANGE;\n      lowHealthIntervalRef.current = setInterval(() => {\n        setGlitch(prev => toggleGlitchState(prev, GLITCH_OPACITY));\n      }, interval);\n    } else {\n      if (lowHealthIntervalRef.current) {\n        clearInterval(lowHealthIntervalRef.current);\n        lowHealthIntervalRef.current = null;\n        setGlitch(0);\n      }\n    }\n\n    return () => {\n      if (lowHealthIntervalRef.current) {\n        clearInterval(lowHealthIntervalRef.current);\n        lowHealthIntervalRef.current = null;\n      }\n    };\n  }, [health]);\n\n  const glitchOpacityMultiplier = LOW_HEALTH_THRESHOLD > 0\n    ? 1 + (Math.max(0, LOW_HEALTH_THRESHOLD - health) / LOW_HEALTH_THRESHOLD) * 2\n    : 1;\n\n  return { glitch, glitchPhase, glitchOpacityMultiplier };\n};","path":null,"size_bytes":2658,"size_tokens":null},"client/src/components/ui/field.tsx":{"content":"\"use client\"\n\nimport { useMemo } from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction FieldSet({ className, ...props }: React.ComponentProps<\"fieldset\">) {\n  return (\n    <fieldset\n      data-slot=\"field-set\"\n      className={cn(\n        \"flex flex-col gap-6\",\n        \"has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLegend({\n  className,\n  variant = \"legend\",\n  ...props\n}: React.ComponentProps<\"legend\"> & { variant?: \"legend\" | \"label\" }) {\n  return (\n    <legend\n      data-slot=\"field-legend\"\n      data-variant={variant}\n      className={cn(\n        \"mb-3 font-medium\",\n        \"data-[variant=legend]:text-base\",\n        \"data-[variant=label]:text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-group\"\n      className={cn(\n        \"group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst fieldVariants = cva(\n  \"group/field data-[invalid=true]:text-destructive flex w-full gap-3\",\n  {\n    variants: {\n      orientation: {\n        vertical: [\"flex-col [&>*]:w-full [&>.sr-only]:w-auto\"],\n        horizontal: [\n          \"flex-row items-center\",\n          \"[&>[data-slot=field-label]]:flex-auto\",\n          \"has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px has-[>[data-slot=field-content]]:items-start\",\n        ],\n        responsive: [\n          \"@md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto flex-col [&>*]:w-full [&>.sr-only]:w-auto\",\n          \"@md/field-group:[&>[data-slot=field-label]]:flex-auto\",\n          \"@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px\",\n        ],\n      },\n    },\n    defaultVariants: {\n      orientation: \"vertical\",\n    },\n  }\n)\n\nfunction Field({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof fieldVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"field\"\n      data-orientation={orientation}\n      className={cn(fieldVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction FieldContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-content\"\n      className={cn(\n        \"group/field-content flex flex-1 flex-col gap-1.5 leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof Label>) {\n  return (\n    <Label\n      data-slot=\"field-label\"\n      className={cn(\n        \"group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50\",\n        \"has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>[data-slot=field]]:p-4\",\n        \"has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-label\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug group-data-[disabled=true]/field:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"field-description\"\n      className={cn(\n        \"text-muted-foreground text-sm font-normal leading-normal group-has-[[data-orientation=horizontal]]/field:text-balance\",\n        \"nth-last-2:-mt-1 last:mt-0 [[data-variant=legend]+&]:-mt-1.5\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldSeparator({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  children?: React.ReactNode\n}) {\n  return (\n    <div\n      data-slot=\"field-separator\"\n      data-content={!!children}\n      className={cn(\n        \"relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2\",\n        className\n      )}\n      {...props}\n    >\n      <Separator className=\"absolute inset-0 top-1/2\" />\n      {children && (\n        <span\n          className=\"bg-background text-muted-foreground relative mx-auto block w-fit px-2\"\n          data-slot=\"field-separator-content\"\n        >\n          {children}\n        </span>\n      )}\n    </div>\n  )\n}\n\nfunction FieldError({\n  className,\n  children,\n  errors,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  errors?: Array<{ message?: string } | undefined>\n}) {\n  const content = useMemo(() => {\n    if (children) {\n      return children\n    }\n\n    if (!errors) {\n      return null\n    }\n\n    if (errors?.length === 1 && errors[0]?.message) {\n      return errors[0].message\n    }\n\n    return (\n      <ul className=\"ml-4 flex list-disc flex-col gap-1\">\n        {errors.map(\n          (error, index) =>\n            error?.message && <li key={index}>{error.message}</li>\n        )}\n      </ul>\n    )\n  }, [children, errors])\n\n  if (!content) {\n    return null\n  }\n\n  return (\n    <div\n      role=\"alert\"\n      data-slot=\"field-error\"\n      className={cn(\"text-destructive text-sm font-normal\", className)}\n      {...props}\n    >\n      {content}\n    </div>\n  )\n}\n\nexport {\n  Field,\n  FieldLabel,\n  FieldDescription,\n  FieldError,\n  FieldGroup,\n  FieldLegend,\n  FieldSeparator,\n  FieldSet,\n  FieldContent,\n  FieldTitle,\n}\n","path":null,"size_bytes":6044,"size_tokens":null},"client/src/components/game/loaders/ErrorLogViewerHelpers.tsx":{"content":"// src/components/ErrorLogViewerHelpers.tsx\n// UI-only components for stats display - no state, pure props\nimport React from 'react';\n\nexport interface StatBoxProps {\n  label: string;\n  value: number | string;\n  color?: 'gray' | 'green' | 'red' | 'blue' | 'yellow' | 'purple' | 'cyan' | 'pink';\n}\n\nexport function StatBox({ label, value, color = 'gray' }: StatBoxProps) {\n  const colorMap = {\n    gray: 'text-gray-500',\n    green: 'text-green-300',\n    red: 'text-red-300',\n    blue: 'text-blue-300',\n    yellow: 'text-yellow-300',\n    purple: 'text-purple-300',\n    cyan: 'text-cyan-300',\n    pink: 'text-pink-300',\n  };\n  return (\n    <div className=\"bg-gray-800 p-1 rounded\">\n      <div className={`text-gray-500 text-xs`}>{label}</div>\n      <div className={`text-lg font-bold ${colorMap[color]}`}>{value}</div>\n    </div>\n  );\n}\n\nexport interface StatGridProps {\n  children: React.ReactNode;\n  cols?: number;\n}\n\nexport function StatGrid({ children, cols = 3 }: StatGridProps) {\n  return (\n    <div className={`grid gap-1`} style={{ gridTemplateColumns: `repeat(${cols}, minmax(0, 1fr))` }}>\n      {children}\n    </div>\n  );\n}\n\nexport interface StatSectionProps {\n  title: string;\n  titleColor?: 'purple' | 'green' | 'blue' | 'cyan' | 'red' | 'yellow';\n  textColor?: 'purple' | 'green' | 'blue' | 'cyan' | 'red' | 'yellow';\n  children: React.ReactNode;\n  divider?: boolean;\n}\n\nexport function StatSection({ title, titleColor = 'purple', textColor = 'purple', children, divider = false }: StatSectionProps) {\n  const colorMap = {\n    purple: { title: 'text-purple-400', text: 'text-purple-300' },\n    green: { title: 'text-green-400', text: 'text-green-300' },\n    blue: { title: 'text-blue-400', text: 'text-blue-300' },\n    cyan: { title: 'text-cyan-400', text: 'text-cyan-300' },\n    red: { title: 'text-red-400', text: 'text-red-300' },\n    yellow: { title: 'text-yellow-400', text: 'text-yellow-300' },\n  };\n  return (\n    <div className={`bg-gray-900 rounded p-2 text-xs ${colorMap[textColor].text} font-mono space-y-2${divider ? ' border-t border-gray-700 pt-2' : ''}`}>\n      <div className={`font-bold ${colorMap[titleColor].title} mb-1`}>{title}</div>\n      {children}\n    </div>\n  );\n}\n\nexport const formatLaneStats = (lanes: any) => {\n  if (!lanes) return 'N/A';\n  return Object.entries(lanes)\n    .map(([lane, count]) => `L${lane}:${count}`)\n    .join(' ');\n};\n","path":null,"size_bytes":2377,"size_tokens":null},"client/src/lib/notes/hold/holdGreystate.ts":{"content":"import {\n  GREYSCALE_FILL_COLOR,\n  GREYSCALE_GLOW_COLOR,\n  JUDGEMENT_RADIUS,\n  COLOR_DECK_LEFT,\n  COLOR_DECK_RIGHT,\n} from '@/lib/config/gameConstants';\nimport { HoldNoteFailureStates } from './holdNoteHelpers';\n\nexport interface HoldNoteColors {\n  fillColor: string;\n  glowColor: string;\n  strokeColor: string;\n}\n\nexport const calculateHoldNoteColors = (\n  isGreyed: boolean,\n  lane: number,\n  baseColor: string\n): HoldNoteColors => {\n  if (isGreyed) {\n    return {\n      fillColor: GREYSCALE_FILL_COLOR,\n      glowColor: GREYSCALE_GLOW_COLOR,\n      strokeColor: 'rgba(120, 120, 120, 1)',\n    };\n  }\n  \n  const fillColor = lane === -1 \n    ? COLOR_DECK_LEFT \n    : lane === -2 \n    ? COLOR_DECK_RIGHT \n    : baseColor;\n  \n  return {\n    fillColor,\n    glowColor: fillColor,\n    strokeColor: 'rgba(255,255,255,1)',\n  };\n};\n\nexport interface GreyscaleState {\n  isGreyed: boolean;\n  reason: 'none' | 'tooEarlyImmediate' | 'holdMissAtJudgement' | 'holdReleaseFailure';\n}\n\nexport const determineGreyscaleState = (\n  failures: HoldNoteFailureStates,\n  pressHoldTime: number,\n  approachNearDistance: number,\n  isHit: boolean = false\n): GreyscaleState => {\n  // Prevent greyscale if note was successfully hit\n  if (isHit) {\n    return { isGreyed: false, reason: 'none' };\n  }\n\n  if (failures.isHoldReleaseFailure) {\n    return { isGreyed: true, reason: 'holdReleaseFailure' };\n  }\n  \n  if (failures.isTooEarlyFailure) {\n    return { isGreyed: true, reason: 'tooEarlyImmediate' };\n  }\n  \n  // Greyscale when miss reaches 70% of judgement radius (at judgement moment)\n  if (failures.isHoldMissFailure && approachNearDistance >= JUDGEMENT_RADIUS * 0.7) {\n    return { isGreyed: true, reason: 'holdMissAtJudgement' };\n  }\n  \n  return { isGreyed: false, reason: 'none' };\n};\n","path":null,"size_bytes":1763,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":724,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport {\n  ChevronDownIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon,\n} from \"lucide-react\"\nimport { DayButton, DayPicker, getDefaultClassNames } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button, buttonVariants } from \"@/components/ui/button\"\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  captionLayout = \"label\",\n  buttonVariant = \"ghost\",\n  formatters,\n  components,\n  ...props\n}: React.ComponentProps<typeof DayPicker> & {\n  buttonVariant?: React.ComponentProps<typeof Button>[\"variant\"]\n}) {\n  const defaultClassNames = getDefaultClassNames()\n\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\n        \"bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent\",\n        String.raw`rtl:**:[.rdp-button\\_next>svg]:rotate-180`,\n        String.raw`rtl:**:[.rdp-button\\_previous>svg]:rotate-180`,\n        className\n      )}\n      captionLayout={captionLayout}\n      formatters={{\n        formatMonthDropdown: (date) =>\n          date.toLocaleString(\"default\", { month: \"short\" }),\n        ...formatters,\n      }}\n      classNames={{\n        root: cn(\"w-fit\", defaultClassNames.root),\n        months: cn(\n          \"relative flex flex-col gap-4 md:flex-row\",\n          defaultClassNames.months\n        ),\n        month: cn(\"flex w-full flex-col gap-4\", defaultClassNames.month),\n        nav: cn(\n          \"absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1\",\n          defaultClassNames.nav\n        ),\n        button_previous: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_previous\n        ),\n        button_next: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_next\n        ),\n        month_caption: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]\",\n          defaultClassNames.month_caption\n        ),\n        dropdowns: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium\",\n          defaultClassNames.dropdowns\n        ),\n        dropdown_root: cn(\n          \"has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border\",\n          defaultClassNames.dropdown_root\n        ),\n        dropdown: cn(\n          \"bg-popover absolute inset-0 opacity-0\",\n          defaultClassNames.dropdown\n        ),\n        caption_label: cn(\n          \"select-none font-medium\",\n          captionLayout === \"label\"\n            ? \"text-sm\"\n            : \"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5\",\n          defaultClassNames.caption_label\n        ),\n        table: \"w-full border-collapse\",\n        weekdays: cn(\"flex\", defaultClassNames.weekdays),\n        weekday: cn(\n          \"text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal\",\n          defaultClassNames.weekday\n        ),\n        week: cn(\"mt-2 flex w-full\", defaultClassNames.week),\n        week_number_header: cn(\n          \"w-[--cell-size] select-none\",\n          defaultClassNames.week_number_header\n        ),\n        week_number: cn(\n          \"text-muted-foreground select-none text-[0.8rem]\",\n          defaultClassNames.week_number\n        ),\n        day: cn(\n          \"group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md\",\n          defaultClassNames.day\n        ),\n        range_start: cn(\n          \"bg-accent rounded-l-md\",\n          defaultClassNames.range_start\n        ),\n        range_middle: cn(\"rounded-none\", defaultClassNames.range_middle),\n        range_end: cn(\"bg-accent rounded-r-md\", defaultClassNames.range_end),\n        today: cn(\n          \"bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none\",\n          defaultClassNames.today\n        ),\n        outside: cn(\n          \"text-muted-foreground aria-selected:text-muted-foreground\",\n          defaultClassNames.outside\n        ),\n        disabled: cn(\n          \"text-muted-foreground opacity-50\",\n          defaultClassNames.disabled\n        ),\n        hidden: cn(\"invisible\", defaultClassNames.hidden),\n        ...classNames,\n      }}\n      components={{\n        Root: ({ className, rootRef, ...props }) => {\n          return (\n            <div\n              data-slot=\"calendar\"\n              ref={rootRef}\n              className={cn(className)}\n              {...props}\n            />\n          )\n        },\n        Chevron: ({ className, orientation, ...props }) => {\n          if (orientation === \"left\") {\n            return (\n              <ChevronLeftIcon className={cn(\"size-4\", className)} {...props} />\n            )\n          }\n\n          if (orientation === \"right\") {\n            return (\n              <ChevronRightIcon\n                className={cn(\"size-4\", className)}\n                {...props}\n              />\n            )\n          }\n\n          return (\n            <ChevronDownIcon className={cn(\"size-4\", className)} {...props} />\n          )\n        },\n        DayButton: CalendarDayButton,\n        WeekNumber: ({ children, ...props }) => {\n          return (\n            <td {...props}>\n              <div className=\"flex size-[--cell-size] items-center justify-center text-center\">\n                {children}\n              </div>\n            </td>\n          )\n        },\n        ...components,\n      }}\n      {...props}\n    />\n  )\n}\n\nfunction CalendarDayButton({\n  className,\n  day,\n  modifiers,\n  ...props\n}: React.ComponentProps<typeof DayButton>) {\n  const defaultClassNames = getDefaultClassNames()\n\n  const ref = React.useRef<HTMLButtonElement>(null)\n  React.useEffect(() => {\n    if (modifiers.focused) ref.current?.focus()\n  }, [modifiers.focused])\n\n  return (\n    <Button\n      ref={ref}\n      variant=\"ghost\"\n      size=\"icon\"\n      data-day={day.date.toLocaleDateString()}\n      data-selected-single={\n        modifiers.selected &&\n        !modifiers.range_start &&\n        !modifiers.range_end &&\n        !modifiers.range_middle\n      }\n      data-range-start={modifiers.range_start}\n      data-range-end={modifiers.range_end}\n      data-range-middle={modifiers.range_middle}\n      className={cn(\n        \"data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70\",\n        defaultClassNames.day,\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Calendar, CalendarDayButton }\n","path":null,"size_bytes":7569,"size_tokens":null},"client/src/lib/utils/parseBeatmapUtils.ts":{"content":"// src/utils/parseBeatmap.ts\nimport { GameErrors } from '@/lib/errors/errorLog';\n\nexport interface BeatmapMetadata {\n  title: string;\n  artist: string;\n  bpm: number;\n  duration: number;\n  youtube?: string;\n  beatmapStart?: number;\n  beatmapEnd?: number;\n}\n\nexport interface BeatmapData {\n  metadata: BeatmapMetadata;\n  difficulties: {\n    EASY?: string[];\n    MEDIUM?: string[];\n    HARD?: string[];\n  };\n}\n\nexport interface ParsedBeatmap {\n  metadata: BeatmapMetadata;\n  notes: Array<{\n    time: number;\n    lane: number;\n    type: 'TAP' | 'HOLD';\n    duration?: number;\n    holdId?: string;\n    beatmapStart?: number;\n    beatmapEnd?: number;\n  }>;\n}\n\nexport function parseBeatmap(text: string, difficulty: 'EASY' | 'MEDIUM' | 'HARD'): ParsedBeatmap | null {\n  try {\n    const lines = text.split('\\n').map(line => line.trim()).filter(line => line);\n\n    let metadata: BeatmapMetadata | null = null;\n    let noteLines: string[] = [];\n\n    let inMetadata = false;\n    let foundDifficulty = false;\n\n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i];\n\n      if (line === '[METADATA]') {\n        inMetadata = true;\n        continue;\n      }\n\n      if (line.match(/^\\[(EASY|MEDIUM|HARD)\\]$/)) {\n        inMetadata = false;\n        const sectionDifficulty = line.replace(/[\\[\\]]/g, '');\n\n        if (sectionDifficulty === difficulty) {\n          foundDifficulty = true;\n          for (let j = i + 1; j < lines.length; j++) {\n            if (lines[j].match(/^\\[/)) break;\n            if (lines[j]) noteLines.push(lines[j]);\n          }\n          break;\n        }\n      }\n\n      if (inMetadata && line.includes(':')) {\n        const parts = line.split(':');\n        if (parts.length < 2) continue;\n\n        const key = parts[0].trim();\n        const value = parts.slice(1).join(':').trim();\n\n        if (!metadata) metadata = { title: '', artist: '', bpm: 0, duration: 0 };\n\n        if (key.toLowerCase() === 'title') metadata.title = value;\n        if (key.toLowerCase() === 'artist') metadata.artist = value;\n        if (key.toLowerCase() === 'bpm') {\n          const bpm = parseInt(value);\n          if (!isNaN(bpm)) metadata.bpm = bpm;\n        }\n        if (key.toLowerCase() === 'duration') {\n          const dur = parseInt(value);\n          if (!isNaN(dur)) metadata.duration = dur;\n        }\n        if (key.toLowerCase() === 'youtube') metadata.youtube = value;\n        if (key.toLowerCase() === 'beatmapstart') {\n          const start = parseInt(value);\n          if (!isNaN(start)) metadata.beatmapStart = start;\n        }\n        if (key.toLowerCase() === 'beatmapend') {\n          const end = parseInt(value);\n          if (!isNaN(end)) metadata.beatmapEnd = end;\n        }\n      }\n    }\n\n    if (!metadata || !foundDifficulty) {\n      GameErrors.log(`BeatmapParser: Missing metadata or ${difficulty} difficulty section`);\n      return null;\n    }\n    if (!metadata.title || !metadata.artist || metadata.bpm <= 0 || metadata.duration <= 0) {\n      GameErrors.log(`BeatmapParser: Invalid metadata - title: \"${metadata?.title}\", artist: \"${metadata?.artist}\", bpm: ${metadata?.bpm}, duration: ${metadata?.duration}`);\n      return null;\n    }\n\n    const notes: ParsedBeatmap['notes'] = [];\n    const holdStarts: Record<string, { time: number; lane: number }> = {};\n    const holdEnds: Record<string, { time: number; lane: number }> = {};\n\n    for (let lineIdx = 0; lineIdx < noteLines.length; lineIdx++) {\n      const line = noteLines[lineIdx];\n      const parts = line.split('|');\n      if (parts.length < 3) {\n        GameErrors.log(`BeatmapParser: Line ${lineIdx} has insufficient fields: \"${line}\"`);\n        continue;\n      }\n\n      const time = parseInt(parts[0]);\n      const lane = parseInt(parts[1]);\n      const type = parts[2].toUpperCase();\n\n      if (isNaN(time) || isNaN(lane)) {\n        GameErrors.log(`BeatmapParser: Line ${lineIdx} invalid time or lane: time=${parts[0]}, lane=${parts[1]}`);\n        continue;\n      }\n\n      if (lane !== -2 && lane !== -1 && (lane < 0 || lane > 3)) {\n        GameErrors.log(`BeatmapParser: Line ${lineIdx} invalid lane ${lane}. Valid lanes: -2 (P deck), -1 (Q deck), 0-3 (soundpads)`);\n        continue;\n      }\n\n      if (type === 'HOLD_START') {\n        if (parts.length < 4) {\n          GameErrors.log(`BeatmapParser: HOLD_START line ${lineIdx} missing holdId: \"${line}\"`);\n          continue;\n        }\n        const holdId = parts[3].trim();\n        if (!holdId) {\n          GameErrors.log(`BeatmapParser: HOLD_START line ${lineIdx} missing holdId`);\n          continue;\n        }\n        holdStarts[holdId] = { time, lane };\n      } else if (type === 'HOLD_END') {\n        if (parts.length < 4) {\n          GameErrors.log(`BeatmapParser: HOLD_END line ${lineIdx} missing holdId: \"${line}\"`);\n          continue;\n        }\n        const holdId = parts[3].trim();\n        if (!holdId) {\n          GameErrors.log(`BeatmapParser: HOLD_END line ${lineIdx} missing holdId`);\n          continue;\n        }\n        holdEnds[holdId] = { time, lane };\n      } else if (type === 'TAP') {\n        notes.push({ time, lane, type: 'TAP', beatmapStart: metadata.beatmapStart, beatmapEnd: metadata.beatmapEnd });\n      } else if (type === 'HOLD') {\n        if (parts.length < 5) {\n          GameErrors.log(`BeatmapParser: HOLD note line ${lineIdx} missing duration or holdId: \"${line}\"`);\n          continue;\n        }\n        const duration = parseInt(parts[3]);\n        const holdId = parts[4].trim();\n\n        if (isNaN(duration)) {\n          GameErrors.log(`BeatmapParser: HOLD note line ${lineIdx} invalid duration: \"${parts[3]}\"`);\n          continue;\n        }\n        if (!holdId) {\n          GameErrors.log(`BeatmapParser: HOLD note line ${lineIdx} missing holdId`);\n          continue;\n        }\n\n        notes.push({ time, lane, type: 'HOLD', duration, holdId, beatmapStart: metadata.beatmapStart, beatmapEnd: metadata.beatmapEnd });\n      } else if (type !== 'TAP' && type !== 'HOLD' && type !== 'HOLD_START' && type !== 'HOLD_END') {\n        GameErrors.log(`BeatmapParser: Line ${lineIdx} unknown note type: \"${type}\"`);\n      }\n    }\n\n    const processedHoldIds = new Set<string>();\n    for (const holdId in holdStarts) {\n      if (!holdEnds[holdId]) {\n        GameErrors.log(`BeatmapParser: HOLD_START \"${holdId}\" has no matching HOLD_END`);\n        continue;\n      }\n\n      const start = holdStarts[holdId];\n      const end = holdEnds[holdId];\n\n      if (start.lane !== end.lane) {\n        GameErrors.log(`BeatmapParser: HOLD \"${holdId}\" has mismatched lanes: start lane=${start.lane}, end lane=${end.lane}`);\n        continue;\n      }\n\n      if (end.time <= start.time) {\n        GameErrors.log(`BeatmapParser: HOLD \"${holdId}\" has invalid timing: start=${start.time}, end=${end.time}`);\n        continue;\n      }\n\n      const duration = end.time - start.time;\n      notes.push({ time: start.time, lane: start.lane, type: 'HOLD', duration, holdId, beatmapStart: metadata.beatmapStart, beatmapEnd: metadata.beatmapEnd });\n      processedHoldIds.add(holdId);\n    }\n\n    for (const holdId in holdEnds) {\n      if (!holdStarts[holdId]) {\n        GameErrors.log(`BeatmapParser: HOLD_END \"${holdId}\" has no matching HOLD_START`);\n      }\n    }\n\n    return { metadata, notes };\n  } catch (error) {\n    GameErrors.log(`BeatmapParser: Beatmap parse error: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    return null;\n  }\n}","path":null,"size_bytes":7416,"size_tokens":null},"client/src/hooks/useLoadBeatmap.ts":{"content":"// src/hooks/useLoadBeatmap.ts\nimport { useGameStore } from '@/stores/useGameStore';\n\nexport function useLoadBeatmap(): { notes: any[] } {\n  const notes = useGameStore(state => state.notes);\n  return { notes };\n}","path":null,"size_bytes":212,"size_tokens":null},"client/src/hooks/useVanishingPointOffset.ts":{"content":"// src/hooks/useVanishingPointOffset.ts\nimport { useVanishingPointStore } from '@/stores/useVanishingPointStore';\n\ninterface Offset {\n  x: number;\n  y: number;\n}\n\nexport function useVanishingPointOffset(): Offset {\n  return useVanishingPointStore((state) => state.vpOffset);\n}","path":null,"size_bytes":276,"size_tokens":null},"client/src/components/ui/sonner.tsx":{"content":"\"use client\"\n\nimport { useTheme } from \"next-themes\"\nimport { Toaster as Sonner } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster }\n","path":null,"size_bytes":894,"size_tokens":null},"client/src/components/screens/ResumeOverlay.tsx":{"content":"// src/components/ResumeOverlay.tsx\nimport React, { memo } from 'react';\nimport { motion } from \"framer-motion\";\nimport { useGameStore } from '@/stores/useGameStore';\n\ninterface ResumeOverlayProps {\n  visible?: boolean;\n  opacity?: number;\n}\n\nconst ResumeOverlayComponent = ({ visible: propVisible, opacity: propOpacity = 0.3 }: ResumeOverlayProps = {}) => {\n  const isPaused = propVisible ?? useGameStore(state => state.isPaused);\n\n  if (!isPaused) return null;\n\n  return (\n    <motion.div\n      className=\"fixed inset-0 bg-black/30 backdrop-blur-sm z-40\"\n      data-testid=\"resume-overlay\"\n      initial={{ opacity: 0 }}\n      animate={{ opacity: propOpacity }}\n      transition={{ duration: 0.2 }}\n    />\n  );\n};\n\nexport const ResumeOverlay = memo(ResumeOverlayComponent);","path":null,"size_bytes":775,"size_tokens":null},"client/src/components/game/effects/PerfectPulse.tsx":{"content":"// src/components/PerfectPulse.tsx\nimport { motion } from 'framer-motion';\nimport { COMBO_PERFECT_MILESTONE, COLOR_PARTICLE_GREEN, COLOR_PARTICLE_RED } from '@/lib/config/gameConstants';\n\ninterface PerfectPulseProps { combo: number; }\n\nexport const PerfectPulse: React.FC<PerfectPulseProps> = ({ combo }) => (\n  <motion.div\n    initial={{ scale: 0.5, opacity: 1 }}\n    animate={{ scale: 3, opacity: 0 }}\n    transition={{ duration: 0.6, ease: 'easeOut' }}\n    className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full border-2\"\n    style={{\n      width: '100px',\n      height: '100px',\n      borderColor: combo % (COMBO_PERFECT_MILESTONE * 2) === 0 ? COLOR_PARTICLE_GREEN : COLOR_PARTICLE_RED,\n      boxShadow: combo % (COMBO_PERFECT_MILESTONE * 2) === 0 ? `0 0 50px ${COLOR_PARTICLE_GREEN}` : `0 0 50px ${COLOR_PARTICLE_RED}`,\n    }}\n  />\n);","path":null,"size_bytes":868,"size_tokens":null},"client/src/hooks/useGameLoop.ts":{"content":"// src/hooks/useGameLoop.ts\nimport { useEffect, useRef } from 'react';\n\ninterface GameLoopCallbacks {\n  onFrame: (currentTime: number) => void;\n  onGameOver?: () => void;\n}\n\nexport function useGameLoop(\n  isActive: boolean,\n  callbacks: GameLoopCallbacks\n): void {\n  const requestRef = useRef<number | undefined>(undefined);\n  const callbacksRef = useRef<GameLoopCallbacks>(callbacks);\n\n  // Keep callbacks fresh without restarting loop\n  useEffect(() => {\n    callbacksRef.current = callbacks;\n  }, [callbacks]);\n\n  useEffect(() => {\n    if (!isActive) {\n      if (requestRef.current) {\n        cancelAnimationFrame(requestRef.current);\n        requestRef.current = undefined;\n      }\n      return;\n    }\n\n    const loop = () => {\n      callbacksRef.current.onFrame(performance.now());\n      requestRef.current = requestAnimationFrame(loop);\n    };\n\n    requestRef.current = requestAnimationFrame(loop);\n\n    return () => {\n      if (requestRef.current) {\n        cancelAnimationFrame(requestRef.current);\n      }\n    };\n  }, [isActive]);\n}","path":null,"size_bytes":1041,"size_tokens":null},"client/src/types/visualEffects.ts":{"content":"// src/types/visualEffects.ts\nexport interface Particle {\n  id: string;\n  x: number;\n  y: number;\n  color: string;\n  size: number;\n  birthTime: number;\n}\n\nexport interface ShakeOffset { x: number; y: number; }\nexport interface GlitchState { glitch: number; glitchPhase: number; glitchOpacityMultiplier: number; }","path":null,"size_bytes":312,"size_tokens":null},"client/src/stores/useVanishingPointStore.ts":{"content":"import { create } from 'zustand';\n\nexport interface VanishingPointStoreState {\n  vpOffset: { x: number; y: number };\n  setVPOffset: (offset: { x: number; y: number }) => void;\n}\n\nexport const useVanishingPointStore = create<VanishingPointStoreState>((set) => ({\n  vpOffset: { x: 0, y: 0 },\n\n  setVPOffset: (vpOffset) => set({ vpOffset }),\n}));\n","path":null,"size_bytes":344,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":2001,"size_tokens":null},"client/src/hooks/useHoldNotes.ts":{"content":"// src/hooks/useHoldNotes.ts\nimport { useMemo } from 'react';\nimport { Note } from '@/lib/engine/gameTypes';\nimport { processSingleHoldNote, HoldNoteProcessedData } from '@/lib/utils/holdNoteUtils';\nimport { useGameStore } from '@/stores/useGameStore';\n\nexport type { HoldNoteProcessedData };\n\nexport function useHoldNotes(visibleNotes: Note[], currentTime: number): HoldNoteProcessedData[] {\n  const gameState = useGameStore(state => state.gameState);\n  const beatmapBpm = useGameStore(state => state.beatmapBpm) || 120;\n  \n  return useMemo(() => {\n    // Don't render notes until game is actually playing (YouTube started)\n    if (gameState !== 'PLAYING' && gameState !== 'PAUSED' && gameState !== 'RESUMING') {\n      return [];\n    }\n    \n    // Ensure visibleNotes is an array\n    if (!visibleNotes || !Array.isArray(visibleNotes)) {\n      return [];\n    }\n    \n    return visibleNotes\n      .filter((n) => n && (n.type === 'HOLD' || n.type === 'SPIN_LEFT' || n.type === 'SPIN_RIGHT') && n.id)\n      .map((note) => processSingleHoldNote(note, currentTime, beatmapBpm))\n      .filter((data): data is HoldNoteProcessedData => data !== null);\n  }, [visibleNotes, currentTime, gameState, beatmapBpm]);\n}","path":null,"size_bytes":1203,"size_tokens":null},"client/src/lib/notes/tap/tapGreystate.ts":{"content":"import {\n  GREYSCALE_FILL_COLOR,\n  GREYSCALE_GLOW_COLOR,\n} from '@/lib/config/gameConstants';\nimport { TapNoteState } from './tapNoteHelpers';\nimport { getColorForLane } from '@/lib/utils/laneUtils';\n\nexport interface TapNoteColors {\n  fillColor: string;\n  glowColor: string;\n  strokeColor: string;\n}\n\nexport interface TapGreyscaleState {\n  isGreyed: boolean;\n  reason: 'none' | 'tapTooEarlyImmediate' | 'tapMissAtJudgement';\n}\n\nexport const determineTapGreyscaleState = (\n  state: TapNoteState,\n  progress: number\n): TapGreyscaleState => {\n  // Prevent greyscale if note was successfully hit\n  if (state.isHit) {\n    return { isGreyed: false, reason: 'none' };\n  }\n\n  // Immediate greyscale for too-early failure\n  if (state.isTapTooEarlyFailure) {\n    return { isGreyed: true, reason: 'tapTooEarlyImmediate' };\n  }\n  \n  // Immediate greyscale for miss failure (removed progress gate for consistency)\n  if (state.isTapMissFailure) {\n    return { isGreyed: true, reason: 'tapMissAtJudgement' };\n  }\n  \n  return { isGreyed: false, reason: 'none' };\n};\n\nexport const calculateTapNoteColors = (\n  greyscaleState: TapGreyscaleState,\n  lane: number,\n  baseColor: string\n): TapNoteColors => {\n  if (greyscaleState.isGreyed) {\n    return {\n      fillColor: GREYSCALE_FILL_COLOR,\n      glowColor: GREYSCALE_GLOW_COLOR,\n      strokeColor: 'rgba(120, 120, 120, 1)',\n    };\n  }\n  \n  return {\n    fillColor: baseColor,\n    glowColor: baseColor,\n    strokeColor: 'rgba(255,255,255,1)',\n  };\n};\n","path":null,"size_bytes":1481,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4419,"size_tokens":null},"client/src/components/game/tunnel/RadialSpokes.tsx":{"content":"// src/components/RadialSpokes.tsx\nimport React, { memo } from 'react';\nimport { RAY_ANGLES, TUNNEL_MAX_DISTANCE } from '@/lib/config/gameConstants';\n\ninterface RadialSpokesProps {\n  rayColor: string;\n  vpX: number;\n  vpY: number;\n  hexCenterX: number;\n  hexCenterY: number;\n}\n\nconst RadialSpokesComponent = ({ rayColor, vpX, vpY, hexCenterX, hexCenterY }: RadialSpokesProps) => {\n  const maxRadius = TUNNEL_MAX_DISTANCE;\n  return (\n    <>\n      {RAY_ANGLES.map((angle: number) => {\n        const rad = (angle * Math.PI) / 180;\n        const cornerX = hexCenterX + maxRadius * Math.cos(rad);\n        const cornerY = hexCenterY + maxRadius * Math.sin(rad);\n        return (\n          <g key={`spoke-group-${angle}`} data-testid={`spoke-${angle}`}>\n            {Array.from({ length: 12 }).map((_, segIdx) => {\n              const segProgress = (segIdx + 1) / 12;\n              const x1 = vpX + (cornerX - vpX) * (segProgress - 1 / 12);\n              const y1 = vpY + (cornerY - vpY) * (segProgress - 1 / 12);\n              const x2 = vpX + (cornerX - vpX) * segProgress;\n              const y2 = vpY + (cornerY - vpY) * segProgress;\n              const strokeWidth = 0.3 + segProgress * 3.5;\n              const opacity = 0.1 + segProgress * 0.4;\n              return (\n                <line \n                  key={`segment-${angle}-${segIdx}`} \n                  data-testid={`segment-${angle}-${segIdx}`}\n                  x1={x1} \n                  y1={y1} \n                  x2={x2} \n                  y2={y2} \n                  stroke={rayColor} \n                  strokeWidth={strokeWidth} \n                  opacity={opacity} \n                  strokeLinecap=\"round\" \n                />\n              );\n            })}\n          </g>\n        );\n      })}\n    </>\n  );\n};\n\nexport const RadialSpokes = memo(RadialSpokesComponent);","path":null,"size_bytes":1835,"size_tokens":null},"client/src/hooks/useGameEngine.ts":{"content":"import { useEffect, useMemo, useCallback, useRef } from 'react';\nimport { useGameStore } from '@/stores/useGameStore';\nimport type { GameState, Note, Difficulty, GameConfig } from '@/types/game';\nimport { NoteProcessor } from '@/lib/notes/processors/noteProcessor';\nimport { NoteValidator } from '@/lib/notes/processors/noteValidator';\nimport { ScoringManager } from '@/lib/managers/scoringManager';\nimport { GameErrors } from '@/lib/errors/errorLog';\nimport { GAME_CONFIG } from '@/lib/config/gameConstants';\n\n// Default config from single source of truth\nconst DEFAULT_CONFIG: GameConfig = GAME_CONFIG as GameConfig;\n\ninterface UseGameEngineProps {\n  difficulty: Difficulty;\n  customNotes?: Note[];\n  getVideoTime?: () => number | null;\n}\n\nexport interface UseGameEngineReturn {\n  gameState: GameState;\n  score: number;\n  combo: number;\n  health: number;\n  notes: Note[];\n  currentTime: number;\n  isPaused: boolean;\n  startGame: () => void;\n  pauseGame: () => void;\n  resumeGame: () => void;\n  restartGame: () => void;\n  setGameState: (state: GameState) => void;\n  hitNote: (lane: number) => void;\n  trackHoldStart: (lane: number) => void;\n  trackHoldEnd: (lane: number) => void;\n  markNoteMissed: (noteId: string) => void;\n  getReleaseTime: (noteId: string) => number | undefined;\n}\n\nexport function useGameEngine({\n  difficulty,\n  customNotes = [],\n  getVideoTime,\n}: UseGameEngineProps): UseGameEngineReturn {\n  const gameState = useGameStore(state => state.gameState);\n  const score = useGameStore(state => state.score);\n  const combo = useGameStore(state => state.combo);\n  const health = useGameStore(state => state.health);\n  const notes = useGameStore(state => state.notes);\n  const currentTime = useGameStore(state => state.currentTime);\n  const isPaused = useGameStore(state => state.isPaused);\n  \n  const setGameState = useGameStore(state => state.setGameState);\n  const setNotes = useGameStore(state => state.setNotes);\n  const setCurrentTime = useGameStore(state => state.setCurrentTime);\n  const hitNote = useGameStore(state => state.hitNote);\n  const startDeckHold = useGameStore(state => state.startDeckHold);\n  const endDeckHold = useGameStore(state => state.endDeckHold);\n  const pauseGame = useGameStore(state => state.pauseGame);\n  const resumeGame = useGameStore(state => state.resumeGame);\n  const restartGameStore = useGameStore(state => state.restartGame);\n  \n  const setScore = useGameStore(state => state.setScore);\n  const setCombo = useGameStore(state => state.setCombo);\n  const setHealth = useGameStore(state => state.setHealth);\n\n  const beatmapBpm = useGameStore(state => state.beatmapBpm) || 120;\n\n  // Construct GameConfig from single source of truth\n  const gameConfig = useMemo<GameConfig>(() => DEFAULT_CONFIG, []);\n\n  // Initialize Engine Components\n  const { processor, validator, scorer } = useMemo(() => {\n    const scorer = new ScoringManager(gameConfig);\n    const validator = new NoteValidator(gameConfig, beatmapBpm);\n    const processor = new NoteProcessor(gameConfig, validator, scorer, beatmapBpm);\n    return { processor, validator, scorer };\n  }, [gameConfig, beatmapBpm]);\n\n  // Store last frame timestamp for fallback timing\n  const lastFrameTimeRef = useRef<number>(performance.now());\n\n  useEffect(() => {\n    if (customNotes && customNotes.length > 0) {\n        setNotes(customNotes);\n        GameErrors.updateNoteStats(customNotes);\n    }\n  }, [customNotes, setNotes]);\n\n  const startGame = () => {\n    setGameState('PLAYING');\n    lastFrameTimeRef.current = performance.now();\n  };\n\n  const markNoteMissed = (noteId: string) => {\n    console.log(`[MISS] ${noteId}`);\n  };\n\n  const getReleaseTime = (noteId: string): number | undefined => {\n    return undefined;\n  };\n\n  const restartGame = useCallback(() => {\n    scorer.reset();\n    restartGameStore();\n    lastFrameTimeRef.current = performance.now();\n  }, [scorer, restartGameStore]);\n\n  // IMPLEMENTATION OF HIT NOTE\n  const handleHitNote = useCallback((lane: number) => {\n    const { notes, currentTime } = useGameStore.getState();\n    \n    // Lanes 0-3 are Taps\n    if (lane >= 0 && lane <= 3) {\n        const targetNote = validator.findClosestActiveNote(notes, lane, 'TAP', currentTime);\n        \n        if (targetNote) {\n            console.log(`[GAME-ENGINE] Try hit note ${targetNote.id} at ${currentTime}ms (diff ${currentTime - targetNote.time}ms)`);\n            const result = processor.processTapHit(targetNote, currentTime);\n            \n            // Always persist the note update (success or failure)\n            const updatedNotes = notes.map(n => n.id === targetNote.id ? result.updatedNote : n);\n            setNotes(updatedNotes);\n            GameErrors.updateNoteStats(updatedNotes);\n            \n            if (result.success) {\n                console.log(`[GAME-ENGINE] Hit success!`, result.scoreChange);\n                \n                if (result.scoreChange) {\n                    setScore(result.scoreChange.score);\n                    setCombo(result.scoreChange.combo);\n                    setHealth(result.scoreChange.health);\n                }\n            } else {\n                console.log(`[GAME-ENGINE] Hit failed - tapTooEarlyFailure: ${result.updatedNote.tapTooEarlyFailure}, tapMissFailure: ${result.updatedNote.tapMissFailure}`);\n                \n                if (result.scoreChange) {\n                    setScore(result.scoreChange.score);\n                    setCombo(result.scoreChange.combo);\n                    setHealth(result.scoreChange.health);\n                }\n            }\n        } else {\n             console.log(`[GAME-ENGINE] No active note found in lane ${lane} at ${currentTime}`);\n        }\n    } \n  }, [validator, processor, setNotes, setScore, setCombo, setHealth]);\n\n  const handleTrackHoldStart = useCallback((lane: number) => {\n     const { notes, currentTime } = useGameStore.getState();\n     \n     const targetNote = validator.findPressableHoldNote(notes, lane, currentTime);\n     \n     if (targetNote) {\n         const result = processor.processHoldStart(targetNote, currentTime);\n         // Always persist the note update (success or failure)\n         const updatedNotes = notes.map(n => n.id === targetNote.id ? result.updatedNote : n);\n         setNotes(updatedNotes);\n         GameErrors.updateNoteStats(updatedNotes);\n         \n         if (result.success) {\n             startDeckHold(lane);\n             \n             if (result.scoreChange) {\n                 setScore(result.scoreChange.score);\n                 setCombo(result.scoreChange.combo);\n                 setHealth(result.scoreChange.health);\n             }\n         } else {\n             console.log(`[GAME-ENGINE] Hold start failed - tooEarlyFailure: ${result.updatedNote.tooEarlyFailure}, holdMissFailure: ${result.updatedNote.holdMissFailure}`);\n             \n             if (result.scoreChange) {\n                 setScore(result.scoreChange.score);\n                 setCombo(result.scoreChange.combo);\n                 setHealth(result.scoreChange.health);\n             }\n         }\n     }\n  }, [validator, processor, setNotes, setScore, setCombo, setHealth, startDeckHold]);\n\n  const handleTrackHoldEnd = useCallback((lane: number) => {\n     const { notes, currentTime } = useGameStore.getState();\n     \n     const targetNote = validator.findActiveHoldNote(notes, lane, currentTime);\n     \n     if (targetNote) {\n         const result = processor.processHoldEnd(targetNote, currentTime);\n         const updatedNotes = notes.map(n => n.id === targetNote.id ? result.updatedNote : n);\n         setNotes(updatedNotes);\n         GameErrors.updateNoteStats(updatedNotes);\n         \n         if (result.scoreChange) {\n             setScore(result.scoreChange.score);\n             setCombo(result.scoreChange.combo);\n             setHealth(result.scoreChange.health);\n         }\n     }\n     endDeckHold(lane);\n  }, [validator, processor, setNotes, endDeckHold, setScore, setCombo, setHealth]);\n\n  useEffect(() => {\n    if (gameState !== 'PLAYING' || isPaused) {\n        lastFrameTimeRef.current = performance.now();\n        return;\n    }\n    \n    const interval = setInterval(() => {\n      const now = performance.now();\n      const dt = now - lastFrameTimeRef.current;\n      lastFrameTimeRef.current = now;\n\n      let timeToUse: number | null = getVideoTime ? getVideoTime() : null;\n\n      if (timeToUse === null || (timeToUse === 0 && dt > 0)) {\n          const currentStoreTime = useGameStore.getState().currentTime;\n          timeToUse = currentStoreTime + dt; \n          \n          if (Math.random() < 0.01) {\n             console.log('[GAME-ENGINE] Using fallback local timing:', timeToUse.toFixed(0));\n          }\n      }\n\n      if (timeToUse !== null) {\n        setCurrentTime(timeToUse);\n        \n        const currentNotes = useGameStore.getState().notes;\n        const result = processor.processNotesFrame(currentNotes, timeToUse);\n        \n        if (result.scoreState) {\n             setScore(result.scoreState.score);\n             setCombo(result.scoreState.combo);\n             setHealth(result.scoreState.health);\n        }\n\n        if (result.updatedNotes !== currentNotes) {\n             setNotes(result.updatedNotes);\n             GameErrors.updateNoteStats(result.updatedNotes);\n        }\n      }\n    }, 16);\n    \n    return () => clearInterval(interval);\n  }, [getVideoTime, gameState, isPaused, setCurrentTime, processor, setScore, setCombo, setHealth, setNotes]);\n\n  return {\n    gameState,\n    score,\n    combo,\n    health,\n    notes,\n    currentTime,\n    isPaused,\n    startGame,\n    pauseGame,\n    resumeGame,\n    restartGame,\n    setGameState,\n    hitNote: handleHitNote,\n    trackHoldStart: handleTrackHoldStart,\n    trackHoldEnd: handleTrackHoldEnd,\n    markNoteMissed,\n    getReleaseTime,\n  };\n}\n","path":null,"size_bytes":9787,"size_tokens":null},"client/src/components/game/effects/ParticleSystem.tsx":{"content":"// src/components/ParticleSystem.tsx\nimport { motion } from 'framer-motion';\nimport { Particle } from '@/types/visualEffects';\n\ninterface ParticleSystemProps { particles: Particle[]; }\n\nexport const ParticleSystem: React.FC<ParticleSystemProps> = ({ particles }) => (\n  <>\n    {particles.map(particle => (\n      <motion.div\n        key={particle.id}\n        initial={{ x: `${particle.x}%`, y: `${particle.y}%`, opacity: 1, scale: 1 }}\n        animate={{\n          x: `${particle.x + (Math.random() - 0.5) * 200}%`,\n          y: `${particle.y - 200}%`,\n          opacity: 0,\n          scale: 0,\n        }}\n        transition={{ duration: 1, ease: 'easeOut' }}\n        className=\"absolute rounded-full\"\n        style={{\n          left: '50%', top: '50%',\n          width: `${particle.size}px`,\n          height: `${particle.size}px`,\n          backgroundColor: particle.color,\n          boxShadow: `0 0 ${particle.size * 2}px ${particle.color}`,\n        }}\n      />\n    ))}\n  </>\n);","path":null,"size_bytes":980,"size_tokens":null},"client/src/hooks/useErrorLogs.ts":{"content":"// src/hooks/useErrorLogs.ts\nimport { useGameDebuggerStore } from '@/stores/useGameDebuggerStore';\nimport { countErrorsByCategory, resetHitStats, resetRenderStats } from '@/lib/utils/errorLogUtils';\n\nexport const useErrorLogs = () => {\n  const state = useGameDebuggerStore();\n  \n  // Derived stats\n  const errorCounts = countErrorsByCategory(state.notes);\n  \n  const getAnimationStats = () => {\n    const total = state.animations.length;\n    const completed = state.animations.filter(a => a.completed).length;\n    const failed = 0; // Not currently tracked in AnimationTrackingEntry\n    const pending = total - completed;\n    const rendering = pending; // Simplified mapping\n\n    return {\n      total,\n      completed,\n      failed,\n      pending,\n      rendering\n    };\n  };\n\n  const animationStats = getAnimationStats();\n\n  const downloadUnifiedLogs = () => {\n    const consoleLogs = (window as any).__consoleLogs || [];\n\n    const logData = {\n      timestamp: new Date().toISOString(),\n      gameErrors: {\n        errors: state.notes,\n        animations: state.animations,\n        stats: {\n          notes: state.noteStats,\n          render: state.renderStats,\n          hits: state.hitStats,\n          animation: animationStats,\n        },\n      },\n      consoleLogs: consoleLogs.map((entry: any) => ({\n        t: entry.t,\n        level: entry.l,\n        message: entry.m,\n      })),\n    };\n\n    const jsonStr = JSON.stringify(logData, null, 2);\n    const blob = new Blob([jsonStr], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = `hyperverse-logs-${Date.now()}.json`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n  };\n\n  const clearLogs = () => {\n    state.reset();\n  };\n\n  return {\n    errors: state.notes,\n    animations: state.animations,\n    noteCounts: errorCounts,\n    noteStats: state.noteStats,\n    renderStats: state.renderStats,\n    hitStats: state.hitStats,\n    animationStats,\n    downloadUnifiedLogs,\n    clearLogs,\n  };\n};\n","path":null,"size_bytes":2132,"size_tokens":null},"client/src/lib/notes/processors/noteProcessor.ts":{"content":"import { Note, GameConfig, ScoreState } from '@/lib/engine/gameTypes';\nimport { NoteValidator } from './noteValidator';\nimport { ScoringManager } from '@/lib/managers/scoringManager';\nimport { roundTime } from './noteUpdateHelpers';\nimport { checkTapAutoFail, checkHoldAutoFail } from './noteAutoFailHelpers';\nimport { GameErrors } from '@/lib/errors/errorLog';\nimport { TAP_RENDER_WINDOW_MS, LEAD_TIME, REFERENCE_BPM } from '@/lib/config/gameConstants';\n\nexport type NoteUpdateResult = {\n  updatedNote: Note;\n  scoreChange?: ScoreState;\n  success: boolean;\n};\n\n// ============================================================================\n// NOTE PROCESSOR - Orchestrates note hit detection and state updates\n// ============================================================================\n\nexport class NoteProcessor {\n  private effectiveLEAD_TIME: number;\n  \n  constructor(\n    private config: GameConfig,\n    private validator: NoteValidator,\n    private scorer: ScoringManager,\n    beatmapBpm: number = 120\n  ) {\n    // Scale LEAD_TIME with BPM to match geometry scaling\n    this.effectiveLEAD_TIME = LEAD_TIME * (REFERENCE_BPM / Math.max(1, beatmapBpm));\n  }\n\n  processTapHit(note: Note, currentTime: number): NoteUpdateResult {\n    const timeSinceNote = currentTime - note.time;\n\n    // Too early - pressed too far before note appears (TAP_RENDER_WINDOW_MS before note.time)\n    if (timeSinceNote < -TAP_RENDER_WINDOW_MS) {\n      GameErrors.updateHitStats({ tapTooEarlyFailures: (GameErrors.hitStats.tapTooEarlyFailures || 0) + 1 });\n      GameErrors.log(`[TAP-HIT] noteId=${note.id} tapTooEarlyFailure at ${currentTime}ms`, currentTime);\n      return {\n        updatedNote: {\n          ...note,\n          tapTooEarlyFailure: true,\n          failureTime: roundTime(currentTime),\n        },\n        scoreChange: this.scorer.recordMiss(),\n        success: false,\n      };\n    }\n\n    // Valid hit - small window around note.time (TAP_HIT_WINDOW on both sides)\n    if (timeSinceNote >= -this.config.TAP_HIT_WINDOW && timeSinceNote <= this.config.TAP_HIT_WINDOW) {\n      const scoreChange = this.scorer.recordHit(timeSinceNote);\n      GameErrors.updateHitStats({ successfulHits: (GameErrors.hitStats.successfulHits || 0) + 1 });\n      GameErrors.log(`[TAP-HIT] noteId=${note.id} successfulHit at ${currentTime}ms (timing: ${timeSinceNote.toFixed(0)}ms)`, currentTime);\n      return {\n        updatedNote: {\n          ...note,\n          hit: true,\n        },\n        scoreChange,\n        success: true,\n      };\n    }\n\n    // Too late - handled by auto-miss logic\n    return { updatedNote: note, success: false };\n  }\n\n  processHoldStart(note: Note, currentTime: number): NoteUpdateResult {\n    const timeSinceNote = currentTime - note.time;\n\n    // Too early - pressed too far before note appears (effectiveLEAD_TIME before note.time)\n    if (timeSinceNote < -this.effectiveLEAD_TIME) {\n      GameErrors.updateHitStats({ tooEarlyFailures: (GameErrors.hitStats.tooEarlyFailures || 0) + 1 });\n      GameErrors.log(`[HOLD-HIT] noteId=${note.id} tooEarlyFailure at ${currentTime}ms`, currentTime);\n      return {\n        updatedNote: {\n          ...note,\n          pressHoldTime: roundTime(currentTime),\n          tooEarlyFailure: true,\n          failureTime: roundTime(currentTime),\n        },\n        scoreChange: this.scorer.recordMiss(),\n        success: false,\n      };\n    }\n\n    // Too late - pressed after leniency window\n    if (timeSinceNote > this.config.HOLD_ACTIVATION_WINDOW) {\n      GameErrors.updateHitStats({ holdMissFailures: (GameErrors.hitStats.holdMissFailures || 0) + 1 });\n      GameErrors.log(`[HOLD-HIT] noteId=${note.id} holdMissFailure at ${currentTime}ms`, currentTime);\n      return {\n        updatedNote: {\n          ...note,\n          pressHoldTime: roundTime(currentTime),\n          holdMissFailure: true,\n          failureTime: roundTime(currentTime),\n        },\n        scoreChange: this.scorer.recordMiss(),\n        success: false,\n      };\n    }\n\n    // Successful press - must be within HOLD_HIT_WINDOW of note.time\n    if (Math.abs(timeSinceNote) <= this.config.HOLD_HIT_WINDOW) {\n      return {\n        updatedNote: {\n          ...note,\n          pressHoldTime: roundTime(currentTime),\n        },\n        success: true,\n      };\n    }\n\n    // Within leniency window but not successful (late press)\n    return { updatedNote: note, success: false };\n  }\n\n  processHoldEnd(note: Note, currentTime: number): NoteUpdateResult {\n    const holdDuration = note.duration || 1000;\n    const expectedReleaseTime = note.time + holdDuration;\n    const timeSinceExpectedRelease = currentTime - expectedReleaseTime;\n    const totalHoldTime = currentTime - note.time;\n\n    // Released too early\n    if (totalHoldTime < holdDuration) {\n      return {\n        updatedNote: {\n          ...note,\n          releaseTime: roundTime(currentTime),\n          holdReleaseFailure: true,\n          failureTime: roundTime(currentTime),\n        },\n        scoreChange: this.scorer.recordMiss(),\n        success: false,\n      };\n    }\n\n    // Valid release\n    if (Math.abs(timeSinceExpectedRelease) <= this.config.HOLD_RELEASE_WINDOW) {\n      const scoreChange = this.scorer.recordHit(timeSinceExpectedRelease);\n      return {\n        updatedNote: {\n          ...note,\n          hit: true,\n          releaseTime: roundTime(currentTime),\n        },\n        scoreChange,\n        success: true,\n      };\n    }\n\n    // Released too late\n    return {\n      updatedNote: {\n        ...note,\n        releaseTime: roundTime(currentTime),\n        holdReleaseFailure: true,\n        failureTime: roundTime(currentTime),\n      },\n      scoreChange: this.scorer.recordMiss(),\n      success: false,\n    };\n  }\n\n  checkAutoFail(note: Note, currentTime: number): NoteUpdateResult | null {\n    if (!this.validator.isNoteActive(note)) return null;\n\n    if (note.type === 'TAP') {\n      return checkTapAutoFail(note, currentTime, this.config, this.scorer);\n    }\n\n    if (note.type === 'SPIN_LEFT' || note.type === 'SPIN_RIGHT' || note.type === 'HOLD') {\n      return checkHoldAutoFail(note, currentTime, this.config, this.scorer);\n    }\n\n    return null;\n  }\n\n  processNotesFrame(notes: Note[], currentTime: number): { updatedNotes: Note[]; shouldGameOver: boolean; scoreState: ScoreState | null } {\n    let shouldGameOver = false;\n    let hasChanges = false;\n    let scoreUpdated = false;\n\n    const updatedNotes = notes.map(note => {\n      // Auto-fail check\n      const autoFailResult = this.checkAutoFail(note, currentTime);\n      if (autoFailResult && !autoFailResult.success) {\n        // shouldGameOver = true; // Don't force game over on single miss, rely on health\n        hasChanges = true;\n        scoreUpdated = true;\n        return autoFailResult.updatedNote;\n      }\n\n      // Cleanup check\n      if (this.validator.shouldCleanupNote(note, currentTime)) {\n        hasChanges = true;\n        return { ...note, missed: true }; // Mark as missed if cleaned up without hit\n      }\n\n      return note;\n    });\n    \n    const scoreState = scoreUpdated ? this.scorer.getState() : null;\n    if (this.scorer.isDead()) shouldGameOver = true;\n\n    return { updatedNotes: hasChanges ? updatedNotes : notes, shouldGameOver, scoreState };\n  }\n}\n","path":null,"size_bytes":7233,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1037,"size_tokens":null},"client/src/components/ui/empty.tsx":{"content":"import { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Empty({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty\"\n      className={cn(\n        \"flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-header\"\n      className={cn(\n        \"flex max-w-sm flex-col items-center gap-2 text-center\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst emptyMediaVariants = cva(\n  \"mb-2 flex shrink-0 items-center justify-center [&_svg]:pointer-events-none [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction EmptyMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof emptyMediaVariants>) {\n  return (\n    <div\n      data-slot=\"empty-icon\"\n      data-variant={variant}\n      className={cn(emptyMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-title\"\n      className={cn(\"text-lg font-medium tracking-tight\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <div\n      data-slot=\"empty-description\"\n      className={cn(\n        \"text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-content\"\n      className={cn(\n        \"flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Empty,\n  EmptyHeader,\n  EmptyTitle,\n  EmptyDescription,\n  EmptyContent,\n  EmptyMedia,\n}\n","path":null,"size_bytes":2396,"size_tokens":null},"client/src/stores/useGameStore.ts":{"content":"import { create } from 'zustand';\nimport type { GameStoreState } from '@/types/game';\nimport { DEFAULT_BEATMAP_BPM } from '@/lib/config/gameConstants';\n\nexport const useGameStore = create<GameStoreState>((set, get) => ({\n  // Initial state\n  gameState: 'IDLE',\n  difficulty: 'MEDIUM',\n  notes: [],\n  currentTime: 0,\n  isPaused: false,\n  score: 0,\n  combo: 0,\n  health: 200,\n  maxHealth: 200,\n  missCount: 0,\n  countdownSeconds: 0,\n  beatmapBpm: DEFAULT_BEATMAP_BPM, // Default BPM - will be updated when beatmap loads\n\n  // Setters\n  setGameState: (gameState) => set({ gameState }),\n  setDifficulty: (difficulty) => set({ difficulty }),\n  setNotes: (notes) => set({ notes }),\n  setScore: (score) => set({ score }),\n  setCombo: (combo) => set({ combo }),\n  setHealth: (health) => set({ health }),\n  setMissCount: (missCount) => set({ missCount }),\n  setCurrentTime: (currentTime) => set({ currentTime }),\n  setIsPaused: (isPaused) => set({ isPaused }),\n  setCountdownSeconds: (countdownSeconds) => set({ countdownSeconds }),\n  setBeatmapBpm: (bpm) => set({ beatmapBpm: bpm }),\n\n  // Game actions\n  hitNote: (lane) => {\n    console.log(`[GAME] Hit note on lane ${lane}`);\n  },\n  hitPad: (lane) => {\n    console.log(`[GAME] Hit pad on lane ${lane}`);\n  },\n  startDeckHold: (lane) => {\n    console.log(`[GAME] Start deck hold on lane ${lane}`);\n  },\n  endDeckHold: (lane) => {\n    console.log(`[GAME] End deck hold on lane ${lane}`);\n  },\n  pauseGame: () => set({ isPaused: true, countdownSeconds: 0 }),\n  resumeGame: () => set({ isPaused: false }),\n  \n  resetGameState: () => set((state) => ({ \n    // Reset note states but keep the notes array\n    notes: state.notes.map(note => ({\n      ...note,\n      hit: false,\n      missed: false,\n      failureTime: undefined,\n      pressHoldTime: undefined,\n      releaseTime: undefined,\n      tapTooEarlyFailure: false,\n      tapMissFailure: false,\n      tooEarlyFailure: false,\n      holdMissFailure: false,\n      holdReleaseFailure: false\n    }))\n  })),\n  \n  rewindGame: () => set((state) => ({ \n    currentTime: 0,\n    // Reset note states - create brand new objects to break stale references\n    notes: state.notes.map((note, idx) => ({\n      ...note,\n      id: `${note.time}-${note.lane}-${idx}`, // Regenerate ID to ensure fresh objects\n      hit: false,\n      missed: false,\n      failureTime: undefined,\n      pressHoldTime: undefined,\n      releaseTime: undefined,\n      tapTooEarlyFailure: false,\n      tapMissFailure: false,\n      tooEarlyFailure: false,\n      holdMissFailure: false,\n      holdReleaseFailure: false\n    }))\n  })),\n  \n  restartGame: () => set((state) => ({ \n    currentTime: 0, \n    score: 0, \n    combo: 0, \n    health: 200, \n    gameState: 'IDLE', \n    isPaused: false,\n    countdownSeconds: 0,\n    // Reset note states - create brand new objects to ensure all references are cleared\n    notes: state.notes.map((note, idx) => ({\n      ...note,\n      id: `${note.time}-${note.lane}-${idx}`, // Regenerate ID to break any stale references\n      hit: false,\n      missed: false,\n      failureTime: undefined,\n      pressHoldTime: undefined,\n      releaseTime: undefined,\n      tapTooEarlyFailure: false,\n      tapMissFailure: false,\n      tooEarlyFailure: false,\n      holdMissFailure: false,\n      holdReleaseFailure: false\n    }))\n  })),\n\n  // Selectors\n  getVisibleNotes: () => {\n    const { notes, currentTime } = get();\n    const leadTime = 2000;\n    return notes.filter(n => n.time <= currentTime + leadTime && n.time >= currentTime - 500);\n  },\n  getProcessedTapNotes: () => {\n    const { getVisibleNotes } = get();\n    return getVisibleNotes().filter(n => n.type === 'TAP');\n  },\n  getHoldNotes: () => {\n    const { getVisibleNotes } = get();\n    return getVisibleNotes().filter(n => n.type === 'HOLD' || n.type === 'SPIN_LEFT' || n.type === 'SPIN_RIGHT');\n  },\n  getActiveNotes: () => {\n    return get().getVisibleNotes();\n  },\n  getCompletedNotes: () => {\n    const { notes } = get();\n    return notes.filter(n => n.hit || n.missed);\n  },\n  getActiveNotesOnLane: (lane: number) => {\n    return get().getVisibleNotes().filter(n => n.lane === lane);\n  },\n  isDead: () => {\n    return get().health <= 0;\n  },\n}));\n","path":null,"size_bytes":4187,"size_tokens":null},"client/src/stores/useParticlesStore.ts":{"content":"import { create } from 'zustand';\nimport type { Particle } from '@/types/visualEffects';\n\nexport interface ParticlesStoreState {\n  particles: Particle[];\n  addParticle: (particle: Particle) => void;\n  updateParticles: (updater: (p: Particle[]) => Particle[]) => void;\n  clearParticles: () => void;\n}\n\nexport const useParticlesStore = create<ParticlesStoreState>((set) => ({\n  particles: [],\n\n  addParticle: (particle) => {\n    set((state) => ({ particles: [...state.particles, particle] }));\n  },\n\n  updateParticles: (updater) => {\n    set((state) => ({ particles: updater(state.particles) }));\n  },\n\n  clearParticles: () => set({ particles: [] }),\n}));\n","path":null,"size_bytes":654,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/components/game/loaders/FailureBreakdownSection.tsx":{"content":"// src/components/FailureBreakdownSection.tsx\nimport React from 'react';\nimport { StatSection } from './ErrorLogViewerHelpers';\n\ninterface FailureBreakdownSectionProps {\n  hitStats: { tapMissFailures: number; tooEarlyFailures: number; holdMissFailures: number; holdReleaseFailures: number };\n}\n\nexport const FailureBreakdownSection: React.FC<FailureBreakdownSectionProps> = ({ hitStats }) => {\n  const failures = [\n    { label: 'TAP Miss', count: hitStats.tapMissFailures },\n    { label: 'Too Early', count: hitStats.tooEarlyFailures },\n    { label: 'Hold Miss', count: hitStats.holdMissFailures },\n    { label: 'Release Fail', count: hitStats.holdReleaseFailures },\n  ].filter(f => f.count > 0);\n\n  if (failures.length === 0) return null;\n\n  return (\n    <StatSection title=\"FAILURE BREAKDOWN\" titleColor=\"red\" textColor=\"red\">\n      <div className=\"grid grid-cols-2 gap-1\">\n        {failures.map(({ label, count }) => (\n          <div key={label}>\n            <span className=\"text-gray-500\">{label}</span>: <span className=\"font-bold\">{count}</span>\n          </div>\n        ))}\n      </div>\n    </StatSection>\n  );\n};","path":null,"size_bytes":1121,"size_tokens":null},"client/src/lib/utils/soundpadUtils.ts":{"content":"// src/utils/soundpadUtils.ts\nimport { HEXAGON_RADII } from '@/lib/config/gameConstants';\n\nexport const calculateButtonPosition = (angle: number, vpX: number, vpY: number): { cx: number; cy: number } => {\n  const outerHexagonRadius = HEXAGON_RADII[HEXAGON_RADII.length - 1];\n  const rad = (angle * Math.PI) / 180;\n  const cx = vpX + Math.cos(rad) * outerHexagonRadius;\n  const cy = vpY + Math.sin(rad) * outerHexagonRadius;\n  return { cx, cy };\n};","path":null,"size_bytes":447,"size_tokens":null},"client/src/components/game/effects/VisualEffects.tsx":{"content":"// src/components/VisualEffects.tsx\nimport React, { useEffect, useRef, useCallback } from 'react';\nimport { useGameStore } from '@/stores/useGameStore'; // Your game store (e.g., with combo, health, missCount)\nimport { useParticles } from '@/hooks/useParticles';\nimport { useShake } from '@/hooks/useShake';\nimport { useChromatic } from '@/hooks/useChromatic';\nimport { useGlitch } from '@/hooks/useGlitch';\nimport { ParticleSystem } from '@/components/game/effects/ParticleSystem';\nimport { GlitchOverlay } from '@/components/game/effects/GlitchOverlay';\nimport { ChromaticAberration } from '@/components/game/effects/ChromaticAberration';\nimport { PerfectPulse } from '@/components/game/effects/PerfectPulse';\nimport { MAX_HEALTH, LOW_HEALTH_THRESHOLD, COMBO_PERFECT_MILESTONE, GREYSCALE_INTENSITY, GLITCH_BACKGROUND_SIZE } from '@/lib/config/gameConstants';\nimport { GameErrors } from '@/lib/errors/errorLog';\n\ninterface VisualEffectsProps {\n  // Optional: Override with local props if needed; defaults to store\n  combo?: number;\n  health?: number;\n  missCount?: number;\n}\n\nexport function VisualEffects({ combo: propCombo, health: propHealth, missCount: propMissCount }: VisualEffectsProps = {}) {\n  // Refs to track previous values\n  const prevMissCountRef = useRef(0);\n  const prevComboRef = useRef(0);\n\n  // Pull from Zustand individually to prevent unnecessary re-renders\n  const combo = useGameStore(state => propCombo ?? state.combo);\n  const health = useGameStore(state => propHealth ?? state.health);\n  const missCount = useGameStore(state => propMissCount ?? state.missCount);\n\n  // Validation (runs on prop/store changes)\n  useEffect(() => {\n    if (!Number.isFinite(combo) || combo < 0 || !Number.isFinite(health) || health < 0 || !Number.isFinite(missCount)) {\n      GameErrors.log(`VisualEffects: Invalid state - combo=${combo}, health=${health}, missCount=${missCount}`);\n    }\n  }, [combo, health, missCount]);\n\n  const particles = useParticles();\n  const shakeOffset = useShake();\n  const chromaticIntensity = useChromatic({ combo });\n  const { glitch, glitchPhase, glitchOpacityMultiplier } = useGlitch({ \n    missCount, \n    health, \n    prevMissCount: prevMissCountRef.current\n  });\n\n  // Track perfect pulse trigger by detecting milestone crossing\n  const showPerfectPulse = combo > 0 && combo % COMBO_PERFECT_MILESTONE === 0 && combo !== prevComboRef.current;\n\n  // Update refs after each render to track changes\n  useEffect(() => {\n    prevMissCountRef.current = missCount;\n  }, [missCount]);\n\n  useEffect(() => {\n    prevComboRef.current = combo;\n  }, [combo]);\n\n  const greyscaleIntensity = Math.max(0, (MAX_HEALTH - health) / MAX_HEALTH) * GREYSCALE_INTENSITY;\n\n  // Glitch CSS init (once, outside deps)\n  useEffect(() => {\n    const existingStyle = document.querySelector('style[data-glitch]');\n    if (!existingStyle) {\n      const style = document.createElement('style');\n      style.textContent = `\n        @keyframes glitch-scroll {\n          0% { background-position: 0 0; }\n          100% { background-position: 0 ${GLITCH_BACKGROUND_SIZE}px; }\n        }\n      `;\n      style.setAttribute('data-glitch', 'true');\n      document.head.appendChild(style);\n    }\n  }, []);\n\n  return (\n    <div\n      className=\"fixed inset-0 pointer-events-none z-50 overflow-hidden\"\n      style={{ \n        filter: `grayscale(${greyscaleIntensity})`,\n        transform: `translate(${shakeOffset.x}px, ${shakeOffset.y}px)`,\n      }}\n    >\n      <ParticleSystem particles={particles} />\n      {glitch > 0 && (\n        <GlitchOverlay \n          glitch={glitch} \n          glitchPhase={glitchPhase} \n          glitchOpacityMultiplier={glitchOpacityMultiplier} \n        />\n      )}\n      {chromaticIntensity > 0 && <ChromaticAberration intensity={chromaticIntensity} />}\n      {showPerfectPulse && <PerfectPulse combo={combo} />}\n    </div>\n  );\n}","path":null,"size_bytes":3858,"size_tokens":null},"client/src/components/game/hud/RectangleMeter.tsx":{"content":"// src/components/RectangleMeter.tsx\nimport React, { memo } from \"react\";\nimport { motion } from \"framer-motion\";\nimport { GameErrors } from '@/lib/errors/errorLog';\nimport {\n  DECK_METER_SEGMENTS,\n  DECK_METER_SEGMENT_WIDTH,\n  DECK_METER_COMPLETION_THRESHOLD,\n  COLOR_DECK_LEFT,\n  COLOR_DECK_RIGHT,\n} from '@/lib/config/gameConstants';\n\nconst getRectangleMeterColor = (lane: number): string => {\n  if (lane === -1) return COLOR_DECK_LEFT; // Q - green\n  if (lane === -2) return COLOR_DECK_RIGHT; // P - red\n  return '#FFFFFF'; // Fallback\n};\n\ninterface RectangleMeterProps {\n  progress: number;\n  outlineColor: string;\n  lane: number;\n  isGlowing: boolean; // From hook, replaces completionGlow record\n}\n\nconst RectangleMeterComponent = ({ progress, outlineColor, lane, isGlowing }: RectangleMeterProps) => {\n  // Validate progress before rendering\n  if (!Number.isFinite(progress) || progress < 0 || progress > 1) {\n    GameErrors.log(`DeckMeter: Invalid progress=${progress} for lane ${lane}`);\n    return null;\n  }\n\n  const filledSegments = Math.ceil(progress * DECK_METER_SEGMENTS);\n  const isFull = progress >= DECK_METER_COMPLETION_THRESHOLD;\n\n  // Validate segment count\n  if (!Number.isFinite(filledSegments) || filledSegments < 0 || filledSegments > DECK_METER_SEGMENTS) {\n    GameErrors.log(`DeckMeter: Invalid filledSegments=${filledSegments} for lane ${lane} (max=${DECK_METER_SEGMENTS})`);\n    return null;\n  }\n\n  const fillColor = getRectangleMeterColor(lane);\n\n  return (\n    <motion.div\n      className=\"flex flex-col-reverse gap-0.5\"\n      animate={isGlowing ? { scale: 1.15 } : { scale: 1 }}\n      transition={{ duration: 0.15 }}\n    >\n      {Array.from({ length: DECK_METER_SEGMENTS }).map((_, idx) => {\n        const isFilled = idx < filledSegments;\n\n        return (\n          <motion.div\n            key={idx}\n            className=\"h-4 rounded-sm border-2\"\n            style={{\n              width: `${DECK_METER_SEGMENT_WIDTH}px`,\n              borderColor: outlineColor,\n              background: isFilled ? fillColor : 'transparent',\n              boxShadow: isFull && isFilled\n                ? `0 0 15px ${fillColor}, 0 0 30px ${fillColor}, inset 0 0 8px rgba(255,255,255,0.6)`\n                : isFilled\n                  ? `0 0 10px ${fillColor}, inset 0 0 6px rgba(255,255,255,0.3)`\n                  : 'none',\n            }}\n            animate={{\n              opacity: isFilled ? 1 : 0.15,\n              boxShadow: isFull && isFilled\n                ? [\n                    `0 0 15px ${fillColor}, 0 0 30px ${fillColor}, inset 0 0 8px rgba(255,255,255,0.6)`,\n                    `0 0 20px ${fillColor}, 0 0 40px ${fillColor}, inset 0 0 10px rgba(255,255,255,0.8)`,\n                    `0 0 15px ${fillColor}, 0 0 30px ${fillColor}, inset 0 0 8px rgba(255,255,255,0.6)`,\n                  ]\n                : isFilled\n                  ? `0 0 10px ${fillColor}, inset 0 0 6px rgba(255,255,255,0.3)`\n                  : 'none',\n            }}\n            transition={isFull && isFilled ? { duration: 0.6, repeat: Infinity } : { duration: 0.08 }}\n          />\n        );\n      })}\n    </motion.div>\n  );\n};\n\nexport const RectangleMeter = memo(RectangleMeterComponent);","path":null,"size_bytes":3200,"size_tokens":null},"client/src/lib/utils/visualEffectsUtils.ts":{"content":"// src/utils/visualEffectsUtils.ts\nimport { PARTICLE_COLORS, PARTICLE_SIZE_MIN, PARTICLE_SIZE_MAX } from '@/lib/config/gameConstants';\n\nexport const generateParticles = (count: number) => {\n  const now = Date.now();\n  return Array.from({ length: count }, (_, i) => ({\n    id: `${now}-${i}`,\n    x: Math.random() * 100,\n    y: Math.random() * 100,\n    color: PARTICLE_COLORS[Math.floor(Math.random() * PARTICLE_COLORS.length)],\n    size: Math.random() * (PARTICLE_SIZE_MAX - PARTICLE_SIZE_MIN) + PARTICLE_SIZE_MIN,\n    birthTime: now,\n  }));\n};\n\nexport const toggleGlitchState = (prevGlitch: number, opacity: number): number => {\n  return prevGlitch > 0 ? 0 : opacity;\n};","path":null,"size_bytes":670,"size_tokens":null},"client/src/components/ui/HUD/ControlsHint.tsx":{"content":"// src/components/ControlsHint.tsx\nimport React from 'react';\n\nexport function ControlsHint() {\n  return (\n    <div className=\"absolute bottom-4 w-full text-center text-white/20 text-xs\">\n      KEYS: [W] [O] [E] [I] FOR SOUNDPADS // [Q] [P] FOR DECKS\n    </div>\n  );\n}","path":null,"size_bytes":268,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3835,"size_tokens":null},"client/src/components/game/loaders/ErrorLogViewer.tsx":{"content":"// src/components/ErrorLogViewer.tsx\nimport React, { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown } from 'lucide-react';\nimport { useErrorLogs } from '@/hooks/useErrorLogs';\nimport { NoteStatsSection } from './NoteStatsSection';\nimport { RenderAndHitStatsSection } from './RenderAndHitStatsSection';\nimport { FailureBreakdownSection } from './FailureBreakdownSection';\nimport { AnimationStatsSection } from './AnimationStatsSection';\nimport { ErrorCountsSection } from './ErrorCountsSection';\nimport { ErrorListSection } from './ErrorListSection';\n\nexport function ErrorLogViewer() {\n  const [isOpen, setIsOpen] = useState(false);\n  const {\n    errors,\n    animations,\n    noteCounts: errorCounts,\n    noteStats,\n    renderStats,\n    hitStats,\n    animationStats,\n    downloadUnifiedLogs,\n    clearLogs,\n  } = useErrorLogs();\n\n  return (\n    <motion.div\n      className=\"fixed bottom-4 right-4 z-50 pointer-events-auto\"\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n    >\n      {/* Toggle Button */}\n      <motion.button\n        onClick={() => setIsOpen(!isOpen)}\n        className=\"bg-gray-900 border border-cyan-500 text-cyan-400 px-3 py-2 rounded text-sm font-mono flex items-center gap-2 hover:bg-gray-800 transition\"\n        whileHover={{ scale: 1.05 }}\n        whileTap={{ scale: 0.95 }}\n        data-testid=\"button-toggle-error-log\"\n      >\n        <span>Logs</span>\n        <ChevronDown\n          size={16}\n          className={`transition-transform ${isOpen ? 'rotate-180' : ''}`}\n        />\n      </motion.button>\n      {/* Log Panel */}\n      <AnimatePresence>\n        {isOpen && (\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: 20 }}\n            className=\"absolute bottom-12 right-0 bg-gray-950 border border-cyan-500 rounded-lg w-96 h-96 flex flex-col shadow-2xl\"\n            data-testid=\"panel-error-log-viewer\"\n          >\n            <div className=\"flex-1 overflow-y-auto flex flex-col gap-3 p-4\">\n              <NoteStatsSection noteStats={noteStats} />\n              <RenderAndHitStatsSection renderStats={renderStats} hitStats={hitStats} />\n              <FailureBreakdownSection hitStats={hitStats} />\n              <AnimationStatsSection animationStats={animationStats} animations={animations} />\n              <ErrorCountsSection errorCounts={errorCounts} />\n              <ErrorListSection errors={errors} />\n            </div>\n            {/* Controls - Fixed at bottom */}\n            <div className=\"border-t border-cyan-500/30 p-4 bg-gray-950 space-y-2 flex-shrink-0\">\n              <div className=\"flex gap-2 text-xs\">\n                <button\n                  onClick={downloadUnifiedLogs}\n                  className=\"flex-1 bg-cyan-600 hover:bg-cyan-500 text-white px-2 py-1 rounded transition\"\n                  data-testid=\"button-download-logs\"\n                  title=\"Download unified diagnostic logs (JSON)\"\n                >\n                  Download All Logs\n                </button>\n                <button\n                  onClick={clearLogs}\n                  className=\"flex-1 bg-red-600 hover:bg-red-500 text-white px-2 py-1 rounded transition\"\n                  data-testid=\"button-clear-logs\"\n                >\n                  Clear\n                </button>\n              </div>\n              <div className=\"text-xs text-gray-500 text-center\">\n                Updated: {new Date().toLocaleTimeString()}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n","path":null,"size_bytes":3654,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/lib/notes/processors/noteAutoFailHelpers.ts":{"content":"import { Note, GameConfig } from '@/lib/engine/gameTypes';\nimport { ScoringManager } from '@/lib/managers/scoringManager';\nimport { roundTime } from './noteUpdateHelpers';\nimport { GameErrors } from '@/lib/errors/errorLog';\nimport type { NoteUpdateResult } from './noteUpdateHelpers';\n\nexport const checkTapAutoFail = (\n  note: Note,\n  currentTime: number,\n  config: GameConfig,\n  scorer: ScoringManager\n): NoteUpdateResult | null => {\n  const autoFailThreshold = note.time + config.TAP_HIT_WINDOW + config.TAP_FAILURE_BUFFER;\n  if (currentTime <= autoFailThreshold) return null;\n\n  GameErrors.updateHitStats({ tapMissFailures: (GameErrors.hitStats.tapMissFailures || 0) + 1 });\n  GameErrors.log(`[TAP-MISS] noteId=${note.id} tapMissFailure at ${currentTime}ms`, currentTime);\n  return {\n    updatedNote: {\n      ...note,\n      tapMissFailure: true,\n      failureTime: roundTime(currentTime),\n    },\n    scoreChange: scorer.recordMiss(),\n    success: false,\n  };\n};\n\nexport const checkHoldAutoFail = (\n  note: Note,\n  currentTime: number,\n  config: GameConfig,\n  scorer: ScoringManager\n): NoteUpdateResult | null => {\n  // Never pressed\n  if (!note.pressHoldTime && currentTime > note.time + config.HOLD_MISS_TIMEOUT) {\n    GameErrors.updateHitStats({ holdMissFailures: (GameErrors.hitStats.holdMissFailures || 0) + 1 });\n    GameErrors.log(`[HOLD-MISS] noteId=${note.id} holdMissFailure at ${currentTime}ms (never pressed)`, currentTime);\n    return {\n      updatedNote: {\n        ...note,\n        holdMissFailure: true,\n        failureTime: roundTime(currentTime),\n      },\n      scoreChange: scorer.recordMiss(),\n      success: false,\n    };\n  }\n\n  // Pressed but never released (timeout)\n  if (note.pressHoldTime && note.pressHoldTime > 0 && !note.hit) {\n    const noteHoldDuration = note.duration || 1000;\n    const releaseFailThreshold = note.pressHoldTime + noteHoldDuration + config.HOLD_RELEASE_OFFSET;\n    if (currentTime > releaseFailThreshold) {\n      GameErrors.updateHitStats({ holdReleaseFailures: (GameErrors.hitStats.holdReleaseFailures || 0) + 1 });\n      GameErrors.log(`[HOLD-RELEASE] noteId=${note.id} holdReleaseFailure at ${currentTime}ms`, currentTime);\n      return {\n        updatedNote: {\n          ...note,\n          holdReleaseFailure: true,\n          failureTime: roundTime(currentTime),\n        },\n        scoreChange: scorer.recordMiss(),\n        success: false,\n      };\n    }\n  }\n\n  return null;\n};\n","path":null,"size_bytes":2433,"size_tokens":null},"client/src/components/game/Down3DNoteLane.tsx":{"content":"// src/components/Down3DNoteLane.tsx\nimport React, { memo, useEffect } from \"react\";\nimport { VANISHING_POINT_X, VANISHING_POINT_Y } from '@/lib/config/gameConstants';\nimport { useVanishingPointOffset } from '@/hooks/useVanishingPointOffset';\nimport { useGameStore } from '@/stores/useGameStore';\nimport { TunnelBackground } from './tunnel/TunnelBackground';\nimport { SoundpadButtons } from './hud/SoundpadButtons';\nimport { JudgementLines } from './tunnel/JudgementLines';\nimport { HoldNotes } from './notes/HoldNotes';\nimport { TapNotes } from './notes/TapNotes';\n\ninterface Down3DNoteLaneProps {\n  health?: number;\n  combo?: number;\n  onPadHit?: (lane: number) => void;\n}\n\nconst Down3DNoteLaneComponent = ({\n  health: propHealth,\n  combo: propCombo,\n  onPadHit\n}: Down3DNoteLaneProps = {}) => {\n  // Select atomic values to prevent unnecessary re-renders\n  const health = useGameStore(state => propHealth ?? state.health);\n  const combo = useGameStore(state => propCombo ?? state.combo);\n\n  const vpOffset = useVanishingPointOffset();\n  \n  const vpX = VANISHING_POINT_X + vpOffset.x;\n  const vpY = VANISHING_POINT_Y + vpOffset.y;\n  const hexCenterX = VANISHING_POINT_X;\n  const hexCenterY = VANISHING_POINT_Y;\n\n  useEffect(() => {\n    if (combo > 0 && combo % 5 === 0) {\n      console.log(\n        `[VP-RENDER] Combo ${combo}: vpOffset=[${vpOffset.x.toFixed(1)}, ${vpOffset.y.toFixed(1)}] â†’ vpX=${vpX.toFixed(1)}, vpY=${vpY.toFixed(1)}`\n      );\n    }\n  }, [vpOffset, combo, vpX, vpY]);\n\n  return (\n    <div className=\"relative w-full h-full flex items-center justify-center overflow-hidden\" data-testid=\"down3d-note-lane\">\n      <TunnelBackground vpX={vpX} vpY={vpY} hexCenterX={hexCenterX} hexCenterY={hexCenterY} health={health} />\n      <SoundpadButtons vpX={vpX} vpY={vpY} onPadHit={onPadHit} />\n      <JudgementLines vpX={vpX} vpY={vpY} type=\"tap\" />\n      <HoldNotes vpX={vpX} vpY={vpY} />\n      <JudgementLines vpX={vpX} vpY={vpY} type=\"hold\" />\n      <TapNotes vpX={vpX} vpY={vpY} />\n    </div>\n  );\n};\n\nexport const Down3DNoteLane = memo(Down3DNoteLaneComponent);","path":null,"size_bytes":2078,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      \"p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2859,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/stores/useShakeStore.ts":{"content":"import { create } from 'zustand';\n\nexport interface ShakeStoreState {\n  shakeOffset: { x: number; y: number };\n  setShakeOffset: (offset: { x: number; y: number }) => void;\n}\n\nexport const useShakeStore = create<ShakeStoreState>((set) => ({\n  shakeOffset: { x: 0, y: 0 },\n\n  setShakeOffset: (shakeOffset) => set({ shakeOffset }),\n}));\n","path":null,"size_bytes":335,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/stores/useGameDebuggerStore.ts":{"content":"import { create } from 'zustand';\nimport { FailureType } from '@/types/gameDebugTypes';\n\nexport interface AnimationTrackingEntry {\n  noteId: string;\n  type: FailureType;\n  failureTime?: number;\n  completed: boolean;\n}\n\nexport interface NoteStatsType {\n  total: number;\n  tap: number;\n  hold: number;\n  hit: number;\n  missed: number;\n  failed: number;\n  byLane: Record<number, number>;\n}\n\nexport interface HitStatsType {\n  successfulHits: number;\n  tapTooEarlyFailures: number;\n  tapMissFailures: number;\n  tooEarlyFailures: number;\n  holdMissFailures: number;\n  holdReleaseFailures: number;\n}\n\nexport interface RenderStatsType {\n  rendered: number;\n  preMissed: number;\n}\n\nexport interface LogEntry {\n  message: string;\n  timestamp: number; // milliseconds since game start\n}\n\nexport interface GameDebuggerStoreState {\n  notes: (string | LogEntry)[];\n  animations: AnimationTrackingEntry[];\n  noteStats: NoteStatsType;\n  renderStats: RenderStatsType;\n  hitStats: HitStatsType;\n  gameStartTime?: number;\n\n  log: (msg: string, gameTime?: number) => void;\n  trackAnimation: (noteId: string, type: FailureType, failureTime?: number) => void;\n  updateAnimation: (noteId: string, updates: Partial<AnimationTrackingEntry>) => void;\n  updateNoteStats: (notes: any[]) => void;\n  updateRenderStats: (rendered: number, preMissed: number) => void;\n  updateHitStats: (stats: Partial<HitStatsType>) => void;\n  reset: () => void;\n}\n\nexport const useGameDebuggerStore = create<GameDebuggerStoreState>((set) => ({\n  notes: [],\n  animations: [],\n  noteStats: { total: 0, tap: 0, hold: 0, hit: 0, missed: 0, failed: 0, byLane: {} },\n  renderStats: { rendered: 0, preMissed: 0 },\n  hitStats: { successfulHits: 0, tapTooEarlyFailures: 0, tapMissFailures: 0, tooEarlyFailures: 0, holdMissFailures: 0, holdReleaseFailures: 0 },\n  gameStartTime: undefined,\n\n  log: (msg, gameTime) => {\n    set((state) => ({ \n      notes: [...state.notes, { \n        message: msg, \n        timestamp: gameTime ?? performance.now() \n      }] \n    }));\n  },\n\n  trackAnimation: (noteId, type, failureTime) => {\n    set((state) => ({\n      animations: [...state.animations, { noteId, type, failureTime, completed: false }],\n    }));\n  },\n\n  updateAnimation: (noteId, updates) => {\n    set((state) => ({\n      animations: state.animations.map((a) =>\n        a.noteId === noteId ? { ...a, ...updates } : a\n      ),\n    }));\n  },\n\n  updateNoteStats: (notes) => {\n    const stats: NoteStatsType = { total: 0, tap: 0, hold: 0, hit: 0, missed: 0, failed: 0, byLane: {} };\n    notes.forEach((note) => {\n      stats.total++;\n      if (note.type === 'TAP') stats.tap++;\n      else stats.hold++;\n      if (note.hit) stats.hit++;\n      if (note.missed) stats.missed++;\n      if (note.failed) stats.failed++;\n      stats.byLane[note.lane] = (stats.byLane[note.lane] || 0) + 1;\n    });\n    set({ noteStats: stats });\n  },\n\n  updateRenderStats: (rendered, preMissed) => {\n    set({ renderStats: { rendered, preMissed } });\n  },\n\n  updateHitStats: (stats) => {\n    set((state) => ({\n      hitStats: { ...state.hitStats, ...stats },\n    }));\n  },\n\n  reset: () => {\n    set({\n        notes: [],\n        animations: [],\n        noteStats: { total: 0, tap: 0, hold: 0, hit: 0, missed: 0, failed: 0, byLane: {} },\n        renderStats: { rendered: 0, preMissed: 0 },\n        hitStats: { successfulHits: 0, tapTooEarlyFailures: 0, tapMissFailures: 0, tooEarlyFailures: 0, holdMissFailures: 0, holdReleaseFailures: 0 },\n        gameStartTime: undefined,\n    });\n  }\n}));\n","path":null,"size_bytes":3503,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8608,"size_tokens":null},"client/src/components/game/notes/HoldNotes.tsx":{"content":"import React, { memo, useCallback } from 'react';\nimport { HoldNote } from './HoldNote';\nimport { useHoldNotes } from '@/hooks/useHoldNotes';\nimport { useGameStore } from '@/stores/useGameStore';\nimport { TUNNEL_CONTAINER_WIDTH, TUNNEL_CONTAINER_HEIGHT, LEAD_TIME, REFERENCE_BPM } from '@/lib/config/gameConstants';\n\ninterface HoldNotesProps {\n  vpX?: number;\n  vpY?: number;\n}\n\nconst HoldNotesComponent = ({ vpX: propVpX = 350, vpY: propVpY = 300 }: HoldNotesProps) => {\n  // Split selectors to prevent unnecessary object creation and re-renders\n  const notes = useGameStore(state => state.notes || []);\n  const currentTime = useGameStore(state => state.currentTime);\n  const beatmapBpm = useGameStore(state => state.beatmapBpm) || 120;\n\n  const visibleNotes = React.useMemo(() => {\n    if (!notes || !Array.isArray(notes)) return [];\n    \n    // effectiveLEAD_TIME scales with BPM to prevent note stacking on fast songs\n    const effectiveLEAD_TIME = LEAD_TIME * (REFERENCE_BPM / Math.max(1, beatmapBpm));\n    \n    const holdNotes = notes.filter(n => n.type === 'HOLD' || n.type === 'SPIN_LEFT' || n.type === 'SPIN_RIGHT');\n    const tapNotes = notes.filter(n => n.type === 'TAP');\n    \n    return notes.filter(n => {\n      // For hold notes, check visibility based on note.time + note.duration, not just note.time\n      const isHoldNote = n.type === 'HOLD' || n.type === 'SPIN_LEFT' || n.type === 'SPIN_RIGHT';\n      const holdDuration = isHoldNote ? (n.duration || 1000) : 0;\n      const noteStartTime = n.time;\n      const noteEndTime = isHoldNote ? n.time + holdDuration : n.time;\n      \n      if (n.tooEarlyFailure) return noteStartTime <= currentTime + effectiveLEAD_TIME && noteStartTime >= currentTime - 4000;\n      if (n.holdMissFailure || n.holdReleaseFailure) return noteStartTime <= currentTime + effectiveLEAD_TIME && noteStartTime >= currentTime - 2000;\n      \n      // For hold notes: keep visible from effectiveLEAD_TIME before start to 500ms after end\n      // Upper bound: effectiveLEAD_TIME before start (so it appears at vanishing point)\n      // Lower bound: 500ms after it ends (holdDuration past start)\n      if (isHoldNote) {\n        const isVisible = noteStartTime <= currentTime + effectiveLEAD_TIME && noteEndTime >= currentTime - 500;\n        return isVisible;\n      }\n      \n      // For normal tap notes: keep visible from effectiveLEAD_TIME before start to 500ms after start\n      return noteStartTime <= currentTime + effectiveLEAD_TIME && noteStartTime >= currentTime - 500;\n    });\n  }, [notes, currentTime, beatmapBpm]);\n\n  const processedNotes = useHoldNotes(visibleNotes, currentTime);\n\n  return (\n    <svg \n      className=\"absolute inset-0\" \n      data-testid=\"hold-notes-container\"\n      style={{ width: `${TUNNEL_CONTAINER_WIDTH}px`, height: `${TUNNEL_CONTAINER_HEIGHT}px`, opacity: 1, pointerEvents: 'none', margin: '0 auto' }}\n    >\n      {processedNotes.map((noteData: any) => (\n        <HoldNote key={noteData.note.id} noteData={noteData} vpX={propVpX} vpY={propVpY} />\n      ))}\n    </svg>\n  );\n};\n\nexport const HoldNotes = memo(HoldNotesComponent);\n","path":null,"size_bytes":3098,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5124,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1828,"size_tokens":null},"client/src/components/game/tunnel/HexagonLayers.tsx":{"content":"// src/components/HexagonLayers.tsx\nimport React from 'react';\nimport { HEXAGON_RADII } from '@/lib/config/gameConstants';\n\ninterface HexagonLayersProps {\n  rayColor: string;\n  vpX: number;\n  vpY: number;\n  hexCenterX: number;\n  hexCenterY: number;\n}\n\nexport function HexagonLayers({ rayColor, vpX, vpY, hexCenterX, hexCenterY }: HexagonLayersProps) {\n  const maxRadius = HEXAGON_RADII[HEXAGON_RADII.length - 1];\n  return (\n    <>\n      {HEXAGON_RADII.map((radius, idx) => {\n        const progress = radius / maxRadius;\n        const centerX = idx === HEXAGON_RADII.length - 1 ? hexCenterX : vpX;\n        const centerY = idx === HEXAGON_RADII.length - 1 ? hexCenterY : vpY;\n        const points = Array.from({ length: 6 }).map((_, i) => {\n          const angle = (i * 60 * Math.PI) / 180;\n          const x = centerX + radius * Math.cos(angle);\n          const y = centerY + radius * Math.sin(angle);\n          return `${x},${y}`;\n        }).join(' ');\n        const strokeWidth = 0.3 + progress * 3.5;\n        const opacity = 0.08 + progress * 0.22;\n        return (\n          <polygon \n            key={`tunnel-hexagon-${idx}`} \n            points={points} \n            fill=\"none\" \n            stroke={rayColor} \n            strokeWidth={strokeWidth} \n            opacity={opacity} \n          />\n        );\n      })}\n    </>\n  );\n}","path":null,"size_bytes":1334,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"// src/hooks/useToast.ts\nimport * as React from \"react\";\nimport { useToastStore } from '@/stores/useToastStore';\nimport type { ToastActionElement, ToastProps } from \"@/components/ui/toast\";\n\ntype ToasterToast = ToastProps & {\n  id: string;\n  title?: React.ReactNode;\n  description?: React.ReactNode;\n  action?: ToastActionElement;\n};\n\ntype Toast = Omit<ToasterToast, \"id\">;\n\nexport function useToast() {\n  const { toasts, toast: addToast, dismiss } = useToastStore();\n\n  return {\n    toasts,\n    toast: (props: Toast) => addToast(props),\n    dismiss,\n  };\n}\n\nexport { toast } from '@/stores/useToastStore'; // Re-export toast function for direct use","path":null,"size_bytes":649,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/game/effects/ChromaticAberration.tsx":{"content":"// src/components/ChromaticAberration.tsx\nimport { motion } from 'framer-motion';\nimport { CHROMATIC_OFFSET_PX } from '@/lib/config/gameConstants';\n\ninterface ChromaticAberrationProps { intensity: number; }\n\nexport const ChromaticAberration: React.FC<ChromaticAberrationProps> = ({ intensity }) => (\n  <motion.div\n    className=\"absolute inset-0\"\n    initial={{ filter: 'none' }}\n    animate={{ \n      filter: `drop-shadow(${intensity * CHROMATIC_OFFSET_PX}px 0 0 rgb(255, 0, 127)) drop-shadow(${-intensity * CHROMATIC_OFFSET_PX}px 0 0 rgb(0, 255, 255))` \n    }}\n    transition={{ duration: 0.3 }} // CHROMATIC_DURATION / 1000\n  />\n);","path":null,"size_bytes":634,"size_tokens":null},"client/src/components/game/loaders/ErrorListSection.tsx":{"content":"// src/components/ErrorListSection.tsx\nimport React from 'react';\n\ninterface ErrorListSectionProps {\n  errors: (string | any)[];\n}\n\nexport const ErrorListSection: React.FC<ErrorListSectionProps> = ({ errors }) => {\n  // Display last 100 logs to show both render tracking and hit results\n  const displayLogs = errors.slice(-100);\n\n  return (\n    <div\n      className=\"bg-gray-900 rounded p-2 text-xs text-red-300 font-mono space-y-1 flex-1 overflow-y-auto\"\n      data-testid=\"list-error-messages\"\n    >\n      {displayLogs.length === 0 ? (\n        <div className=\"text-gray-500\">No events</div>\n      ) : (\n        displayLogs.map((entry, idx) => {\n          const msg = typeof entry === 'string' ? entry : entry.message || '';\n          const timestamp = typeof entry === 'string' ? '' : ` [${entry.timestamp?.toFixed(0) || '?'}ms]`;\n          return (\n            <div key={idx} className=\"truncate hover:text-red-200 break-words whitespace-pre-wrap\">\n              {msg}{timestamp}\n            </div>\n          );\n        })\n      )}\n    </div>\n  );\n};","path":null,"size_bytes":1053,"size_tokens":null},"client/src/lib/utils/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // @replit\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \",\n  {\n    variants: {\n      variant: {\n        default:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary:\n          // @replit no hover because we use hover-elevate\n          \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n          // @replit shadow-xs\" - use badge outline variable\n        outline: \"text-foreground border [border-color:var(--badge-outline)]\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1522,"size_tokens":null},"server/storage.ts":{"content":"import { type User, type InsertUser } from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\n\n// modify the interface with any CRUD methods\n// you might need\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User>;\n\n  constructor() {\n    this.users = new Map();\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(\n      (user) => user.username === username,\n    );\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = randomUUID();\n    const user: User = { ...insertUser, id };\n    this.users.set(id, user);\n    return user;\n  }\n}\n\nexport const storage = new MemStorage();\n","path":null,"size_bytes":993,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/hooks/useSyncedValue.ts":{"content":"// src/hooks/useSyncedValue.ts\nimport { useEffect, useRef, useState } from 'react';\nimport { StoreApi } from 'zustand';\n\nexport function useSyncedValue<T, State = any>(\n  store: StoreApi<State>,\n  selector: (state: State) => T,\n  interval: number,\n  isActive: boolean\n): T {\n  const [value, setValue] = useState<T>(() => selector(store.getState()));\n  const lastUpdateRef = useRef<number>(0);\n  const selectorRef = useRef(selector);\n  const unsubRef = useRef<(() => void) | null>(null);\n\n  useEffect(() => {\n    selectorRef.current = selector;\n  }, [selector]);\n\n  useEffect(() => {\n    if (!isActive) {\n      unsubRef.current?.();\n      unsubRef.current = null;\n      return;\n    }\n\n    // Immediate sync\n    const newValue = selectorRef.current(store.getState());\n    setValue(newValue);\n    lastUpdateRef.current = performance.now();\n\n    // Subscribe for reactive updates\n    unsubRef.current = store.subscribe(\n      (state: State) => {\n        const newVal = selectorRef.current(state);\n        setValue(newVal);\n        lastUpdateRef.current = performance.now();\n      }\n    );\n\n    // Fallback polling for non-reactive sources\n    const checkUpdate = () => {\n      const now = performance.now();\n      if (now - lastUpdateRef.current >= interval) {\n        const newValue = selectorRef.current(store.getState());\n        setValue(newValue);\n        lastUpdateRef.current = now;\n      }\n    };\n    const intervalId = setInterval(checkUpdate, interval);\n\n    return () => {\n      unsubRef.current?.();\n      clearInterval(intervalId);\n      unsubRef.current = null;\n    };\n  }, [store, interval, isActive]);\n\n  return value;\n}","path":null,"size_bytes":1632,"size_tokens":null},"client/src/hooks/useCountdown.ts":{"content":"// src/hooks/useCountdown.ts\nimport { useEffect, useRef } from 'react';\nimport { useGameStore } from '@/stores/useGameStore';\nimport { GameState } from '@/lib/engine/gameTypes';\n\ninterface UseCountdownProps {\n  gameState: GameState;\n  onCountdownComplete: () => void;\n  setPauseMenuOpen?: (open: boolean) => void;\n}\n\nexport function useCountdown({\n  gameState,\n  onCountdownComplete,\n  setPauseMenuOpen,\n}: UseCountdownProps): void {\n  const countdownSeconds = useGameStore(state => state.countdownSeconds);\n  const setCountdownSeconds = useGameStore(state => state.setCountdownSeconds);\n  const wasCountingDownRef = useRef(false);\n\n  // Track if we are actively counting down\n  useEffect(() => {\n    if (countdownSeconds > 0) {\n      wasCountingDownRef.current = true;\n    }\n  }, [countdownSeconds]);\n\n  // Ticking logic\n  useEffect(() => {\n    if (gameState !== 'PAUSED' || countdownSeconds === 0) return;\n\n    const interval = setInterval(() => {\n      const current = useGameStore.getState().countdownSeconds;\n      setCountdownSeconds(Math.max(current - 1, 0));\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, [gameState, countdownSeconds, setCountdownSeconds]);\n\n  // Completion logic\n  useEffect(() => {\n    // Only trigger completion if we were actually counting down and hit 0\n    if (countdownSeconds === 0 && gameState === 'PAUSED' && wasCountingDownRef.current) {\n      wasCountingDownRef.current = false;\n      setPauseMenuOpen?.(false);\n      onCountdownComplete();\n    }\n  }, [countdownSeconds, gameState, setPauseMenuOpen, onCountdownComplete]);\n}","path":null,"size_bytes":1577,"size_tokens":null},"replit.md":{"content":"# HYPERVERSE - Rhythm Game\n\n## Project Overview\nHYPERVERSE is a 3D rhythm game with beatmap loading, YouTube music sync, and deck-based hold note mechanics. Players interact with notes coming through a hexagonal tunnel visualization.\n\n**Status:** Active development - hold note geometry refinement phase\n\n---\n\n## Game Architecture\n\n### Screens\n1. **Home** (`pages/Home.tsx`)\n   - Beatmap/difficulty selection\n   - LOAD BEATMAP: Open loader for custom beatmaps\n   - LOAD NEW: Replace current beatmap with new one\n   - START SESSION: Launch game with selected difficulty\n   - Difficulty toggle: EASY, MEDIUM, HARD\n\n2. **Game** (`pages/Game.tsx`)\n   - Main gameplay loop\n   - 3D tunnel visualization with notes approaching\n   - Real-time score/combo/health display\n   - Pause menu, rewind, difficulty switching\n\n3. **Not Found** - 404 page\n\n### State Management\n- **Zustand** (`stores/useGameStore.ts`): Central game state\n  - Notes, score, combo, health, game state (IDLE/PLAYING/PAUSED)\n  - Current time sync with YouTube player\n  - Pause state management\n\n- **URL params**: Difficulty via query string\n\n### Data Flow\n1. User selects beatmap + difficulty on Home\n2. Beatmap text stored in `localStorage.pendingBeatmap` (raw text for re-parsing)\n3. Game component mounts with difficulty, re-parses beatmap\n4. Notes rendered based on time sync with YouTube player\n\n---\n\n## Core Systems\n\n### Beatmap System\n- **Input**: Raw text files (escaping-gravity.txt, lost-in-the-rhythm.txt, etc.)\n- **Parser** (`lib/beatmap/beatmapParser.ts`): Converts text to note objects\n- **Format**: [METADATA] + difficulty sections with TAP/HOLD notes\n- **Storage**: Full beatmap text in localStorage for re-parsing any difficulty\n\n### YouTube Integration\n- **Player**: Embedded iframe (persistent across screens)\n- **Sync**: `useYoutubePlayer` hook provides real-time video time\n- **Methods**: play(), pause(), seek(0), getCurrentTime()\n- **On Difficulty Change**: Game remounts with new key, seeks to 0, resets all state\n\n### 3D Tunnel Geometry\n- **Vanishing Point**: (350, 300) - center of screen\n- **Rays**: 6 lanes at angles [0Â°, 60Â°, 120Â°, 180Â°, 240Â°, 300Â°]\n- **Hexagon Radii**: [22, 52, 89, 135, 187, 248] - visual depth circles\n- **Judgement Radius**: 187 - where notes are tapped/held\n- **Approach Window**: Notes visible 2000ms before judgement (LEAD_TIME)\n\n### Note Types\n\n#### TAP Notes\n- Simple point notes (2D trapezoid)\n- Approach geometry calculated by `calculateTapNoteGeometry`\n- Perfect/Good/Bad timing windows\n\n#### HOLD Notes\n- Duration-based notes with start/end points\n- **Geometry States**:\n  1. **Approach Phase** (before pressed): Near end moves from vanishing point to judgement, far end maintains constant depth behind\n  2. **Collapse Phase** (after pressed/failed): Strip shrinks from both ends toward center\n  3. **Miss Failure**: Near end extends PAST judgement line (showing \"moving through\" user), far end stays at proper depth\n\n---\n\n## Recent Changes (Latest Session - Gameplay Tuning & YouTube Sync)\n\n### 1. Gameplay Balance Adjustments\n- **LOW_HEALTH_THRESHOLD**: 160 â†’ 50 (25% health)\n  - Glitch effect now only triggers when player in danger zone (last quarter health)\n  - Prevents visual noise during normal gameplay\n  - Glitch intensity still scales smoothly from 50â†’0 health via `glitchOpacityMultiplier`\n\n### 2. TAP Note Visibility Fix\n- **Removed**: `TAP_HIT_HOLD_DURATION` (confusing nomenclature - TAP notes aren't \"held\")\n- **Now uses**: `TAP_HIT_FLASH.DURATION` (600ms) for successful hit rendering\n- **Impact**: Notes stay visible for entire white flash animation (previously disappeared at 200ms, cutting flash short)\n\n### 3. YouTube Sync - YouTube-First Flow (Optimal)\n- **Strategy**: YouTube plays FIRST, then game starts (not the other way around)\n  - Ensures video is playing before any note timing begins\n  - Eliminates timing mismatches from delayed YouTube startup\n\n**Implementation:**\n- **Auto-start trigger** (when IDLE + notes loaded + YouTube ready):\n  - **With YouTube video**: Calls `onPlayYouTube()` â†’ `playYouTubeVideo()` â†’ waits for playing\n  - **Without YouTube**: Calls `startGame()` directly\n  \n- **YouTube playback confirmation** (`onPlaying` callback):\n  - Fires AFTER `playYouTubeVideo()` confirms `state === 1` (playing)\n  - Then calls `startGame()` â†’ game timer syncs to YouTube time\n  - Flow: `onPlayYouTube()` â†’ YouTube plays â†’ `onPlaying` fires â†’ `startGame()`\n\n- **Protection layers**:\n  - 800ms buffer in `useYouTubePlayer` before `youtubeIsReady` (iframe init)\n  - `playYouTubeVideo()` polls for playing confirmation (not just ready)\n  - Double-check prevents game starting before actual playback\n\n---\n\n## Current State\n\n### Working Features\nâœ… Beatmap loading (text + parsing)\nâœ… YouTube video sync\nâœ… Note rendering (TAP + HOLD)\nâœ… Difficulty switching with clean state reset\nâœ… Game state persistence across difficulty changes\nâœ… Hold note constant-width strip geometry\nâœ… Hold note miss failure extension past judgement\n\n### Known Issues / TODOs\n- Hold note far distance depth values at moment of miss (needs verification - currently set to maintain ~50+ distance from vanishing point)\n- Collapse animation timing may need tuning\n- Deck interaction system (left/right spin notes) - basic framework exists\n\n### Key Constants (See `lib/config/gameConstants.ts` for full annotations)\n- **JUDGEMENT_RADIUS**: 187 (distance where notes are judged)\n- **LEAD_TIME**: 4000ms (notes visible 4s before hit, appear at vanishing point)\n- **TAP_RENDER_WINDOW_MS**: 4000ms (TAP notes visible 4s before)\n- **TAP_FALLTHROUGH_WINDOW_MS**: 200ms (visible 200ms past judgement line)\n- **TAP_HIT_FLASH.DURATION**: 600ms (successful hit white flash visibility)\n- **HOLD_NOTE_STRIP_WIDTH_MULTIPLIER**: 0.15 (duration ms â†’ visual width px)\n- **FAILURE_ANIMATION_DURATION**: 1100ms (glitch effect on missed hold)\n- **TAP_HIT_WINDOW**: Â±150ms (successful tap window around note.time)\n- **HOLD_HIT_WINDOW**: Â±150ms (successful hold press window)\n- **HOLD_MISS_TIMEOUT**: 500ms (after note.time before auto-fail)\n- **LOW_HEALTH_THRESHOLD**: 50 (25% health - triggers glitch effect)\n- **MAX_HEALTH**: 200\n- **YOUTUBE_BUFFER**: 800ms (delay before auto-start for YouTube initialization)\n\n---\n\n## Files Structure\n```\nclient/src/\nâ”œâ”€â”€ pages/                  # Screen components\nâ”‚   â”œâ”€â”€ Home.tsx\nâ”‚   â”œâ”€â”€ Game.tsx\nâ”‚   â””â”€â”€ not-found.tsx\nâ”œâ”€â”€ components/\nâ”‚   â”œâ”€â”€ game/\nâ”‚   â”‚   â”œâ”€â”€ Down3DNoteLane.tsx    # Main game viewport\nâ”‚   â”‚   â”œâ”€â”€ notes/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ TapNotes.tsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ HoldNotes.tsx\nâ”‚   â”‚   â”‚   â””â”€â”€ HoldNote.tsx\nâ”‚   â”‚   â””â”€â”€ TunnelBackground.tsx\nâ”‚   â””â”€â”€ loaders/BeatmapLoader.tsx\nâ”œâ”€â”€ lib/\nâ”‚   â”œâ”€â”€ beatmap/           # Parsing & conversion\nâ”‚   â”‚   â”œâ”€â”€ beatmapParser.ts\nâ”‚   â”‚   â””â”€â”€ beatmapConverter.ts\nâ”‚   â”œâ”€â”€ geometry/          # 3D calculations\nâ”‚   â”‚   â””â”€â”€ holdNoteGeometry.ts\nâ”‚   â”œâ”€â”€ youtube/           # YouTube integration\nâ”‚   â”‚   â”œâ”€â”€ youtubeSeek.ts\nâ”‚   â”‚   â”œâ”€â”€ youtubePlay.ts\nâ”‚   â”‚   â””â”€â”€ [others]\nâ”‚   â”œâ”€â”€ notes/             # Note rendering logic\nâ”‚   â”‚   â”œâ”€â”€ tap/\nâ”‚   â”‚   â””â”€â”€ hold/\nâ”‚   â”‚       â”œâ”€â”€ holdNoteStyle.ts\nâ”‚   â”‚       â”œâ”€â”€ holdGreystate.ts\nâ”‚   â”‚       â””â”€â”€ holdNoteHelpers.ts\nâ”‚   â””â”€â”€ config/\nâ”‚       â””â”€â”€ gameConstants.ts\nâ”œâ”€â”€ stores/\nâ”‚   â””â”€â”€ useGameStore.ts    # Zustand state management\nâ”œâ”€â”€ hooks/\nâ”‚   â”œâ”€â”€ useGameLogic.ts    # Main game engine\nâ”‚   â”œâ”€â”€ useYoutubePlayer.ts\nâ”‚   â”œâ”€â”€ useHoldNotes.ts\nâ”‚   â””â”€â”€ [others]\nâ””â”€â”€ App.tsx\n```\n\n---\n\n## Next Steps / Development Priorities\n1. **Verify hold note far distance values** - ensure they're realistic for all hold durations\n2. **Test miss failure visual** - confirm near end extends properly and collapses correctly\n3. **Deck mechanics** - implement left/right spin note interactions\n4. **Visual polish** - particle effects, color schemes, animations\n5. **Sound effects** - tap/hit/miss audio feedback\n6. **Performance optimization** - render pipeline profiling\n\n---\n\n## Session Context (Latest Work - Gameplay Tuning & YouTube Sync Optimization)\n\n### Gameplay Balance\n- âœ… Reduced low health glitch threshold from 80% â†’ 25% for better game feel\n- âœ… Fixed TAP note flash visibility (now shows full 600ms animation, not cut at 200ms)\n\n### YouTube Synchronization - Optimal Flow\n- âœ… Restructured to YouTube-first: video plays before game starts\n- âœ… Auto-start now triggers YouTube playback (not game start)\n- âœ… Game starts via onPlaying callback AFTER YouTube confirms playing\n- âœ… Flow: Auto-start â†’ YouTube plays â†’ onPlaying confirms â†’ game starts (perfectly synced)\n\n### Previous Sessions\n- âœ… Fixed difficulty switching: Game component remounts with new key while iFrame persists\n- âœ… Fixed YouTube seek on difficulty change: Now properly awaits async seek(0)\n- âœ… Fixed hold note geometry: Constant-width strip instead of collapsing triangle\n- âœ… Fixed miss failure: Near end extends past judgement, far end maintains depth\n","path":null,"size_bytes":9218,"size_tokens":null}},"version":2}